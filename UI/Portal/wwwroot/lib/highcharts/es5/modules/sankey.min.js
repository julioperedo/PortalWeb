!function(t){"object"==typeof module&&module.exports?module.exports=t.default=t:"function"==typeof define&&define.amd?define("highcharts/modules/sankey",["highcharts"],function(o){return t(o),t.Highcharts=o,t}):t("undefined"!=typeof Highcharts?Highcharts:void 0)}(function(o){"use strict";o=o?o._modules:{};function t(o,t,e,i){o.hasOwnProperty(t)||(o[t]=i.apply(null,e),"function"==typeof CustomEvent&&window.dispatchEvent(new CustomEvent("HighchartsModuleLoaded",{detail:{path:t,module:o[t]}})))}t(o,"Series/NodesComposition.js",[o["Core/Series/SeriesRegistry.js"],o["Core/Utilities.js"]],function(o,e){var t,i,o=o.series,n=o.prototype,d=o.prototype.pointClass.prototype,r=e.defined,s=e.extend,a=e.find,p=e.merge,h=e.pick;return o=t=t||{},i=[],o.compose=function(o,t){return e.pushUnique(i,o)&&((o=o.prototype).setNodeState=u,o.setState=u,o.update=f),e.pushUnique(i,t)&&((o=t.prototype).destroy=l,o.setData=c),t},o.createNode=function(o){function t(o,t){return a(o,function(o){return o.id===t})}var e,n,i=this.pointClass,r=t(this.nodes,o);return r||(e=this.options.nodes&&t(this.options.nodes,o),(n=(new i).init(this,s({className:"highcharts-node",isNode:!0,id:o,y:1},e))).linksTo=[],n.linksFrom=[],n.getSum=function(){var t=0,e=0;return n.linksTo.forEach(function(o){t+=o.weight||0}),n.linksFrom.forEach(function(o){e+=o.weight||0}),Math.max(t,e)},n.offset=function(o,t){for(var e=0,i=0;i<n[t].length;i++){if(n[t][i]===o)return e;e+=n[t][i].weight}},n.hasShape=function(){var t=0;return n.linksTo.forEach(function(o){o.outgoing&&t++}),!n.linksTo.length||t!==n.linksTo.length},n.index=this.nodes.push(n)-1,r=n),r.formatPrefix="node",r.name=r.name||r.options.id||"",r.mass=h(r.options.mass,r.options.marker&&r.options.marker.radius,this.options.marker&&this.options.marker.radius,4),r},o.destroy=l,o.generatePoints=function(){var t=this,e=this.chart,i={};n.generatePoints.call(this),this.nodes||(this.nodes=[]),this.colorCounter=0,this.nodes.forEach(function(o){o.linksFrom.length=0,o.linksTo.length=0,o.level=o.options.level}),this.points.forEach(function(o){r(o.from)&&(i[o.from]||(i[o.from]=t.createNode(o.from)),i[o.from].linksFrom.push(o),o.fromNode=i[o.from],e.styledMode?o.colorIndex=h(o.options.colorIndex,i[o.from].colorIndex):o.color=o.options.color||i[o.from].color),r(o.to)&&(i[o.to]||(i[o.to]=t.createNode(o.to)),i[o.to].linksTo.push(o),o.toNode=i[o.to]),o.name=o.name||o.id},this),this.nodeLookup=i},o.setNodeState=u,o.updateNode=f,t;function l(){return this.data=[].concat(this.points||[],this.nodes),n.destroy.apply(this,arguments)}function c(){this.nodes&&(this.nodes.forEach(function(o){o.destroy()}),this.nodes.length=0),n.setData.apply(this,arguments)}function u(o){var t=arguments,e=this.isNode?this.linksTo.concat(this.linksFrom):[this.fromNode,this.toNode];"select"!==o&&e.forEach(function(o){o&&o.series&&(d.setState.apply(o,t),o.isNode||(o.fromNode.graphic&&d.setState.apply(o.fromNode,t),o.toNode&&o.toNode.graphic&&d.setState.apply(o.toNode,t)))}),d.setState.apply(this,t)}function f(o,t,e,i){var n=this,r=this.series.options.nodes,s=this.series.options.data,a=s&&s.length||0,l=s&&s[this.index];d.update.call(this,o,!this.isNode&&t,e,i),this.isNode&&(o=(r||[]).reduce(function(o,t,e){return n.id===t.id?e:o},-1),i=p(r&&r[o]||{},s&&s[this.index]||{}),s&&(l?s[this.index]=l:s.length=a),r?0<=o?r[o]=i:r.push(i):this.series.options.nodes=[i],h(t,!0)&&this.series.chart.redraw(e))}}),t(o,"Series/Sankey/SankeyPoint.js",[o["Core/Series/Point.js"],o["Core/Series/SeriesRegistry.js"],o["Core/Utilities.js"]],function(e,o,t){var i,n,r=this&&this.__extends||(i=function(o,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,t){o.__proto__=t}||function(o,t){for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&(o[e]=t[e])})(o,t)},function(o,t){if("function"!=typeof t&&null!==t)throw TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=o}i(o,t),o.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}),o=o.seriesTypes.column,s=t.defined;return n=o.prototype.pointClass,r(a,n),a.prototype.applyOptions=function(o,t){return e.prototype.applyOptions.call(this,o,t),s(this.options.level)&&(this.options.column=this.column=this.options.level),this},a.prototype.getClassName=function(){return(this.isNode?"highcharts-node ":"highcharts-link ")+e.prototype.getClassName.call(this)},a.prototype.getFromNode=function(){for(var o,t=-1,e=0;e<this.linksTo.length;e++){var i=this.linksTo[e];i.fromNode.column>t&&i.fromNode!==this&&(t=(o=i.fromNode).column)}return{fromNode:o,fromColumn:t}},a.prototype.setNodeColumn=function(){s(this.options.column)||(0===this.linksTo.length?this.column=0:this.column=this.getFromNode().fromColumn+1)},a.prototype.isValid=function(){return this.isNode||"number"==typeof this.weight},a;function a(){var o=null!==n&&n.apply(this,arguments)||this;return o.className=void 0,o.fromNode=void 0,o.level=void 0,o.linkBase=void 0,o.linkColorMode=void 0,o.linksFrom=void 0,o.linksTo=void 0,o.mass=void 0,o.nodeX=void 0,o.nodeY=void 0,o.options=void 0,o.series=void 0,o.toNode=void 0,o}}),t(o,"Series/Sankey/SankeySeriesDefaults.js",[],function(){return{borderWidth:0,colorByPoint:!0,curveFactor:.33,dataLabels:{enabled:!0,backgroundColor:"none",crop:!1,nodeFormat:void 0,nodeFormatter:function(){return this.point.name},format:void 0,formatter:function(){},inside:!0},inactiveOtherPoints:!0,linkColorMode:"from",linkOpacity:.5,opacity:1,minLinkWidth:0,nodeAlignment:"center",nodeWidth:20,nodePadding:10,showInLegend:!1,states:{hover:{linkOpacity:1,opacity:1},inactive:{linkOpacity:.1,opacity:.1,animation:{duration:50}}},tooltip:{followPointer:!0,headerFormat:'<span style="font-size: 0.8em">{series.name}</span><br/>',pointFormat:"{point.fromNode.name} â†’ {point.toNode.name}: <b>{point.weight}</b><br/>",nodeFormat:"{point.name}: <b>{point.sum}</b><br/>"}}}),t(o,"Series/Sankey/SankeyColumnComposition.js",[o["Core/Utilities.js"]],function(o){var e,h=o.defined,c=(o.pushUnique,o.relativeLength),t=o={compose:function(o,t){return o.sankeyColumn=new e(o,t),o}};return i.prototype.getTranslationFactor=function(o){for(var t,e,i=this.points,n=i.slice(),r=o.chart,s=o.options.minLinkWidth||0,a=0,l=(r.plotSizeY||0)-(o.options.borderWidth||0)-(i.length-1)*o.nodePadding;i.length;){for(a=l/i.sankeyColumn.sum(),t=!1,e=i.length;e--;)i[e].getSum()*a<s&&(i.splice(e,1),l=Math.max(0,l-s),t=!0);if(!t)break}for(var d=i.length=0;d<n.length;d++){var p=n[d];i.push(p)}return a},i.prototype.top=function(e){var i=this.series,n=i.nodePadding,o=this.points.reduce(function(o,t){return 0<o&&(o+=n),o+Math.max(t.getSum()*e,i.options.minLinkWidth||0)},0);return{top:0,center:.5,bottom:1}[i.options.nodeAlignment||"center"]*((i.chart.plotSizeY||0)-o)},i.prototype.left=function(e){var i=this.series,o=i.chart,n=i.options.equalNodes,r=o.inverted?o.plotHeight:o.plotWidth,s=i.nodePadding,t=this.points.reduce(function(o,t){return 0<o&&(o+=s),o+(n?r/t.series.nodes.length-s:Math.max(t.getSum()*e,i.options.minLinkWidth||0))},0);return((o.plotSizeX||0)-Math.round(t))/2},i.prototype.sum=function(){return this.points.reduce(function(o,t){return o+t.getSum()},0)},i.prototype.offset=function(o,t){var e=this.points,i=this.series,n=i.nodePadding,r=0;if(i.is("organization")&&o.hangsFrom)return{absoluteTop:o.hangsFrom.nodeY};for(var s=0;s<e.length;s++){var a=e[s].getSum(),l=Math.max(a*t,i.options.minLinkWidth||0),d=o.options[i.chart.inverted?"offsetHorizontal":"offsetVertical"],p=o.options.offset||0,a=a?l+n:0;if(e[s]===o)return{relativeTop:r+(h(d)?c(d,l):c(p,a))};r+=a}},e=i,t.SankeyColumnAdditions=e,o;function i(o,t){this.points=o,this.series=t}}),t(o,"Series/TreeUtilities.js",[o["Core/Color/Color.js"],o["Core/Utilities.js"]],function(f,o){var h=o.extend,l=o.isArray,d=o.isNumber,p=o.isObject,c=o.merge,m=o.pick;return{getColor:function(o,t){var e,i,n,r=t.index,s=t.mapOptionsToLevel,a=t.parentColor,l=t.parentColorIndex,d=t.series,p=t.colors,h=t.siblings,c=d.points,u=d.chart.options.chart;return o&&(c=c[o.i],s=s[o.level]||{},c&&s.colorByPoint&&(e=c.index%(p?p.length:u.colorCount),n=p&&p[e]),d.chart.styledMode||(i=m(c&&c.options.color,s&&s.color,n,a&&((o=s&&s.colorVariation)&&"brightness"===o.key&&r&&h?f.parse(a).brighten(o.to*(r/h)).get():a),d.color)),n=m(c&&c.options.colorIndex,s&&s.colorIndex,e,l,t.colorIndex)),{color:i,colorIndex:n}},getLevelOptions:function(o){var n,t,e,r,i,s,a={};if(p(o))for(r=d(o.from)?o.from:1,s=o.levels,t={},n=p(o.defaults)?o.defaults:{},l(s)&&(t=s.reduce(function(o,t){var e,i;return p(t)&&d(t.level)&&(e=m((i=c({},t)).levelIsConstant,n.levelIsConstant),delete i.levelIsConstant,delete i.level,p(o[t=t.level+(e?0:r-1)])?c(!0,o[t],i):o[t]=i),o},{})),i=d(o.to)?o.to:1,e=0;e<=i;e++)a[e]=c({},n,p(t[e])?t[e]:{});return a},setTreeValues:function i(n,r){var o=r.before,t=r.idRoot,e=r.mapIdToNode[t],s=!1!==r.levelIsConstant,a=r.points[n.i],l=a&&a.options||{},d=[],p=0,s=(n.levelDynamic=n.level-(s?0:e.level),n.name=m(a&&a.name,""),n.visible=t===n.id||!0===r.visible,(n="function"==typeof o?o(n,r):n).children.forEach(function(o,t){var e=h({},r);h(e,{index:t,siblings:n.children.length,visible:n.visible}),o=i(o,e),d.push(o),o.visible&&(p+=o.val)}),m(l.value,p));return n.visible=0<=s&&(0<p||n.visible),n.children=d,n.childrenTotal=p,n.isLeaf=n.visible&&!p,n.val=s,n},updateRootId:function(o){var t;return p(o)&&(t=p(o.options)?o.options:{},t=m(o.rootNode,t.rootId,""),p(o.userOptions)&&(o.userOptions.rootId=t),o.rootNode=t),t}}}),t(o,"Series/Sankey/SankeySeries.js",[o["Core/Globals.js"],o["Series/NodesComposition.js"],o["Series/Sankey/SankeyPoint.js"],o["Series/Sankey/SankeySeriesDefaults.js"],o["Core/Series/SeriesRegistry.js"],o["Series/Sankey/SankeyColumnComposition.js"],o["Core/Color/Color.js"],o["Series/TreeUtilities.js"],o["Core/Utilities.js"]],function(o,i,t,e,n,r,a,s,l){var d,p,h=this&&this.__extends||(d=function(o,t){return(d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,t){o.__proto__=t}||function(o,t){for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&(o[e]=t[e])})(o,t)},function(o,t){if("function"!=typeof t&&null!==t)throw TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=o}d(o,t),o.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}),c=n.seriesTypes,u=c.column,c=c.line,M=a.parse,f=s.getLevelOptions,m=l.clamp,s=l.extend,v=l.isObject,y=l.merge,F=l.pick,g=l.relativeLength,k=l.stableSort,l=(h(C,p=u),C.getDLOptions=function(o){var t=v(o.optionsPoint)?o.optionsPoint.dataLabels:{};return y({style:{}},v(o.level)?o.level.dataLabels:{},t)},C.prototype.createNodeColumns=function(){for(var o=[],t=0,e=this.nodes;t<e.length;t++){var i=e[t];i.setNodeColumn(),o[i.column]||(o[i.column]=r.compose([],this)),o[i.column].push(i)}for(var n=0;n<o.length;n++)void 0===o[n]&&(o[n]=r.compose([],this));return o},C.prototype.order=function(o,t){if(void 0===o.level){o.level=t;for(var e=0,i=o.linksFrom;e<i.length;e++){var n=i[e];n.toNode&&this.order(n.toNode,t+1)}}},C.prototype.generatePoints=function(){if(i.generatePoints.apply(this,arguments),this.orderNodes){for(var o=0,t=this.nodes;o<t.length;o++){var e=t[o];0===e.linksTo.length&&this.order(e,0)}k(this.nodes,function(o,t){return o.level-t.level})}},C.prototype.getNodePadding=function(){var o,t=this.options.nodePadding||0;return t=this.nodeColumns&&(o=this.nodeColumns.reduce(function(o,t){return Math.max(o,t.length)},0))*t>this.chart.plotSizeY?this.chart.plotSizeY/o:t},C.prototype.hasData=function(){return!!this.processedXData.length},C.prototype.pointAttribs=function(o,t){if(!o)return{};var e=this,i=(o.isNode?o:o.fromNode).level,n=e.mapOptionsToLevel[i||0]||{},r=o.options,s=n.states&&n.states[t||""]||{},i=["colorByPoint","borderColor","borderWidth","linkOpacity","opacity"].reduce(function(o,t){return o[t]=F(s[t],r[t],n[t],e.options[t]),o},{}),t=F(s.color,r.color,(i.colorByPoint?o:n).color);return o.isNode?{fill:t,stroke:i.borderColor,"stroke-width":i.borderWidth,opacity:i.opacity}:{fill:a.parse(t).setOpacity(i.linkOpacity).get()}},C.prototype.drawTracker=function(){u.prototype.drawTracker.call(this,this.points),u.prototype.drawTracker.call(this,this.nodes)},C.prototype.drawPoints=function(){u.prototype.drawPoints.call(this,this.points),u.prototype.drawPoints.call(this,this.nodes)},C.prototype.drawDataLabels=function(){u.prototype.drawDataLabels.call(this,this.points),u.prototype.drawDataLabels.call(this,this.nodes)},C.prototype.translate=function(){this.processedXData||this.processData(),this.generatePoints(),this.nodeColumns=this.createNodeColumns(),this.nodeWidth=g(this.options.nodeWidth,this.chart.plotSizeX);var e=this,o=this.chart,t=this.options,i=this.nodeWidth,n=this.nodeColumns;this.nodePadding=this.getNodePadding(),this.translationFactor=n.reduce(function(o,t){return Math.min(o,t.sankeyColumn.getTranslationFactor(e))},1/0),this.colDistance=(o.plotSizeX-i-t.borderWidth)/Math.max(1,n.length-1),e.mapOptionsToLevel=f({from:1,levels:t.levels,to:n.length-1,defaults:{borderColor:t.borderColor,borderRadius:t.borderRadius,borderWidth:t.borderWidth,color:e.color,colorByPoint:t.colorByPoint,levelIsConstant:!0,linkColor:t.linkColor,linkLineWidth:t.linkLineWidth,linkOpacity:t.linkOpacity,states:t.states}});for(var r=0;r<n.length;r++)for(var s=n[r],a=0;a<s.length;a++){var l=s[a];e.translateNode(l,s)}for(var d=0,p=this.nodes;d<p.length;d++)for(var h=0,c=(l=p[d]).linksFrom;h<c.length;h++){var u=c[h];(u.weight||u.isNull)&&u.to&&(e.translateLink(u),u.allowShadow=!1)}},C.prototype.translateLink=function(e){function o(o,t){return t=o.offset(e,t)*C,Math.min(o.nodeY+t,o.nodeY+(o.shapeArgs&&o.shapeArgs.height||0)-w)}var t,i,n,r,s,a,l,d,p,h,c,u,f,m,v=e.fromNode,y=e.toNode,g=this.chart,k=g.inverted,C=this.translationFactor,S=this.options,b=F(e.linkColorMode,S.linkColorMode),S=(g.inverted?-this.colDistance:this.colDistance)*S.curveFactor,N=v.nodeX,x=y.nodeX,L=e.outgoing,w=Math.max(e.weight*C,this.options.minLinkWidth),P=o(v,"linksFrom"),T=o(y,"linksTo"),O=this.nodeWidth,j=N+O<x;g.inverted&&(P=g.plotSizeY-P,T=(g.plotSizeY||0)-T,O=-O,w=-w,j=x<N),e.shapeType="path",e.linkBase=[P,P+w,T,T+w],j&&"number"==typeof T?e.shapeArgs={d:[["M",N+O,P],["C",N+O+S,P,x-S,T,x,T],["L",x+(L?O:0),T+w/2],["L",x,T+w],["C",x-S,T+w,N+O+S,P+w,N+O,P+w],["Z"]]}:"number"==typeof T&&(j=g.plotHeight-P-w,L=x-20-w,f=(t=(S=N+O)+20)+w,s=(r=(j=(n=(i=(d=P)+w)+20)+j)+20)+w,p=i-.7*w,h=r+.7*w,c=(l=(a=T)+w)-.7*w,u=x-.7*w,m=S+.7*w,e.shapeArgs={d:[["M",S,d],["C",m,d,f,p,f,n],["L",f,j],["C",f,h,m,s,S,s],["L",x,s],["C",u,s,L,h,L,j],["L",L,d=l+20],["C",L,c,u,a,x,a],["L",x,l],["C",p=x-20,l,p,l,p,d],["L",p,j],["C",p,r,p,r,x,r],["L",S,r],["C",t,r,t,r,t,j],["L",t,n],["C",t,i,t,i,S,i],["Z"]]}),e.dlBox={x:N+(x-N+O)/2,y:P+(T-P)/2,height:w,width:0},e.tooltipPos=g.inverted?[g.plotSizeY-e.dlBox.y-w/2,g.plotSizeX-e.dlBox.x]:[e.dlBox.x,e.dlBox.y+w/2],e.y=e.plotY=1,e.x=e.plotX=1,e.options.color||("from"===b?e.color=v.color:"to"===b?e.color=y.color:"gradient"===b&&(f=M(v.color).get(),m=M(y.color).get(),e.color={linearGradient:{x1:1,x2:0,y1:0,y2:0},stops:[[0,k?f:m],[1,k?m:f]]}))},C.prototype.translateNode=function(o,t){var e=this.translationFactor,i=this.chart,n=this.options,r=n.borderRadius,s=n.borderWidth,s=void 0===s?0:s,a=o.getSum(),l=Math.max(Math.round(a*e),this.options.minLinkWidth),d=Math.round(this.nodeWidth),p=Math.round(s)%2/2,h=t.sankeyColumn.offset(o,e),t=Math.floor(F(h.absoluteTop,t.sankeyColumn.top(e)+h.relativeTop))+p,e=Math.floor(this.colDistance*o.column+s/2)+g(o.options[i.inverted?"offsetVertical":"offsetHorizontal"]||0,d)+p,h=i.inverted?i.plotSizeX-e:e;(o.sum=a)?(o.shapeType="roundedRect",s=o.nodeX=h,p=o.nodeY=t,e=o.options.width||n.width||d,a=o.options.height||n.height||l,r=m(g("object"==typeof r?r.radius:r||0,e),0,l/2),i.inverted&&(s=h-d,p=i.plotSizeY-t-l,e=o.options.height||n.height||d,a=o.options.width||n.width||l),o.dlOptions=C.getDLOptions({level:this.mapOptionsToLevel[o.level],optionsPoint:o.options}),o.plotX=1,o.plotY=1,o.tooltipPos=i.inverted?[i.plotSizeY-p-a/2,i.plotSizeX-s-e/2]:[s+e/2,p+a/2],o.shapeArgs={x:s,y:p,width:e,height:a,r:r,display:o.hasShape()?"":"none"}):o.dlOptions={enabled:!1}},C.defaultOptions=y(u.defaultOptions,e),C);function C(){var o=null!==p&&p.apply(this,arguments)||this;return o.colDistance=void 0,o.data=void 0,o.group=void 0,o.nodeLookup=void 0,o.nodePadding=void 0,o.nodes=void 0,o.nodeWidth=void 0,o.options=void 0,o.points=void 0,o.translationFactor=void 0,o}return i.compose(t,l),s(l.prototype,{animate:c.prototype.animate,createNode:i.createNode,forceDL:!0,invertible:!0,isCartesian:!1,orderNodes:!0,noSharedTooltip:!0,pointArrayMap:["from","to","weight"],pointClass:t,searchPoint:o.noop}),n.registerSeriesType("sankey",l),l}),t(o,"masters/modules/sankey.src.js",[],function(){})});