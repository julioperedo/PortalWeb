"use strict";import ConnectorsDefaults from"./ConnectorsDefaults.js";import D from"../Core/Defaults.js";const setOptions=D["setOptions"];import U from"../Core/Utilities.js";const{defined,error,merge,pushUnique}=U;function getPointBB(t){var n=t.shapeArgs;if(n)return{xMin:n.x||0,xMax:(n.x||0)+(n.width||0),yMin:n.y||0,yMax:(n.y||0)+(n.height||0)};n=t.graphic&&t.graphic.getBBox();return n?{xMin:t.plotX-n.width/2,xMax:t.plotX+n.width/2,yMin:t.plotY-n.height/2,yMax:t.plotY+n.height/2}:null}function warnLegacy(t){(t.options.pathfinder||t.series.reduce(function(t,n){return n.options&&merge(!0,n.options.connectors=n.options.connectors||{},n.options.pathfinder),t||n.options&&n.options.pathfinder},!1))&&(merge(!0,t.options.connectors=t.options.connectors||{},t.options.pathfinder),error('WARNING: Pathfinder options have been renamed. Use "chart.connectors" or "series.connectors" instead.'))}var ConnectionComposition;!function(t){const i=[];function s(t){var n=getPointBB(this);let o,e;switch(t.align){case"right":o="xMax";break;case"left":o="xMin"}switch(t.verticalAlign){case"top":e="yMin";break;case"bottom":e="yMax"}return{x:o?n[o]:(n.xMin+n.xMax)/2,y:e?n[e]:(n.yMin+n.yMax)/2}}function r(t,n){var o;return defined(n)||(o=getPointBB(this))&&(n={x:(o.xMin+o.xMax)/2,y:(o.yMin+o.yMax)/2}),Math.atan2(n.y-t.y,t.x-n.x)}function a(t,n,o){const e=2*Math.PI,i=getPointBB(this),s=i.xMax-i.xMin,r=i.yMax-i.yMin,a=Math.atan2(r,s),c=s/2,p=r/2,h=i.xMin+c,x=i.yMin+p,M={x:h,y:x};let u=t,f,y=!1,d=1,g=1;for(;u<-Math.PI;)u+=e;for(;u>Math.PI;)u-=e;return f=Math.tan(u),u>-a&&u<=a?(g=-1,y=!0):u>a&&u<=Math.PI-a?g=-1:u>Math.PI-a||u<=-(Math.PI-a)?(d=-1,y=!0):d=-1,y?(M.x+=d*c,M.y+=g*c*f):(M.x+=d*(r/(2*f)),M.y+=g*p),o.x!==h&&(M.x=o.x),o.y!==x&&(M.y=o.y),{x:M.x+n*Math.cos(u),y:M.y-n*Math.sin(u)}}t.compose=function(t,n,o){if(pushUnique(i,t)&&t.prototype.callbacks.push(function(t){!1!==t.options.connectors.enabled&&(warnLegacy(t),this.pathfinder=new n(this),this.pathfinder.update(!0))}),pushUnique(i,o)){const e=o.prototype;e.getMarkerVector=a,e.getPathfinderAnchorPoint=s,e.getRadiansToVector=r}pushUnique(i,setOptions)&&setOptions(ConnectorsDefaults)}}(ConnectionComposition=ConnectionComposition||{});export default ConnectionComposition;