"use strict";import H from"../../parts/Globals.js";import U from"../../parts/Utilities.js";var error=U.error,merge=U.merge,pick=U.pick;import utilities from"./utilities.js";var defaultInstrumentOptions={minDuration:20,maxDuration:2e3,minVolume:.1,maxVolume:1,minPan:-1,maxPan:1,minFrequency:220,maxFrequency:2200};function pointSonify(n){var i=this,t=i.series.chart,e=n.dataExtremes||{},o=function(n,t,o){return"function"==typeof n?t?function(t){return n(i,e,t)}:n(i,e):"string"==typeof n?(e[n]=e[n]||utilities.calculateDataExtremes(i.series.chart,n),utilities.virtualAxisTranslate(pick(i[n],i.options[n]),e[n],o)):n};t.sonification.currentlyPlayingPoint=i,i.sonification=i.sonification||{},i.sonification.instrumentsPlaying=i.sonification.instrumentsPlaying||{};var a=i.sonification.signalHandler=i.sonification.signalHandler||new utilities.SignalHandler(["onEnd"]);a.clearSignalCallbacks(),a.registerSignalCallbacks({onEnd:n.onEnd}),!i.isNull&&i.visible&&i.series.visible?n.instruments.forEach(function(n){var e="string"==typeof n.instrument?H.sonification.instruments[n.instrument]:n.instrument,s=n.instrumentMapping||{},r=merge(defaultInstrumentOptions,n.instrumentOptions),l=e.id;e&&e.play?(i.sonification.instrumentsPlaying[e.id]=e,e.play({frequency:o(s.frequency,!0,{min:r.minFrequency,max:r.maxFrequency}),duration:o(s.duration,!1,{min:r.minDuration,max:r.maxDuration}),pan:o(s.pan,!0,{min:r.minPan,max:r.maxPan}),volume:o(s.volume,!0,{min:r.minVolume,max:r.maxVolume}),onEnd:function(e){n.onEnd&&n.onEnd.apply(this,arguments),t.sonification&&t.sonification.currentlyPlayingPoint&&delete t.sonification.currentlyPlayingPoint,i.sonification&&i.sonification.instrumentsPlaying&&(delete i.sonification.instrumentsPlaying[l],Object.keys(i.sonification.instrumentsPlaying).length||a.emitSignal("onEnd",e))},minFrequency:r.minFrequency,maxFrequency:r.maxFrequency})):error(30)}):a.emitSignal("onEnd")}function pointCancelSonify(n){var i=this.sonification&&this.sonification.instrumentsPlaying,t=i&&Object.keys(i);t&&t.length&&(t.forEach(function(t){i[t].stop(!n,null,"cancelled")}),this.sonification.instrumentsPlaying={},this.sonification.signalHandler.emitSignal("onEnd","cancelled"))}var pointSonifyFunctions={pointSonify:pointSonify,pointCancelSonify:pointCancelSonify};export default pointSonifyFunctions;