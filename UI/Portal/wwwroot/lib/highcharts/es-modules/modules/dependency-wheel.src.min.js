"use strict";import H from"../parts/Globals.js";import U from"../parts/Utilities.js";var animObject=U.animObject,seriesType=U.seriesType;import"../parts/Options.js";import"../mixins/nodes.js";var base=H.seriesTypes.sankey.prototype;seriesType("dependencywheel","sankey",{center:[null,null],curveFactor:.6,startAngle:0},{orderNodes:!1,getCenter:H.seriesTypes.pie.prototype.getCenter,createNodeColumns:function(){var t=[this.createNodeColumn()];return this.nodes.forEach(function(e){e.column=0,t[0].push(e)}),t},getNodePadding:function(){return this.options.nodePadding/Math.PI},createNode:function(t){var e=base.createNode.call(this,t);return e.index=this.nodes.length-1,e.getSum=function(){return e.linksFrom.concat(e.linksTo).reduce(function(t,e){return t+e.weight},0)},e.offset=function(t){var n,a,i=0,s=e.linksFrom.concat(e.linksTo);function r(t){return t.fromNode===e?t.toNode:t.fromNode}for(s.sort(function(t,e){return r(t).index-r(e).index}),n=0;n<s.length;n++)if(r(s[n]).index>e.index){s=s.slice(0,n).reverse().concat(s.slice(n).reverse()),a=!0;break}for(a||s.reverse(),n=0;n<s.length;n++){if(s[n]===t)return i;i+=s[n].weight}},e},translate:function(){var t=this.options,e=2*Math.PI/(this.chart.plotHeight+this.getNodePadding()),n=this.getCenter(),a=(t.startAngle-90)*H.deg2rad;base.translate.call(this),this.nodeColumns[0].forEach(function(i){if(i.sum){var s=i.shapeArgs,r=n[0],o=n[1],c=n[2]/2,h=c-t.nodeWidth,d=a+e*s.y,p=a+e*(s.y+s.height);i.angle=d+(p-d)/2,i.shapeType="arc",i.shapeArgs={x:r,y:o,r:c,innerR:h,start:d,end:p},i.dlBox={x:r+Math.cos((d+p)/2)*(c+h)/2,y:o+Math.sin((d+p)/2)*(c+h)/2,width:1,height:1},i.linksFrom.forEach(function(n){if(n.linkBase){var i,s=n.linkBase.map(function(s,c){var d=e*s,p=Math.cos(a+d)*(h+1),l=Math.sin(a+d)*(h+1),u=t.curveFactor;return(i=Math.abs(n.linkBase[3-c]*e-d))>Math.PI&&(i=2*Math.PI-i),(i*=h)<h&&(u*=i/h),{x:r+p,y:o+l,cpX:r+(1-u)*p,cpY:o+(1-u)*l}});n.shapeArgs={d:[["M",s[0].x,s[0].y],["A",h,h,0,0,1,s[1].x,s[1].y],["C",s[1].cpX,s[1].cpY,s[2].cpX,s[2].cpY,s[2].x,s[2].y],["A",h,h,0,0,1,s[3].x,s[3].y],["C",s[3].cpX,s[3].cpY,s[0].cpX,s[0].cpY,s[0].x,s[0].y]]}}})}})},animate:function(t){if(!t){var e=animObject(this.options.animation).duration/2/this.nodes.length;this.nodes.forEach(function(t,n){var a=t.graphic;a&&(a.attr({opacity:0}),setTimeout(function(){a.animate({opacity:1},{duration:e})},e*n))},this),this.points.forEach(function(t){var e=t.graphic;!t.isNode&&e&&e.attr({opacity:0}).animate({opacity:1},this.options.animation)},this)}}},{setState:H.NodesMixin.setNodeState,getDataLabelPath:function(t){var e=this.series.chart.renderer,n=this.shapeArgs,a=this.angle<0||this.angle>Math.PI,i=n.start,s=n.end;return this.dataLabelPath||(this.dataLabelPath=e.arc({open:!0}).add(t)),this.dataLabelPath.attr({x:n.x,y:n.y,r:n.r+(this.dataLabel.options.distance||0),start:a?i:s,end:a?s:i,clockwise:+a}),this.dataLabelPath},isValid:function(){return!0}});