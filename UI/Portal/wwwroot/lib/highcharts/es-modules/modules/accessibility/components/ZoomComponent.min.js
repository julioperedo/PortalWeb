"use strict";import H from"../../../parts/Globals.js";import U from"../../../parts/Utilities.js";var extend=U.extend,pick=U.pick;import AccessibilityComponent from"../AccessibilityComponent.js";import KeyboardNavigationHandler from"../KeyboardNavigationHandler.js";import ChartUtilities from"../utils/chartUtilities.js";var unhideChartElementFromAT=ChartUtilities.unhideChartElementFromAT;import HTMLUtilities from"../utils/htmlUtilities.js";var setElAttrs=HTMLUtilities.setElAttrs,removeElement=HTMLUtilities.removeElement;function chartHasMapZoom(t){return!!(t.mapZoom&&t.mapNavButtons&&t.mapNavButtons.length)}H.Axis.prototype.panStep=function(t,o){var e=o||3,n=this.getExtremes(),i=(n.max-n.min)/e*t,r=n.max+i,a=n.min+i,s=r-a;t<0&&a<n.dataMin?r=(a=n.dataMin)+s:t>0&&r>n.dataMax&&(a=(r=n.dataMax)-s),this.setExtremes(a,r)};var ZoomComponent=function(){};ZoomComponent.prototype=new AccessibilityComponent,extend(ZoomComponent.prototype,{init:function(){var t=this,o=this.chart;["afterShowResetZoom","afterDrilldown","drillupall"].forEach(function(e){t.addEvent(o,e,function(){t.updateProxyOverlays()})})},onChartUpdate:function(){var t=this.chart,o=this;t.mapNavButtons&&t.mapNavButtons.forEach(function(e,n){unhideChartElementFromAT(t,e.element),o.setMapNavButtonAttrs(e.element,"accessibility.zoom.mapZoom"+(n?"Out":"In"))})},setMapNavButtonAttrs:function(t,o){var e=this.chart,n=e.langFormat(o,{chart:e});setElAttrs(t,{tabindex:-1,role:"button","aria-label":n})},onChartRender:function(){this.updateProxyOverlays()},updateProxyOverlays:function(){var t=this.chart;removeElement(this.drillUpProxyGroup),removeElement(this.resetZoomProxyGroup),t.resetZoomButton&&this.recreateProxyButtonAndGroup(t.resetZoomButton,"resetZoomProxyButton","resetZoomProxyGroup",t.langFormat("accessibility.zoom.resetZoomButton",{chart:t})),t.drillUpButton&&this.recreateProxyButtonAndGroup(t.drillUpButton,"drillUpProxyButton","drillUpProxyGroup",t.langFormat("accessibility.drillUpButton",{chart:t,buttonText:t.getDrilldownBackText()}))},recreateProxyButtonAndGroup:function(t,o,e,n){removeElement(this[e]),this[e]=this.addProxyGroup(),this[o]=this.createProxyButton(t,this[e],{"aria-label":n,tabindex:-1})},getMapZoomNavigation:function(){var t=this.keyCodes,o=this.chart,e=this;return new KeyboardNavigationHandler(o,{keyCodeMap:[[[t.up,t.down,t.left,t.right],function(t){return e.onMapKbdArrow(this,t)}],[[t.tab],function(t,o){return e.onMapKbdTab(this,o)}],[[t.space,t.enter],function(){return e.onMapKbdClick(this)}]],validate:function(){return chartHasMapZoom(o)},init:function(t){return e.onMapNavInit(t)}})},onMapKbdArrow:function(t,o){var e=this.keyCodes,n=o===e.up||o===e.down?"yAxis":"xAxis",i=o===e.left||o===e.up?-1:1;return this.chart[n][0].panStep(i),t.response.success},onMapKbdTab:function(t,o){var e,n=this.chart,i=t.response,r=o.shiftKey,a=r&&!this.focusedMapNavButtonIx||!r&&this.focusedMapNavButtonIx;return n.mapNavButtons[this.focusedMapNavButtonIx].setState(0),a?(n.mapZoom(),i[r?"prev":"next"]):(this.focusedMapNavButtonIx+=r?-1:1,e=n.mapNavButtons[this.focusedMapNavButtonIx],n.setFocusToElement(e.box,e.element),e.setState(2),i.success)},onMapKbdClick:function(t){return this.fakeClickEvent(this.chart.mapNavButtons[this.focusedMapNavButtonIx].element),t.response.success},onMapNavInit:function(t){var o=this.chart,e=o.mapNavButtons[0],n=o.mapNavButtons[1],i=t>0?e:n;o.setFocusToElement(i.box,i.element),i.setState(2),this.focusedMapNavButtonIx=t>0?0:1},simpleButtonNavigation:function(t,o,e){var n=this.keyCodes,i=this,r=this.chart;return new KeyboardNavigationHandler(r,{keyCodeMap:[[[n.tab,n.up,n.down,n.left,n.right],function(t,o){var e=t===n.tab&&o.shiftKey||t===n.left||t===n.up;return this.response[e?"prev":"next"]}],[[n.space,n.enter],function(){var t=e(this,r);return pick(t,this.response.success)}]],validate:function(){return r[t]&&r[t].box&&i[o]},init:function(){r.setFocusToElement(r[t].box,i[o])}})},getKeyboardNavigation:function(){return[this.simpleButtonNavigation("resetZoomButton","resetZoomProxyButton",function(t,o){o.zoomOut()}),this.simpleButtonNavigation("drillUpButton","drillUpProxyButton",function(t,o){return o.drillUp(),t.response.prev}),this.getMapZoomNavigation()]}});export default ZoomComponent;