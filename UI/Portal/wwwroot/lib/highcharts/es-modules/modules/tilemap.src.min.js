"use strict";import H from"../parts/Globals.js";import U from"../parts/Utilities.js";var addEvent=U.addEvent,clamp=U.clamp,extend=U.extend,pick=U.pick,seriesType=U.seriesType;import"../parts-map/HeatmapSeries.js";function tilePaddingFromTileSize(t,e,a){var i=t.options;return{xPad:(i.colsize||1)/-e,yPad:(i.rowsize||1)/-a}}H.tileShapeTypes={hexagon:{alignDataLabel:H.seriesTypes.scatter.prototype.alignDataLabel,getSeriesPadding:function(t){return tilePaddingFromTileSize(t,3,2)},haloPath:function(t){if(!t)return[];var e=this.tileEdges;return[["M",e.x2-t,e.y1+t],["L",e.x3+t,e.y1+t],["L",e.x4+1.5*t,e.y2],["L",e.x3+t,e.y3-t],["L",e.x2-t,e.y3-t],["L",e.x1-1.5*t,e.y2],["Z"]]},translate:function(){var t,e=this.options,a=this.xAxis,i=this.yAxis,n=e.pointPadding||0,r=(e.colsize||1)/3,s=(e.rowsize||1)/2;this.generatePoints(),this.points.forEach(function(e){var l=clamp(Math.floor(a.len-a.translate(e.x-2*r,0,1,0,1)),-a.len,2*a.len),o=clamp(Math.floor(a.len-a.translate(e.x-r,0,1,0,1)),-a.len,2*a.len),p=clamp(Math.floor(a.len-a.translate(e.x+r,0,1,0,1)),-a.len,2*a.len),h=clamp(Math.floor(a.len-a.translate(e.x+2*r,0,1,0,1)),-a.len,2*a.len),d=clamp(Math.floor(i.translate(e.y-s,0,1,0,1)),-i.len,2*i.len),c=clamp(Math.floor(i.translate(e.y,0,1,0,1)),-i.len,2*i.len),y=clamp(Math.floor(i.translate(e.y+s,0,1,0,1)),-i.len,2*i.len),g=pick(e.pointPadding,n),u=g*Math.abs(o-l)/Math.abs(y-c),x=a.reversed?-u:u,m=a.reversed?-g:g,f=i.reversed?-g:g;e.x%2&&(d+=t=t||Math.round(Math.abs(y-d)/2)*(i.reversed?-1:1),c+=t,y+=t),e.plotX=e.clientX=(o+p)/2,e.plotY=c,l+=x+m,o+=m,p-=m,h-=x+m,d-=f,y+=f,e.tileEdges={x1:l,x2:o,x3:p,x4:h,y1:d,y2:c,y3:y},e.shapeType="path",e.shapeArgs={d:[["M",o,d],["L",p,d],["L",h,c],["L",p,y],["L",o,y],["L",l,c],["Z"]]}}),this.translateColors()}},diamond:{alignDataLabel:H.seriesTypes.scatter.prototype.alignDataLabel,getSeriesPadding:function(t){return tilePaddingFromTileSize(t,2,2)},haloPath:function(t){if(!t)return[];var e=this.tileEdges;return[["M",e.x2,e.y1+t],["L",e.x3+t,e.y2],["L",e.x2,e.y3-t],["L",e.x1-t,e.y2],["Z"]]},translate:function(){var t,e=this.options,a=this.xAxis,i=this.yAxis,n=e.pointPadding||0,r=e.colsize||1,s=(e.rowsize||1)/2;this.generatePoints(),this.points.forEach(function(e){var l=clamp(Math.round(a.len-a.translate(e.x-r,0,1,0,0)),-a.len,2*a.len),o=clamp(Math.round(a.len-a.translate(e.x,0,1,0,0)),-a.len,2*a.len),p=clamp(Math.round(a.len-a.translate(e.x+r,0,1,0,0)),-a.len,2*a.len),h=clamp(Math.round(i.translate(e.y-s,0,1,0,0)),-i.len,2*i.len),d=clamp(Math.round(i.translate(e.y,0,1,0,0)),-i.len,2*i.len),c=clamp(Math.round(i.translate(e.y+s,0,1,0,0)),-i.len,2*i.len),y=pick(e.pointPadding,n),g=y*Math.abs(o-l)/Math.abs(c-d),u=a.reversed?-g:g,x=i.reversed?-y:y;e.x%2&&(h+=t=Math.abs(c-h)/2*(i.reversed?-1:1),d+=t,c+=t),e.plotX=e.clientX=o,e.plotY=d,l+=u,p-=u,h-=x,c+=x,e.tileEdges={x1:l,x2:o,x3:p,y1:h,y2:d,y3:c},e.shapeType="path",e.shapeArgs={d:[["M",o,h],["L",p,d],["L",o,c],["L",l,d],["Z"]]}}),this.translateColors()}},circle:{alignDataLabel:H.seriesTypes.scatter.prototype.alignDataLabel,getSeriesPadding:function(t){return tilePaddingFromTileSize(t,2,2)},haloPath:function(t){return H.seriesTypes.scatter.prototype.pointClass.prototype.haloPath.call(this,t+(t&&this.radius))},translate:function(){var t,e,a,i,n=this.options,r=this.xAxis,s=this.yAxis,l=n.pointPadding||0,o=(n.rowsize||1)/2,p=n.colsize||1,h=!1;this.generatePoints(),this.points.forEach(function(n){var d=clamp(Math.round(r.len-r.translate(n.x,0,1,0,0)),-r.len,2*r.len),c=clamp(Math.round(s.translate(n.y,0,1,0,0)),-s.len,2*s.len),y=l,g=!1;void 0!==n.pointPadding&&(y=n.pointPadding,g=!0,h=!0),i&&!h||(t=Math.abs(clamp(Math.floor(r.len-r.translate(n.x+p,0,1,0,0)),-r.len,2*r.len)-d),e=Math.abs(clamp(Math.floor(s.translate(n.y+o,0,1,0,0)),-s.len,2*s.len)-c),a=Math.floor(Math.sqrt(t*t+e*e)/2),i=Math.min(t,a,e)-y,h&&!g&&(h=!1)),n.x%2&&(c+=e*(s.reversed?-1:1)),n.plotX=n.clientX=d,n.plotY=c,n.radius=i,n.shapeType="circle",n.shapeArgs={x:d,y:c,r:i}}),this.translateColors()}},square:{alignDataLabel:H.seriesTypes.heatmap.prototype.alignDataLabel,translate:H.seriesTypes.heatmap.prototype.translate,getSeriesPadding:function(){},haloPath:H.seriesTypes.heatmap.prototype.pointClass.prototype.haloPath}},addEvent(H.Axis,"afterSetAxisTranslation",function(){if(!this.recomputingForTilemap&&"colorAxis"!==this.coll){var t=this,e=t.series.map(function(e){return e.getSeriesPixelPadding&&e.getSeriesPixelPadding(t)}).reduce(function(t,e){return(t&&t.padding)>(e&&e.padding)?t:e},void 0)||{padding:0,axisLengthFactor:1},a=Math.round(e.padding*e.axisLengthFactor);e.padding&&(t.len-=a,t.recomputingForTilemap=!0,t.setAxisTranslation(),delete t.recomputingForTilemap,t.minPixelPadding+=e.padding,t.len+=a)}}),seriesType("tilemap","heatmap",{marker:null,states:{hover:{halo:{enabled:!0,size:2,opacity:.5,attributes:{zIndex:3}}}},pointPadding:2,tileShape:"hexagon"},{markerAttribs:H.seriesTypes.scatter.prototype.markerAttribs,pointAttribs:H.seriesTypes.column.prototype.pointAttribs,getSymbol:H.noop,drawPoints:function(){var t=this;H.seriesTypes.column.prototype.drawPoints.call(this),this.points.forEach(function(e){e.graphic&&e.graphic[t.chart.styledMode?"css":"animate"](t.colorAttribs(e))})},setOptions:function(){var t=H.seriesTypes.heatmap.prototype.setOptions.apply(this,Array.prototype.slice.call(arguments));return this.tileShape=H.tileShapeTypes[t.tileShape],t},alignDataLabel:function(){return this.tileShape.alignDataLabel.apply(this,Array.prototype.slice.call(arguments))},getSeriesPixelPadding:function(t){var e,a,i=t.isXAxis,n=this.tileShape.getSeriesPadding(this);return n?(e=Math.round(t.translate(i?2*n.xPad:n.yPad,0,1,0,1)),a=Math.round(t.translate(i?n.xPad:0,0,1,0,1)),{padding:Math.abs(e-a)||0,axisLengthFactor:i?2:1.1}):{padding:0,axisLengthFactor:1}},translate:function(){return this.tileShape.translate.apply(this,Array.prototype.slice.call(arguments))}},extend({haloPath:function(){return this.series.tileShape.haloPath.apply(this,Array.prototype.slice.call(arguments))}},H.colorPointMixin));