"use strict";import H from"../parts/Globals.js";import Color from"../parts/Color.js";var color=Color.parse;import Point from"../parts/Point.js";import U from"../parts/Utilities.js";var arrayMax=U.arrayMax,arrayMin=U.arrayMin,clamp=U.clamp,extend=U.extend,isNumber=U.isNumber,pick=U.pick,pInt=U.pInt,seriesType=U.seriesType;import"../parts/Axis.js";import"../parts/Series.js";import"../parts/ScatterSeries.js";import"./BubbleLegend.js";var Axis=H.Axis,noop=H.noop,Series=H.Series,seriesTypes=H.seriesTypes;seriesType("bubble","scatter",{dataLabels:{formatter:function(){return this.point.z},inside:!0,verticalAlign:"middle"},animationLimit:250,marker:{lineColor:null,lineWidth:1,fillOpacity:.5,radius:null,states:{hover:{radiusPlus:0}},symbol:"circle"},minSize:8,maxSize:"20%",softThreshold:!1,states:{hover:{halo:{size:5}}},tooltip:{pointFormat:"({point.x}, {point.y}), Size: {point.z}"},turboThreshold:0,zThreshold:0,zoneAxis:"z"},{pointArrayMap:["y","z"],parallelArrays:["x","y","z"],trackerGroups:["group","dataLabelsGroup"],specialGroup:"group",bubblePadding:!0,zoneAxis:"z",directTouch:!0,isBubble:!0,pointAttribs:function(i,t){var a=this.options.marker.fillOpacity,r=Series.prototype.pointAttribs.call(this,i,t);return 1!==a&&(r.fill=color(r.fill).setOpacity(a).get("rgba")),r},getRadii:function(i,t,a){var r,e,s,o=this.zData,n=this.yData,l=a.minPxSize,h=a.maxPxSize,p=[];for(e=0,r=o.length;e<r;e++)s=o[e],p.push(this.getRadius(i,t,l,h,s,n[e]));this.radii=p},getRadius:function(i,t,a,r,e,s){var o=this.options,n="width"!==o.sizeBy,l=o.zThreshold,h=t-i,p=.5;if(null===s||null===e)return null;if(isNumber(e)){if(o.sizeByAbsoluteValue&&(e=Math.abs(e-l),t=h=Math.max(t-l,Math.abs(i-l)),i=0),e<i)return a/2-1;h>0&&(p=(e-i)/h)}return n&&p>=0&&(p=Math.sqrt(p)),Math.ceil(a+p*(r-a))/2},animate:function(i){!i&&this.points.length<this.options.animationLimit&&this.points.forEach(function(i){var t=i.graphic;t&&t.width&&(this.hasRendered||t.attr({x:i.plotX,y:i.plotY,width:1,height:1}),t.animate(this.markerAttribs(i),this.options.animation))},this)},hasData:function(){return!!this.processedXData.length},translate:function(){var i,t,a,r=this.data,e=this.radii;for(seriesTypes.scatter.prototype.translate.call(this),i=r.length;i--;)t=r[i],a=e?e[i]:0,isNumber(a)&&a>=this.minPxSize/2?(t.marker=extend(t.marker,{radius:a,width:2*a,height:2*a}),t.dlBox={x:t.plotX-a,y:t.plotY-a,width:2*a,height:2*a}):t.shapeArgs=t.plotY=t.dlBox=void 0},alignDataLabel:seriesTypes.column.prototype.alignDataLabel,buildKDTree:noop,applyZones:noop},{haloPath:function(i){return Point.prototype.haloPath.call(this,0===i?0:(this.marker&&this.marker.radius||0)+i)},ttBelow:!1}),Axis.prototype.beforePadding=function(){var i=this,t=this.len,a=this.chart,r=0,e=t,s=this.isXAxis,o=s?"xData":"yData",n=this.min,l={},h=Math.min(a.plotWidth,a.plotHeight),p=Number.MAX_VALUE,m=-Number.MAX_VALUE,u=this.max-n,d=t/u,c=[];this.series.forEach(function(t){var r,e=t.options;!t.bubblePadding||!t.visible&&a.options.chart.ignoreHiddenSeries||(i.allowZoomOutside=!0,c.push(t),s&&(["minSize","maxSize"].forEach(function(i){var t=e[i],a=/%$/.test(t);t=pInt(t),l[i]=a?h*t/100:t}),t.minPxSize=l.minSize,t.maxPxSize=Math.max(l.maxSize,l.minSize),(r=t.zData.filter(isNumber)).length&&(p=pick(e.zMin,clamp(arrayMin(r),!1===e.displayNegative?e.zThreshold:-Number.MAX_VALUE,p)),m=pick(e.zMax,Math.max(m,arrayMax(r))))))}),c.forEach(function(t){var a,l=t[o],h=l.length;if(s&&t.getRadii(p,m,t),u>0)for(;h--;)isNumber(l[h])&&i.dataMin<=l[h]&&l[h]<=i.max&&(a=t.radii?t.radii[h]:0,r=Math.min((l[h]-n)*d-a,r),e=Math.max((l[h]-n)*d+a,e))}),c.length&&u>0&&!this.logarithmic&&(e-=t,d*=(t+Math.max(0,r)-Math.min(e,t))/t,[["min","userMin",r],["max","userMax",e]].forEach(function(t){void 0===pick(i.options[t[0]],i[t[1]])&&(i[t[0]]+=t[2]/d)}))};