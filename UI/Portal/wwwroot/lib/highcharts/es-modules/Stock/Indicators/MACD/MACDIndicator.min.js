"use strict";import H from"../../../Core/Globals.js";const noop=H["noop"];import SeriesRegistry from"../../../Core/Series/SeriesRegistry.js";const{column:ColumnSeries,sma:SMAIndicator}=SeriesRegistry.seriesTypes;import U from"../../../Core/Utilities.js";const{extend,correctFloat,defined,merge}=U;class MACDIndicator extends SMAIndicator{constructor(){super(...arguments),this.data=void 0,this.macdZones=void 0,this.options=void 0,this.points=void 0,this.signalZones=void 0}init(){SeriesRegistry.seriesTypes.sma.prototype.init.apply(this,arguments);var e=this.color;this.options&&(defined(this.colorIndex)&&(this.options.signalLine&&this.options.signalLine.styles&&!this.options.signalLine.styles.lineColor&&(this.options.colorIndex=this.colorIndex+1,this.getCyclic("color",void 0,this.chart.options.colors),this.options.signalLine.styles.lineColor=this.color),this.options.macdLine&&this.options.macdLine.styles&&!this.options.macdLine.styles.lineColor&&(this.options.colorIndex=this.colorIndex+1,this.getCyclic("color",void 0,this.chart.options.colors),this.options.macdLine.styles.lineColor=this.color)),this.macdZones={zones:this.options.macdLine.zones,startIndex:0},this.signalZones={zones:this.macdZones.zones.concat(this.options.signalLine.zones),startIndex:this.macdZones.zones.length},this.resetZones=!0),this.color=e}toYData(e){return[e.y,e.signal,e.MACD]}translate(){const i=this,t=["plotSignal","plotMACD"];H.seriesTypes.column.prototype.translate.apply(i),i.points.forEach(function(o){[o.signal,o.MACD].forEach(function(e,s){null!==e&&(o[t[s]]=i.yAxis.toPixels(e,!0))})})}destroy(){this.graph=null,this.graphmacd=this.graphmacd&&this.graphmacd.destroy(),this.graphsignal=this.graphsignal&&this.graphsignal.destroy(),SeriesRegistry.seriesTypes.sma.prototype.destroy.apply(this,arguments)}drawGraph(){const o=this,e=o.points,i=o.options,s=o.zones,t={options:{gapSize:i.gapSize}},n=[[],[]];let r,a=e.length;for(;a--;)r=e[a],defined(r.plotMACD)&&n[0].push({plotX:r.plotX,plotY:r.plotMACD,isNull:!defined(r.plotMACD)}),defined(r.plotSignal)&&n[1].push({plotX:r.plotX,plotY:r.plotSignal,isNull:!defined(r.plotMACD)});["macd","signal"].forEach(function(e,s){o.points=n[s],o.options=merge(i[e+"Line"].styles,t),o.graph=o["graph"+e],o.currentLineZone=e+"Zones",o.zones=o[o.currentLineZone].zones,SeriesRegistry.seriesTypes.sma.prototype.drawGraph.call(o),o["graph"+e]=o.graph}),o.points=e,o.options=i,o.zones=s,o.currentLineZone=void 0}getZonesGraphs(e){const s=super.getZonesGraphs(e);let o=s;return this.currentLineZone&&((o=s.splice(this[this.currentLineZone].startIndex+1)).length?o.splice(0,0,e[0]):o=[e[0]]),o}applyZones(){var e=this.zones;this.zones=this.signalZones.zones,SeriesRegistry.seriesTypes.sma.prototype.applyZones.call(this),this.graphmacd&&this.options.macdLine.zones.length&&this.graphmacd.hide(),this.zones=e}getValues(e,s){const o=s.longPeriod-s.shortPeriod,i=[],t=[],n=[];let r,a,l,p=0,d;if(!(e.xData.length<s.longPeriod+s.signalPeriod)){for(r=SeriesRegistry.seriesTypes.ema.prototype.getValues(e,{period:s.shortPeriod,index:s.index}),a=SeriesRegistry.seriesTypes.ema.prototype.getValues(e,{period:s.longPeriod,index:s.index}),r=r.values,a=a.values,l=0;l<=r.length;l++)defined(a[l])&&defined(a[l][1])&&defined(r[l+o])&&defined(r[l+o][0])&&i.push([r[l+o][0],0,null,r[l+o][1]-a[l][1]]);for(l=0;l<i.length;l++)t.push(i[l][0]),n.push([0,null,i[l][3]]);for(d=SeriesRegistry.seriesTypes.ema.prototype.getValues({xData:t,yData:n},{period:s.signalPeriod,index:2}).values,l=0;l<i.length;l++)i[l][0]>=d[0][0]&&(i[l][2]=d[p][1],n[l]=[0,d[p][1],i[l][3]],null===i[l][3]?(i[l][1]=0,n[l][0]=0):(i[l][1]=correctFloat(i[l][3]-d[p][1]),n[l][0]=correctFloat(i[l][3]-d[p][1])),p++);return{values:i,xData:t,yData:n}}}}MACDIndicator.defaultOptions=merge(SMAIndicator.defaultOptions,{params:{shortPeriod:12,longPeriod:26,signalPeriod:9,period:26},signalLine:{zones:[],styles:{lineWidth:1,lineColor:void 0}},macdLine:{zones:[],styles:{lineWidth:1,lineColor:void 0}},threshold:0,groupPadding:.1,pointPadding:.1,crisp:!1,states:{hover:{halo:{size:0}}},tooltip:{pointFormat:'<span style="color:{point.color}">‚óè</span> <b> {series.name}</b><br/>Value: {point.MACD}<br/>Signal: {point.signal}<br/>Histogram: {point.y}<br/>'},dataGrouping:{approximation:"averages"},minPointLength:0}),extend(MACDIndicator.prototype,{nameComponents:["longPeriod","shortPeriod","signalPeriod"],pointArrayMap:["y","signal","MACD"],parallelArrays:["x","y","signal","MACD"],pointValKey:"y",markerAttribs:noop,getColumnMetrics:H.seriesTypes.column.prototype.getColumnMetrics,crispCol:H.seriesTypes.column.prototype.crispCol,drawPoints:H.seriesTypes.column.prototype.drawPoints}),SeriesRegistry.registerSeriesType("macd",MACDIndicator);export default MACDIndicator;