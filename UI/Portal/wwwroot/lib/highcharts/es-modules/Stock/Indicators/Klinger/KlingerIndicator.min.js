"use strict";import MultipleLinesComposition from"../MultipleLinesComposition.js";import SeriesRegistry from"../../../Core/Series/SeriesRegistry.js";const{ema:EMAIndicator,sma:SMAIndicator}=SeriesRegistry.seriesTypes;import U from"../../../Core/Utilities.js";const{correctFloat,error,extend,isArray,merge}=U;class KlingerIndicator extends SMAIndicator{constructor(){super(...arguments),this.data=void 0,this.points=void 0,this.options=void 0,this.volumeSeries=void 0}calculateTrend(e,t){return e[t][1]+e[t][2]+e[t][3]>e[t-1][1]+e[t-1][2]+e[t-1][3]?1:-1}isValidData(e){const t=this.chart,i=this.options,r=this.linkedParent,o=isArray(e)&&4===e.length,s=this.volumeSeries||(this.volumeSeries=t.get(i.params.volumeSeriesID));return s||error("Series "+i.params.volumeSeriesID+" not found! Check `volumeSeriesID`.",!0,r.chart),!(![r,s].every(function(e){return e&&e.xData&&e.xData.length>=i.params.slowAvgPeriod})||!o)}getCM(e,t,i,r,o){return correctFloat(t+(i===r?e:o))}getDM(e,t){return correctFloat(e-t)}getVolumeForce(e){const t=[];let i,r,o,s=1,a=0,n=e[0][1]-e[0][2],l=0,g;for(s;s<e.length;s++)g=this.calculateTrend(e,s),r=this.getDM(e[s][1],e[s][2]),i=this.getCM(a,r,g,l,n),o=this.volumeSeries.yData[s]*g*Math.abs(2*(r/i-1))*100,t.push([o]),l=g,a=i,n=r;return t}getEMA(e,t,i,r,o,s,a){return EMAIndicator.prototype.calculateEma(a||[],e,void 0===s?1:s,r,t,void 0===o?-1:o,i)}getSMA(e,t,i){return EMAIndicator.prototype.accumulatePeriodPoints(e,t,i)/e}getValues(e,t){const i=[],r=e.xData,o=e.yData,s=[],a=[],n=[];let l,g=0,p=0,d,c=void 0,u=void 0,m=null;if(this.isValidData(o[0])){var h=this.getVolumeForce(o),v=this.getSMA(t.fastAvgPeriod,0,h),A=this.getSMA(t.slowAvgPeriod,0,h),y=2/(t.fastAvgPeriod+1),S=2/(t.slowAvgPeriod+1);for(g;g<o.length;g++)g>=t.fastAvgPeriod&&(p=this.getEMA(h,c,v,y,0,g,r)[1],c=p),g>=t.slowAvgPeriod&&(d=this.getEMA(h,u,A,S,0,g,r)[1],u=d,l=correctFloat(p-d),n.push(l),n.length>=t.signalPeriod&&(m=n.slice(-t.signalPeriod).reduce((e,t)=>e+t)/t.signalPeriod),i.push([r[g],l,m]),s.push(r[g]),a.push([l,m]));return{values:i,xData:s,yData:a}}}}KlingerIndicator.defaultOptions=merge(SMAIndicator.defaultOptions,{params:{fastAvgPeriod:34,slowAvgPeriod:55,signalPeriod:13,volumeSeriesID:"volume"},signalLine:{styles:{lineWidth:1,lineColor:"#ff0000"}},dataGrouping:{approximation:"averages"},tooltip:{pointFormat:'<span style="color: {point.color}">‚óè</span><b> {series.name}</b><br/><span style="color: {point.color}">Klinger</span>: {point.y}<br/><span style="color: {point.series.options.signalLine.styles.lineColor}">Signal</span>: {point.signal}<br/>'}}),extend(KlingerIndicator.prototype,{areaLinesNames:[],linesApiNames:["signalLine"],nameBase:"Klinger",nameComponents:["fastAvgPeriod","slowAvgPeriod"],pointArrayMap:["y","signal"],parallelArrays:["x","y","signal"],pointValKey:"y"}),MultipleLinesComposition.compose(KlingerIndicator),SeriesRegistry.registerSeriesType("klinger",KlingerIndicator);export default KlingerIndicator;