"use strict";import PivotPointsPoint from"./PivotPointsPoint.js";import SeriesRegistry from"../../../Core/Series/SeriesRegistry.js";const SMAIndicator=SeriesRegistry.seriesTypes["sma"];import U from"../../../Core/Utilities.js";const{merge,extend,defined,isArray}=U;class PivotPointsIndicator extends SMAIndicator{constructor(){super(...arguments),this.data=void 0,this.options=void 0,this.points=void 0,this.endPoint=void 0,this.plotEndPoint=void 0}toYData(t){return[t.P]}translate(){const e=this;super.translate.apply(e),e.points.forEach(function(a){e.pointArrayMap.forEach(function(t){defined(a[t])&&(a["plot"+t]=e.yAxis.toPixels(a[t],!0))})}),e.plotEndPoint=e.xAxis.toPixels(e.endPoint,!0)}getGraphPath(t){const a=this,e=[[],[],[],[],[],[],[],[],[]],o=a.pointArrayMap.length;let i=a.plotEndPoint,n=[],r,s,l=t.length,p;for(;l--;){for(s=t[l],p=0;p<o;p++)r=a.pointArrayMap[p],defined(s[r])&&e[p].push({plotX:s.plotX,plotY:s["plot"+r],isNull:!1},{plotX:i,plotY:s["plot"+r],isNull:!1},{plotX:i,plotY:null,isNull:!0});i=s.plotX}return e.forEach(t=>{n=n.concat(super.getGraphPath.call(a,t))}),n}drawDataLabels(){const e=this,o=e.pointArrayMap;let i,n,r,s;e.options.dataLabels.enabled&&(n=e.points.length,o.concat([!1]).forEach((t,a)=>{for(s=n;s--;)r=e.points[s],t?(r.y=r[t],r.pivotLine=t,r.plotY=r["plot"+t],i=r["dataLabel"+t],a&&(r["dataLabel"+o[a-1]]=r.dataLabel),r.dataLabels||(r.dataLabels=[]),r.dataLabels[0]=r.dataLabel=i=i&&i.element?i:null):r["dataLabel"+o[a-1]]=r.dataLabel;super.drawDataLabels.call(e)}))}getValues(t,a){const e=a.period,o=t.xData,i=t.yData,n=i?i.length:0,r=this[a.algorithm+"Placement"],s=[],l=[],p=[];let d,c,P,u,h,v,g,f;if(!(o.length<e)&&isArray(i[0])&&4===i[0].length){for(f=e+1;f<=n+e;f+=e)P=o.slice(f-e-1,f),u=i.slice(f-e-1,f),c=P.length,d=P[c-1],v=this.getPivotAndHLC(u),g=r(v),h=s.push([d].concat(g)),l.push(d),p.push(s[h-1].slice(1));return this.endPoint=P[0]+(d-P[0])/c*e,{values:s,xData:l,yData:p}}}getPivotAndHLC(t){var a=t[t.length-1][3];let e=-1/0,o=1/0;return t.forEach(function(t){e=Math.max(e,t[1]),o=Math.min(o,t[2])}),[(e+o+a)/3,e,o,a]}standardPlacement(t){var a=t[1]-t[2];return[null,null,t[0]+a,2*t[0]-t[2],t[0],2*t[0]-t[1],t[0]-a,null,null]}camarillaPlacement(t){var a=t[1]-t[2];return[t[3]+1.5*a,t[3]+1.25*a,t[3]+1.1666*a,t[3]+1.0833*a,t[0],t[3]-1.0833*a,t[3]-1.1666*a,t[3]-1.25*a,t[3]-1.5*a]}fibonacciPlacement(t){var a=t[1]-t[2];return[null,t[0]+a,t[0]+.618*a,t[0]+.382*a,t[0],t[0]-.382*a,t[0]-.618*a,t[0]-a,null]}}PivotPointsIndicator.defaultOptions=merge(SMAIndicator.defaultOptions,{params:{index:void 0,period:28,algorithm:"standard"},marker:{enabled:!1},enableMouseTracking:!1,dataLabels:{enabled:!0,format:"{point.pivotLine}"},dataGrouping:{approximation:"averages"}}),extend(PivotPointsIndicator.prototype,{nameBase:"Pivot Points",pointArrayMap:["R4","R3","R2","R1","P","S1","S2","S3","S4"],pointValKey:"P",pointClass:PivotPointsPoint}),SeriesRegistry.registerSeriesType("pivotpoints",PivotPointsIndicator);export default PivotPointsIndicator;