"use strict";import SeriesRegistry from"../../../Core/Series/SeriesRegistry.js";const SMAIndicator=SeriesRegistry.seriesTypes["sma"];import U from"../../../Core/Utilities.js";const merge=U["merge"];function toFixed(t,e){return parseFloat(t.toFixed(e))}function calculateDirection(t,e,i,r){return 1===t&&r<e||-1===t&&r<i?1:-1}function getAccelerationFactor(t,e,i,r,n,a,o,c){return t===e?1===t&&r<i||-1===t&&i<r?n===o?o:toFixed(n+a,2):n:c}function getExtremePoint(t,e,i,r){return 1===i?r<t?t:r:e<r?e:r}function getEPMinusPSAR(t,e){return t-e}function getAccelerationFactorMultiply(t,e){return t*e}function getPSAR(t,e,i,r,n,a,o,c,s){return t===e?1===t?i+r<Math.min(n,a)?i+r:Math.min(n,a):i+r>Math.max(c,o)?i+r:Math.max(c,o):s}class PSARIndicator extends SMAIndicator{constructor(){super(...arguments),this.data=void 0,this.nameComponents=void 0,this.points=void 0,this.options=void 0}getValues(t,e){const i=t.xData,r=t.yData,n=e.maxAccelerationFactor,a=e.increment,o=e.initialAccelerationFactor,c=e.decimals,s=e.index,l=[],u=[],d=[];let m=e.initialAccelerationFactor,p,g=r[0][1],A,h,x,F=1,S,f,M,P,R=r[0][2],y,v,I,D;if(!(s>=r.length)){for(D=0;D<s;D++)g=Math.max(r[D][1],g),R=Math.min(r[D][2],toFixed(R,c));for(p=r[D][1]>R?1:-1,A=getEPMinusPSAR(g,R),m=e.initialAccelerationFactor,h=getAccelerationFactorMultiply(m,A),l.push([i[s],R]),u.push(i[s]),d.push(toFixed(R,c)),D=s+1;D<r.length;D++)S=r[D-1][2],f=r[D-2][2],M=r[D-1][1],P=r[D-2][1],v=r[D][1],I=r[D][2],null!==f&&null!==P&&null!==S&&null!==M&&null!==v&&null!==I&&(R=getPSAR(p,F,R,h,f,S,M,P,g),y=getExtremePoint(v,I,p,g),x=calculateDirection(F,I,v,R),m=getAccelerationFactor(x,p,y,g,m,a,n,o),A=getEPMinusPSAR(y,R),h=getAccelerationFactorMultiply(m,A),l.push([i[D],toFixed(R,c)]),u.push(i[D]),d.push(toFixed(R,c)),F=p,p=x,g=y);return{values:l,xData:u,yData:d}}}}PSARIndicator.defaultOptions=merge(SMAIndicator.defaultOptions,{lineWidth:0,marker:{enabled:!0},states:{hover:{lineWidthPlus:0}},params:{period:void 0,initialAccelerationFactor:.02,maxAccelerationFactor:.2,increment:.02,index:2,decimals:4}}),SeriesRegistry.registerSeriesType("psar",PSARIndicator);export default PSARIndicator;