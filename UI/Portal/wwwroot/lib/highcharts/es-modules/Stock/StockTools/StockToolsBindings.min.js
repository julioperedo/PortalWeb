"use strict";import H from"../../Core/Globals.js";import NBU from"../../Extensions/Annotations/NavigationBindingsUtilities.js";const getAssignedAxis=NBU["getAssignedAxis"];import STU from"./StockToolsUtilities.js";const{addFlagFromForm,attractToPoint,isNotNavigatorYAxis,isPriceIndicatorEnabled,manageIndicators,updateHeight,updateNthPoint,updateRectSize}=STU;import U from"../../Core/Utilities.js";const{fireEvent,merge}=U,StockToolsBindings={segment:{className:"highcharts-segment",start:function(t){var i,t=this.chart.pointer.getCoordinates(t),n=getAssignedAxis(t.xAxis),t=getAssignedAxis(t.yAxis);if(n&&t)return i=this.chart.options.navigation,n=merge({langKey:"segment",type:"crookedLine",typeOptions:{xAxis:n.axis.index,yAxis:t.axis.index,points:[{x:n.value,y:t.value},{x:n.value,y:t.value}]}},i.annotationsOptions,i.bindings.segment.annotationsOptions),this.chart.addAnnotation(n)},steps:[updateNthPoint(1)]},arrowSegment:{className:"highcharts-arrow-segment",start:function(t){var i,t=this.chart.pointer.getCoordinates(t),n=getAssignedAxis(t.xAxis),t=getAssignedAxis(t.yAxis);if(n&&t)return i=this.chart.options.navigation,n=merge({langKey:"arrowSegment",type:"crookedLine",typeOptions:{line:{markerEnd:"arrow"},xAxis:n.axis.index,yAxis:t.axis.index,points:[{x:n.value,y:t.value},{x:n.value,y:t.value}]}},i.annotationsOptions,i.bindings.arrowSegment.annotationsOptions),this.chart.addAnnotation(n)},steps:[updateNthPoint(1)]},ray:{className:"highcharts-ray",start:function(t){var i,t=this.chart.pointer.getCoordinates(t),n=getAssignedAxis(t.xAxis),t=getAssignedAxis(t.yAxis);if(n&&t)return i=this.chart.options.navigation,n=merge({langKey:"ray",type:"infinityLine",typeOptions:{type:"ray",xAxis:n.axis.index,yAxis:t.axis.index,points:[{x:n.value,y:t.value},{x:n.value,y:t.value}]}},i.annotationsOptions,i.bindings.ray.annotationsOptions),this.chart.addAnnotation(n)},steps:[updateNthPoint(1)]},arrowRay:{className:"highcharts-arrow-ray",start:function(t){var i,t=this.chart.pointer.getCoordinates(t),n=getAssignedAxis(t.xAxis),t=getAssignedAxis(t.yAxis);if(n&&t)return i=this.chart.options.navigation,n=merge({langKey:"arrowRay",type:"infinityLine",typeOptions:{type:"ray",line:{markerEnd:"arrow"},xAxis:n.axis.index,yAxis:t.axis.index,points:[{x:n.value,y:t.value},{x:n.value,y:t.value}]}},i.annotationsOptions,i.bindings.arrowRay.annotationsOptions),this.chart.addAnnotation(n)},steps:[updateNthPoint(1)]},infinityLine:{className:"highcharts-infinity-line",start:function(t){var i,t=this.chart.pointer.getCoordinates(t),n=getAssignedAxis(t.xAxis),t=getAssignedAxis(t.yAxis);if(n&&t)return i=this.chart.options.navigation,n=merge({langKey:"infinityLine",type:"infinityLine",typeOptions:{type:"line",xAxis:n.axis.index,yAxis:t.axis.index,points:[{x:n.value,y:t.value},{x:n.value,y:t.value}]}},i.annotationsOptions,i.bindings.infinityLine.annotationsOptions),this.chart.addAnnotation(n)},steps:[updateNthPoint(1)]},arrowInfinityLine:{className:"highcharts-arrow-infinity-line",start:function(t){var i,t=this.chart.pointer.getCoordinates(t),n=getAssignedAxis(t.xAxis),t=getAssignedAxis(t.yAxis);if(n&&t)return i=this.chart.options.navigation,n=merge({langKey:"arrowInfinityLine",type:"infinityLine",typeOptions:{type:"line",line:{markerEnd:"arrow"},xAxis:n.axis.index,yAxis:t.axis.index,points:[{x:n.value,y:t.value},{x:n.value,y:t.value}]}},i.annotationsOptions,i.bindings.arrowInfinityLine.annotationsOptions),this.chart.addAnnotation(n)},steps:[updateNthPoint(1)]},horizontalLine:{className:"highcharts-horizontal-line",start:function(t){var i,t=this.chart.pointer.getCoordinates(t),n=getAssignedAxis(t.xAxis),t=getAssignedAxis(t.yAxis);n&&t&&(i=this.chart.options.navigation,n=merge({langKey:"horizontalLine",type:"infinityLine",draggable:"y",typeOptions:{type:"horizontalLine",xAxis:n.axis.index,yAxis:t.axis.index,points:[{x:n.value,y:t.value}]}},i.annotationsOptions,i.bindings.horizontalLine.annotationsOptions),this.chart.addAnnotation(n))}},verticalLine:{className:"highcharts-vertical-line",start:function(t){var i,t=this.chart.pointer.getCoordinates(t),n=getAssignedAxis(t.xAxis),t=getAssignedAxis(t.yAxis);n&&t&&(i=this.chart.options.navigation,n=merge({langKey:"verticalLine",type:"infinityLine",draggable:"x",typeOptions:{type:"verticalLine",xAxis:n.axis.index,yAxis:t.axis.index,points:[{x:n.value,y:t.value}]}},i.annotationsOptions,i.bindings.verticalLine.annotationsOptions),this.chart.addAnnotation(n))}},crooked3:{className:"highcharts-crooked3",start:function(t){var i,n,s,t=this.chart.pointer.getCoordinates(t),e=getAssignedAxis(t.xAxis),t=getAssignedAxis(t.yAxis);if(e&&t)return i=e.value,n=t.value,s=this.chart.options.navigation,e=merge({langKey:"crooked3",type:"crookedLine",typeOptions:{xAxis:e.axis.index,yAxis:t.axis.index,points:[{x:i,y:n},{x:i,y:n},{x:i,y:n}]}},s.annotationsOptions,s.bindings.crooked3.annotationsOptions),this.chart.addAnnotation(e)},steps:[updateNthPoint(1),updateNthPoint(2)]},crooked5:{className:"highcharts-crooked5",start:function(t){var i,n,s,t=this.chart.pointer.getCoordinates(t),e=getAssignedAxis(t.xAxis),t=getAssignedAxis(t.yAxis);if(e&&t)return i=e.value,n=t.value,s=this.chart.options.navigation,e=merge({langKey:"crooked5",type:"crookedLine",typeOptions:{xAxis:e.axis.index,yAxis:t.axis.index,points:[{x:i,y:n},{x:i,y:n},{x:i,y:n},{x:i,y:n},{x:i,y:n}]}},s.annotationsOptions,s.bindings.crooked5.annotationsOptions),this.chart.addAnnotation(e)},steps:[updateNthPoint(1),updateNthPoint(2),updateNthPoint(3),updateNthPoint(4)]},elliott3:{className:"highcharts-elliott3",start:function(t){var i,n,s,t=this.chart.pointer.getCoordinates(t),e=getAssignedAxis(t.xAxis),t=getAssignedAxis(t.yAxis);if(e&&t)return i=e.value,n=t.value,s=this.chart.options.navigation,e=merge({langKey:"elliott3",type:"elliottWave",typeOptions:{xAxis:e.axis.index,yAxis:t.axis.index,points:[{x:i,y:n},{x:i,y:n},{x:i,y:n},{x:i,y:n}]},labelOptions:{style:{color:"#666666"}}},s.annotationsOptions,s.bindings.elliott3.annotationsOptions),this.chart.addAnnotation(e)},steps:[updateNthPoint(1),updateNthPoint(2),updateNthPoint(3)]},elliott5:{className:"highcharts-elliott5",start:function(t){var i,n,s,t=this.chart.pointer.getCoordinates(t),e=getAssignedAxis(t.xAxis),t=getAssignedAxis(t.yAxis);if(e&&t)return i=e.value,n=t.value,s=this.chart.options.navigation,e=merge({langKey:"elliott5",type:"elliottWave",typeOptions:{xAxis:e.axis.index,yAxis:t.axis.index,points:[{x:i,y:n},{x:i,y:n},{x:i,y:n},{x:i,y:n},{x:i,y:n},{x:i,y:n}]},labelOptions:{style:{color:"#666666"}}},s.annotationsOptions,s.bindings.elliott5.annotationsOptions),this.chart.addAnnotation(e)},steps:[updateNthPoint(1),updateNthPoint(2),updateNthPoint(3),updateNthPoint(4),updateNthPoint(5)]},measureX:{className:"highcharts-measure-x",start:function(t){var i,n,s,t=this.chart.pointer.getCoordinates(t),e=getAssignedAxis(t.xAxis),t=getAssignedAxis(t.yAxis);if(e&&t)return i=e.value,n=t.value,s=this.chart.options.navigation,e=merge({langKey:"measure",type:"measure",typeOptions:{selectType:"x",xAxis:e.axis.index,yAxis:t.axis.index,point:{x:i,y:n},crosshairX:{strokeWidth:1,stroke:"#000000"},crosshairY:{enabled:!1,strokeWidth:0,stroke:"#000000"},background:{width:0,height:0,strokeWidth:0,stroke:"#ffffff"}},labelOptions:{style:{color:"#666666"}}},s.annotationsOptions,s.bindings.measureX.annotationsOptions),this.chart.addAnnotation(e)},steps:[updateRectSize]},measureY:{className:"highcharts-measure-y",start:function(t){var i,n,s,t=this.chart.pointer.getCoordinates(t),e=getAssignedAxis(t.xAxis),t=getAssignedAxis(t.yAxis);if(e&&t)return i=e.value,n=t.value,s=this.chart.options.navigation,e=merge({langKey:"measure",type:"measure",typeOptions:{selectType:"y",xAxis:e.axis.index,yAxis:t.axis.index,point:{x:i,y:n},crosshairX:{enabled:!1,strokeWidth:0,stroke:"#000000"},crosshairY:{strokeWidth:1,stroke:"#000000"},background:{width:0,height:0,strokeWidth:0,stroke:"#ffffff"}},labelOptions:{style:{color:"#666666"}}},s.annotationsOptions,s.bindings.measureY.annotationsOptions),this.chart.addAnnotation(e)},steps:[updateRectSize]},measureXY:{className:"highcharts-measure-xy",start:function(t){var i,n,s,t=this.chart.pointer.getCoordinates(t),e=getAssignedAxis(t.xAxis),t=getAssignedAxis(t.yAxis);if(e&&t)return i=e.value,n=t.value,s=this.chart.options.navigation,e=merge({langKey:"measure",type:"measure",typeOptions:{selectType:"xy",xAxis:e.axis.index,yAxis:t.axis.index,point:{x:i,y:n},background:{width:0,height:0,strokeWidth:10},crosshairX:{strokeWidth:1,stroke:"#000000"},crosshairY:{strokeWidth:1,stroke:"#000000"}},labelOptions:{style:{color:"#666666"}}},s.annotationsOptions,s.bindings.measureXY.annotationsOptions),this.chart.addAnnotation(e)},steps:[updateRectSize]},fibonacci:{className:"highcharts-fibonacci",start:function(t){var i,n,s,t=this.chart.pointer.getCoordinates(t),e=getAssignedAxis(t.xAxis),t=getAssignedAxis(t.yAxis);if(e&&t)return i=e.value,n=t.value,s=this.chart.options.navigation,e=merge({langKey:"fibonacci",type:"fibonacci",typeOptions:{xAxis:e.axis.index,yAxis:t.axis.index,points:[{x:i,y:n},{x:i,y:n}]},labelOptions:{style:{color:"#666666"}}},s.annotationsOptions,s.bindings.fibonacci.annotationsOptions),this.chart.addAnnotation(e)},steps:[updateNthPoint(1),updateHeight]},parallelChannel:{className:"highcharts-parallel-channel",start:function(t){var i,n,s,t=this.chart.pointer.getCoordinates(t),e=getAssignedAxis(t.xAxis),t=getAssignedAxis(t.yAxis);if(e&&t)return i=e.value,n=t.value,s=this.chart.options.navigation,e=merge({langKey:"parallelChannel",type:"tunnel",typeOptions:{xAxis:e.axis.index,yAxis:t.axis.index,points:[{x:i,y:n},{x:i,y:n}]}},s.annotationsOptions,s.bindings.parallelChannel.annotationsOptions),this.chart.addAnnotation(e)},steps:[updateNthPoint(1),updateHeight]},pitchfork:{className:"highcharts-pitchfork",start:function(t){var i,n,s,t=this.chart.pointer.getCoordinates(t),e=getAssignedAxis(t.xAxis),t=getAssignedAxis(t.yAxis);if(e&&t)return i=e.value,n=t.value,s=this.chart.options.navigation,e=merge({langKey:"pitchfork",type:"pitchfork",typeOptions:{xAxis:e.axis.index,yAxis:t.axis.index,points:[{x:e.value,y:t.value,controlPoint:{style:{fill:"#f21313"}}},{x:i,y:n},{x:i,y:n}],innerBackground:{fill:"rgba(100, 170, 255, 0.8)"}},shapeOptions:{strokeWidth:2}},s.annotationsOptions,s.bindings.pitchfork.annotationsOptions),this.chart.addAnnotation(e)},steps:[updateNthPoint(1),updateNthPoint(2)]},verticalCounter:{className:"highcharts-vertical-counter",start:function(t){t=attractToPoint(t,this.chart);if(t){this.verticalCounter=this.verticalCounter||0;const i=this.chart.options.navigation,n=merge({langKey:"verticalCounter",type:"verticalLine",typeOptions:{point:{x:t.x,y:t.y,xAxis:t.xAxis,yAxis:t.yAxis},label:{offset:t.below?40:-40,text:this.verticalCounter.toString()}},labelOptions:{style:{color:"#666666",fontSize:"0.7em"}},shapeOptions:{stroke:"rgba(0, 0, 0, 0.75)",strokeWidth:1}},i.annotationsOptions,i.bindings.verticalCounter.annotationsOptions),s=this.chart.addAnnotation(n);this.verticalCounter++,s.options.events.click.call(s,{})}}},timeCycles:{className:"highcharts-time-cycles",start:function(t){t=attractToPoint(t,this.chart);if(t){const i=this.chart.options.navigation,n=merge({langKey:"timeCycles",type:"timeCycles",typeOptions:{xAxis:t.xAxis,yAxis:t.yAxis,points:[{x:t.x},{x:t.x}],line:{stroke:"rgba(0, 0, 0, 0.75)",fill:"transparent",strokeWidth:2}}},i.annotationsOptions,i.bindings.timeCycles.annotationsOptions),s=this.chart.addAnnotation(n);return s.options.events.click.call(s,{}),s}},steps:[updateNthPoint(1)]},verticalLabel:{className:"highcharts-vertical-label",start:function(t){t=attractToPoint(t,this.chart);if(t){const i=this.chart.options.navigation,n=merge({langKey:"verticalLabel",type:"verticalLine",typeOptions:{point:{x:t.x,y:t.y,xAxis:t.xAxis,yAxis:t.yAxis},label:{offset:t.below?40:-40}},labelOptions:{style:{color:"#666666",fontSize:"0.7em"}},shapeOptions:{stroke:"rgba(0, 0, 0, 0.75)",strokeWidth:1}},i.annotationsOptions,i.bindings.verticalLabel.annotationsOptions),s=this.chart.addAnnotation(n);s.options.events.click.call(s,{})}}},verticalArrow:{className:"highcharts-vertical-arrow",start:function(t){t=attractToPoint(t,this.chart);if(t){const i=this.chart.options.navigation,n=merge({langKey:"verticalArrow",type:"verticalLine",typeOptions:{point:{x:t.x,y:t.y,xAxis:t.xAxis,yAxis:t.yAxis},label:{offset:t.below?40:-40,format:" "},connector:{fill:"none",stroke:t.below?"#f21313":"#06b535"}},shapeOptions:{stroke:"rgba(0, 0, 0, 0.75)",strokeWidth:1}},i.annotationsOptions,i.bindings.verticalArrow.annotationsOptions),s=this.chart.addAnnotation(n);s.options.events.click.call(s,{})}}},fibonacciTimeZones:{className:"highcharts-fibonacci-time-zones",start:function(t){var i,t=this.chart.pointer.getCoordinates(t),n=getAssignedAxis(t.xAxis),t=getAssignedAxis(t.yAxis);if(n&&t)return i=this.chart.options.navigation,t=merge({type:"fibonacciTimeZones",langKey:"fibonacciTimeZones",typeOptions:{xAxis:n.axis.index,yAxis:t.axis.index,points:[{x:n.value}]}},i.annotationsOptions,i.bindings.fibonacciTimeZones.annotationsOptions),this.chart.addAnnotation(t)},steps:[function(t,i){var n=i.options.typeOptions.points,n=n&&n[0].x,t=this.chart.pointer.getCoordinates(t),s=getAssignedAxis(t.xAxis),t=getAssignedAxis(t.yAxis);i.update({typeOptions:{xAxis:s.axis.index,yAxis:t.axis.index,points:[{x:n},{x:s.value}]}})}]},flagCirclepin:{className:"highcharts-flag-circlepin",start:addFlagFromForm("circlepin")},flagDiamondpin:{className:"highcharts-flag-diamondpin",start:addFlagFromForm("flag")},flagSquarepin:{className:"highcharts-flag-squarepin",start:addFlagFromForm("squarepin")},flagSimplepin:{className:"highcharts-flag-simplepin",start:addFlagFromForm("nopin")},zoomX:{className:"highcharts-zoom-x",init:function(t){this.chart.update({chart:{zooming:{type:"x"}}}),fireEvent(this,"deselectButton",{button:t})}},zoomY:{className:"highcharts-zoom-y",init:function(t){this.chart.update({chart:{zooming:{type:"y"}}}),fireEvent(this,"deselectButton",{button:t})}},zoomXY:{className:"highcharts-zoom-xy",init:function(t){this.chart.update({chart:{zooming:{type:"xy"}}}),fireEvent(this,"deselectButton",{button:t})}},seriesTypeLine:{className:"highcharts-series-type-line",init:function(t){this.chart.series[0].update({type:"line",useOhlcData:!0}),fireEvent(this,"deselectButton",{button:t})}},seriesTypeOhlc:{className:"highcharts-series-type-ohlc",init:function(t){this.chart.series[0].update({type:"ohlc"}),fireEvent(this,"deselectButton",{button:t})}},seriesTypeCandlestick:{className:"highcharts-series-type-candlestick",init:function(t){this.chart.series[0].update({type:"candlestick"}),fireEvent(this,"deselectButton",{button:t})}},seriesTypeHeikinAshi:{className:"highcharts-series-type-heikinashi",init:function(t){this.chart.series[0].update({type:"heikinashi"}),fireEvent(this,"deselectButton",{button:t})}},seriesTypeHLC:{className:"highcharts-series-type-hlc",init:function(t){this.chart.series[0].update({type:"hlc",useOhlcData:!0}),fireEvent(this,"deselectButton",{button:t})}},seriesTypeHollowCandlestick:{className:"highcharts-series-type-hollowcandlestick",init:function(t){this.chart.series[0].update({type:"hollowcandlestick"}),fireEvent(this,"deselectButton",{button:t})}},fullScreen:{className:"highcharts-full-screen",noDataState:"normal",init:function(t){this.chart.fullscreen&&this.chart.fullscreen.toggle(),fireEvent(this,"deselectButton",{button:t})}},currentPriceIndicator:{className:"highcharts-current-price-indicator",init:function(t){const i=this.chart,n=i.series,s=i.stockTools,e=isPriceIndicatorEnabled(i.series);s&&s.guiEnabled&&(n.forEach(function(t){t.update({lastPrice:{enabled:!e},lastVisiblePrice:{enabled:!e,label:{enabled:!0}}},!1)}),i.redraw()),fireEvent(this,"deselectButton",{button:t})}},indicators:{className:"highcharts-indicators",init:function(){const i=this;fireEvent(i,"showPopup",{formType:"indicators",options:{},onSubmit:function(t){manageIndicators.call(i,t)}})}},toggleAnnotations:{className:"highcharts-toggle-annotations",init:function(t){const i=this.chart,n=i.stockTools,s=n.getIconsURL();this.toggledAnnotations=!this.toggledAnnotations,(i.annotations||[]).forEach(function(t){t.setVisibility(!this.toggledAnnotations)},this),n&&n.guiEnabled&&(this.toggledAnnotations?t.firstChild.style["background-image"]='url("'+s+'annotations-hidden.svg")':t.firstChild.style["background-image"]='url("'+s+'annotations-visible.svg")'),fireEvent(this,"deselectButton",{button:t})}},saveChart:{className:"highcharts-save-chart",noDataState:"normal",init:function(t){const i=this.chart,n=[],s=[],e=[],a=[];i.annotations.forEach(function(t,i){n[i]=t.userOptions}),i.series.forEach(function(t){t.is("sma")?s.push(t.userOptions):"flags"===t.type&&e.push(t.userOptions)}),i.yAxis.forEach(function(t){isNotNavigatorYAxis(t)&&a.push(t.options)}),H.win.localStorage.setItem("highcharts-chart",JSON.stringify({annotations:n,indicators:s,flags:e,yAxes:a})),fireEvent(this,"deselectButton",{button:t})}}};export default StockToolsBindings;