"use strict";import U from"../../Core/Utilities.js";const{addEvent,createElement,css,fireEvent,getStyle,isArray,merge,pick}=U;class Toolbar{constructor(t,e,i){this.arrowDown=void 0,this.arrowUp=void 0,this.arrowWrapper=void 0,this.listWrapper=void 0,this.showhideBtn=void 0,this.submenu=void 0,this.toolbar=void 0,this.wrapper=void 0,this.chart=i,this.options=t,this.lang=e,this.iconsURL=this.getIconsURL(),this.guiEnabled=t.enabled,this.visible=pick(t.visible,!0),this.placed=pick(t.placed,!1),this.eventsToUnbind=[],this.guiEnabled&&(this.createHTML(),this.init(),this.showHideNavigatorion()),fireEvent(this,"afterInit")}init(){const i=this.lang,t=this.options,s=this.toolbar,e=t.buttons,a=t.definitions,r=s.childNodes;e.forEach(t=>{const e=this.addButton(s,a,t,i);this.eventsToUnbind.push(addEvent(e.buttonWrapper,"click",()=>this.eraseActiveButtons(r,e.buttonWrapper))),isArray(a[t].items)&&this.addSubmenu(e,a[t])})}addSubmenu(t,e){const i=t.submenuArrow,s=t.buttonWrapper,a=getStyle(s,"width"),r=this.wrapper,h=this.listWrapper,o=this.toolbar.childNodes,n=this.submenu=createElement("ul",{className:"highcharts-submenu-wrapper"},void 0,s);this.addSubmenuItems(s,e),this.eventsToUnbind.push(addEvent(i,"click",t=>{if(t.stopPropagation(),this.eraseActiveButtons(o,s),0<=s.className.indexOf("highcharts-current"))h.style.width=h.startWidth+"px",s.classList.remove("highcharts-current"),n.style.display="none";else{n.style.display="block";let t=n.offsetHeight-s.offsetHeight-3;n.offsetHeight+s.offsetTop>r.offsetHeight&&s.offsetTop>t||(t=0),css(n,{top:-t+"px",left:a+3+"px"}),s.className+=" highcharts-current",h.startWidth=r.offsetWidth,h.style.width=h.startWidth+getStyle(h,"padding-left")+n.offsetWidth+3+"px"}}))}addSubmenuItems(e,i){const s=this,a=this.submenu,r=this.lang,h=this.listWrapper,t=i.items;let o;t.forEach(t=>{o=this.addButton(a,i,t,r),this.eventsToUnbind.push(addEvent(o.mainButton,"click",function(){s.switchSymbol(this,e,!0),h.style.width=h.startWidth+"px",a.style.display="none"}))});var n=a.querySelectorAll("li > .highcharts-menu-item-btn")[0];this.switchSymbol(n,!1)}eraseActiveButtons(t,e,i){[].forEach.call(t,t=>{t!==e&&(t.classList.remove("highcharts-current"),t.classList.remove("highcharts-active"),0<(i=t.querySelectorAll(".highcharts-submenu-wrapper")).length&&(i[0].style.display="none"))})}addButton(t,e,i,s={}){var e=e[i],a=e.items,r=Toolbar.prototype.classMapping,h=e.className||"",r=createElement("li",{className:pick(r[i],"")+" "+h,title:s[i]||i},void 0,t);const o=createElement("span",{className:"highcharts-menu-item-btn"},void 0,r);if(a&&a.length){const n=createElement("span",{className:"highcharts-submenu-item-arrow highcharts-arrow-right"},void 0,r);return n.style.backgroundImage="url("+this.iconsURL+"arrow-bottom.svg)",{buttonWrapper:r,mainButton:o,submenuArrow:n}}return o.style.backgroundImage="url("+this.iconsURL+e.symbol+")",{buttonWrapper:r,mainButton:o}}addNavigation(){const t=this.wrapper;this.arrowWrapper=createElement("div",{className:"highcharts-arrow-wrapper"}),this.arrowUp=createElement("div",{className:"highcharts-arrow-up"},void 0,this.arrowWrapper),this.arrowUp.style.backgroundImage="url("+this.iconsURL+"arrow-right.svg)",this.arrowDown=createElement("div",{className:"highcharts-arrow-down"},void 0,this.arrowWrapper),this.arrowDown.style.backgroundImage="url("+this.iconsURL+"arrow-right.svg)",t.insertBefore(this.arrowWrapper,t.childNodes[0]),this.scrollButtons()}scrollButtons(){const t=this.wrapper,e=this.toolbar,i=.1*t.offsetHeight;let s=0;this.eventsToUnbind.push(addEvent(this.arrowUp,"click",()=>{0<s&&(s-=i,e.style.marginTop=-s+"px")})),this.eventsToUnbind.push(addEvent(this.arrowDown,"click",()=>{t.offsetHeight+s<=e.offsetHeight+i&&(s+=i,e.style.marginTop=-s+"px")}))}createHTML(){const e=this.chart,t=this.options,i=e.container,s=e.options.navigation,a=s&&s.bindingsClassName;let r,h;const o=this.wrapper=createElement("div",{className:"highcharts-stocktools-wrapper "+t.className+" "+a});i.appendChild(o),["mousedown","mousemove","click","touchstart"].forEach(t=>{addEvent(o,t,t=>t.stopPropagation())}),addEvent(o,"mouseover",t=>e.pointer.onContainerMouseLeave(t)),this.toolbar=h=createElement("ul",{className:"highcharts-stocktools-toolbar "+t.toolbarClassName}),this.listWrapper=r=createElement("div",{className:"highcharts-menu-wrapper"}),o.insertBefore(r,o.childNodes[0]),r.insertBefore(h,r.childNodes[0]),this.showHideToolbar(),this.addNavigation()}showHideNavigatorion(){this.visible&&this.toolbar.offsetHeight>this.wrapper.offsetHeight-50?this.arrowWrapper.style.display="block":(this.toolbar.style.marginTop="0px",this.arrowWrapper.style.display="none")}showHideToolbar(){const t=this.chart,e=this.wrapper,i=this.listWrapper,s=this.submenu,a=this.showhideBtn=createElement("div",{className:"highcharts-toggle-toolbar highcharts-arrow-left"},void 0,e);let r=this.visible;a.style.backgroundImage="url("+this.iconsURL+"arrow-right.svg)",r?(e.style.height="100%",a.style.top=getStyle(i,"padding-top")+"px",a.style.left=e.offsetWidth+getStyle(i,"padding-left")+"px"):(s&&(s.style.display="none"),a.style.left="0px",r=this.visible=!1,i.classList.add("highcharts-hide"),a.classList.toggle("highcharts-arrow-right"),e.style.height=a.offsetHeight+"px"),this.eventsToUnbind.push(addEvent(a,"click",()=>{t.update({stockTools:{gui:{visible:!r,placed:!0}}})}))}switchSymbol(t,e){const i=t.parentNode,s=i.className,a=i.parentNode.parentNode;-1<s.indexOf("highcharts-disabled-btn")||(a.className="",s&&a.classList.add(s.trim()),a.querySelectorAll(".highcharts-menu-item-btn")[0].style.backgroundImage=t.style.backgroundImage,e&&this.toggleButtonActiveClass(a))}toggleButtonActiveClass(t){const e=t.classList;e.contains("highcharts-active")?e.remove("highcharts-active"):e.add("highcharts-active")}unselectAllButtons(e){var t=e.parentNode.querySelectorAll(".highcharts-active");[].forEach.call(t,t=>{t!==e&&t.classList.remove("highcharts-active")})}update(t,e){merge(!0,this.chart.options.stockTools,t),this.destroy(),this.chart.setStockTools(t),this.chart.navigationBindings&&this.chart.navigationBindings.update(),this.chart.isDirtyBox=!0,pick(e,!0)&&this.chart.redraw()}destroy(){const t=this.wrapper,e=t&&t.parentNode;this.eventsToUnbind.forEach(t=>t()),e&&e.removeChild(t)}redraw(){this.showHideNavigatorion()}getIconsURL(){return this.chart.options.navigation.iconsURL||this.options.iconsURL||"https://code.highcharts.com/11.2.0/gfx/stock-icons/"}}Toolbar.prototype.classMapping={circle:"highcharts-circle-annotation",ellipse:"highcharts-ellipse-annotation",rectangle:"highcharts-rectangle-annotation",label:"highcharts-label-annotation",segment:"highcharts-segment",arrowSegment:"highcharts-arrow-segment",ray:"highcharts-ray",arrowRay:"highcharts-arrow-ray",line:"highcharts-infinity-line",arrowInfinityLine:"highcharts-arrow-infinity-line",verticalLine:"highcharts-vertical-line",horizontalLine:"highcharts-horizontal-line",crooked3:"highcharts-crooked3",crooked5:"highcharts-crooked5",elliott3:"highcharts-elliott3",elliott5:"highcharts-elliott5",pitchfork:"highcharts-pitchfork",fibonacci:"highcharts-fibonacci",fibonacciTimeZones:"highcharts-fibonacci-time-zones",parallelChannel:"highcharts-parallel-channel",measureX:"highcharts-measure-x",measureY:"highcharts-measure-y",measureXY:"highcharts-measure-xy",timeCycles:"highcharts-time-cycles",verticalCounter:"highcharts-vertical-counter",verticalLabel:"highcharts-vertical-label",verticalArrow:"highcharts-vertical-arrow",currentPriceIndicator:"highcharts-current-price-indicator",indicators:"highcharts-indicators",flagCirclepin:"highcharts-flag-circlepin",flagDiamondpin:"highcharts-flag-diamondpin",flagSquarepin:"highcharts-flag-squarepin",flagSimplepin:"highcharts-flag-simplepin",zoomX:"highcharts-zoom-x",zoomY:"highcharts-zoom-y",zoomXY:"highcharts-zoom-xy",typeLine:"highcharts-series-type-line",typeOHLC:"highcharts-series-type-ohlc",typeHLC:"highcharts-series-type-hlc",typeCandlestick:"highcharts-series-type-candlestick",typeHollowCandlestick:"highcharts-series-type-hollowcandlestick",typeHeikinAshi:"highcharts-series-type-heikinashi",fullScreen:"highcharts-full-screen",toggleAnnotations:"highcharts-toggle-annotations",saveChart:"highcharts-save-chart",separator:"highcharts-separator"};export default Toolbar;