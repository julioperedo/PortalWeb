"use strict";import D from"../../Core/Defaults.js";const setOptions=D["setOptions"];import NBU from"../../Extensions/Annotations/NavigationBindingsUtilities.js";const getAssignedAxis=NBU["getAssignedAxis"];import StockToolsBindings from"./StockToolsBindings.js";import StockToolsDefaults from"./StockToolsDefaults.js";import STU from"./StockToolsUtilities.js";const{isNotNavigatorYAxis,isPriceIndicatorEnabled}=STU;import U from"../../Core/Utilities.js";const{correctFloat,defined,isNumber,pick}=U,composedMembers=[];function compose(t){if(U.pushUnique(composedMembers,t)){const o=t.prototype;o.getYAxisPositions=navigationGetYAxisPositions,o.getYAxisResizers=navigationGetYAxisResizers,o.recalculateYAxisPositions=navigationRecalculateYAxisPositions,o.resizeYAxes=navigationResizeYAxes,o.utils={indicatorsWithAxes:STU.indicatorsWithAxes,indicatorsWithVolume:STU.indicatorsWithVolume,getAssignedAxis:getAssignedAxis,isPriceIndicatorEnabled:isPriceIndicatorEnabled,manageIndicators:STU.manageIndicators}}U.pushUnique(composedMembers,setOptions)&&(setOptions(StockToolsDefaults),setOptions({navigation:{bindings:StockToolsBindings}}))}function navigationGetYAxisPositions(e,n,r,t){let a=0,c,l,p;function g(t){return defined(t)&&!isNumber(t)&&t.match("%")}return t&&(p=correctFloat(parseFloat(t.top)/100),l=correctFloat(parseFloat(t.height)/100)),{positions:e.map((t,o)=>{let i=correctFloat(g(t.options.height)?parseFloat(t.options.height)/100:t.height/n),s=correctFloat(g(t.options.top)?parseFloat(t.options.top)/100:(t.top-t.chart.plotTop)/n);return a=l?(s>p&&(s-=l),Math.max(a,(s||0)+(i||0))):(isNumber(i)||(i=e[o-1].series.every(t=>t.is("sma"))?c:r/100),isNumber(s)||(s=a),c=i,correctFloat(Math.max(a,(s||0)+(i||0)))),{height:100*i,top:100*s}}),allAxesHeight:a}}function navigationGetYAxisResizers(s){const e=[];return s.forEach(function(t,o){var i=s[o+1];e[o]=i?{enabled:!0,controlledAxis:{next:[pick(i.options.id,i.index)]}}:{enabled:!1}}),e}function navigationRecalculateYAxisPositions(i,s,e,n){return i.forEach(function(t,o){o=i[o-1];t.top=o?correctFloat(o.height+o.top):0,e&&(t.height=correctFloat(t.height+n*s))}),i}function navigationResizeYAxes(t){const o=this.chart,i=o.yAxis.filter(isNotNavigatorYAxis),s=o.plotHeight,{positions:e,allAxesHeight:n}=this.getYAxisPositions(i,s,20,t),r=this.getYAxisResizers(i);!t&&n<=correctFloat(1)?e[e.length-1]={height:20,top:correctFloat(100*n-20)}:e.forEach(function(t){t.height=t.height/(100*n)*100,t.top=t.top/(100*n)*100}),e.forEach(function(t,o){i[o].update({height:t.height+"%",top:t.top+"%",resize:r[o],offset:0},!1)})}const StockTools={compose:compose};export default StockTools;