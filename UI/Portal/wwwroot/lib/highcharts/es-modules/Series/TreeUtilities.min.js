"use strict";import Color from"../Core/Color/Color.js";import U from"../Core/Utilities.js";const{extend,isArray,isNumber,isObject,merge,pick}=U;function getColor(e,o){const t=o.index,i=o.mapOptionsToLevel,l=o.parentColor,r=o.parentColorIndex,s=o.series,n=o.colors,c=o.siblings,a=s.points,d=s.chart.options.chart;let p,u,v,b,m,f;var g;return e&&(p=a[e.i],u=i[e.level]||{},p&&u.colorByPoint&&(b=p.index%(n?n.length:d.colorCount),v=n&&n[b]),s.chart.styledMode||(m=pick(p&&p.options.color,u&&u.color,v,l&&(e=l,(g=u&&u.colorVariation)&&"brightness"===g.key&&t&&c?Color.parse(e).brighten(g.to*(t/c)).get():e),s.color)),f=pick(p&&p.options.colorIndex,u&&u.colorIndex,b,r,o.colorIndex)),{color:m,colorIndex:f}}function getLevelOptions(e){let o={},r,t,i,s,l,n;if(isObject(e))for(s=isNumber(e.from)?e.from:1,n=e.levels,t={},r=isObject(e.defaults)?e.defaults:{},isArray(n)&&(t=n.reduce((e,o)=>{let t,i,l;return isObject(o)&&isNumber(o.level)&&(l=merge({},o),i=pick(l.levelIsConstant,r.levelIsConstant),delete l.levelIsConstant,delete l.level,t=o.level+(i?0:s-1),isObject(e[t])?merge(!0,e[t],l):e[t]=l),e},{})),l=isNumber(e.to)?e.to:1,i=0;i<=l;i++)o[i]=merge({},r,isObject(t[i])?t[i]:{});return o}function setTreeValues(i,l){const e=l.before,o=l.idRoot,t=l.mapIdToNode,r=t[o],s=!1!==l.levelIsConstant,n=l.points,c=n[i.i],a=c&&c.options||{},d=[];let p=0;i.levelDynamic=i.level-(s?0:r.level),i.name=pick(c&&c.name,""),i.visible=o===i.id||!0===l.visible,(i="function"==typeof e?e(i,l):i).children.forEach((e,o)=>{var t=extend({},l);extend(t,{index:o,siblings:i.children.length,visible:i.visible}),e=setTreeValues(e,t),d.push(e),e.visible&&(p+=e.val)});var u=pick(a.value,p);return i.visible=0<=u&&(0<p||i.visible),i.children=d,i.childrenTotal=p,i.isLeaf=i.visible&&!p,i.val=u,i}function updateRootId(e){let o,t;return isObject(e)&&(t=isObject(e.options)?e.options:{},o=pick(e.rootNode,t.rootId,""),isObject(e.userOptions)&&(e.userOptions.rootId=o),e.rootNode=o),o}const TreeUtilities={getColor:getColor,getLevelOptions:getLevelOptions,setTreeValues:setTreeValues,updateRootId:updateRootId};export default TreeUtilities;