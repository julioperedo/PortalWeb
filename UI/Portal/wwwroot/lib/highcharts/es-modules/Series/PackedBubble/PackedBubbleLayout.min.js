"use strict";import GraphLayout from"../GraphLayoutComposition.js";import PackedBubbleIntegration from"./PackedBubbleIntegration.js";import ReingoldFruchtermanLayout from"../Networkgraph/ReingoldFruchtermanLayout.js";import U from"../../Core/Utilities.js";const{addEvent,pick}=U,composedMembers=[];function chartGetSelectedParentNodes(){const e=this.series,t=[];return e.forEach(e=>{e.parentNode&&e.parentNode.selected&&t.push(e.parentNode)}),t}function onChartBeforeRedraw(){this.allDataPoints&&delete this.allDataPoints}class PackedBubbleLayout extends ReingoldFruchtermanLayout{constructor(){super(...arguments),this.index=NaN,this.nodes=[],this.options=void 0,this.series=[]}static compose(e){if(ReingoldFruchtermanLayout.compose(e),GraphLayout.integrations.packedbubble=PackedBubbleIntegration,GraphLayout.layouts.packedbubble=PackedBubbleLayout,U.pushUnique(composedMembers,e)){addEvent(e,"beforeRedraw",onChartBeforeRedraw);const t=e.prototype;t.getSelectedParentNodes=chartGetSelectedParentNodes}}beforeStep(){this.options.marker&&this.series.forEach(e=>{e&&e.calculateParentRadius()})}isStable(){var e=Math.abs(this.prevSystemTemperature-this.systemTemperature),t=10*this.systemTemperature/Math.sqrt(this.nodes.length);return Math.abs(t)<1&&e<1e-5||this.temperature<=0}setCircularPositions(){var e=this,t=e.box,s=e.nodes,o=s.length+1,r=2*Math.PI/o,i=e.options.initialPositionRadius;let a,n,p=0;for(const d of s)n=e.options.splitSeries&&!d.isParentNode?(a=d.series.parentNode.plotX,d.series.parentNode.plotY):(a=t.width/2,t.height/2),d.plotX=d.prevX=pick(d.plotX,a+i*Math.cos(d.index||p*r)),d.plotY=d.prevY=pick(d.plotY,n+i*Math.sin(d.index||p*r)),d.dispX=0,d.dispY=0,p++}repulsiveForces(){const s=this,o=s.options.bubblePadding;let r,i,a;s.nodes.forEach(t=>{t.degree=t.mass,t.neighbours=0,s.nodes.forEach(e=>{r=0,t===e||t.fixedPosition||!s.options.seriesInteraction&&t.series!==e.series||(a=s.getDistXY(t,e),(i=s.vectorLength(a)-(t.marker.radius+e.marker.radius+o))<0&&(t.degree+=.01,t.neighbours++,r=s.repulsiveForce(-i/Math.sqrt(t.neighbours),s.k,t,e)),s.force("repulsive",t,r*e.mass,a,e,i))})})}applyLimitBox(e,t){var s,o=this;o.options.splitSeries&&!e.isParentNode&&o.options.parentNodeLimit&&(s=o.getDistXY(e,e.series.parentNode),(o=e.series.parentNodeRadius-e.marker.radius-o.vectorLength(s))<0&&o>-2*e.marker.radius&&(e.plotX-=.01*s.x,e.plotY-=.01*s.y)),super.applyLimitBox(e,t)}}export default GraphLayout.layouts.packedbubble=PackedBubbleLayout;