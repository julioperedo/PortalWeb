"use strict";import SeriesRegistry from"../../Core/Series/SeriesRegistry.js";const{column:ColumnSeries,line:LineSeries}=SeriesRegistry.seriesTypes;import TimelinePoint from"./TimelinePoint.js";import TimelineSeriesDefaults from"./TimelineSeriesDefaults.js";import U from"../../Core/Utilities.js";const{addEvent,arrayMax,arrayMin,defined,extend,merge,pick}=U;class TimelineSeries extends LineSeries{constructor(){super(...arguments),this.data=void 0,this.options=void 0,this.points=void 0,this.userOptions=void 0,this.visibilityMap=void 0}alignDataLabel(e,t,i,s){const a=this,r=a.chart.inverted,n=a.visibilityMap.filter(e=>!!e),o=a.visiblePointsCount||0,l=n.indexOf(e),d=!l||l===o-1,p=a.options.dataLabels,h=e.userDLOptions||{},u=p.alternate?d?1.5:2:1,c=Math.floor(a.xAxis.len/o),m=t.padding;let b,f,x;e.visible&&(b=Math.abs(h.x||e.options.dataLabels.x),x=r?(f=2*(b-m)-(e.itemHeight||0)/2,{width:pick(p.style?.width,.4*a.yAxis.len+"px"),textOverflow:(t.width||0)/f*(t.height||0)/2>c*u?"ellipsis":"none"}):{width:(h.width||p.width||c*u-2*m)+"px"},t.css(x),a.chart.styledMode||t.shadow(p.shadow)),super.alignDataLabel.apply(a,arguments)}bindAxes(){var e=this;super.bindAxes(),e.xAxis.userOptions.type||(e.xAxis.categories=e.xAxis.hasNames=!0)}distributeDL(){var e=this,t=e.options.dataLabels,i=e.chart.inverted;let s=1;if(t){var a=pick(t.distance,i?20:100);for(const r of e.points){const n={[i?"x":"y"]:t.alternate&&s%2?-a:a};i&&(n.align=t.alternate&&s%2?"right":"left"),r.options.dataLabels=merge(n,r.userDLOptions),s++}}}generatePoints(){super.generatePoints();const i=this,s=i.points;for(let e=0,t=s.length;e<t;++e)s[e].applyOptions({x:i.xData[e]},i.xData[e])}getVisibilityMap(){var e=this;return(e.data.length?e.data:e.userOptions.data||[]).map(e=>!(!e||!1===e.visible||e.isNull)&&e)}getXExtremes(e){const i=this,t=e.filter((e,t)=>i.points[t].isValid()&&i.points[t].visible);return{min:arrayMin(t),max:arrayMax(t)}}init(){const s=this;super.init.apply(s,arguments),s.eventsToUnbind.push(addEvent(s,"afterTranslate",function(){let e,t=Number.MAX_VALUE;for(const i of s.points)i.isInside=i.isInside&&i.visible,i.visible&&!i.isNull&&(defined(e)&&(t=Math.min(t,Math.abs(i.plotX-e))),e=i.plotX);s.closestPointRangePx=t})),s.eventsToUnbind.push(addEvent(s,"drawDataLabels",function(){s.distributeDL()})),s.eventsToUnbind.push(addEvent(s,"afterDrawDataLabels",function(){let e;for(const t of s.points)(e=t.dataLabel)&&(e.animate=function(e){return this.targetPosition&&(this.targetPosition=e),this.renderer.Element.prototype.animate.apply(this,arguments)},e.targetPosition||(e.targetPosition={}),t.drawConnector())})),s.eventsToUnbind.push(addEvent(s.chart,"afterHideOverlappingLabel",function(){for(const e of s.points)e.dataLabel&&e.dataLabel.connector&&e.dataLabel.oldOpacity!==e.dataLabel.newOpacity&&e.alignConnector()}))}markerAttribs(e,t){const i=this,s=i.options.marker,a=e.marker||{},r=a.symbol||s.symbol,n=pick(a.width,s.width,i.closestPointRangePx),o=pick(a.height,s.height);let l,d,p=0;if(i.xAxis.dateTime)return super.markerAttribs(e,t);t&&(l=s.states[t]||{},d=a.states&&a.states[t]||{},p=pick(d.radius,l.radius,p+(l.radiusPlus||0))),e.hasImage=r&&0===r.indexOf("url");t={x:Math.floor(e.plotX)-n/2-p/2,y:e.plotY-o/2-p/2,width:n+p,height:o+p};return i.chart.inverted?{y:t.x&&t.width&&i.xAxis.len-t.x-t.width,x:t.y,width:t.height,height:t.width}:t}processData(){var e=this;let t=0,i;e.visibilityMap=e.getVisibilityMap();for(const s of e.visibilityMap)s&&t++;for(e.visiblePointsCount=t,i=0;i<e.xData.length;i++)e.yData[i]=1;super.processData.call(this,arguments)}}TimelineSeries.defaultOptions=merge(LineSeries.defaultOptions,TimelineSeriesDefaults),extend(TimelineSeries.prototype,{drawTracker:ColumnSeries.prototype.drawTracker,pointClass:TimelinePoint,trackerGroups:["markerGroup","dataLabelsGroup"]}),SeriesRegistry.registerSeriesType("timeline",TimelineSeries);export default TimelineSeries;