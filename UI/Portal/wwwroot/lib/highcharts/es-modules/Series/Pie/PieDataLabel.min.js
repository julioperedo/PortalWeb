"use strict";import DataLabel from"../../Core/Series/DataLabel.js";import H from"../../Core/Globals.js";const noop=H["noop"];import R from"../../Core/Renderer/RendererUtilities.js";const distribute=R["distribute"];import SeriesRegistry from"../../Core/Series/SeriesRegistry.js";const Series=SeriesRegistry["series"];import U from"../../Core/Utilities.js";const{arrayMax,clamp,defined,pick,relativeLength}=U;var ColumnDataLabel;!function(t){const e=[],i={radialDistributionY:function(t,a){return(a.dataLabelPosition?.top||0)+t.distributeBox.pos},radialDistributionX:function(t,a,e,i,o){var r=o.dataLabelPosition;return t.getX(e<(r?.top||0)+2||e>(r?.bottom||0)-2?i:e,a.half,a,o)},justify:function(t,a,e,i){return i[0]+(t.half?-1:1)*(e+(a.dataLabelPosition?.distance||0))},alignToPlotEdges:function(t,a,e,i){t=t.getBBox().width;return a?t+i:e-t-i},alignToConnectors:function(t,a,e,i){let o=0,r;return t.forEach(function(t){(r=t.dataLabel.getBBox().width)>o&&(o=r)}),a?o+i:e-o-i}};function o(t,a){var{center:e,options:i}=this,o=e[2]/2,r=t.angle||0,s=Math.cos(r),r=Math.sin(r),n=e[0]+s*o,e=e[1]+r*o,o=Math.min((i.slicedOffset||0)+(i.borderWidth||0),a/5);return{natural:{x:n+s*a,y:e+r*a},computed:{},alignment:a<0?"center":t.half?"right":"left",connectorPosition:{breakAt:{x:n+s*o,y:e+r*o},touchingSliceAt:{x:n,y:e}},distance:a}}function r(){const u=this,t=u.points,s=u.chart,f=s.plotWidth,p=s.plotHeight,m=s.plotLeft,r=Math.round(s.chartWidth/3),g=u.center,L=g[2]/2,n=g[1],l=[[],[]],x=[0,0,0,0],y=u.dataLabelPositioners;let h,M,v,w=0;u.visible&&u.hasDataLabels?.()&&(t.forEach(t=>{(t.dataLabels||[]).forEach(t=>{t.shortened&&(t.attr({width:"auto"}).css({width:"auto",textOverflow:"clip"}),t.shortened=!1)})}),Series.prototype.drawDataLabels.apply(u),t.forEach(o=>{(o.dataLabels||[]).forEach((t,a)=>{var e=g[2]/2,i=t.options,e=relativeLength(i?.distance||0,e);0===a&&l[o.half].push(o),defined(i?.style?.width)||t.getBBox().width>r&&(t.css({width:Math.round(.7*r)+"px"}),t.shortened=!0),t.dataLabelPosition=this.getDataLabelPosition(o,e),w=Math.max(w,e)})}),l.forEach((d,c)=>{const t=d.length,b=[];let a,e,o=0,i;t&&(u.sortByAngle(d,c-.5),0<w&&(a=Math.max(0,n-L-w),e=Math.min(n+L+w,s.plotHeight),d.forEach(i=>{(i.dataLabels||[]).forEach((t,a)=>{const e=t.dataLabelPosition;e&&0<e.distance&&(e.top=Math.max(0,n-L-e.distance),e.bottom=Math.min(n+L+e.distance,s.plotHeight),o=t.getBBox().height||21,i.distributeBox={target:(t.dataLabelPosition?.natural.y||0)-e.top+o/2,size:o,rank:i.y},b.push(i.distributeBox))})}),i=e+o-a,distribute(b,i,i/5)),d.forEach(h=>{(h.dataLabels||[]).forEach(a=>{const t=a.options||{},e=h.distributeBox,i=a.dataLabelPosition,o=i?.natural.y||0,r=t.connectorPadding||0;let s=0,n=o,l="inherit";if(i){if(b&&defined(e)&&0<i.distance&&(void 0===e.pos?l="hidden":(v=e.size,n=y.radialDistributionY(h,a))),t.justify)s=y.justify(h,a,L,g);else switch(t.alignTo){case"connectors":s=y.alignToConnectors(d,c,f,m);break;case"plotEdges":s=y.alignToPlotEdges(a,c,f,m);break;default:s=y.radialDistributionX(u,h,n,o,a)}if(i.attribs={visibility:l,align:i.alignment},i.posAttribs={x:s+(t.x||0)+({left:r,right:-r}[i.alignment]||0),y:n+(t.y||0)-a.getBBox().height/2},i.computed.x=s,i.computed.y=n,pick(t.crop,!0)){M=a.getBBox().width;let t;s-M<r&&1===c?(t=Math.round(M-s+r),x[3]=Math.max(t,x[3])):s+M>f-r&&0===c&&(t=Math.round(s+M-f+r),x[1]=Math.max(t,x[1])),n-v/2<0?x[0]=Math.max(Math.round(-n+v/2),x[0]):n+v/2>p&&(x[2]=Math.max(Math.round(n+v/2-p),x[2])),i.sideOverflow=t}}})}))}),0!==arrayMax(x)&&!this.verifyDataLabelOverflow(x)||(this.placeDataLabels(),this.points.forEach(r=>{(r.dataLabels||[]).forEach(t=>{var a,{connectorColor:e,connectorWidth:i=1}=t.options||{},o=t.dataLabelPosition;i&&(h=t.connector,o&&0<o.distance?(a=!h,h||(t.connector=h=s.renderer.path().addClass("highcharts-data-label-connector  highcharts-color-"+r.colorIndex+(r.className?" "+r.className:"")).add(u.dataLabelsGroup)),s.styledMode||h.attr({"stroke-width":i,stroke:e||r.color||"#666666"}),h[a?"attr":"animate"]({d:r.getConnectorPath(t)}),h.attr({visibility:o.attribs?.visibility})):h&&(t.connector=h.destroy()))})})))}function s(){this.points.forEach(t=>{(t.dataLabels||[]).forEach(t=>{var a=t.dataLabelPosition;a?(a.sideOverflow&&(t.css({width:Math.max(t.getBBox().width-a.sideOverflow,0)+"px",textOverflow:(t.options?.style||{}).textOverflow||"ellipsis"}),t.shortened=!0),t.attr(a.attribs),t[t.moved?"animate":"attr"](a.posAttribs),t.moved=!0):t&&t.attr({y:-9999})}),delete t.distributeBox},this)}function n(t){let a=this.center,e=this.options,i=e.center,o=e.minSize||80,r=o,s=null!==e.size;return s||(null!==i[0]?r=Math.max(a[2]-Math.max(t[1],t[3]),o):(r=Math.max(a[2]-t[1]-t[3],o),a[0]+=(t[3]-t[1])/2),null!==i[1]?r=clamp(r,o,a[2]-Math.max(t[0],t[2])):(r=clamp(r,o,a[2]-t[0]-t[2]),a[1]+=(t[0]-t[2])/2),r<a[2]?(a[2]=r,a[3]=Math.min(e.thickness?Math.max(0,r-2*e.thickness):Math.max(0,relativeLength(e.innerSize||0,r)),r),this.translate(a),this.drawDataLabels&&this.drawDataLabels()):s=!0),s}t.compose=function(t){if(DataLabel.compose(Series),U.pushUnique(e,t)){const a=t.prototype;a.dataLabelPositioners=i,a.alignDataLabel=noop,a.drawDataLabels=r,a.getDataLabelPosition=o,a.placeDataLabels=s,a.verifyDataLabelOverflow=n}}}(ColumnDataLabel=ColumnDataLabel||{});export default ColumnDataLabel;