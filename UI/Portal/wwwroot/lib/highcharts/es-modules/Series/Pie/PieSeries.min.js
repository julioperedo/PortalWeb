"use strict";import CU from"../CenteredUtilities.js";const getStartAndEndRadians=CU["getStartAndEndRadians"];import ColumnSeries from"../Column/ColumnSeries.js";import H from"../../Core/Globals.js";const noop=H["noop"];import PiePoint from"./PiePoint.js";import PieSeriesDefaults from"./PieSeriesDefaults.js";import Series from"../../Core/Series/Series.js";import SeriesRegistry from"../../Core/Series/SeriesRegistry.js";import Symbols from"../../Core/Renderer/SVG/Symbols.js";import U from"../../Core/Utilities.js";const{clamp,extend,fireEvent,merge,pick,relativeLength,splat}=U;class PieSeries extends Series{constructor(){super(...arguments),this.center=void 0,this.data=void 0,this.options=void 0,this.points=void 0}animate(e){const i=this,t=i.points,s=i.startAngleRad;e||t.forEach(function(e){const t=e.graphic,r=e.shapeArgs;t&&r&&(t.attr({r:pick(e.startR,i.center&&i.center[3]/2),start:s,end:s}),t.animate({r:r.r,start:r.start,end:r.end},i.options.animation))})}drawEmpty(){var e,t,r=this.startAngleRad,i=this.endAngleRad,s=this.options;0===this.total&&this.center?(e=this.center[0],t=this.center[1],this.graph||(this.graph=this.chart.renderer.arc(e,t,this.center[1]/2,0,r,i).addClass("highcharts-empty-series").add(this.group)),this.graph.attr({d:Symbols.arc(e,t,this.center[2]/2,0,{start:r,end:i,innerR:this.center[3]/2})}),this.chart.styledMode||this.graph.attr({"stroke-width":s.borderWidth,fill:s.fillColor||"none",stroke:s.color||"#cccccc"})):this.graph&&(this.graph=this.graph.destroy())}drawPoints(){const t=this.chart.renderer;this.points.forEach(function(e){e.graphic&&e.hasNewShapeType()&&(e.graphic=e.graphic.destroy()),e.graphic||(e.graphic=t[e.shapeType](e.shapeArgs).add(e.series.group),e.delayedRendering=!0)})}generatePoints(){super.generatePoints(),this.updateTotals()}getX(e,t,r,i){var s=this.center,r=this.radii?this.radii[r.index]||0:s[2]/2,a=i.dataLabelPosition?.distance||0,e=Math.asin(clamp((e-s[1])/(r+a),-1,1));return s[0]+(t?-1:1)*(Math.cos(e)*(r+a))+(0<a?(t?-1:1)*(i.padding||0):0)}hasData(){return!!this.processedXData.length}redrawPoints(){const r=this,i=r.chart;let s,a,n,o;this.drawEmpty(),r.group&&!i.styledMode&&r.group.shadow(r.options.shadow),r.points.forEach(function(e){var t={};a=e.graphic,!e.isNull&&a?(o=e.shapeArgs,s=e.getTranslate(),i.styledMode||(n=r.pointAttribs(e,e.selected&&"select")),e.delayedRendering?(a.setRadialReference(r.center).attr(o).attr(s),i.styledMode||a.attr(n).attr({"stroke-linejoin":"round"}),e.delayedRendering=!1):(a.setRadialReference(r.center),i.styledMode||merge(!0,t,n),merge(!0,t,o,s),a.animate(t)),a.attr({visibility:e.visible?"inherit":"hidden"}),a.addClass(e.getClassName(),!0)):a&&(e.graphic=a.destroy())})}sortByAngle(e,r){e.sort(function(e,t){return void 0!==e.angle&&(t.angle-e.angle)*r})}translate(e){fireEvent(this,"translate"),this.generatePoints();var t=this,r=1e3,i=t.options,s=i.slicedOffset,a=getStartAndEndRadians(i.startAngle,i.endAngle),n=t.startAngleRad=a.start,o=(t.endAngleRad=a.end)-n,d=t.points,h=i.ignoreHiddenPoint,l=d.length;let p,c,g,m,u,f,y,S=0;for(e||(t.center=e=t.getCenter()),f=0;f<l;f++){y=d[f],p=n+S*o,!y.isValid()||h&&!y.visible||(S+=y.percentage/100),c=n+S*o;var P={x:e[0],y:e[1],r:e[2]/2,innerR:e[3]/2,start:Math.round(p*r)/r,end:Math.round(c*r)/r};y.shapeType="arc",y.shapeArgs=P,(g=(c+p)/2)>1.5*Math.PI?g-=2*Math.PI:g<-Math.PI/2&&(g+=2*Math.PI),y.slicedTranslation={translateX:Math.round(Math.cos(g)*s),translateY:Math.round(Math.sin(g)*s)},m=Math.cos(g)*e[2]/2,u=Math.sin(g)*e[2]/2,y.tooltipPos=[e[0]+.7*m,e[1]+.7*u],y.half=g<-Math.PI/2||g>Math.PI/2?1:0,y.angle=g}fireEvent(t,"afterTranslate")}updateTotals(){var e=this.points,t=e.length,r=this.options.ignoreHiddenPoint;let i,s,a=0;for(i=0;i<t;i++)!(s=e[i]).isValid()||r&&!s.visible||(a+=s.y);for(this.total=a,i=0;i<t;i++)(s=e[i]).percentage=0<a&&(s.visible||!r)?s.y/a*100:0,s.total=a}}PieSeries.defaultOptions=merge(Series.defaultOptions,PieSeriesDefaults),extend(PieSeries.prototype,{axisTypes:[],directTouch:!0,drawGraph:void 0,drawTracker:ColumnSeries.prototype.drawTracker,getCenter:CU.getCenter,getSymbol:noop,isCartesian:!1,noSharedTooltip:!0,pointAttribs:ColumnSeries.prototype.pointAttribs,pointClass:PiePoint,requireSorting:!1,searchPoint:noop,trackerGroups:["group","dataLabelsGroup"]}),SeriesRegistry.registerSeriesType("pie",PieSeries);export default PieSeries;