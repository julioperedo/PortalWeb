"use strict";import Point from"../Core/Series/Point.js";import Series from"../Core/Series/Series.js";import SeriesRegistry from"../Core/Series/SeriesRegistry.js";import SVGRenderer from"../Core/Renderer/SVG/SVGRenderer.js";const{bubble,pie,sunburst}=SeriesRegistry.seriesTypes;import U from"../Core/Utilities.js";const{addEvent,defined,find,isNumber}=U;var SeriesOnPointComposition;!function(e){const a=[];e.compose=function(e,t){var{chartGetZData:i,seriesAfterInit:s,seriesAfterRender:o,seriesGetCenter:r,seriesShowOrHide:n,seriesTranslate:d}=h.prototype;return pie.prototype.onPointSupported=!0,U.pushUnique(a,e)&&(addEvent(Series,"afterInit",s),addEvent(Series,"afterRender",o),addEvent(Series,"afterGetCenter",r),addEvent(Series,"hide",n),addEvent(Series,"show",n),addEvent(Series,"translate",d)),U.pushUnique(a,t)&&(addEvent(t,"beforeRender",i),addEvent(t,"beforeRedraw",i)),e};class h{constructor(e){this.getRadii=bubble.prototype.getRadii,this.getRadius=bubble.prototype.getRadius,this.getPxExtremes=bubble.prototype.getPxExtremes,this.getZExtremes=bubble.prototype.getZExtremes,this.chart=e.chart,this.series=e,this.options=e.options.onPoint}drawConnector(){this.connector||(this.connector=this.series.chart.renderer.path().addClass("highcharts-connector-seriesonpoint").attr({zIndex:-1}).add(this.series.markerGroup));var e=this.getConnectorAttributes();e&&this.connector.animate(e)}getConnectorAttributes(){const e=this.series.chart,t=this.options;if(t){var i=t.connectorOptions||{},s=t.position,o=e.get(t.id);if(o instanceof Point&&s&&defined(o.plotX)&&defined(o.plotY)){const r=defined(s.x)?s.x:o.plotX,n=defined(s.y)?s.y:o.plotY,d=r+(s.offsetX||0),a=n+(s.offsetY||0),h=i.width||1,p=i.stroke||this.series.color,c=i.dashstyle,f={d:SVGRenderer.prototype.crispLine([["M",r,n],["L",d,a]],h,"ceil"),"stroke-width":h};return e.styledMode||(f.stroke=p,f.dashstyle=c),f}}}seriesAfterInit(){this.onPointSupported&&this.options.onPoint&&(this.bubblePadding=!0,this.useMapGeometry=!0,this.onPoint=new h(this))}seriesAfterRender(){delete this.chart.bubbleZExtremes,this.onPoint&&this.onPoint.drawConnector()}seriesGetCenter(e){const t=this.options.onPoint,i=e.positions;t&&((s=this.chart.get(t.id))instanceof Point&&defined(s.plotX)&&defined(s.plotY)&&(i[0]=s.plotX,i[1]=s.plotY),(s=t.position)&&(defined(s.x)&&(i[0]=s.x),defined(s.y)&&(i[1]=s.y),s.offsetX&&(i[0]+=s.offsetX),s.offsetY&&(i[1]+=s.offsetY)));var s=this.radii&&this.radii[this.index];isNumber(s)&&(i[2]=2*s),e.positions=i}seriesShowOrHide(){const i=this.chart.series;this.points.forEach(t=>{const e=find(i,e=>{e=((e.onPoint||{}).options||{}).id;return!!e&&e===t.id});e&&e.setVisible(!e.visible,!1)})}seriesTranslate(){this.onPoint&&(this.onPoint.getRadii(),this.radii=this.onPoint.radii)}chartGetZData(){const t=[];this.series.forEach(e=>{e=e.options.onPoint;t.push(e&&e.z?e.z:null)}),this.series.forEach(e=>{e.onPoint&&(e.onPoint.zData=e.zData=t)})}}e.Additions=h}(SeriesOnPointComposition=SeriesOnPointComposition||{});export default SeriesOnPointComposition;