"use strict";import A from"../../Core/Animation/AnimationUtilities.js";const animObject=A["animObject"];import ApproximationRegistry from"../../Extensions/DataGrouping/ApproximationRegistry.js";import H from"../../Core/Globals.js";import OnSeriesComposition from"../OnSeriesComposition.js";import SeriesRegistry from"../../Core/Series/SeriesRegistry.js";const ColumnSeries=SeriesRegistry.seriesTypes["column"];import U from"../../Core/Utilities.js";const{extend,merge,pick}=U;import WindbarbPoint from"./WindbarbPoint.js";import WindbarbSeriesDefaults from"./WindbarbSeriesDefaults.js";function registerApproximation(){ApproximationRegistry.windbarb||(ApproximationRegistry.windbarb=(i,e)=>{let o=0,s=0;for(let t=0,r=i.length;t<r;t++)o+=i[t]*Math.cos(e[t]*H.deg2rad),s+=i[t]*Math.sin(e[t]*H.deg2rad);return[i.reduce((t,r)=>t+r,0)/i.length,Math.atan2(s,o)/H.deg2rad]})}class WindbarbSeries extends ColumnSeries{constructor(){super(...arguments),this.data=void 0,this.options=void 0,this.points=void 0}init(t,r){super.init(t,r)}pointAttribs(t,r){var i=this.options;let e=t.color||this.color,o=this.options.lineWidth;return r&&(e=i.states[r].color||e,o=(i.states[r].lineWidth||o)+(i.states[r].lineWidthPlus||0)),{stroke:e,"stroke-width":o}}windArrow(t){var r=t.beaufortLevel,i=this.options.vectorLength/20;let e=1.943844*t.value,o,s=-10;if(t.isNull)return[];if(0===r)return this.chart.renderer.symbols.circle(-10*i,-10*i,20*i,20*i);const n=[["M",0,7*i],["L",-1.5*i,7*i],["L",0,10*i],["L",1.5*i,7*i],["L",0,7*i],["L",0,-10*i]];if(0<(o=(e-e%50)/50))for(;o--;)n.push(-10===s?["L",0,s*i]:["M",0,s*i],["L",5*i,s*i+2],["L",0,s*i+4]),e-=50,s+=7;if(0<(o=(e-e%10)/10))for(;o--;)n.push(-10===s?["L",0,s*i]:["M",0,s*i],["L",7*i,s*i]),e-=10,s+=3;if(0<(o=(e-e%5)/5))for(;o--;)n.push(-10===s?["L",0,s*i]:["M",0,s*i],["L",4*i,s*i]),e-=5,s+=3;return n}drawPoints(){const t=this.chart,r=this.yAxis,i=t.inverted,e=this.options.vectorLength/2;for(const n of this.points){var o=n.plotX,s=n.plotY;!1===this.options.clip||t.isInsidePlot(o,0)?(n.graphic||(n.graphic=this.chart.renderer.path().add(this.markerGroup).addClass("highcharts-point highcharts-color-"+pick(n.colorIndex,n.series.colorIndex))),n.graphic.attr({d:this.windArrow(n),translateX:o+this.options.xOffset,translateY:s+this.options.yOffset,rotation:n.direction}),this.chart.styledMode||n.graphic.attr(this.pointAttribs(n))):n.graphic&&(n.graphic=n.graphic.destroy()),n.tooltipPos=[o+this.options.xOffset+(i&&!this.onSeries?e:0),s+this.options.yOffset-(i?0:e+r.pos-t.plotTop)]}}animate(t){t?this.markerGroup.attr({opacity:.01}):this.markerGroup.animate({opacity:1},animObject(this.options.animation))}markerAttribs(t,r){return{}}getExtremes(){return{}}shouldShowTooltip(t,r,i={}){return i.ignoreX=this.chart.inverted,i.ignoreY=!i.ignoreX,super.shouldShowTooltip(t,r,i)}}WindbarbSeries.defaultOptions=merge(ColumnSeries.defaultOptions,WindbarbSeriesDefaults),OnSeriesComposition.compose(WindbarbSeries),extend(WindbarbSeries.prototype,{beaufortFloor:[0,.3,1.6,3.4,5.5,8,10.8,13.9,17.2,20.8,24.5,28.5,32.7],beaufortName:["Calm","Light air","Light breeze","Gentle breeze","Moderate breeze","Fresh breeze","Strong breeze","Near gale","Gale","Strong gale","Storm","Violent storm","Hurricane"],invertible:!1,parallelArrays:["x","value","direction"],pointArrayMap:["value","direction"],pointClass:WindbarbPoint,trackerGroups:["markerGroup"],translate:function(){var r=this.beaufortFloor,i=this.beaufortName;OnSeriesComposition.translate.call(this);for(const e of this.points){let t=0;for(;t<r.length&&!(r[t]>e.value);t++);e.beaufortLevel=t-1,e.beaufort=i[t-1]}}}),SeriesRegistry.registerSeriesType("windbarb",WindbarbSeries),registerApproximation();export default WindbarbSeries;