"use strict";import Point from"../../Core/Series/Point.js";import SeriesRegistry from"../../Core/Series/SeriesRegistry.js";const{treemap:{prototype:{pointClass:TreemapPoint}}}=SeriesRegistry["seriesTypes"];import U from"../../Core/Utilities.js";const{addEvent,fireEvent,merge,pick}=U;class TreegraphPoint extends TreemapPoint{constructor(){super(...arguments),this.options=void 0,this.isLink=!1,this.series=void 0,this.node=void 0,this.setState=Point.prototype.setState}draw(){super.draw.apply(this,arguments);let t=this.graphic;t&&t.animate({visibility:this.visible?"inherit":"hidden"}),this.renderCollapseButton()}renderCollapseButton(){const t=this,e=t.series,i=t.graphic&&t.graphic.parentGroup,s=e.mapOptionsToLevel[t.node.level||0]||{},o=merge(e.options.collapseButton,s.collapseButton,t.options.collapseButton),{width:r,height:n,shape:l,style:a}=o,h=this.series.chart,p=!t.visible||!t.collapsed&&o.onlyOnHover&&"hover"!==t.state?0:1;var d,c,g;t.shapeArgs&&(this.collapseButtonOptions=o,t.collapseButton?t.node.children.length&&o.enabled?({x:d,y:c}=this.getCollapseBtnPosition(o),t.collapseButton.attr({text:t.collapsed?"+":"-",rotation:h.inverted?90:0,rotationOriginX:r/2,rotationOriginY:n/2,visibility:t.visible?"inherit":"hidden"}).animate({x:d,y:c,opacity:p})):(t.collapseButton.destroy(),delete t.collapseButton):t.node.children.length&&o.enabled&&({x:d,y:c}=this.getCollapseBtnPosition(o),g=o.fillColor||t.color||"#cccccc",t.collapseButton=h.renderer.label(t.collapsed?"+":"-",d,c,l).attr({height:n-4,width:r-4,padding:2,fill:g,rotation:h.inverted?90:0,rotationOriginX:r/2,rotationOriginY:n/2,stroke:o.lineColor||"#ffffff","stroke-width":o.lineWidth,"text-align":"center",align:"center",zIndex:1,opacity:p,visibility:t.visible?"inherit":"hidden"}).addClass("highcharts-tracker").addClass("highcharts-collapse-button").removeClass("highcharts-no-tooltip").css(merge({color:"string"==typeof g?h.renderer.getContrast(g):"#333333"},a)).add(i),t.collapseButton.element.point=t))}toggleCollapse(t){this.collapsed=pick(t,!this.collapsed),fireEvent(this.series,"toggleCollapse"),this.series.redraw()}destroy(){this.collapseButton&&(this.collapseButton.destroy(),delete this.collapseButton,this.collapseButton=void 0),this.linkToParent&&(this.linkToParent.destroy(),delete this.linkToParent),super.destroy.apply(this,arguments)}getCollapseBtnPosition(t){var e=this.series.chart.inverted,i=t.width,s=t.height,{x:o=0,y:r=0,width:n=0,height:l=0}=this.shapeArgs||{};return{x:o+t.x+(e?.3*-s:n+-.3*i),y:r+l/2-s/2+t.y}}}addEvent(TreegraphPoint,"mouseOut",function(){const t=this.collapseButton,e=this.collapseButtonOptions;t&&e&&e.onlyOnHover&&!this.collapsed&&t.animate({opacity:0})}),addEvent(TreegraphPoint,"mouseOver",function(){this.collapseButton&&this.visible&&this.collapseButton.animate({opacity:1},this.series.options.states&&this.series.options.states.hover&&this.series.options.states.hover.animation)}),addEvent(TreegraphPoint,"click",function(){this.toggleCollapse()});export default TreegraphPoint;