"use strict";import ColumnSeries from"./Column/ColumnSeries.js";const columnProto=ColumnSeries["prototype"];import Series from"../Core/Series/Series.js";const seriesProto=Series["prototype"];import U from"../Core/Utilities.js";const{defined,stableSort}=U;var OnSeriesComposition;!function(t){const e=[];function s(t){return seriesProto.getPlotBox.call(this.options.onSeries&&this.chart.get(this.options.onSeries)||this,t)}function i(){columnProto.translate.apply(this);const s=this,t=s.options,o=s.chart,i=s.points,e=t.onSeries,n=e&&o.get(e),r=n&&n.options.step,l=n&&n.points,p=o.inverted,a=s.xAxis,f=s.yAxis;let c=i.length-1,x,u,d=t.onKey||"y",h=l&&l.length,m=0,S,y,X,g,C;if(n&&n.visible&&h)for(m=(n.pointXOffset||0)+(n.barW||0)/2,g=n.currentDataGrouping,y=l[h-1].x+(g?g.totalRange:0),stableSort(i,(t,o)=>t.x-o.x),d="plot"+d[0].toUpperCase()+d.substr(1);h--&&i[c];)if(S=l[h],(x=i[c]).y=S.y,S.x<=x.x&&void 0!==S[d]){if(x.x<=y&&(x.plotY=S[d],S.x<x.x&&!r&&(X=l[h+1])&&void 0!==X[d]))if(defined(x.plotX)&&n.is("spline")){const Y=[S.plotX||0,S.plotY||0],v=[X.plotX||0,X.plotY||0],k=S.controlPoints?.high||Y,U=X.controlPoints?.low||v,O=(t,o)=>Math.pow(1-t,3)*Y[o]+3*(1-t)*(1-t)*t*k[o]+3*(1-t)*t*t*U[o]+t*t*t*v[o];let o=0,e=1,s;for(let t=0;t<100;t++){var b=(o+e)/2,P=O(b,0);if(null===P)break;if(Math.abs(P-x.plotX)<.25){s=b;break}P<x.plotX?o=b:e=b}defined(s)&&(x.plotY=O(s,1),x.y=f.toValue(x.plotY,!0))}else C=(x.x-S.x)/(X.x-S.x),x.plotY+=C*(X[d]-S[d]),x.y+=C*(X.y-S.y);if(c--,h++,c<0)break}i.forEach((t,o)=>{let e;t.plotX+=m,void 0!==t.plotY&&!p||(0<=t.plotX&&t.plotX<=a.len?p?(t.plotY=a.translate(t.x,0,1,0,1),t.plotX=defined(t.y)?f.translate(t.y,0,0,0,1):0):t.plotY=(a.opposite?0:s.yAxis.len)+a.offset:t.shapeArgs={}),(u=i[o-1])&&u.plotX===t.plotX&&(void 0===u.stackIndex&&(u.stackIndex=0),e=u.stackIndex+1),t.stackIndex=e}),this.onSeries=n}t.compose=function(t){if(U.pushUnique(e,t)){const o=t.prototype;o.getPlotBox=s,o.translate=i}return t},t.getPlotBox=s,t.translate=i}(OnSeriesComposition=OnSeriesComposition||{});export default OnSeriesComposition;