"use strict";import DerivedComposition from"../DerivedComposition.js";import HistogramSeriesDefaults from"./HistogramSeriesDefaults.js";import SeriesRegistry from"../../Core/Series/SeriesRegistry.js";const ColumnSeries=SeriesRegistry.seriesTypes["column"];import U from"../../Core/Utilities.js";const{arrayMax,arrayMin,correctFloat,extend,isNumber,merge,objectEach}=U,binsNumberFormulas={"square-root":function(e){return Math.ceil(Math.sqrt(e.options.data.length))},sturges:function(e){return Math.ceil(Math.log(e.options.data.length)*Math.LOG2E)},rice:function(e){return Math.ceil(2*Math.pow(e.options.data.length,1/3))}};function fitToBinLeftClosed(r){return function(e){let t=1;for(;r[t]<=e;)t++;return r[--t]}}class HistogramSeries extends ColumnSeries{constructor(){super(...arguments),this.data=void 0,this.options=void 0,this.points=void 0,this.userOptions=void 0}binsNumber(){var e=this.options.binsNumber;const t=binsNumberFormulas[e]||"function"==typeof e&&e;return Math.ceil(t&&t(this.baseSeries)||(isNumber(e)?e:binsNumberFormulas["square-root"](this.baseSeries)))}derivedData(e,t,r){const s=this,i=correctFloat(arrayMax(e)),o=correctFloat(arrayMin(e)),a=[],n={},u=[];let c;for(r=s.binWidth=correctFloat(isNumber(r)?r||1:(i-o)/t),s.options.pointRange=Math.max(r,0),c=o;c<i&&(s.userOptions.binWidth||correctFloat(i-c)>=r||correctFloat(correctFloat(o+a.length*r)-c)<=0);c=correctFloat(c+r))a.push(c),n[c]=0;0!==n[o]&&(a.push(o),n[o]=0);const m=fitToBinLeftClosed(a.map(e=>parseFloat(e)));for(const l of e)n[correctFloat(m(l))]++;for(const h of Object.keys(n))u.push({x:Number(h),y:n[h],x2:correctFloat(Number(c)+r)});return u.sort((e,t)=>e.x-t.x),u[u.length-1].x2=i,u}setDerivedData(){var e=this.baseSeries.yData;e.length?(e=this.derivedData(e,this.binsNumber(),this.options.binWidth),this.setData(e,!1)):this.setData([])}}HistogramSeries.defaultOptions=merge(ColumnSeries.defaultOptions,HistogramSeriesDefaults),extend(HistogramSeries.prototype,{hasDerivedData:DerivedComposition.hasDerivedData}),DerivedComposition.compose(HistogramSeries),SeriesRegistry.registerSeriesType("histogram",HistogramSeries);export default HistogramSeries;