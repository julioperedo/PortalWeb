"use strict";import SeriesRegistry from"../../Core/Series/SeriesRegistry.js";const ColumnSeries=SeriesRegistry.seriesTypes["column"];import VariwideComposition from"./VariwideComposition.js";import VariwidePoint from"./VariwidePoint.js";import VariwideSeriesDefaults from"./VariwideSeriesDefaults.js";import U from"../../Core/Utilities.js";const{addEvent,extend,merge,pick}=U;class VariwideSeries extends ColumnSeries{constructor(){super(...arguments),this.data=void 0,this.options=void 0,this.points=void 0,this.relZ=void 0,this.totalZ=void 0,this.zData=void 0}processData(i){this.totalZ=0,this.relZ=[],SeriesRegistry.seriesTypes.column.prototype.processData.call(this,i),(this.xAxis.reversed?this.zData.slice().reverse():this.zData).forEach(function(i,t){this.relZ[t]=this.totalZ,this.totalZ+=i},this),this.xAxis.categories&&(this.xAxis.variwide=!0,this.xAxis.zData=this.zData)}postTranslate(i,t,s){const e=this.xAxis,r=this.relZ,o=e.reversed?r.length-i:i,a=e.reversed?-1:1,n=e.toPixels(e.reversed?(e.dataMax||0)+e.pointRange:e.dataMin||0),h=e.toPixels(e.reversed?e.dataMin||0:(e.dataMax||0)+e.pointRange),d=Math.abs(h-n),p=this.totalZ,l=this.chart.inverted?h-(this.chart.plotTop-a*e.minPixelPadding):n-this.chart.plotLeft-a*e.minPixelPadding,c=o/r.length*d,x=(o+a)/r.length*d,m=pick(r[o],p)/p*d,w=pick(r[o+a],p)/p*d,u=t-(l+c);return s&&(s.crosshairWidth=w-m),l+m+u*(w-m)/(x-c)}translate(){this.crispOption=this.options.crisp,this.options.crisp=!1,super.translate(),this.options.crisp=this.crispOption}correctStackLabels(){var i=this,t=i.options,s=i.yAxis;let e,r,o,a;for(const n of i.points)a=n.x,r=n.shapeArgs.width,(o=s.stacking.stacks[(i.negStacks&&n.y<(t.startFromThreshold?0:t.threshold)?"-":"")+i.stackKey])&&(e=o[a])&&!n.isNull&&e.setOffset(-r/2||0,r||0,void 0,void 0,n.plotX,i.xAxis)}}VariwideSeries.compose=VariwideComposition.compose,VariwideSeries.defaultOptions=merge(ColumnSeries.defaultOptions,VariwideSeriesDefaults),addEvent(VariwideSeries,"afterColumnTranslate",function(){const s=this.xAxis,e=this.chart.inverted,r=this.borderWidth%2/2;let o=-1;for(const a of this.points){++o;const n=a.shapeArgs||{},{x:h=0,width:d=0}=n,{plotX:p=0,tooltipPos:l,z:c=0}=a;let i,t;t=s.variwide?(i=this.postTranslate(o,h,a),this.postTranslate(o,h+d)):(i=p,s.translate(a.x+c,!1,!1,!1,!0)),this.crispOption&&(i=Math.round(i)-r,t=Math.round(t)-r),n.x=i,n.width=Math.max(t-i,1),a.plotX=(i+t)/2,l&&(e?l[1]=s.len-n.x-n.width/2:l[0]=n.x+n.width/2)}this.options.stacking&&this.correctStackLabels()},{order:2}),extend(VariwideSeries.prototype,{irregularWidths:!0,pointArrayMap:["y","z"],parallelArrays:["x","y","z"],pointClass:VariwidePoint}),SeriesRegistry.registerSeriesType("variwide",VariwideSeries);export default VariwideSeries;