"use strict";import AreaRangePoint from"./AreaRangePoint.js";import H from"../../Core/Globals.js";const noop=H["noop"];import SeriesRegistry from"../../Core/Series/SeriesRegistry.js";const{area:AreaSeries,area:{prototype:areaProto},column:{prototype:columnProto}}=SeriesRegistry.seriesTypes;import U from"../../Core/Utilities.js";const{addEvent,defined,extend,isArray,isNumber,pick,merge}=U,areaRangeSeriesOptions={lineWidth:1,threshold:null,tooltip:{pointFormat:'<span style="color:{series.color}">‚óè</span> {series.name}: <b>{point.low}</b> - <b>{point.high}</b><br/>'},trackByArea:!0,dataLabels:{align:void 0,verticalAlign:void 0,xLow:0,xHigh:0,yLow:0,yHigh:0}};class AreaRangeSeries extends AreaSeries{constructor(){super(...arguments),this.data=void 0,this.options=void 0,this.points=void 0,this.lowerStateMarkerGraphic=void 0,this.xAxis=void 0}toYData(t){return[t.low,t.high]}highToXY(t){var o=this.chart,e=this.xAxis.postTranslate(t.rectPlotX||0,this.yAxis.len-(t.plotHigh||0));t.plotHighX=e.x-o.plotLeft,t.plotHigh=e.y-o.plotTop,t.plotLowX=t.plotX}getGraphPath(t){const o=[],e=[],a=areaProto.getGraphPath,i=this.options,r=this.chart.polar,s=r&&!1!==i.connectEnds,l=i.connectNulls;let p,n,h,g=i.step;for(t=t||this.points,p=t.length;p--;){n=t[p];var d=r?{plotX:n.rectPlotX,plotY:n.yBottom,doCurve:!1}:{plotX:n.plotX,plotY:n.plotY,doCurve:!1};n.isNull||s||l||t[p+1]&&!t[p+1].isNull||e.push(d),h={polarPlotY:n.polarPlotY,rectPlotX:n.rectPlotX,yBottom:n.yBottom,plotX:pick(n.plotHighX,n.plotX),plotY:n.plotHigh,isNull:n.isNull},e.push(h),o.push(h),n.isNull||s||l||t[p-1]&&!t[p-1].isNull||e.push(d)}const c=a.call(this,t);g&&(!0===g&&(g="left"),i.step={left:"right",center:"center",right:"left"}[g]);var y=a.call(this,o);const b=a.call(this,e),f=(i.step=g,[].concat(c,y));return!this.chart.polar&&b[0]&&"M"===b[0][0]&&(b[0]=["L",b[0][1],b[0][2]]),this.graphPath=f,this.areaPath=c.concat(b),f.isArea=!0,f.xMap=c.xMap,this.areaPath.xMap=c.xMap,f}drawDataLabels(){const t=this.points,o=t.length,e=[],a=this.options.dataLabels,i=this.chart.inverted;let r,s,l,p,n;if(a){if(isArray(a)?(p=a[0]||{enabled:!1},n=a[1]||{enabled:!1}):((p=extend({},a)).x=a.xHigh,p.y=a.yHigh,(n=extend({},a)).x=a.xLow,n.y=a.yLow),p.enabled||this.hasDataLabels?.()){for(r=o;r--;){var h,g;(s=t[r])&&({plotHigh:h=0,plotLow:g=0}=s,l=p.inside?h<g:g<h,s.y=s.high,s._plotY=s.plotY,s.plotY=h,e[r]=s.dataLabel,s.dataLabel=s.dataLabelUpper,s.below=l,i?p.align||(p.align=l?"right":"left"):p.verticalAlign||(p.verticalAlign=l?"top":"bottom"))}for(this.options.dataLabels=p,areaProto.drawDataLabels&&areaProto.drawDataLabels.apply(this,arguments),r=o;r--;)(s=t[r])&&(s.dataLabelUpper=s.dataLabel,s.dataLabel=e[r],delete s.dataLabels,s.y=s.low,s.plotY=s._plotY)}if(n.enabled||this.hasDataLabels?.()){for(r=o;r--;){var d,c;(s=t[r])&&({plotHigh:d=0,plotLow:c=0}=s,l=n.inside?d<c:c<d,s.below=!l,i?n.align||(n.align=l?"left":"right"):n.verticalAlign||(n.verticalAlign=l?"bottom":"top"))}this.options.dataLabels=n,areaProto.drawDataLabels&&areaProto.drawDataLabels.apply(this,arguments)}if(p.enabled)for(r=o;r--;)(s=t[r])&&(s.dataLabels=[s.dataLabelUpper,s.dataLabel].filter(function(t){return!!t}));this.options.dataLabels=a}}alignDataLabel(){columnProto.alignDataLabel.apply(this,arguments)}modifyMarkerSettings(){var t,o,e=this,a={marker:e.options.marker,symbol:e.symbol};return e.options.lowMarker&&({marker:t,lowMarker:o}=e["options"],e.options.marker=merge(t,o),o.symbol&&(e.symbol=o.symbol)),a}restoreMarkerSettings(t){this.options.marker=t.marker,this.symbol=t.symbol}drawPoints(){var t=this,o=t.points.length;let e,a;var i=t.modifyMarkerSettings();for(areaProto.drawPoints.apply(t,arguments),t.restoreMarkerSettings(i),e=0;e<o;)(a=t.points[e]).graphics=a.graphics||[],a.origProps={plotY:a.plotY,plotX:a.plotX,isInside:a.isInside,negative:a.negative,zone:a.zone,y:a.y},(a.graphic||a.graphics[0])&&(a.graphics[0]=a.graphic),a.graphic=a.graphics[1],a.plotY=a.plotHigh,defined(a.plotHighX)&&(a.plotX=a.plotHighX),a.y=pick(a.high,a.origProps.y),a.negative=a.y<(t.options.threshold||0),t.zones.length&&(a.zone=a.getZone()),t.chart.polar||(a.isInside=a.isTopInside=void 0!==a.plotY&&0<=a.plotY&&a.plotY<=t.yAxis.len&&0<=a.plotX&&a.plotX<=t.xAxis.len),e++;for(areaProto.drawPoints.apply(t,arguments),e=0;e<o;)(a=t.points[e]).graphics=a.graphics||[],(a.graphic||a.graphics[1])&&(a.graphics[1]=a.graphic),a.graphic=a.graphics[0],a.origProps&&(extend(a,a.origProps),delete a.origProps),e++}hasMarkerChanged(t,o){var e=t.lowMarker,a=o.lowMarker||{};return e&&(!1===e.enabled||a.symbol!==e.symbol||a.height!==e.height||a.width!==e.width)||super.hasMarkerChanged(t,o)}}AreaRangeSeries.defaultOptions=merge(AreaSeries.defaultOptions,areaRangeSeriesOptions),addEvent(AreaRangeSeries,"afterTranslate",function(){"low,high"===this.pointArrayMap.join(",")&&this.points.forEach(t=>{var o=t.high,e=t.plotY;t.isNull?t.plotY=void 0:(t.plotLow=e,t.plotHigh=isNumber(o)?this.yAxis.translate(this.dataModify?this.dataModify.modifyValue(o):o,!1,!0,void 0,!0):void 0,this.dataModify&&(t.yBottom=t.plotHigh))})},{order:0}),addEvent(AreaRangeSeries,"afterTranslate",function(){this.chart.inverted;this.points.forEach(t=>{if(this.chart.polar)this.highToXY(t),t.plotLow=t.plotY,t.tooltipPos=[((t.plotHighX||0)+(t.plotLowX||0))/2,((t.plotHigh||0)+(t.plotLow||0))/2];else{const o=t.pos(!1,t.plotLow),e=t.pos(!1,t.plotHigh);o&&e&&(o[0]=(o[0]+e[0])/2,o[1]=(o[1]+e[1])/2),t.tooltipPos=o}})},{order:3}),extend(AreaRangeSeries.prototype,{deferTranslatePolar:!0,pointArrayMap:["low","high"],pointClass:AreaRangePoint,pointValKey:"low",setStackedPoints:noop}),SeriesRegistry.registerSeriesType("arearange",AreaRangeSeries);export default AreaRangeSeries;