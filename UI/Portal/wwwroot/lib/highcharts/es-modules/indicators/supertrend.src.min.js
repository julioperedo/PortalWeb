"use strict";import H from"../parts/Globals.js";import U from"../parts/Utilities.js";var correctFloat=U.correctFloat,merge=U.merge,seriesType=U.seriesType,isArray=U.isArray,objectEach=U.objectEach,ATR=H.seriesTypes.atr,SMA=H.seriesTypes.sma;function createPointObj(o,e,r){return{index:e,close:o.yData[e][r],x:o.xData[e]}}seriesType("supertrend","sma",{params:{multiplier:3,period:10},risingTrendColor:"#06B535",fallingTrendColor:"#F21313",changeTrendLine:{styles:{lineWidth:1,lineColor:"#333333",dashStyle:"LongDash"}}},{nameBase:"Supertrend",nameComponents:["multiplier","period"],requiredIndicators:["atr"],init:function(){var o,e;SMA.prototype.init.apply(this,arguments),o=this.options,e=this.linkedParent.options,o.cropThreshold=e.cropThreshold-(o.params.period-1)},drawGraph:function(){for(var o,e,r,t,l,i,s,n,a,p=this,c=p.options,h=p.linkedParent,d=h?h.points:[],y=p.points,g=p.graph,u=y.length,x=d.length-u,m=x>0?x:0,T={options:{gapSize:c.gapSize}},f={top:[],bottom:[],intersect:[]},C={top:{styles:{lineWidth:c.lineWidth,lineColor:c.fallingTrendColor||c.color,dashStyle:c.dashStyle}},bottom:{styles:{lineWidth:c.lineWidth,lineColor:c.risingTrendColor||c.color,dashStyle:c.dashStyle}},intersect:c.changeTrendLine};u--;)o=y[u],e=y[u-1],r=d[u-1+m],t=d[u-2+m],l=d[u+m],i=d[u+m+1],s=o.options.color,n={x:o.x,plotX:o.plotX,plotY:o.plotY,isNull:!1},!t&&r&&h.yData[r.index-1]&&(t=createPointObj(h,r.index-1,3)),!i&&l&&h.yData[l.index+1]&&(i=createPointObj(h,l.index+1,3)),!r&&t&&h.yData[t.index+1]?r=createPointObj(h,t.index+1,3):!r&&l&&h.yData[l.index-1]&&(r=createPointObj(h,l.index-1,3)),o&&r&&l&&t&&o.x!==r.x&&(o.x===l.x?(t=r,r=l):o.x===t.x?(r=t,t={close:h.yData[r.index-1][3],x:h.xData[r.index-1]}):i&&o.x===i.x&&(r=i,t=l)),e&&t&&r?(a={x:e.x,plotX:e.plotX,plotY:e.plotY,isNull:!1},o.y>=r.close&&e.y>=t.close?(o.color=s||c.fallingTrendColor||c.color,f.top.push(n)):o.y<r.close&&e.y<t.close?(o.color=s||c.risingTrendColor||c.color,f.bottom.push(n)):(f.intersect.push(n),f.intersect.push(a),f.intersect.push(merge(a,{isNull:!0})),o.y>=r.close&&e.y<t.close?(o.color=s||c.fallingTrendColor||c.color,e.color=s||c.risingTrendColor||c.color,f.top.push(n),f.top.push(merge(a,{isNull:!0}))):o.y<r.close&&e.y>=t.close&&(o.color=s||c.risingTrendColor||c.color,e.color=s||c.fallingTrendColor||c.color,f.bottom.push(n),f.bottom.push(merge(a,{isNull:!0}))))):r&&(o.y>=r.close?(o.color=s||c.fallingTrendColor||c.color,f.top.push(n)):(o.color=s||c.risingTrendColor||c.color,f.bottom.push(n)));objectEach(f,function(o,e){p.points=o,p.options=merge(C[e].styles,T),p.graph=p["graph"+e+"Line"],SMA.prototype.drawGraph.call(p),p["graph"+e+"Line"]=p.graph}),p.points=y,p.options=c,p.graph=g},getValues:function(o,e){var r,t,l,i,s,n,a,p,c,h,d=e.period,y=e.multiplier,g=o.xData,u=o.yData,x=[],m=[],T=[],f=0===d?0:d-1,C=[],b=[];if(!(g.length<=d||!isArray(u[0])||4!==u[0].length||d<0)){for(r=ATR.prototype.getValues.call(this,o,{period:d}).yData,h=0;h<r.length;h++)c=u[f+h],p=u[f+h-1]||[],s=C[h-1],n=b[h-1],a=T[h-1],0===h&&(s=n=a=0),t=correctFloat((c[1]+c[2])/2+y*r[h]),l=correctFloat((c[1]+c[2])/2-y*r[h]),t<s||p[3]>s?C[h]=t:C[h]=s,l>n||p[3]<n?b[h]=l:b[h]=n,a===s&&c[3]<C[h]||a===n&&c[3]<b[h]?i=C[h]:(a===s&&c[3]>C[h]||a===n&&c[3]>b[h])&&(i=b[h]),x.push([g[f+h],i]),m.push(g[f+h]),T.push(i);return{values:x,xData:m,yData:T}}}});