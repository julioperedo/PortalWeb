"use strict";import H from"../parts/Globals.js";import U from"../parts/Utilities.js";var isArray=U.isArray,merge=U.merge,seriesType=U.seriesType,SMA=H.seriesTypes.sma;seriesType("priceenvelopes","sma",{marker:{enabled:!1},tooltip:{pointFormat:'<span style="color:{point.color}">‚óè</span><b> {series.name}</b><br/>Top: {point.top}<br/>Middle: {point.middle}<br/>Bottom: {point.bottom}<br/>'},params:{period:20,topBand:.1,bottomBand:.1},bottomLine:{styles:{lineWidth:1,lineColor:void 0}},topLine:{styles:{lineWidth:1}},dataGrouping:{approximation:"averages"}},{nameComponents:["period","topBand","bottomBand"],nameBase:"Price envelopes",pointArrayMap:["top","middle","bottom"],parallelArrays:["x","y","top","bottom"],pointValKey:"middle",init:function(){SMA.prototype.init.apply(this,arguments),this.options=merge({topLine:{styles:{lineColor:this.color}},bottomLine:{styles:{lineColor:this.color}}},this.options)},toYData:function(t){return[t.top,t.middle,t.bottom]},translate:function(){var t=this,o=["plotTop","plotMiddle","plotBottom"];SMA.prototype.translate.apply(t),t.points.forEach(function(p){[p.top,p.middle,p.bottom].forEach(function(e,i){null!==e&&(p[o[i]]=t.yAxis.toPixels(e,!0))})})},drawGraph:function(){for(var t,o=this,p=o.points,e=p.length,i=o.options,a=o.graph,r={options:{gapSize:i.gapSize}},s=[[],[]];e--;)t=p[e],s[0].push({plotX:t.plotX,plotY:t.plotTop,isNull:t.isNull}),s[1].push({plotX:t.plotX,plotY:t.plotBottom,isNull:t.isNull});["topLine","bottomLine"].forEach(function(t,p){o.points=s[p],o.options=merge(i[t].styles,r),o.graph=o["graph"+t],SMA.prototype.drawGraph.call(o),o["graph"+t]=o.graph}),o.points=p,o.options=i,o.graph=a,SMA.prototype.drawGraph.call(o)},getValues:function(t,o){var p,e,i,a,r,s,l,n,m=o.period,d=o.topBand,h=o.bottomBand,y=t.xData,u=t.yData,c=u?u.length:0,g=[],b=[],f=[];if(!(y.length<m)&&isArray(u[0])&&4===u[0].length){for(n=m;n<=c;n++)r=y.slice(n-m,n),s=u.slice(n-m,n),a=(l=SMA.prototype.getValues.call(this,{xData:r,yData:s},o)).xData[0],e=(p=l.yData[0])*(1+d),i=p*(1-h),g.push([a,e,p,i]),b.push(a),f.push([e,p,i]);return{values:g,xData:b,yData:f}}}});