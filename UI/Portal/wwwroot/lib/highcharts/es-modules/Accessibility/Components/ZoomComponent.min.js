"use strict";import AccessibilityComponent from"../AccessibilityComponent.js";import CU from"../Utils/ChartUtilities.js";const unhideChartElementFromAT=CU["unhideChartElementFromAT"];import HU from"../Utils/HTMLUtilities.js";const getFakeMouseEvent=HU["getFakeMouseEvent"];import KeyboardNavigationHandler from"../KeyboardNavigationHandler.js";import U from"../../Core/Utilities.js";const{attr,pick}=U;function chartHasMapZoom(t){return!!(t.mapView&&t.mapNavigation&&t.mapNavigation.navButtons.length)}class ZoomComponent extends AccessibilityComponent{constructor(){super(...arguments),this.focusedMapNavButtonIx=-1}init(){const o=this,e=this.chart;this.proxyProvider.addGroup("zoom","div"),["afterShowResetZoom","afterApplyDrilldown","drillupall"].forEach(t=>{o.addEvent(e,t,function(){o.updateProxyOverlays()})})}onChartUpdate(){const e=this.chart,n=this;e.mapNavigation&&e.mapNavigation.navButtons.forEach((t,o)=>{unhideChartElementFromAT(e,t.element),n.setMapNavButtonAttrs(t.element,"accessibility.zoom.mapZoom"+(o?"Out":"In"))})}setMapNavButtonAttrs(t,o){const e=this.chart,n=e.langFormat(o,{chart:e});attr(t,{tabindex:-1,role:"button","aria-label":n})}onChartRender(){this.updateProxyOverlays()}updateProxyOverlays(){const t=this.chart;var o;this.proxyProvider.clearGroup("zoom"),t.resetZoomButton&&this.createZoomProxyButton(t.resetZoomButton,"resetZoomProxyButton",t.langFormat("accessibility.zoom.resetZoomButton",{chart:t})),t.drillUpButton&&t.breadcrumbs&&t.breadcrumbs.list&&(o=t.breadcrumbs.list[t.breadcrumbs.list.length-1],this.createZoomProxyButton(t.drillUpButton,"drillUpProxyButton",t.langFormat("accessibility.drillUpButton",{chart:t,buttonText:t.breadcrumbs.getButtonText(o)})))}createZoomProxyButton(t,o,e){this[o]=this.proxyProvider.addProxyElement("zoom",{click:t},"button",{"aria-label":e,tabindex:-1})}getMapZoomNavigation(){const t=this.keyCodes,o=this.chart,e=this;return new KeyboardNavigationHandler(o,{keyCodeMap:[[[t.up,t.down,t.left,t.right],function(t){return e.onMapKbdArrow(this,t)}],[[t.tab],function(t,o){return e.onMapKbdTab(this,o)}],[[t.space,t.enter],function(){return e.onMapKbdClick(this)}]],validate:function(){return chartHasMapZoom(o)},init:function(t){return e.onMapNavInit(t)}})}onMapKbdArrow(t,o){const e=this.chart,n=this.keyCodes,a=e.container,i=o===n.up||o===n.down,r=o===n.left||o===n.up?1:-1,s=(i?e.plotHeight:e.plotWidth)/10*r,u=10*Math.random(),c={x:a.offsetLeft+e.plotLeft+e.plotWidth/2+u,y:a.offsetTop+e.plotTop+e.plotHeight/2+u},p=i?{x:c.x,y:c.y+s}:{x:c.x+s,y:c.y};return[getFakeMouseEvent("mousedown",c),getFakeMouseEvent("mousemove",p),getFakeMouseEvent("mouseup",p)].forEach(t=>a.dispatchEvent(t)),t.response.success}onMapKbdTab(t,o){const e=this.chart;var t=t.response,o=o.shiftKey,n=o&&!this.focusedMapNavButtonIx||!o&&this.focusedMapNavButtonIx;if(e.mapNavigation.navButtons[this.focusedMapNavButtonIx].setState(0),n)return e.mapView&&e.mapView.zoomBy(),t[o?"prev":"next"];this.focusedMapNavButtonIx+=o?-1:1;const a=e.mapNavigation.navButtons[this.focusedMapNavButtonIx];return e.setFocusToElement(a.box,a.element),a.setState(2),t.success}onMapKbdClick(t){var o=this.chart.mapNavigation.navButtons[this.focusedMapNavButtonIx].element;return this.fakeClickEvent(o),t.response.success}onMapNavInit(t){const o=this.chart,e=o.mapNavigation.navButtons[0],n=o.mapNavigation.navButtons[1],a=0<t?e:n;o.setFocusToElement(a.box,a.element),a.setState(2),this.focusedMapNavButtonIx=0<t?0:1}simpleButtonNavigation(t,o,e){const n=this.keyCodes,a=this,i=this.chart;return new KeyboardNavigationHandler(i,{keyCodeMap:[[[n.tab,n.up,n.down,n.left,n.right],function(t,o){o=t===n.tab&&o.shiftKey||t===n.left||t===n.up;return this.response[o?"prev":"next"]}],[[n.space,n.enter],function(){var t=e(this,i);return pick(t,this.response.success)}]],validate:function(){return i[t]&&i[t].box&&a[o].innerElement},init:function(){i.setFocusToElement(i[t].box,a[o].innerElement)}})}getKeyboardNavigation(){return[this.simpleButtonNavigation("resetZoomButton","resetZoomProxyButton",function(t,o){o.zoomOut()}),this.simpleButtonNavigation("drillUpButton","drillUpProxyButton",function(t,o){return o.drillUp(),t.response.prev}),this.getMapZoomNavigation()]}}export default ZoomComponent;