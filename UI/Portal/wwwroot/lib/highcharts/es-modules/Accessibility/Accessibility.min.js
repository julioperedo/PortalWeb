"use strict";import D from"../Core/Defaults.js";const defaultOptions=D["defaultOptions"];import H from"../Core/Globals.js";const doc=H["doc"];import U from"../Core/Utilities.js";const{addEvent,extend,fireEvent,merge}=U;import HU from"./Utils/HTMLUtilities.js";const removeElement=HU["removeElement"];import A11yI18n from"./A11yI18n.js";import ContainerComponent from"./Components/ContainerComponent.js";import FocusBorder from"./FocusBorder.js";import InfoRegionsComponent from"./Components/InfoRegionsComponent.js";import KeyboardNavigation from"./KeyboardNavigation.js";import LegendComponent from"./Components/LegendComponent.js";import MenuComponent from"./Components/MenuComponent.js";import NavigatorComponent from"./Components/NavigatorComponent.js";import NewDataAnnouncer from"./Components/SeriesComponent/NewDataAnnouncer.js";import ProxyProvider from"./ProxyProvider.js";import RangeSelectorComponent from"./Components/RangeSelectorComponent.js";import SeriesComponent from"./Components/SeriesComponent/SeriesComponent.js";import ZoomComponent from"./Components/ZoomComponent.js";import whcm from"./HighContrastMode.js";import highContrastTheme from"./HighContrastTheme.js";import defaultOptionsA11Y from"./Options/A11yDefaults.js";import defaultLangOptions from"./Options/LangDefaults.js";import copyDeprecatedOptions from"./Options/DeprecatedOptions.js";class Accessibility{constructor(t){this.chart=void 0,this.components=void 0,this.keyboardNavigation=void 0,this.proxyProvider=void 0,this.init(t)}init(t){if(this.chart=t,!doc.addEventListener)return this.zombie=!0,this.components={},void t.renderTo.setAttribute("aria-hidden",!0);copyDeprecatedOptions(t),this.proxyProvider=new ProxyProvider(this.chart),this.initComponents(),this.keyboardNavigation=new KeyboardNavigation(t,this.components)}initComponents(){const e=this.chart,o=this.proxyProvider;var t=e.options.accessibility;this.components={container:new ContainerComponent,infoRegions:new InfoRegionsComponent,legend:new LegendComponent,chartMenu:new MenuComponent,rangeSelector:new RangeSelectorComponent,series:new SeriesComponent,zoom:new ZoomComponent,navigator:new NavigatorComponent},t.customComponents&&extend(this.components,t.customComponents);const n=this.components;this.getComponentOrder().forEach(function(t){n[t].initBase(e,o),n[t].init()})}getComponentOrder(){if(!this.components)return[];if(!this.components.series)return Object.keys(this.components);var t=Object.keys(this.components).filter(t=>"series"!==t);return["series"].concat(t)}update(){const e=this.components,o=this.chart,t=o.options.accessibility;fireEvent(o,"beforeA11yUpdate"),o.types=this.getChartTypes();var n=t.keyboardNavigation.order;this.proxyProvider.updateGroupOrder(n),this.getComponentOrder().forEach(function(t){e[t].onChartUpdate(),fireEvent(o,"afterA11yComponentUpdate",{name:t,component:e[t]})}),this.keyboardNavigation.update(n),!o.highContrastModeActive&&whcm.isHighContrastModeActive()&&whcm.setHighContrastTheme(o),fireEvent(o,"afterA11yUpdate",{accessibility:this})}destroy(){const t=this.chart||{},e=this.components;Object.keys(e).forEach(function(t){e[t].destroy(),e[t].destroyBase()}),this.proxyProvider&&this.proxyProvider.destroy(),t.announcerContainer&&removeElement(t.announcerContainer),this.keyboardNavigation&&this.keyboardNavigation.destroy(),t.renderTo&&t.renderTo.setAttribute("aria-hidden",!0),t.focusElement&&t.focusElement.removeFocusBorder()}getChartTypes(){const e={};return this.chart.series.forEach(function(t){e[t.type]=1}),Object.keys(e)}}!function(o){const a=[];function c(){this.accessibility&&this.accessibility.destroy()}function m(){this.a11yDirty&&this.renderTo&&(delete this.a11yDirty,this.updateA11yEnabled());const e=this.accessibility;e&&!e.zombie&&(e.proxyProvider.updateProxyElementPositions(),e.getComponentOrder().forEach(function(t){e.components[t].onChartRender()}))}function p(t){const e=t.options.accessibility;e&&(e.customComponents&&(this.options.accessibility.customComponents=e.customComponents,delete e.customComponents),merge(!0,this.options.accessibility,e),this.accessibility&&this.accessibility.destroy&&(this.accessibility.destroy(),delete this.accessibility)),this.a11yDirty=!0}function d(){let t=this.accessibility;var e=this.options.accessibility;e&&e.enabled?t&&!t.zombie?t.update():(this.accessibility=t=new o(this),t&&!t.zombie&&t.update()):t?(t.destroy&&t.destroy(),delete this.accessibility):this.renderTo.setAttribute("aria-hidden",!0)}function h(){this.series.chart.accessibility&&(this.series.chart.a11yDirty=!0)}o.i18nFormat=A11yI18n.i18nFormat,o.compose=function(e,t,o,n,i,s){if(KeyboardNavigation.compose(e),NewDataAnnouncer.compose(n),LegendComponent.compose(e,t),MenuComponent.compose(e),SeriesComponent.compose(e,o,n),A11yI18n.compose(e),FocusBorder.compose(e,i),s&&RangeSelectorComponent.compose(e,s),U.pushUnique(a,e)){const r=e.prototype;r.updateA11yEnabled=d,addEvent(e,"destroy",c),addEvent(e,"render",m),addEvent(e,"update",p),["addSeries","init"].forEach(t=>{addEvent(e,t,function(){this.a11yDirty=!0})}),["afterApplyDrilldown","drillupall"].forEach(t=>{addEvent(e,t,function(){const t=this.accessibility;t&&!t.zombie&&t.update()})})}U.pushUnique(a,o)&&addEvent(o,"update",h),U.pushUnique(a,n)&&["update","updatedData","remove"].forEach(t=>{addEvent(n,t,function(){this.chart.accessibility&&(this.chart.a11yDirty=!0)})})}}(Accessibility=Accessibility||{}),merge(!0,defaultOptions,defaultOptionsA11Y,{accessibility:{highContrastTheme:highContrastTheme},lang:defaultLangOptions});export default Accessibility;