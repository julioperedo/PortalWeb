"use strict";import H from"../Core/Globals.js";const doc=H["doc"];import U from"../Core/Utilities.js";const{attr,css,merge}=U;import EventProvider from"./Utils/EventProvider.js";import ChartUtilities from"./Utils/ChartUtilities.js";const fireEventOnWrappedOrUnwrappedElement=ChartUtilities["fireEventOnWrappedOrUnwrappedElement"];import HTMLUtilities from"./Utils/HTMLUtilities.js";const{cloneMouseEvent,cloneTouchEvent,getFakeMouseEvent,removeElement}=HTMLUtilities;class ProxyElement{constructor(e,t,i="button",r,o){this.chart=e,this.target=t,this.eventProvider=new EventProvider;const n=this.innerElement=doc.createElement(i),s=this.element=r?doc.createElement(r):n;e.styledMode||this.hideElementVisually(n),r&&("li"!==r||e.styledMode||(s.style.listStyle="none"),s.appendChild(n),this.element=s),this.updateTarget(t,o)}click(){const e=this.getTargetPosition();e.x+=e.width/2,e.y+=e.height/2;var t=getFakeMouseEvent("click",e);fireEventOnWrappedOrUnwrappedElement(this.target.click,t)}updateTarget(e,t){this.target=e,this.updateCSSClassName();const i=t||{};Object.keys(i).forEach(e=>{null===i[e]&&delete i[e]});t=this.getTargetAttr(e.click,"aria-label");attr(this.innerElement,merge(t?{"aria-label":t}:{},i)),this.eventProvider.removeAddedEvents(),this.addProxyEventsToElement(this.innerElement,e.click),this.refreshPosition()}refreshPosition(){var e=this.getTargetPosition();css(this.innerElement,{width:(e.width||1)+"px",height:(e.height||1)+"px",left:(Math.round(e.x)||0)+"px",top:(Math.round(e.y)||0)+"px"})}remove(){this.eventProvider.removeAddedEvents(),removeElement(this.element)}updateCSSClassName(){var e=e=>-1<e.indexOf("highcharts-no-tooltip"),t=this.chart.legend,t=t.group&&t.group.div,t=e(t&&t.className||""),e=e(this.getTargetAttr(this.target.click,"class")||"");this.innerElement.className=t||e?"highcharts-a11y-proxy-element highcharts-no-tooltip":"highcharts-a11y-proxy-element"}addProxyEventsToElement(t,r){["click","touchstart","touchend","touchcancel","touchmove","mouseover","mouseenter","mouseleave","mouseout"].forEach(e=>{const i=0===e.indexOf("touch");this.eventProvider.addEvent(t,e,e=>{var t=(i?cloneTouchEvent:cloneMouseEvent)(e);r&&fireEventOnWrappedOrUnwrappedElement(r,t),e.stopPropagation(),i||e.preventDefault()},{passive:!1})})}hideElementVisually(e){css(e,{borderWidth:0,backgroundColor:"transparent",cursor:"pointer",outline:"none",opacity:.001,filter:"alpha(opacity=1)",zIndex:999,overflow:"hidden",padding:0,margin:0,display:"block",position:"absolute","-ms-filter":"progid:DXImageTransform.Microsoft.Alpha(Opacity=1)"})}getTargetPosition(){var e,t=this.target.click,t=t.element||t;const i=this.target.visual||t;return this.chart.renderTo&&i&&i.getBoundingClientRect?(t=i.getBoundingClientRect(),e=this.chart.pointer.getChartPosition(),{x:(t.left-e.left)/e.scaleX,y:(t.top-e.top)/e.scaleY,width:t.right/e.scaleX-t.left/e.scaleX,height:t.bottom/e.scaleY-t.top/e.scaleY}):{x:0,y:0,width:1,height:1}}getTargetAttr(e,t){return(e.element||e).getAttribute(t)}}export default ProxyElement;