"use strict";import A from"../Animation/AnimationUtilities.js";const animObject=A["animObject"];import AxisDefaults from"./AxisDefaults.js";import Color from"../Color/Color.js";import D from"../Defaults.js";const defaultOptions=D["defaultOptions"];import F from"../Foundation.js";const registerEventOptions=F["registerEventOptions"];import H from"../Globals.js";const deg2rad=H["deg2rad"];import Tick from"./Tick.js";import U from"../Utilities.js";const{arrayMax,arrayMin,clamp,correctFloat,defined,destroyObjectProperties,erase,error,extend,fireEvent,getClosestDistance,insertItem,isArray,isNumber,isString,merge,normalizeTickInterval,objectEach,pick,relativeLength,removeEvent,splat,syncTimeout}=U,getNormalizedTickInterval=(i,t)=>normalizeTickInterval(t,void 0,void 0,pick(i.options.allowDecimals,t<.5||void 0!==i.tickAmount),!!i.tickAmount);class Axis{constructor(i,t,e){this.alternateBands=void 0,this.bottom=void 0,this.chart=void 0,this.closestPointRange=void 0,this.coll=void 0,this.eventOptions=void 0,this.hasNames=void 0,this.hasVisibleSeries=void 0,this.height=void 0,this.index=void 0,this.isLinked=void 0,this.labelEdge=void 0,this.labelFormatter=void 0,this.left=void 0,this.len=void 0,this.max=void 0,this.maxLabelLength=void 0,this.min=void 0,this.minorTickInterval=void 0,this.minorTicks=void 0,this.minPixelPadding=void 0,this.names=void 0,this.offset=void 0,this.options=void 0,this.overlap=void 0,this.paddedTicks=void 0,this.plotLinesAndBands=void 0,this.plotLinesAndBandsGroups=void 0,this.pointRange=void 0,this.pointRangePadding=void 0,this.pos=void 0,this.positiveValuesOnly=void 0,this.right=void 0,this.series=void 0,this.side=void 0,this.tickAmount=void 0,this.tickInterval=void 0,this.tickmarkOffset=void 0,this.tickPositions=void 0,this.tickRotCorr=void 0,this.ticks=void 0,this.top=void 0,this.transA=void 0,this.transB=void 0,this.translationSlope=void 0,this.userOptions=void 0,this.visible=void 0,this.width=void 0,this.zoomEnabled=void 0,this.init(i,t,e)}init(i,t,e=this.coll){var s="xAxis"===e,n=this,e=(n.chart=i,n.horiz=n.isZAxis||(i.inverted?!s:s),n.isXAxis=s,n.coll=e,fireEvent(this,"init",{userOptions:t}),n.opposite=pick(t.opposite,n.opposite),n.side=pick(t.side,n.side,n.horiz?n.opposite?0:2:n.opposite?1:3),n.setOptions(t),this.options),a=e.labels,o=e.type,t=(n.userOptions=t,n.minPixelPadding=0,n.reversed=pick(e.reversed,n.reversed),n.visible=e.visible,n.zoomEnabled=e.zoomEnabled,n.hasNames="category"===o||!0===e.categories,n.categories=e.categories||(n.hasNames?[]:void 0),n.names||(n.names=[],n.names.keys={}),n.plotLinesAndBandsGroups={},n.positiveValuesOnly=!!n.logarithmic,n.isLinked=defined(e.linkedTo),n.ticks={},n.labelEdge=[],n.minorTicks={},n.plotLinesAndBands=[],n.alternateBands={},n.len=0,n.minRange=n.userMinRange=e.minRange||e.maxZoom,n.range=e.range,n.offset=e.offset||0,n.max=null,n.min=null,pick(e.crosshair,splat(i.options.tooltip.crosshairs)[s?0:1]));n.crosshair=!0===t?{}:t,-1===i.axes.indexOf(n)&&(s?i.axes.splice(i.xAxis.length,0,n):i.axes.push(n),insertItem(this,i[this.coll])),i.orderItems(n.coll),n.series=n.series||[],i.inverted&&!n.isZAxis&&s&&void 0===n.reversed&&(n.reversed=!0),n.labelRotation=isNumber(a.rotation)?a.rotation:void 0,registerEventOptions(n,e),fireEvent(this,"afterInit")}setOptions(i){this.options=merge(AxisDefaults.defaultXAxisOptions,"yAxis"===this.coll&&AxisDefaults.defaultYAxisOptions,[AxisDefaults.defaultTopAxisOptions,AxisDefaults.defaultRightAxisOptions,AxisDefaults.defaultBottomAxisOptions,AxisDefaults.defaultLeftAxisOptions][this.side],merge(defaultOptions[this.coll],i)),fireEvent(this,"afterSetOptions",{userOptions:i})}defaultLabelFormatter(i){const t=this.axis,e=this.chart,s=e["numberFormatter"],n=isNumber(this.value)?this.value:NaN,a=t.chart.time,o=t.categories,r=this.dateTimeLabelFormat,h=defaultOptions.lang,l=h.numericSymbols,c=h.numericSymbolMagnitude||1e3,d=t.logarithmic?Math.abs(n):t.tickInterval;let m=l&&l.length,g,f;if(o)f=""+this.value;else if(r)f=a.dateFormat(r,n);else if(m&&1e3<=d)for(;m--&&void 0===f;)(g=Math.pow(c,m+1))<=d&&10*n%g==0&&null!==l[m]&&0!==n&&(f=s(n/g,-1)+l[m]);return f=void 0===f?1e4<=Math.abs(n)?s(n,-1):s(n,-1,void 0,""):f}getSeriesExtremes(){const o=this;o.chart;let r;fireEvent(this,"getSeriesExtremes",null,function(){o.hasVisibleSeries=!1,o.dataMin=o.dataMax=o.threshold=null,o.softThreshold=!o.isXAxis,o.series.forEach(function(n){if(n.reserveSpace()){var a=n.options;let i,t=a.threshold,e,s;o.hasVisibleSeries=!0,o.positiveValuesOnly&&t<=0&&(t=null),o.isXAxis?(i=n.xData)&&i.length&&(i=o.logarithmic?i.filter(i=>0<i):i,r=n.getXExtremes(i),e=r.min,s=r.max,isNumber(e)||e instanceof Date||(i=i.filter(isNumber),r=n.getXExtremes(i),e=r.min,s=r.max),i.length&&(o.dataMin=Math.min(pick(o.dataMin,e),e),o.dataMax=Math.max(pick(o.dataMax,s),s))):(n=n.applyExtremes(),isNumber(n.dataMin)&&(e=n.dataMin,o.dataMin=Math.min(pick(o.dataMin,e),e)),isNumber(n.dataMax)&&(s=n.dataMax,o.dataMax=Math.max(pick(o.dataMax,s),s)),defined(t)&&(o.threshold=t),a.softThreshold&&!o.positiveValuesOnly||(o.softThreshold=!1))}})}),fireEvent(this,"afterGetSeriesExtremes")}translate(i,t,e,s,n,a){const o=this.linkedParent||this,r=(s&&o.old?o.old:o).min;if(!isNumber(r))return NaN;var h=o.minPixelPadding,n=(o.isOrdinal||o.brokenAxis&&o.brokenAxis.hasBreaks||o.logarithmic&&n)&&o.lin2val;let l=1,c=0,d=(s&&o.old?o.old:o).transA,m=0;return d=d||o.transA,e&&(l*=-1,c=o.len),o.reversed&&(l*=-1,c-=l*(o.sector||o.len)),t?(i=i*l+c,i-=h,m=i/d+r,n&&(m=o.lin2val(m))):(n&&(i=o.val2lin(i)),s=l*(i-r)*d,m=(o.isRadial?s:correctFloat(s))+c+l*h+(isNumber(a)?d*a:0)),m}toPixels(i,t){return this.translate(i,!1,!this.horiz,void 0,!0)+(t?0:this.pos)}toValue(i,t){return this.translate(i-(t?0:this.pos),!0,!this.horiz,void 0,!0)}getPlotLinePath(i){const t=this,e=t.chart,s=t.left,n=t.top,a=i.old,o=i.value,r=i.lineWidth,h=a&&e.oldChartHeight||e.chartHeight,l=a&&e.oldChartWidth||e.chartWidth,c=t.transB;let d=i.translatedValue,m=i.force,g,f,p,x,u;function k(i,t,e){return"pass"!==m&&(i<t||e<i)&&(m?i=clamp(i,t,e):u=!0),i}i={value:o,lineWidth:r,old:a,force:m,acrossPanes:i.acrossPanes,translatedValue:d};return fireEvent(this,"getPlotLinePath",i,function(i){d=pick(d,t.translate(o,void 0,void 0,a)),d=clamp(d,-1e5,1e5),g=p=Math.round(d+c),f=x=Math.round(h-d-c),isNumber(d)?t.horiz?(f=n,x=h-t.bottom,g=p=k(g,s,s+t.width)):(g=s,p=l-t.right,f=x=k(f,n,n+t.height)):(u=!0,m=!1),i.path=u&&!m?void 0:e.renderer.crispLine([["M",g,f],["L",p,x]],r||1)}),i.path||null}getLinearTickPositions(i,t,e){const s=correctFloat(Math.floor(t/i)*i),n=correctFloat(Math.ceil(e/i)*i),a=[];let o,r,h;if(correctFloat(s+i)===s&&(h=20),this.single)return[t];for(o=s;o<=n&&(a.push(o),(o=correctFloat(o+i,h))!==r);)r=o;return a}getMinorTickInterval(){var i=this.options;return!0===i.minorTicks?pick(i.minorTickInterval,"auto"):!1===i.minorTicks?null:i.minorTickInterval}getMinorTickPositions(){const i=this,t=i.options,e=i.tickPositions,s=i.minorTickInterval,n=i.pointRangePadding||0,a=i.min-n,o=i.max+n,r=o-a;let h=[],l;if(r&&r/s<i.len/3){const c=i.logarithmic;if(c)this.paddedTicks.forEach(function(i,t,e){t&&h.push.apply(h,c.getLogTickPositions(s,e[t-1],e[t],!0))});else if(i.dateTime&&"auto"===this.getMinorTickInterval())h=h.concat(i.getTimeTicks(i.dateTime.normalizeTimeTickInterval(s),a,o,t.startOfWeek));else for(l=a+(e[0]-a)%s;l<=o&&l!==h[0];l+=s)h.push(l)}return 0!==h.length&&i.trimTicks(h),h}adjustForMinRange(){const i=this,t=i.options,e=i.logarithmic;let s=i.min,n=i.max,a,o,r,h,l,c;i.isXAxis&&void 0===i.minRange&&!e&&(defined(t.min)||defined(t.max)||defined(t.floor)||defined(t.ceiling)?i.minRange=null:(r=getClosestDistance(i.series.map(i=>(i.xIncrement?i.xData?.slice(0,2):i.xData)||[]))||0,i.minRange=Math.min(5*r,i.dataMax-i.dataMin))),n-s<i.minRange&&(o=i.dataMax-i.dataMin>=i.minRange,a=((c=i.minRange)-n+s)/2,h=[s-a,pick(t.min,s-a)],o&&(h[2]=e?e.log2lin(i.dataMin):i.dataMin),s=arrayMax(h),l=[s+c,pick(t.max,s+c)],o&&(l[2]=e?e.log2lin(i.dataMax):i.dataMax),(n=arrayMin(l))-s<c&&(h[0]=n-c,h[1]=pick(t.min,n-c),s=arrayMax(h))),i.min=s,i.max=n}getClosest(){let i,e;if(this.categories)e=1;else{const s=[];this.series.forEach(function(i){var t=i.closestPointRange;1===i.xData?.length?s.push(i.xData[0]):!i.noSharedTooltip&&defined(t)&&i.reserveSpace()&&(e=defined(e)?Math.min(e,t):t)}),s.length&&(s.sort((i,t)=>i-t),i=getClosestDistance([s]))}return i&&e?Math.min(i,e):i||e}nameToX(i){const t=isArray(this.options.categories),e=t?this.categories:this.names;let s=i.options.x,n;return i.series.requireSorting=!1,-1===(s=defined(s)?s:this.options.uniqueNames&&e?t?e.indexOf(i.name):pick(e.keys[i.name],-1):i.series.autoIncrement())?!t&&e&&(n=e.length):n=s,void 0!==n?(this.names[n]=i.name,this.names.keys[i.name]=n):i.x&&(n=i.x),n}updateNames(){const n=this,t=this.names,i=t.length;0<i&&(Object.keys(t.keys).forEach(function(i){delete t.keys[i]}),t.length=0,this.minRange=this.userMinRange,(this.series||[]).forEach(function(s){s.xIncrement=null,s.points&&!s.isDirtyData||(n.max=Math.max(n.max,s.xData.length-1),s.processData(),s.generatePoints()),s.data.forEach(function(i,t){var e;i&&i.options&&void 0!==i.name&&void 0!==(e=n.nameToX(i))&&e!==i.x&&(i.x=e,s.xData[t]=e)})}))}setAxisTranslation(){const s=this,i=s.max-s.min,t=s.linkedParent,n=!!s.categories,a=s.isXAxis;let o=s.axisPointRange||0,r,h=0,l=0,e,c=void s.transA;(a||n||o)&&(r=s.getClosest(),t?(h=t.minPointOffset,l=t.pointRangePadding):s.series.forEach(function(i){var t=n?1:a?pick(i.options.pointRange,r,0):s.axisPointRange||0,e=i.options.pointPlacement;o=Math.max(o,t),s.single&&!n||(i=i.is("xrange")?!a:a,h=Math.max(h,i&&isString(e)?0:t/2),l=Math.max(l,i&&"on"===e?0:t))}),e=s.ordinal&&s.ordinal.slope&&r?s.ordinal.slope/r:1,s.minPointOffset=h*=e,s.pointRangePadding=l*=e,s.pointRange=Math.min(o,s.single&&n?1:i),a&&r&&(s.closestPointRange=r)),s.translationSlope=s.transA=c=s.staticScale||s.len/(i+l||1),s.transB=s.horiz?s.left:s.bottom,s.minPixelPadding=c*h,fireEvent(this,"afterSetAxisTranslation")}minFromRange(){return this.max-this.range}setTickInterval(i){const t=this,e=t.chart,s=t.logarithmic,n=t.options,a=t.isXAxis,o=t.isLinked,r=n.tickPixelInterval,h=t.categories,l=t.softThreshold;let c=n.maxPadding,d=n.minPadding,m,g,f=isNumber(n.tickInterval)&&0<=n.tickInterval?n.tickInterval:void 0,p=isNumber(t.threshold)?t.threshold:null,x,u,k,v;if(t.dateTime||h||o||this.getTickAmount(),k=pick(t.userMin,n.min),v=pick(t.userMax,n.max),o?(t.linkedParent=e[t.coll][n.linkedTo],g=t.linkedParent.getExtremes(),t.min=pick(g.min,g.dataMin),t.max=pick(g.max,g.dataMax),n.type!==t.linkedParent.options.type&&error(11,1,e)):(l&&defined(p)&&(t.dataMin>=p?(x=p,d=0):t.dataMax<=p&&(u=p,c=0)),t.min=pick(k,x,t.dataMin),t.max=pick(v,u,t.dataMax)),s&&(t.positiveValuesOnly&&!i&&Math.min(t.min,pick(t.dataMin,t.min))<=0&&error(10,1,e),t.min=correctFloat(s.log2lin(t.min),16),t.max=correctFloat(s.log2lin(t.max),16)),t.range&&defined(t.max)&&(t.userMin=t.min=k=Math.max(t.dataMin,t.minFromRange()),t.userMax=v=t.max,t.range=null),fireEvent(t,"foundExtremes"),t.beforePadding&&t.beforePadding(),t.adjustForMinRange(),isNumber(t.userMin)||isNumber(n.softMin)&&n.softMin<t.min&&(t.min=k=n.softMin),isNumber(t.userMax)||isNumber(n.softMax)&&n.softMax>t.max&&(t.max=v=n.softMax),h||t.axisPointRange||t.stacking&&t.stacking.usePercentage||o||!defined(t.min)||!defined(t.max)||(m=t.max-t.min)&&(!defined(k)&&d&&(t.min-=m*d),!defined(v)&&c&&(t.max+=m*c)),!isNumber(t.userMin)&&isNumber(n.floor)&&(t.min=Math.max(t.min,n.floor)),!isNumber(t.userMax)&&isNumber(n.ceiling)&&(t.max=Math.min(t.max,n.ceiling)),l&&defined(t.dataMin)&&(p=p||0,!defined(k)&&t.min<p&&t.dataMin>=p?t.min=t.options.minRange?Math.min(p,t.max-t.minRange):p:!defined(v)&&t.max>p&&t.dataMax<=p&&(t.max=t.options.minRange?Math.max(p,t.min+t.minRange):p)),isNumber(t.min)&&isNumber(t.max)&&!this.chart.polar&&t.min>t.max&&(defined(t.options.min)?t.max=t.min:defined(t.options.max)&&(t.min=t.max)),t.min===t.max||void 0===t.min||void 0===t.max?t.tickInterval=1:o&&t.linkedParent&&!f&&r===t.linkedParent.options.tickPixelInterval?t.tickInterval=f=t.linkedParent.tickInterval:t.tickInterval=pick(f,this.tickAmount?(t.max-t.min)/Math.max(this.tickAmount-1,1):void 0,h?1:(t.max-t.min)*r/Math.max(t.len,r)),a&&!i){const M=t.min!==(t.old&&t.old.min)||t.max!==(t.old&&t.old.max);t.series.forEach(function(i){i.forceCrop=i.forceCropping&&i.forceCropping(),i.processData(M)}),fireEvent(this,"postProcessData",{hasExtremesChanged:M})}t.setAxisTranslation(),fireEvent(this,"initialAxisTranslation"),t.pointRange&&!f&&(t.tickInterval=Math.max(t.pointRange,t.tickInterval));i=pick(n.minTickInterval,t.dateTime&&!t.series.some(i=>i.noSharedTooltip)?t.closestPointRange:0);!f&&t.tickInterval<i&&(t.tickInterval=i),t.dateTime||t.logarithmic||f||(t.tickInterval=getNormalizedTickInterval(t,t.tickInterval)),this.tickAmount||(t.tickInterval=t.unsquish()),this.setTickPositions()}setTickPositions(){const i=this,t=this.options,e=t.tickPositions,s=t.tickPositioner,n=this.getMinorTickInterval(),a=this.hasVerticalPanning(),o="colorAxis"===this.coll,r=(o||!a)&&t.startOnTick,h=(o||!a)&&t.endOnTick;let l=[],c;if(this.tickmarkOffset=this.categories&&"between"===t.tickmarkPlacement&&1===this.tickInterval?.5:0,this.minorTickInterval="auto"===n&&this.tickInterval?this.tickInterval/t.minorTicksPerMajor:n,this.single=this.min===this.max&&defined(this.min)&&!this.tickAmount&&(parseInt(this.min,10)===this.min||!1!==t.allowDecimals),e)l=e.slice();else if(isNumber(this.min)&&isNumber(this.max)){if(i.ordinal&&i.ordinal.positions||!((this.max-this.min)/this.tickInterval>Math.max(2*this.len,200)))if(i.dateTime)l=i.getTimeTicks(i.dateTime.normalizeTimeTickInterval(this.tickInterval,t.units),this.min,this.max,t.startOfWeek,i.ordinal&&i.ordinal.positions,this.closestPointRange,!0);else if(i.logarithmic)l=i.logarithmic.getLogTickPositions(this.tickInterval,this.min,this.max);else{var d=this.tickInterval;let i=d;for(;i<=2*d&&(l=this.getLinearTickPositions(this.tickInterval,this.min,this.max),this.tickAmount&&l.length>this.tickAmount);)this.tickInterval=getNormalizedTickInterval(this,i*=1.1)}else l=[this.min,this.max],error(19,!1,this.chart);l.length>this.len&&(l=[l[0],l[l.length-1]])[0]===l[1]&&(l.length=1),s&&(this.tickPositions=l,(c=s.apply(i,[this.min,this.max]))&&(l=c))}this.tickPositions=l,this.paddedTicks=l.slice(0),this.trimTicks(l,r,h),!this.isLinked&&isNumber(this.min)&&isNumber(this.max)&&(this.single&&l.length<2&&!this.categories&&!this.series.some(i=>i.is("heatmap")&&"between"===i.options.pointPlacement)&&(this.min-=.5,this.max+=.5),e||c||this.adjustTickAmount()),fireEvent(this,"afterSetTickPositions")}trimTicks(i,t,e){var s=i[0],n=i[i.length-1],a=!this.isOrdinal&&this.minPointOffset||0;if(fireEvent(this,"trimTicks"),!this.isLinked){if(t&&s!==-1/0)this.min=s;else for(;this.min-a>i[0];)i.shift();if(e)this.max=n;else for(;this.max+a<i[i.length-1];)i.pop();0===i.length&&defined(s)&&!this.options.tickPositions&&i.push((n+s)/2)}}alignToOthers(){const e=this,s=[this],i=e.options,t="yAxis"===this.coll&&this.chart.options.chart.alignThresholds,n=[];let a;if(e.thresholdAlignment=void 0,(!1!==this.chart.options.chart.alignTicks&&i.alignTicks||t)&&!1!==i.startOnTick&&!1!==i.endOnTick&&!e.logarithmic){const o=i=>{const{horiz:t,options:e}=i;return[t?e.left:e.top,e.width,e.height,e.pane].join(",")},r=o(this);this.chart[this.coll].forEach(function(i){const t=i["series"];t.length&&t.some(i=>i.visible)&&i!==e&&o(i)===r&&(a=!0,s.push(i))})}if(a&&t){s.forEach(i=>{i=i.getThresholdAlignment(e);isNumber(i)&&n.push(i)});const h=1<n.length?n.reduce((i,t)=>i+=t,0)/n.length:void 0;s.forEach(i=>{i.thresholdAlignment=h})}return a}getThresholdAlignment(i){if((!isNumber(this.dataMin)||this!==i&&this.series.some(i=>i.isDirty||i.isDirtyData))&&this.getSeriesExtremes(),isNumber(this.threshold)){let i=clamp((this.threshold-(this.dataMin||0))/((this.dataMax||0)-(this.dataMin||0)),0,1);return i=this.options.reversed?1-i:i}}getTickAmount(){var i=this.options,t=i.tickPixelInterval;let e=i.tickAmount;(e=!(e=!defined(i.tickInterval)&&!e&&this.len<t&&!this.isRadial&&!this.logarithmic&&i.startOnTick&&i.endOnTick?2:e)&&this.alignToOthers()?Math.ceil(this.len/t)+1:e)<4&&(this.finalTickAmt=e,e=5),this.tickAmount=e}adjustTickAmount(){const i=this,{finalTickAmt:t,max:e,min:s,options:n,tickPositions:a,tickAmount:o,thresholdAlignment:r}=i,h=a&&a.length,l=pick(i.threshold,i.softThreshold?0:null);let c,d,m=i.tickInterval,g;var f=()=>a.push(correctFloat(a[a.length-1]+m)),p=()=>a.unshift(correctFloat(a[0]-m));if(isNumber(r)&&(g=r<.5?Math.ceil(r*(o-1)):Math.floor(r*(o-1)),n.reversed&&(g=o-1-g)),i.hasData()&&isNumber(s)&&isNumber(e)){var x=()=>{i.transA*=(h-1)/(o-1),i.min=n.startOnTick?a[0]:Math.min(s,a[0]),i.max=n.endOnTick?a[a.length-1]:Math.max(e,a[a.length-1])};if(isNumber(g)&&isNumber(i.threshold)){for(;a[g]!==l||a.length!==o||a[0]>s||a[a.length-1]<e;){for(a.length=0,a.push(i.threshold);a.length<o;)(void 0===a[g]||a[g]>i.threshold?p:f)();if(m>8*i.tickInterval)break;m*=2}x()}else if(h<o){for(;a.length<o;)(a.length%2||s===l?f:p)();x()}if(defined(t)){for(d=c=a.length;d--;)(3===t&&d%2==1||t<=2&&0<d&&d<c-1)&&a.splice(d,1);i.finalTickAmt=void 0}}}setScale(){const i=this,{coll:t,stacking:e}=i;let s=!1,n=!1;i.series.forEach(i=>{s=s||i.isDirtyData||i.isDirty,n=n||i.xAxis&&i.xAxis.isDirty||!1}),i.setAxisSize();var a=i.len!==(i.old&&i.old.len);a||s||n||i.isLinked||i.forceRedraw||i.userMin!==(i.old&&i.old.userMin)||i.userMax!==(i.old&&i.old.userMax)||i.alignToOthers()?(e&&"yAxis"===t&&e.buildStacks(),i.forceRedraw=!1,i.userMinRange||(i.minRange=void 0),i.getSeriesExtremes(),i.setTickInterval(),e&&"xAxis"===t&&e.buildStacks(),i.isDirty||(i.isDirty=a||i.min!==(i.old&&i.old.min)||i.max!==(i.old&&i.old.max))):e&&e.cleanStacks(),s&&i.panningState&&(i.panningState.isDirty=!0),fireEvent(this,"afterSetScale")}setExtremes(i,t,e,s,n){const a=this,o=a.chart;e=pick(e,!0),a.series.forEach(function(i){delete i.kdTree}),n=extend(n,{min:i,max:t}),fireEvent(a,"setExtremes",n,function(){a.userMin=i,a.userMax=t,a.eventArgs=n,e&&o.redraw(s)})}zoom(i,t){const s=this,n=this.dataMin,a=this.dataMax,e=this.options,o=Math.min(n,pick(e.min,n)),r=Math.max(a,pick(e.max,a)),h={newMin:i,newMax:t};return fireEvent(this,"zoom",h,function(i){let t=i.newMin,e=i.newMax;t===s.min&&e===s.max||(s.allowZoomOutside||(defined(n)&&(t=t<o?o:t)>r&&(t=r),defined(a)&&(e=e<o?o:e)>r&&(e=r)),s.displayBtn=void 0!==t||void 0!==e,s.setExtremes(t,e,!1,void 0,{trigger:"zoom"})),i.zoomed=!0}),h.zoomed}setAxisSize(){var i=this.chart,t=this.options,e=t.offsets||[0,0,0,0],s=this.horiz,n=this.width=Math.round(relativeLength(pick(t.width,i.plotWidth-e[3]+e[1]),i.plotWidth)),a=this.height=Math.round(relativeLength(pick(t.height,i.plotHeight-e[0]+e[2]),i.plotHeight)),o=this.top=Math.round(relativeLength(pick(t.top,i.plotTop+e[0]),i.plotHeight,i.plotTop)),t=this.left=Math.round(relativeLength(pick(t.left,i.plotLeft+e[3]),i.plotWidth,i.plotLeft));this.bottom=i.chartHeight-a-o,this.right=i.chartWidth-n-t,this.len=Math.max(s?n:a,0),this.pos=s?t:o}getExtremes(){const i=this,t=i.logarithmic;return{min:t?correctFloat(t.lin2log(i.min)):i.min,max:t?correctFloat(t.lin2log(i.max)):i.max,dataMin:i.dataMin,dataMax:i.dataMax,userMin:i.userMin,userMax:i.userMax}}getThreshold(i){const t=this,e=t.logarithmic,s=e?e.lin2log(t.min):t.min,n=e?e.lin2log(t.max):t.max;return null===i||i===-1/0?i=s:i===1/0?i=n:i<s?i=s:n<i&&(i=n),t.translate(i,0,1,0,1)}autoLabelAlign(i){const t=(pick(i,0)-90*this.side+720)%360,e={align:"center"};return fireEvent(this,"autoLabelAlign",e,function(i){15<t&&t<165?i.align="right":195<t&&t<345&&(i.align="left")}),e.align}tickSize(i){var t=this.options,e=pick(t["tick"===i?"tickWidth":"minorTickWidth"],"tick"===i&&this.isXAxis&&!this.categories?1:0);let s=t["tick"===i?"tickLength":"minorTickLength"],n;e&&s&&("inside"===t[i+"Position"]&&(s=-s),n=[s,e]);t={tickSize:n};return fireEvent(this,"afterTickSize",t),t.tickSize}labelMetrics(){var i=this.chart.renderer,t=this.ticks,t=t[Object.keys(t)[0]]||{};return this.chart.renderer.fontMetrics(t.label||t.movedLabel||i.box)}unsquish(){function i(i){let t=i/(n||1);return(t=1<t?Math.ceil(t):1)*s>r&&i!==1/0&&n!==1/0&&r&&(t=Math.ceil(r/s)),correctFloat(t*s)}const t=this.options.labels,e=this.horiz,s=this.tickInterval,n=this.len/(((this.categories?1:0)+this.max-this.min)/s),a=t.rotation,o=.75*this.labelMetrics().h,r=Math.max(this.max-this.min,0);let h=s,l,c=Number.MAX_VALUE,d;var m,g;if(e){if(t.staggerLines||(isNumber(a)?d=[a]:n<t.autoRotationLimit&&(d=t.autoRotation)),d)for(const f of d)(f===a||f&&-90<=f&&f<=90)&&(g=(m=i(Math.abs(o/Math.sin(deg2rad*f))))+Math.abs(f/360))<c&&(c=g,l=f,h=m)}else h=i(o);return this.autoRotation=d,this.labelRotation=pick(l,isNumber(a)?a:0),t.step?s:h}getSlotWidth(i){var t=this.chart,e=this.horiz,s=this.options.labels,n=Math.max(this.tickPositions.length-(this.categories?0:1),1),a=t.margin[3];if(i&&isNumber(i.slotWidth))return i.slotWidth;if(e&&s.step<2)return s.rotation?0:(this.staggerLines||1)*this.len/n;if(!e){i=s.style.width;if(void 0!==i)return parseInt(String(i),10);if(a)return a-t.spacing[3]}return.33*t.chartWidth}renderUnsquish(){const i=this.chart,t=i.renderer,e=this.tickPositions,a=this.ticks,s=this.options.labels,o=s.style,n=this.horiz,r=this.getSlotWidth(),h=Math.max(1,Math.round(r-2*s.padding)),l={},c=this.labelMetrics(),d=o.textOverflow;let m,g,f=0,p,x,u;if(isString(s.rotation)||(l.rotation=s.rotation||0),e.forEach(function(i){const t=a[i];t.movedLabel&&t.replaceMovedLabel(),t&&t.label&&t.label.textPxLength>f&&(f=t.label.textPxLength)}),this.maxLabelLength=f,this.autoRotation)f>h&&f>c.h?l.rotation=this.labelRotation:this.labelRotation=0;else if(r&&(m=h,!d))for(g="clip",x=e.length;!n&&x--;)u=e[x],(p=a[u].label)&&(p.styles&&"ellipsis"===p.styles.textOverflow?p.css({textOverflow:"clip"}):p.textPxLength>r&&p.css({width:r+"px"}),p.getBBox().height>this.len/e.length-(c.h-c.f)&&(p.specificTextOverflow="ellipsis"));l.rotation&&(m=f>.5*i.chartHeight?.33*i.chartHeight:f,d||(g="ellipsis")),this.labelAlign=s.align||this.autoLabelAlign(this.labelRotation),this.labelAlign&&(l.align=this.labelAlign),e.forEach(function(i){const t=a[i],e=t&&t.label,s=o.width,n={};e&&(e.attr(l),t.shortenLabel?t.shortenLabel():m&&!s&&"nowrap"!==o.whiteSpace&&(m<e.textPxLength||"SPAN"===e.element.tagName)?(n.width=m+"px",d||(n.textOverflow=e.specificTextOverflow||g),e.css(n)):e.styles&&e.styles.width&&!n.width&&!s&&e.css({width:null}),delete e.specificTextOverflow,t.rotation=l.rotation)},this),this.tickRotCorr=t.rotCorr(c.b,this.labelRotation||0,0!==this.side)}hasData(){return this.series.some(function(i){return i.hasData()})||this.options.showEmpty&&defined(this.min)&&defined(this.max)}addTitle(i){const t=this,e=t.chart.renderer,s=t.horiz,n=t.opposite,a=t.options,o=a.title,r=t.chart.styledMode;let h;t.axisTitle||(h=(h=o.textAlign)||(s?{low:"left",middle:"center",high:"right"}:{low:n?"right":"left",middle:"center",high:n?"left":"right"})[o.align],t.axisTitle=e.text(o.text||"",0,0,o.useHTML).attr({zIndex:7,rotation:o.rotation,align:h}).addClass("highcharts-axis-title"),r||t.axisTitle.css(merge(o.style)),t.axisTitle.add(t.axisGroup),t.axisTitle.isNew=!0),r||o.style.width||t.isRadial||t.axisTitle.css({width:t.len+"px"}),t.axisTitle[i?"show":"hide"](i)}generateTick(i){const t=this.ticks;t[i]?t[i].addLabel():t[i]=new Tick(this,i)}getOffset(){const t=this,{chart:i,horiz:e,options:s,side:n,ticks:a,tickPositions:o,coll:r,axisParent:h}=t,l=i.renderer,c=i.inverted&&!t.isZAxis?[1,0,3,2][n]:n,d=t.hasData(),m=s.title,g=s.labels,f=isNumber(s.crossing),p=i.axisOffset,x=i.clipOffset,u=[-1,1,1,-1][n],k=s.className;let v,M=0,b,T=0,A=0,P,L;var E;t.showAxis=v=d||s.showEmpty,t.staggerLines=t.horiz&&g.staggerLines||void 0,t.axisGroup||(t.gridGroup=(E=(i,t,e)=>l.g(i).attr({zIndex:e}).addClass(`highcharts-${r.toLowerCase()}${t} `+(this.isRadial?`highcharts-radial-axis${t} `:"")+(k||"")).add(h))("grid","-grid",s.gridZIndex),t.axisGroup=E("axis","",s.zIndex),t.labelGroup=E("axis-labels","-labels",g.zIndex)),d||t.isLinked?(o.forEach(function(i){t.generateTick(i)}),t.renderUnsquish(),t.reserveSpaceDefault=0===n||2===n||{1:"left",3:"right"}[n]===t.labelAlign,pick(g.reserveSpace,!f&&null,"center"===t.labelAlign||null,t.reserveSpaceDefault)&&o.forEach(function(i){A=Math.max(a[i].getLabelSize(),A)}),t.staggerLines&&(A*=t.staggerLines),t.labelOffset=A*(t.opposite?-1:1)):objectEach(a,function(i,t){i.destroy(),delete a[t]}),m&&m.text&&!1!==m.enabled&&(t.addTitle(v),v&&!f&&!1!==m.reserveSpace&&(t.titleOffset=M=t.axisTitle.getBBox()[e?"height":"width"],b=m.offset,T=defined(b)?0:pick(m.margin,e?5:10))),t.renderLine(),t.offset=u*pick(s.offset,p[n]?p[n]+(s.margin||0):0),t.tickRotCorr=t.tickRotCorr||{x:0,y:0},L=0===n?-t.labelMetrics().h:2===n?t.tickRotCorr.y:0,P=Math.abs(A)+T,A&&(P=(P-=L)+u*(e?pick(g.y,t.tickRotCorr.y+u*g.distance):pick(g.x,u*g.distance))),t.axisTitleMargin=pick(b,P),t.getMaxLabelDimensions&&(t.maxLabelDimensions=t.getMaxLabelDimensions(a,o)),"colorAxis"!==r&&(E=this.tickSize("tick"),p[n]=Math.max(p[n],(t.axisTitleMargin||0)+M+u*t.offset,P,o&&o.length&&E?E[0]+u*t.offset:0),E=!t.axisLine||s.offset?0:2*Math.floor(t.axisLine.strokeWidth()/2),x[c]=Math.max(x[c],E)),fireEvent(this,"afterGetOffset")}getLinePath(i){const t=this.chart,e=this.opposite,s=this.offset,n=this.horiz,a=this.left+(e?this.width:0)+s,o=t.chartHeight-this.bottom-(e?this.height:0)+s;return e&&(i*=-1),t.renderer.crispLine([["M",n?this.left:a,n?o:this.top],["L",n?t.chartWidth-this.right:a,n?o:t.chartHeight-this.bottom]],i)}renderLine(){this.axisLine||(this.axisLine=this.chart.renderer.path().addClass("highcharts-axis-line").add(this.axisGroup),this.chart.styledMode||this.axisLine.attr({stroke:this.options.lineColor,"stroke-width":this.options.lineWidth,zIndex:7}))}getTitlePosition(i){var t=this.horiz,e=this.left,s=this.top,n=this.len,a=this.options.title,o=t?e:s,r=this.opposite,h=this.offset,l=a.x,c=a.y,d=this.chart.renderer.fontMetrics(i),i=i?Math.max(i.getBBox(!1,0).height-d.h-1,0):0,o={low:o+(t?0:n),middle:o+n/2,high:o+(t?n:0)}[a.align],n=(t?s+this.height:e)+(t?1:-1)*(r?-1:1)*(this.axisTitleMargin||0)+[-i,i,d.f,-i][this.side],a={x:t?o+l:n+(r?this.width:0)+h+l,y:t?n+c-(r?this.height:0)+h:o+c};return fireEvent(this,"afterGetTitlePosition",{titlePosition:a}),a}renderMinorTick(i,t){const e=this.minorTicks;e[i]||(e[i]=new Tick(this,i,"minor")),t&&e[i].isNew&&e[i].render(null,!0),e[i].render(null,!1,1)}renderTick(i,t,e){const s=this,n=s.isLinked,a=s.ticks;(!n||i>=s.min&&i<=s.max||s.grid&&s.grid.isColumn)&&(a[i]||(a[i]=new Tick(s,i)),e&&a[i].isNew&&a[i].render(t,!0,-1),a[i].render(t))}render(){const e=this,s=e.chart,n=e.logarithmic,i=s.renderer,t=e.options,a=e.isLinked,o=e.tickPositions,r=e.axisTitle,h=e.ticks,l=e.minorTicks,c=e.alternateBands,d=t.stackLabels,m=t.alternateGridColor,g=t.crossing,f=e.tickmarkOffset,p=e.axisLine,x=e.showAxis,u=animObject(i.globalAnimation);let k,v;if(e.labelEdge.length=0,e.overlap=!1,[h,l,c].forEach(function(i){objectEach(i,function(i){i.isActive=!1})}),isNumber(g)){const M=(this.isXAxis?s.yAxis:s.xAxis)[0],b=[1,-1,-1,1][this.side];if(M){let i=M.toPixels(g,!0);e.horiz&&(i=M.len-i),e.offset=b*i}}if(e.hasData()||a){const T=e.chart.hasRendered&&e.old&&isNumber(e.old.min);e.minorTickInterval&&!e.categories&&e.getMinorTickPositions().forEach(function(i){e.renderMinorTick(i,T)}),o.length&&(o.forEach(function(i,t){e.renderTick(i,t,T)}),f&&(0===e.min||e.single)&&(h[-1]||(h[-1]=new Tick(e,-1,null,!0)),h[-1].render(-1))),m&&o.forEach(function(i,t){v=void 0!==o[t+1]?o[t+1]+f:e.max-f,t%2==0&&i<e.max&&v<=e.max+(s.polar?-f:f)&&(c[i]||(c[i]=new H.PlotLineOrBand(e)),k=i+f,c[i].options={from:n?n.lin2log(k):k,to:n?n.lin2log(v):v,color:m,className:"highcharts-alternate-grid"},c[i].render(),c[i].isActive=!0)}),e._addedPlotLB||(e._addedPlotLB=!0,(t.plotLines||[]).concat(t.plotBands||[]).forEach(function(i){e.addPlotBandOrLine(i)}))}[h,l,c].forEach(function(t){const e=[],i=u.duration;objectEach(t,function(i,t){i.isActive||(i.render(t,!1,0),i.isActive=!1,e.push(t))}),syncTimeout(function(){let i=e.length;for(;i--;)t[e[i]]&&!t[e[i]].isActive&&(t[e[i]].destroy(),delete t[e[i]])},t!==c&&s.hasRendered&&i?i:0)}),p&&(p[p.isPlaced?"animate":"attr"]({d:this.getLinePath(p.strokeWidth())}),p.isPlaced=!0,p[x?"show":"hide"](x)),r&&x&&(r[r.isNew?"attr":"animate"](e.getTitlePosition(r)),r.isNew=!1),d&&d.enabled&&e.stacking&&e.stacking.renderStackTotals(),e.old={len:e.len,max:e.max,min:e.min,transA:e.transA,userMax:e.userMax,userMin:e.userMin},e.isDirty=!1,fireEvent(this,"afterRender")}redraw(){this.visible&&(this.render(),this.plotLinesAndBands.forEach(function(i){i.render()})),this.series.forEach(function(i){i.isDirty=!0})}getKeepProps(){return this.keepProps||Axis.keepProps}destroy(i){const e=this,t=e.plotLinesAndBands,s=this.eventOptions;if(fireEvent(this,"destroy",{keepEvents:i}),i||removeEvent(e),[e.ticks,e.minorTicks,e.alternateBands].forEach(function(i){destroyObjectProperties(i)}),t){let i=t.length;for(;i--;)t[i].destroy()}["axisLine","axisTitle","axisGroup","gridGroup","labelGroup","cross","scrollbar"].forEach(function(i){e[i]&&(e[i]=e[i].destroy())});for(const n in e.plotLinesAndBandsGroups)e.plotLinesAndBandsGroups[n]=e.plotLinesAndBandsGroups[n].destroy();objectEach(e,function(i,t){-1===e.getKeepProps().indexOf(t)&&delete e[t]}),this.eventOptions=s}drawCrosshair(i,t){const e=this.crosshair,s=pick(e&&e.snap,!0),n=this.chart;let a,o,r,h=this.cross,l;if(fireEvent(this,"drawCrosshair",{e:i,point:t}),i=i||this.cross&&this.cross.e,e&&!1!==(defined(t)||!s)){if(s?defined(t)&&(o=pick("colorAxis"!==this.coll?t.crosshairPos:null,this.isXAxis?t.plotX:this.len-t.plotY)):o=i&&(this.horiz?i.chartX-this.pos:this.len-i.chartY+this.pos),defined(o)&&(l={value:t&&(this.isXAxis?t.x:pick(t.stackY,t.y)),translatedValue:o},n.polar&&extend(l,{isCrosshair:!0,chartX:i&&i.chartX,chartY:i&&i.chartY,point:t}),a=this.getPlotLinePath(l)||null),!defined(a))return void this.hideCrosshair();r=this.categories&&!this.isRadial,h||(this.cross=h=n.renderer.path().addClass("highcharts-crosshair highcharts-crosshair-"+(r?"category ":"thin ")+(e.className||"")).attr({zIndex:pick(e.zIndex,2)}).add(),n.styledMode||(h.attr({stroke:e.color||(r?Color.parse("#ccd3ff").setOpacity(.25).get():"#cccccc"),"stroke-width":pick(e.width,1)}).css({"pointer-events":"none"}),e.dashStyle&&h.attr({dashstyle:e.dashStyle}))),h.show().attr({d:a}),r&&!e.width&&h.attr({"stroke-width":this.transA}),this.cross.e=i}else this.hideCrosshair();fireEvent(this,"afterDrawCrosshair",{e:i,point:t})}hideCrosshair(){this.cross&&this.cross.hide(),fireEvent(this,"afterHideCrosshair")}hasVerticalPanning(){var i=this.chart.options.chart.panning;return Boolean(i&&i.enabled&&/y/.test(i.type))}update(i,t){const e=this.chart;i=merge(this.userOptions,i),this.destroy(!0),this.init(e,i),e.isDirtyBox=!0,pick(t,!0)&&e.redraw()}remove(i){const t=this.chart,e=this.coll,s=this.series;let n=s.length;for(;n--;)s[n]&&s[n].remove(!1);erase(t.axes,this),erase(t[e]||[],this),t.orderItems(e),this.destroy(),t.isDirtyBox=!0,pick(i,!0)&&t.redraw()}setTitle(i,t){this.update({title:i},t)}setCategories(i,t){this.update({categories:i},t)}}Axis.defaultOptions=AxisDefaults.defaultXAxisOptions,Axis.keepProps=["coll","extKey","hcEvents","names","series","userMax","userMin"];export default Axis;