"use strict";import AST from"./AST.js";import SVGElement from"../SVG/SVGElement.js";import SVGRenderer from"../SVG/SVGRenderer.js";import U from"../../Utilities.js";const{attr,createElement,extend,pick}=U,composedMembers=[];class HTMLRenderer extends SVGRenderer{static compose(t){if(U.pushUnique(composedMembers,t)){const e=HTMLRenderer.prototype,s=t.prototype;s.html=e.html}return t}html(t,e,s){function c(o,i){["opacity","visibility"].forEach(function(r){o[r+"Setter"]=function(t,e,s){const n=o.div?o.div.style:i;SVGElement.prototype[r+"Setter"].call(this,t,e,s),n&&(n[e]=t)}}),o.addedSetters=!0}const p=this.createElement("span"),n=p.element,r=p.renderer;return p.textSetter=function(t){t!==this.textStr&&(delete this.bBox,delete this.oldTextWidth,AST.setElementHTML(this.element,pick(t,"")),this.textStr=t,p.doTransform=!0)},c(p,p.element.style),p.xSetter=p.ySetter=p.alignSetter=p.rotationSetter=function(t,e){"align"===e?p.alignValue=p.textAlign=t:p[e]=t,p.doTransform=!0},p.afterSetters=function(){this.doTransform&&(this.htmlUpdateTransform(),this.doTransform=!1)},p.attr({text:t,x:Math.round(e),y:Math.round(s)}).css({position:"absolute"}),r.styledMode||p.css({fontFamily:this.style.fontFamily,fontSize:this.style.fontSize}),n.style.whiteSpace="nowrap",p.css=p.htmlCss,p.add=function(t){const a=r.box.parentNode,l=[];let d,e;if(this.parentGroup=t){if(!(d=t.div)){for(e=t;e;)l.push(e),e=e.parentGroup;l.reverse().forEach(function(s){const t=attr(s.element,"class"),n=s.css;function e(t,e){s[e]=t,"translateX"===e?i.left=t+"px":i.top=t+"px",s.doTransform=!0}var r,o=s.styles||{};const i=(d=s.div=s.div||createElement("div",t?{className:t}:void 0,{position:"absolute",left:(s.translateX||0)+"px",top:(s.translateY||0)+"px",display:s.display,opacity:s.opacity,visibility:s.visibility},d||a)).style;extend(s,{classSetter:(r=d,function(t){this.element.setAttribute("class",t),r.className=t}),css:function(e){return n.call(s,e),["cursor","pointerEvents"].forEach(t=>{e[t]&&(i[t]=e[t])}),s},on:function(){return l[0].div&&p.on.apply({element:l[0].div,onEvents:s.onEvents},arguments),s},translateXSetter:e,translateYSetter:e}),s.addedSetters||c(s),s.css(o)})}}else d=a;return d.appendChild(n),p.added=!0,p.alignOnAdd&&p.htmlUpdateTransform(),p},p}}export default HTMLRenderer;