"use strict";import H from"../../Globals.js";const{isFirefox,isMS,isWebKit,win}=H;import SVGElement from"../SVG/SVGElement.js";import U from"../../Utilities.js";const{css,defined,extend,pick,pInt}=U,composedMembers=[];class HTMLElement extends SVGElement{static compose(t){if(U.pushUnique(composedMembers,t)){const e=HTMLElement.prototype,i=t.prototype;i.getSpanCorrection=e.getSpanCorrection,i.htmlCss=e.htmlCss,i.htmlGetBBox=e.htmlGetBBox,i.htmlUpdateTransform=e.htmlUpdateTransform,i.setSpanRotation=e.setSpanRotation}return t}getSpanCorrection(t,e,i){this.xCorr=-t*i,this.yCorr=-e}htmlCss(t){var e=this,i="SPAN"===e.element.tagName&&t&&"width"in t,o=pick(i&&t.width,void 0);let s;return i&&(delete t.width,e.textWidth=o,s=!0),t&&"ellipsis"===t.textOverflow&&(t.whiteSpace="nowrap",t.overflow="hidden"),e.styles=extend(e.styles,t),css(e.element,t),s&&e.htmlUpdateTransform(),e}htmlGetBBox(){var t=this.element;return{x:t.offsetLeft,y:t.offsetTop,width:t.offsetWidth,height:t.offsetHeight}}htmlUpdateTransform(){if(this.added){const o=this,s=o.renderer,n=o.element,t=o.translateX||0,e=o.translateY||0,r=o.x||0,a=o.y||0,l=o.textAlign||"left",d={left:0,center:.5,right:1}[l],h=o.styles,m=h&&h.whiteSpace;if(css(n,{marginLeft:t,marginTop:e}),"SPAN"===n.tagName){const p=o.rotation,f=o.textWidth&&pInt(o.textWidth),x=[p,l,n.innerHTML,o.textWidth,o.textAlign].join(",");let t,e=!1;var i;f!==o.oldTextWidth&&(i=o.textPxLength||(css(n,{width:"",whiteSpace:m||"nowrap"}),n.offsetWidth),(f>o.oldTextWidth||f<i)&&(/[ \-]/.test(n.textContent||n.innerText)||"ellipsis"===n.style.textOverflow)&&(css(n,{width:f<i||p?f+"px":"auto",display:"block",whiteSpace:m||"normal"}),o.oldTextWidth=f,e=!0)),o.hasBoxWidthChanged=e,x!==o.cTT&&(t=s.fontMetrics(n).b,!defined(p)||p===(o.oldRotation||0)&&l===o.oldAlign||o.setSpanRotation(p,d,t),o.getSpanCorrection(!defined(p)&&o.textPxLength||n.offsetWidth,t,d,p,l)),css(n,{left:r+(o.xCorr||0)+"px",top:a+(o.yCorr||0)+"px"}),o.cTT=x,o.oldRotation=p,o.oldAlign=l}}else this.alignOnAdd=!0}setSpanRotation(t,e,i){const o={},s=isMS&&!/Edge/.test(win.navigator.userAgent)?"-ms-transform":isWebKit?"-webkit-transform":isFirefox?"MozTransform":win.opera?"-o-transform":void 0;s&&(o[s]=o.transform="rotate("+t+"deg)",o[s+(isFirefox?"Origin":"-origin")]=o.transformOrigin=100*e+"% "+i+"px",css(this.element,o))}}export default HTMLElement;