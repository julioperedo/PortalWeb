"use strict";import H from"../../Globals.js";const{SVG_NS,win}=H;import U from"../../Utilities.js";const{attr,createElement,css,error,isFunction,isString,objectEach,splat}=U,trustedTypes=win["trustedTypes"],trustedTypesPolicy=trustedTypes&&isFunction(trustedTypes.createPolicy)&&trustedTypes.createPolicy("highcharts",{createHTML:e=>e}),emptyHTML=trustedTypesPolicy?trustedTypesPolicy.createHTML(""):"",hasValidDOMParser=function(){try{return Boolean((new DOMParser).parseFromString(emptyHTML,"text/html"))}catch(e){return!1}}();class AST{static filterUserAttributes(a){return objectEach(a,(t,e)=>{let r=!0;-1===AST.allowedAttributes.indexOf(e)&&(r=!1),(r=-1!==["background","dynsrc","href","lowsrc","src"].indexOf(e)?isString(t)&&AST.allowedReferences.some(e=>0===t.indexOf(e)):r)||(error(33,!1,void 0,{"Invalid attribute in config":""+e}),delete a[e]),isString(t)&&a[e]&&(a[e]=t.replace(/</g,"&lt;"))}),a}static parseStyle(e){return e.split(";").reduce((e,t)=>{const r=t.split(":").map(e=>e.trim()),a=r.shift();return a&&r.length&&(e[a.replace(/-([a-z])/g,e=>e[1].toUpperCase())]=r.join(":")),e},{})}static setElementHTML(e,t){if(e.innerHTML=AST.emptyHTML,t){const r=new AST(t);r.addToDOM(e)}}constructor(e){this.nodes="string"==typeof e?this.parseMarkup(e):e}addToDOM(e){return function o(e,c){let d;return splat(e).forEach(function(e){var t=e.tagName,r=e.textContent?H.doc.createTextNode(e.textContent):void 0,a=AST.bypassHTMLFiltering;let s;if(t)if("#text"===t)s=r;else if(-1!==AST.allowedTags.indexOf(t)||a){var i="svg"!==t&&c.namespaceURI||SVG_NS;const n=H.doc.createElementNS(i,t),l=e.attributes||{};objectEach(e,function(e,t){"tagName"!==t&&"attributes"!==t&&"children"!==t&&"style"!==t&&"textContent"!==t&&(l[t]=e)}),attr(n,a?l:AST.filterUserAttributes(l)),e.style&&css(n,e.style),r&&n.appendChild(r),o(e.children||[],n),s=n}else error(33,!1,void 0,{"Invalid tagName in config":t});s&&c.appendChild(s),d=s}),d}(this.nodes,e)}parseMarkup(e){const t=[];e=e.trim().replace(/ style=(["'])/g," data-style=$1");let r;if(hasValidDOMParser)r=(new DOMParser).parseFromString(trustedTypesPolicy?trustedTypesPolicy.createHTML(e):e,"text/html");else{const a=createElement("div");a.innerHTML=e,r={body:a}}const n=(e,t)=>{var r=e.nodeName.toLowerCase();const a={tagName:r};"#text"===r&&(a.textContent=e.textContent||"");r=e.attributes;if(r){const s={};[].forEach.call(r,e=>{"data-style"===e.name?a.style=AST.parseStyle(e.value):s[e.name]=e.value}),a.attributes=s}if(e.childNodes.length){const i=[];[].forEach.call(e.childNodes,e=>{n(e,i)}),i.length&&(a.children=i)}t.push(a)};return[].forEach.call(r.body.childNodes,e=>n(e,t)),t}}AST.allowedAttributes=["alt","aria-controls","aria-describedby","aria-expanded","aria-haspopup","aria-hidden","aria-label","aria-labelledby","aria-live","aria-pressed","aria-readonly","aria-roledescription","aria-selected","class","clip-path","color","colspan","cx","cy","d","dx","dy","disabled","fill","filterUnits","flood-color","flood-opacity","height","href","id","in","markerHeight","markerWidth","offset","opacity","orient","padding","paddingLeft","paddingRight","patternUnits","r","refX","refY","role","scope","slope","src","startOffset","stdDeviation","stroke","stroke-linecap","stroke-width","style","tableValues","result","rowspan","summary","target","tabindex","text-align","text-anchor","textAnchor","textLength","title","type","valign","width","x","x1","x2","xlink:href","y","y1","y2","zIndex"],AST.allowedReferences=["https://","http://","mailto:","/","../","./","#"],AST.allowedTags=["a","abbr","b","br","button","caption","circle","clipPath","code","dd","defs","div","dl","dt","em","feComponentTransfer","feDropShadow","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feOffset","feMerge","feMergeNode","filter","h1","h2","h3","h4","h5","h6","hr","i","img","li","linearGradient","marker","ol","p","path","pattern","pre","rect","small","span","stop","strong","style","sub","sup","svg","table","text","textPath","thead","title","tbody","tspan","td","th","tr","u","ul","#text"],AST.emptyHTML=emptyHTML,AST.bypassHTMLFiltering=!1;export default AST;