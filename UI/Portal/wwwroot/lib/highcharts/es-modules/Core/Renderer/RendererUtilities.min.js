"use strict";import U from"../Utilities.js";const{clamp,pick,pushUnique,stableSort}=U;var RendererUtilities;(RendererUtilities||(RendererUtilities={})).distribute=function s(t,r,i){const a=t,e=a.reducedLen||r,o=(e,t)=>e.target-t.target,l=[],n=t.length,p=[],g=l.push;let c,d,u,h=!0,f,z,m=0,U;for(c=n;c--;)m+=t[c].size;if(m>e){for(stableSort(t,(e,t)=>(t.rank||0)-(e.rank||0)),U=t[0].rank===t[t.length-1].rank,u=U?n/2:-1,d=U?u:n-1;u&&m>e;)c=Math.floor(d),f=t[c],pushUnique(p,c)&&(m-=f.size),d+=u,U&&d>=t.length&&(u/=2,d=u);p.sort((e,t)=>t-e).forEach(e=>g.apply(l,t.splice(e,1)))}for(stableSort(t,o),t=t.map(e=>({size:e.size,targets:[e.target],align:pick(e.align,.5)}));h;){for(c=t.length;c--;)f=t[c],z=(Math.min.apply(0,f.targets)+Math.max.apply(0,f.targets))/2,f.pos=clamp(z-f.size*f.align,0,r-f.size);for(c=t.length,h=!1;c--;)0<c&&t[c-1].pos+t[c-1].size>t[c].pos&&(t[c-1].size+=t[c].size,t[c-1].targets=t[c-1].targets.concat(t[c].targets),t[c-1].align=.5,t[c-1].pos+t[c-1].size>r&&(t[c-1].pos=r-t[c-1].size),t.splice(c,1),h=!0)}return g.apply(a,l),c=0,t.some(e=>{let t=0;return(e.targets||[]).some(()=>(a[c].pos=e.pos+t,void 0!==i&&Math.abs(a[c].pos-a[c].target)>i?(a.slice(0,c+1).forEach(e=>delete e.pos),a.reducedLen=(a.reducedLen||r)-.1*r,a.reducedLen>.1*r&&s(a,r,i),!0):(t+=a[c].size,c++,!1)))}),stableSort(a,o),a};export default RendererUtilities;