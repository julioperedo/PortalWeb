"use strict";import D from"./Defaults.js";const{defaultOptions,defaultTime}=D;import U from"./Utilities.js";const{extend,getNestedProperty,isArray,isNumber,isObject,isString,pick,pInt}=U,helpers={add:(t,e)=>t+e,divide:(t,e)=>0!==e?t/e:"",eq:(t,e)=>t==e,each:function(n){const r=arguments[arguments.length-1];return!!isArray(n)&&n.map((t,e)=>format(r.body,extend(isObject(t)?t:{"@this":t},{"@index":e,"@first":0===e,"@last":e===n.length-1}))).join("")},ge:(t,e)=>e<=t,gt:(t,e)=>e<t,if:t=>!!t,le:(t,e)=>t<=e,lt:(t,e)=>t<e,multiply:(t,e)=>t*e,ne:(t,e)=>t!=e,subtract:(t,e)=>t-e,unless:t=>!t};function dateFormat(t,e,n){return defaultTime.dateFormat(t,e,n)}function format(c="",m,t){const e=/\{([a-zA-Z0-9\:\.\,;\-\/<>%_@"'= #\(\)]+)\}/g,n=/\(([a-zA-Z0-9\:\.\,;\-\/<>%_@"'= ]+)\)/g,r=[],u=/f$/,h=/\.([0-9])/,g=defaultOptions.lang,b=t&&t.time||defaultTime,x=t&&t.numberFormatter||numberFormat,y=(t="")=>{let e;return"true"===t||"false"!==t&&((e=Number(t)).toString()===t?e:getNestedProperty(t,m))};let s,i,o=0,l;for(;null!==(s=e.exec(c));){var a,p=n.exec(s[1]),d=(p&&(s=p,l=!0),i&&i.isBlock||(i={ctx:m,expression:s[1],find:s[0],isBlock:"#"===s[1].charAt(0),start:s.index,startInner:s.index+s[0].length,length:s[0].length}),s[1].split(" ")[0].replace("#","")),d=(helpers[d]&&(i.isBlock&&d===i.fn&&o++,i.fn||(i.fn=d)),"else"===s[1]);if(i.isBlock&&i.fn&&(s[1]==="/"+i.fn||d)?o?d||o--:(a=i.startInner,a=c.substr(a,s.index-a),void 0===i.body?(i.body=a,i.startInner=s.index+s[0].length):i.elseBody=a,i.find+=a+s[0],d||(r.push(i),i=void 0)):i.isBlock||r.push(i),p&&!i?.isBlock)break}return r.forEach(t=>{const{body:e,elseBody:n,expression:r,fn:s}=t;let i,o;if(s){const a=[t],p=r.split(" ");for(o=helpers[s].length;o--;)a.unshift(y(p[o+1]));i=helpers[s].apply(m,a),t.isBlock&&"boolean"==typeof i&&(i=format(i?e:n,m))}else{const d=r.split(":");if(i=y(d.shift()||""),d.length&&"number"==typeof i){const f=d.join(":");var l;u.test(f)?(l=parseInt((f.match(h)||["","-1"])[1],10),null!==i&&(i=x(i,l,g.decimalPoint,-1<f.indexOf(",")?g.thousandsSep:""))):i=b.dateFormat(f,i)}}c=c.replace(t.find,pick(i,""))}),l?format(c,m,t):c}function numberFormat(t,e,n,r){t=+t||0,e=+e;let s,i;const o=defaultOptions.lang,l=(t.toString().split(".")[1]||"").split("e")[0].length,a=t.toString().split("e"),p=e,d=(-1===e?e=Math.min(l,20):isNumber(e)?e&&a[1]&&a[1]<0&&(0<=(i=e+ +a[1])?(a[0]=(+a[0]).toExponential(i).split("e")[0],e=i):(a[0]=a[0].split(".")[0]||0,t=e<20?(a[0]*Math.pow(10,a[1])).toFixed(e):0,a[1]=0)):e=2,(Math.abs(a[1]?a[0]:t)+Math.pow(10,-Math.max(e,l)-1)).toFixed(e)),f=String(pInt(d));var c=3<f.length?f.length%3:0;return n=pick(n,o.decimalPoint),r=pick(r,o.thousandsSep),s=t<0?"-":"",s+=c?f.substr(0,c)+r:"",+a[1]<0&&!p?s="0":s+=f.substr(c).replace(/(\d{3})(?=\d)/g,"$1"+r),e&&(s+=n+d.slice(-e)),a[1]&&0!=+s&&(s+="e"+a[1]),s}const Templating={dateFormat:dateFormat,format:format,helpers:helpers,numberFormat:numberFormat};export default Templating;