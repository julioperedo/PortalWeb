"use strict";import Chart from"../Chart/Chart.js";import F from"../Templating.js";const format=F["format"];import D from"../Defaults.js";const getOptions=D["getOptions"];import NavigatorDefaults from"../../Stock/Navigator/NavigatorDefaults.js";import RangeSelectorDefaults from"../../Stock/RangeSelector/RangeSelectorDefaults.js";import ScrollbarDefaults from"../../Stock/Scrollbar/ScrollbarDefaults.js";import U from"../Utilities.js";const{addEvent,clamp,defined,extend,find,isNumber,isString,merge,pick,pushUnique,splat}=U;import"../Pointer.js";function getDefaultAxisOptions(t,e){return"xAxis"===t?{minPadding:0,maxPadding:0,overscroll:0,ordinal:!0,title:{text:null},labels:{overflow:"justify"},showLastLabel:!0}:"yAxis"===t?{labels:{y:-2},opposite:pick(e.opposite,!0),showLastLabel:!(!e.categories&&"category"!==e.type),title:{text:null}}:{}}function getForcedAxisOptions(t,e){if("xAxis"!==t)return{};{const i={type:"datetime",categories:void 0};return pick(e.navigator&&e.navigator.enabled,NavigatorDefaults.enabled,!0)&&(i.startOnTick=!1,i.endOnTick=!1),i}}class StockChart extends Chart{init(i,t){const s=getOptions(),e=i.xAxis,o=i.yAxis,r=pick(i.navigator&&i.navigator.enabled,NavigatorDefaults.enabled,!0),a=(i.xAxis=i.yAxis=void 0,merge({chart:{panning:{enabled:!0,type:"x"},zooming:{pinchType:"x",mouseWheel:{type:"x"}}},navigator:{enabled:r},scrollbar:{enabled:pick(ScrollbarDefaults.enabled,!0)},rangeSelector:{enabled:pick(RangeSelectorDefaults.rangeSelector.enabled,!0)},title:{text:null},tooltip:{split:pick(s.tooltip&&s.tooltip.split,!0),crosshairs:!0},legend:{enabled:!1}},i,{isStock:!0}));i.xAxis=e,i.yAxis=o,a.xAxis=splat(i.xAxis||{}).map((t,e)=>merge(getDefaultAxisOptions("xAxis",t),s.xAxis,s.xAxis&&s.xAxis[e],t,getForcedAxisOptions("xAxis",i))),a.yAxis=splat(i.yAxis||{}).map((t,e)=>merge(getDefaultAxisOptions("yAxis",t),s.yAxis,s.yAxis&&s.yAxis[e],t)),super.init(a,t)}createAxis(t,e){return e.axis=merge(getDefaultAxisOptions(t,e.axis),e.axis,getForcedAxisOptions(t,this.userOptions)),super.createAxis(t,e)}}addEvent(Chart,"update",function(t){const e=this,i=t.options;"scrollbar"in i&&e.navigator&&(merge(!0,e.options.scrollbar,i.scrollbar),e.navigator.update({}),delete i.scrollbar)}),function(s){const o=[];function r(p){var d=this;if(d.crosshair&&d.crosshair.label&&d.crosshair.label.enabled&&d.cross&&isNumber(d.min)&&isNumber(d.max)){const x=d.chart,f=d.logarithmic,g=d.crosshair.label,u=d.horiz,b=d.opposite,m=d.left,A=d.top,v=d.width,y="inside"===d.options.tickPosition,k=!1!==d.crosshair.snap,S=p.e||d.cross&&d.cross.e,D=p.point;let t=d.crossLabel,e,i,s=g.format,o="",r,a=0,n=d.min,l=d.max;f&&(n=f.lin2log(d.min),l=f.lin2log(d.max));var p=u?"center":b?"right"===d.labelAlign?"right":"left":"left"===d.labelAlign?"left":"center",p=(t||(t=d.crossLabel=x.renderer.label("",0,void 0,g.shape||"callout").addClass("highcharts-crosshair-label highcharts-color-"+(D&&D.series?D.series.colorIndex:d.series[0]&&this.series[0].colorIndex)).attr({align:g.align||p,padding:pick(g.padding,8),r:pick(g.borderRadius,3),zIndex:2}).add(d.labelGroup),x.styledMode||t.attr({fill:g.backgroundColor||D&&D.series&&D.series.color||"#666666",stroke:g.borderColor||"","stroke-width":g.borderWidth||0}).css(extend({color:"#ffffff",fontWeight:"normal",fontSize:"0.7em",textAlign:"center"},g.style||{}))),i=u?(e=k?(D.plotX||0)+m:S.chartX,A+(b?0:d.height)):(e=m+d.offset+(b?v:0),k?(D.plotY||0)+A:S.chartY),s||g.formatter||(d.dateTime&&(o="%b %d, %Y"),s="{value"+(o?":"+o:"")+"}"),k?d.isXAxis?D.x:D.y:d.toValue(u?S.chartX:S.chartY)),h=D&&D.series?D.series.isPointInside(D):isNumber(p)&&p>n&&p<l;let c="";s?c=format(s,{value:p},x):g.formatter&&isNumber(p)&&(c=g.formatter.call(d,p)),t.attr({text:c,x:e,y:i,visibility:h?"inherit":"hidden"});p=t.getBBox(),h=(!isNumber(t.x)||u||b||(e=t.x-p.width/2),isNumber(t.y)&&(u?(y&&!b||!y&&b)&&(i=t.y-p.height):i=t.y-p.height/2),r=u?{left:m-p.x,right:m+d.width-p.x}:{left:"left"===d.labelAlign?m:0,right:"right"===d.labelAlign?m+d.width:x.chartWidth},t.translateX||0);h<r.left&&(a=r.left-h),h+p.width>=r.right&&(a=-(h+p.width-r.right)),t.attr({x:e+a,y:i,anchorX:u?e:d.opposite?0:x.chartWidth,anchorY:u?d.opposite?x.chartHeight:0:i+p.height/2})}}function a(){this.crossLabel&&(this.crossLabel=this.crossLabel.hide())}function n(t){const e=this,i=e.chart,s=e.options,o=i._labelPanes=i._labelPanes||{},r=s.labels;var a;i.options.isStock&&"yAxis"===e.coll&&(a=s.top+","+s.height,!o[a]&&r.enabled&&(15===r.distance&&1===e.side&&(r.distance=0),void 0===r.align&&(r.align="right"),o[a]=e,t.align="right",t.preventDefault()))}function l(){const t=this,e=t.chart,i=t.options&&t.options.top+","+t.options.height;i&&e._labelPanes&&e._labelPanes[i]===t&&delete e._labelPanes[i]}function c(t){const s=this,o=(s.isLinked&&!s.series&&s.linkedParent?s.linkedParent:s).series,r=s.chart,e=r.renderer,i=s.left,a=s.top,n=[],l=t.translatedValue,c=t.value,p=t.force;let d,h,x,f,g=[],u,b;if(r.options.isStock&&!1!==t.acrossPanes&&"xAxis"===s.coll||"yAxis"===s.coll){t.preventDefault(),g=(t=>{const e="xAxis"===t?"yAxis":"xAxis",i=s.options[e];return isNumber(i)?[r[e][i]]:isString(i)?[r.get(i)]:o.map(t=>t[e])})(s.coll);for(const A of s.isXAxis?r.yAxis:r.xAxis){var m;defined(A.options.id)&&-1!==A.options.id.indexOf("navigator")||(m=A.isXAxis?"yAxis":"xAxis",m=defined(A.options[m])?r[m][A.options[m]]:r[m][0],s===m&&g.push(A))}u=g.length?[]:[(s.isXAxis?r.yAxis:r.xAxis)[0]];for(const v of g)-1!==u.indexOf(v)||find(u,t=>t.pos===v.pos&&t.len===v.len)||u.push(v);if(b=pick(l,s.translate(c||0,void 0,void 0,t.old)),isNumber(b))if(s.horiz)for(const y of u){let t;h=y.pos,f=h+y.len,d=x=Math.round(b+s.transB),"pass"!==p&&(d<i||d>i+s.width)&&(p?d=x=clamp(d,i,i+s.width):t=!0),t||n.push(["M",d,h],["L",x,f])}else for(const k of u){let t;d=k.pos,x=d+k.len,h=f=Math.round(a+s.height-b),"pass"!==p&&(h<a||h>a+s.height)&&(p?h=f=clamp(h,a,a+s.height):t=!0),t||n.push(["M",d,h],["L",x,f])}t.path=0<n.length?e.crispPolyLine(n,t.lineWidth||1):void 0}}function p(e){var i=this;if(i.chart.options.isStock){let t;i.is("column")||i.is("columnrange")?t={borderWidth:0,shadow:!1}:i.is("scatter")||i.is("sma")||(t={marker:{enabled:!1,radius:2}}),t&&(e.plotOptions[i.type]=merge(e.plotOptions[i.type],t))}}function d(){var t=this.chart,e=this.options.dataGrouping;return!1!==this.allowDG&&e&&pick(e.enabled,t.options.isStock)}function h(e,i){for(let t=0;t<e.length;t+=2){const s=e[t],o=e[t+1];s[1]===o[1]&&(s[1]=o[1]=Math.round(s[1])-i%2/2),s[2]===o[2]&&(s[2]=o[2]=Math.round(s[2])+i%2/2)}return e}s.compose=function(t,e,i){pushUnique(o,t)&&(addEvent(t,"afterDrawCrosshair",r),addEvent(t,"afterHideCrosshair",a),addEvent(t,"autoLabelAlign",n),addEvent(t,"destroy",l),addEvent(t,"getPlotLinePath",c)),pushUnique(o,e)&&(e.prototype.forceCropping=d,addEvent(e,"setOptions",p)),pushUnique(o,i)&&(i.prototype.crispPolyLine=h)},s.stockChart=function(t,e,i){return new s(t,e,i)}}(StockChart=StockChart||{});export default StockChart;