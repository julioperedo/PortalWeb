"use strict";import A from"../Animation/AnimationUtilities.js";const getDeferredAnimation=A["getDeferredAnimation"];import F from"../Templating.js";const format=F["format"];import U from"../Utilities.js";const{defined,extend,fireEvent,isArray,isString,merge,objectEach,pick,pInt,splat}=U;var DataLabel;!function(t){const e=[];function i(){return splat(this.options.dataLabels||{}).some(t=>t?.enabled)}function o(a,e,i,o,r){const s=this,n=this.chart,t=this.isCartesian&&n.inverted,d=this.enabledDataSorting,l=a.plotX,h=a.plotY,c=i.rotation,p=i.align,f=defined(l)&&defined(h)&&n.isInsidePlot(l,Math.round(h),{inverted:t,paneCoordinates:!0,series:s}),b=t=>{d&&s.xAxis&&!y&&s.setDataLabelStartPos(a,e,r,f,t)};let g,u,m,y="justify"===pick(i.overflow,d?"none":"justify"),L=this.visible&&!1!==a.visible&&defined(l)&&(a.series.forceDL||d&&!y||f||pick(i.inside,!!this.options.stacking)&&o&&n.isInsidePlot(l,t?o.x+1:o.y+o.height-1,{inverted:t,paneCoordinates:!0,series:s}));var v,x=a.pos();if(L&&x){c&&e.attr({align:p});let t=e.getBBox(!0),a=[0,0];g=n.renderer.fontMetrics(e).b,o=extend({x:x[0],y:Math.round(x[1]),width:0,height:0},o),extend(i,{width:t.width,height:t.height}),c?(y=!1,u=n.renderer.rotCorr(g,c),m={x:o.x+(i.x||0)+o.width/2+u.x,y:o.y+(i.y||0)+{top:0,middle:.5,bottom:1}[i.verticalAlign]*o.height},a=[t.x-Number(e.attr("x")),t.y-Number(e.attr("y"))],b(m),e[r?"attr":"animate"](m)):(b(o),e.align(i,void 0,o),m=e.alignAttr),y&&0<=o.height?this.justifyDataLabel(e,i,m,t,o,r):pick(i.crop,!0)&&({x:o,y:v}=m,o+=a[0],v+=a[1],L=n.isInsidePlot(o,v,{paneCoordinates:!0,series:s})&&n.isInsidePlot(o+t.width,v+t.height,{paneCoordinates:!0,series:s})),i.shape&&!c&&e[r?"attr":"animate"]({anchorX:x[0],anchorY:x[1]})}r&&d&&(e.placed=!1),L||d&&!y?e.show():(e.hide(),e.placed=!1)}function r(){return this.plotGroup("dataLabelsGroup","data-labels",this.hasRendered?"inherit":"hidden",this.options.dataLabels.zIndex||6)}function s(t){var a=this,e=a.hasRendered||0;const i=this.initDataLabelsGroup().attr({opacity:+e});return!e&&i&&(a.visible&&i.show(),a.options.animation?i.animate({opacity:1},t):i.attr({opacity:1})),i}function n(t){t=t||this.points;const m=this,y=m.chart,L=m.options,v=y.renderer,{backgroundColor:a,plotBackgroundColor:e}=y.options.chart,i=y.options.plotOptions,x=v.getContrast(isString(e)&&e||isString(a)&&a||"#000000");let o=L.dataLabels,r,A;o=l(l(i?.series?.dataLabels,i?.[m.type]?.dataLabels),o);var{animation:s,defer:n}=splat(o)[0],n=n?getDeferredAnimation(y,s,m):{defer:0,duration:0};fireEvent(this,"drawDataLabels"),m.hasDataLabels?.()&&(A=this.initDataLabels(n),t.forEach(g=>{const u=g.dataLabels||[];(r=splat(l(o,g.dlOptions||g.options?.dataLabels))).forEach((t,a)=>{const e=t.enabled&&g.visible&&(!g.isNull||g.dataLabelOnNull)&&(s=g,!(n=(n=t).filter)||(r=n.operator,s=s[n.property],n=n.value,">"===r&&n<s||"<"===r&&s<n||">="===r&&n<=s||"<="===r&&s<=n||"=="===r&&s==n||"==="===r&&s===n)),i=t.style||{},o=t.distance;var r,s,n;let d,l,h,c,p={},f=u[a],b=!f;e&&(l=pick(t[g.formatPrefix+"Format"],t.format),d=g.getLabelConfig(),h=defined(l)?format(l,d,y):(t[g.formatPrefix+"Formatter"]||t.formatter).call(d,t),c=t.rotation,y.styledMode||(i.color=pick(t.color,i.color,isString(m.color)?m.color:void 0,"#000000"),"contrast"===i.color?(g.contrastColor=v.getContrast(g.color||m.color),i.color=!defined(o)&&t.inside||pInt(o||0)<0||L.stacking?g.contrastColor:x):delete g.contrastColor,L.cursor&&(i.cursor=L.cursor)),p={r:t.borderRadius||0,rotation:c,padding:t.padding,zIndex:1},y.styledMode||({backgroundColor:r,borderColor:s}=t,p.fill="auto"===r?g.color:r,p.stroke="auto"===s?g.color:s,p["stroke-width"]=t.borderWidth),objectEach(p,(t,a)=>{void 0===t&&delete p[a]})),!f||e&&defined(h)&&!!f.div==!!t.useHTML&&(f.rotation&&t.rotation||f.rotation===t.rotation)||(f=void 0,b=!0),e&&defined(h)&&(f?p.text=h:(f=c?v.text(h,0,0,t.useHTML).addClass("highcharts-data-label"):v.label(h,0,0,t.shape,void 0,void 0,t.useHTML,void 0,"data-label"))&&f.addClass(" highcharts-data-label-color-"+g.colorIndex+" "+(t.className||"")+(t.useHTML?" highcharts-tracker":"")),f&&(f.options=t,f.attr(p),y.styledMode||f.css(i).shadow(t.shadow),(n=t[g.formatPrefix+"TextPath"]||t.textPath)&&!t.useHTML&&(f.setTextPath(g.getDataLabelPath?.(f)||g.graphic,n),g.dataLabelPath&&!n.enabled&&(g.dataLabelPath=g.dataLabelPath.destroy())),f.added||f.add(A),m.alignDataLabel(g,f,t,void 0,b),f.isActive=!0,u[a]&&u[a]!==f&&u[a].destroy(),u[a]=f))});let t=u.length;for(;t--;)u[t]&&u[t].isActive?u[t].isActive=!1:(u[t]?.destroy(),u.splice(t,1));g.dataLabel=u[0],g.dataLabels=u})),fireEvent(this,"afterDrawDataLabels")}function d(t,a,e,i,o,r){var s=this.chart,n=a.align,d=a.verticalAlign,l=!t.box&&t.padding||0;let{x:h=0,y:c=0}=a,p,f;return(p=(e.x||0)+l)<0&&("right"===n&&0<=h?(a.align="left",a.inside=!0):h-=p,f=!0),(p=(e.x||0)+i.width-l)>s.plotWidth&&("left"===n&&h<=0?(a.align="right",a.inside=!0):h+=s.plotWidth-p,f=!0),(p=e.y+l)<0&&("bottom"===d&&0<=c?(a.verticalAlign="top",a.inside=!0):c-=p,f=!0),(p=(e.y||0)+i.height-l)>s.plotHeight&&("top"===d&&c<=0?(a.verticalAlign="bottom",a.inside=!0):c+=s.plotHeight-p,f=!0),f&&(a.x=h,a.y=c,t.placed=!r,t.align(a,void 0,o)),f}function l(a,e){let t=[],i;if(isArray(a)&&!isArray(e))t=a.map(function(t){return merge(t,e)});else if(isArray(e)&&!isArray(a))t=e.map(function(t){return merge(a,t)});else if(isArray(a)||isArray(e)){if(isArray(a)&&isArray(e))for(i=Math.max(a.length,e.length);i--;)t[i]=merge(a[i],e[i])}else t=merge(a,e);return t}function h(t,a,e,i,o){var r=this.chart,s=r.inverted,n=this.xAxis,d=n.reversed,l=((s?a.height:a.width)||0)/2,t=t.pointWidth,t=t?t/2:0;a.startXPos=s?o.x:d?-l-t:n.width-l+t,a.startYPos=s?d?this.yAxis.height-l+t:-l-t:o.y,i?"hidden"===a.visibility&&(a.show(),a.attr({opacity:0}).animate({opacity:1})):a.attr({opacity:1}).animate({opacity:0},void 0,a.hide),r.hasRendered&&(e&&a.attr({x:a.startXPos,y:a.startYPos}),a.placed=!0)}t.compose=function(t){if(U.pushUnique(e,t)){const a=t.prototype;a.initDataLabelsGroup=r,a.initDataLabels=s,a.alignDataLabel=o,a.drawDataLabels=n,a.justifyDataLabel=d,a.setDataLabelStartPos=h,a.hasDataLabels=i}}}(DataLabel=DataLabel||{});export default DataLabel;