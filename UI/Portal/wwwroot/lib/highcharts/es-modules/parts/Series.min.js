"use strict";import H from"./Globals.js";import LegendSymbolMixin from"../mixins/legend-symbol.js";import O from"./Options.js";var defaultOptions=O.defaultOptions;import Point from"./Point.js";import SVGElement from"./SVGElement.js";import U from"./Utilities.js";var addEvent=U.addEvent,animObject=U.animObject,arrayMax=U.arrayMax,arrayMin=U.arrayMin,clamp=U.clamp,correctFloat=U.correctFloat,defined=U.defined,erase=U.erase,error=U.error,extend=U.extend,find=U.find,fireEvent=U.fireEvent,getNestedProperty=U.getNestedProperty,isArray=U.isArray,isFunction=U.isFunction,isNumber=U.isNumber,isString=U.isString,merge=U.merge,objectEach=U.objectEach,pick=U.pick,removeEvent=U.removeEvent,seriesType=U.seriesType,splat=U.splat,syncTimeout=U.syncTimeout,seriesTypes=H.seriesTypes,win=H.win;H.Series=seriesType("line",null,{lineWidth:2,allowPointSelect:!1,crisp:!0,showCheckbox:!1,animation:{duration:1e3},events:{},marker:{enabledThreshold:2,lineColor:"#ffffff",lineWidth:0,radius:4,states:{normal:{animation:!0},hover:{animation:{duration:50},enabled:!0,radiusPlus:2,lineWidthPlus:1},select:{fillColor:"#cccccc",lineColor:"#000000",lineWidth:2}}},point:{events:{}},dataLabels:{align:"center",formatter:function(){var t=this.series.chart.numberFormatter;return"number"!=typeof this.y?"":t(this.y,-1)},padding:5,style:{fontSize:"11px",fontWeight:"bold",color:"contrast",textOutline:"1px contrast"},verticalAlign:"bottom",x:0,y:0},cropThreshold:300,opacity:1,pointRange:0,softThreshold:!0,states:{normal:{animation:!0},hover:{animation:{duration:50},lineWidthPlus:1,marker:{},halo:{size:10,opacity:.25}},select:{animation:{duration:0}},inactive:{animation:{duration:50},opacity:.2}},stickyTracking:!0,turboThreshold:1e3,findNearestPointBy:"x"},{axisTypes:["xAxis","yAxis"],coll:"series",colorCounter:0,cropShoulder:1,directTouch:!1,eventsToUnbind:[],isCartesian:!0,parallelArrays:["x","y"],pointClass:Point,requireSorting:!0,sorted:!0,init:function(t,i){fireEvent(this,"init",{options:i});var e,s,r=this,n=t.series;this.eventOptions=this.eventOptions||{},r.chart=t,r.options=i=r.setOptions(i),r.linkedSeries=[],r.bindAxes(),extend(r,{name:i.name,state:"",visible:!1!==i.visible,selected:!0===i.selected}),e=i.events,objectEach(e,function(t,i){isFunction(t)&&r.eventOptions[i]!==t&&(isFunction(r.eventOptions[i])&&removeEvent(r,i,r.eventOptions[i]),r.eventOptions[i]=t,addEvent(r,i,t))}),(e&&e.click||i.point&&i.point.events&&i.point.events.click||i.allowPointSelect)&&(t.runTrackerClick=!0),r.getColor(),r.getSymbol(),r.parallelArrays.forEach(function(t){r[t+"Data"]||(r[t+"Data"]=[])}),r.isCartesian&&(t.hasCartesianSeries=!0),n.length&&(s=n[n.length-1]),r._i=pick(s&&s._i,-1)+1,r.opacity=r.options.opacity,t.orderSeries(this.insert(n)),i.dataSorting&&i.dataSorting.enabled?r.setDataSortingOptions():r.points||r.data||r.setData(i.data,!1),fireEvent(this,"afterInit")},is:function(t){return seriesTypes[t]&&this instanceof seriesTypes[t]},insert:function(t){var i,e=this.options.index;if(isNumber(e)){for(i=t.length;i--;)if(e>=pick(t[i].options.index,t[i]._i)){t.splice(i+1,0,this);break}-1===i&&t.unshift(this),i+=1}else t.push(this);return pick(i,t.length-1)},bindAxes:function(){var t,i=this,e=i.options,s=i.chart;fireEvent(this,"bindAxes",null,function(){(i.axisTypes||[]).forEach(function(r){s[r].forEach(function(s){t=s.options,(e[r]===t.index||void 0!==e[r]&&e[r]===t.id||void 0===e[r]&&0===t.index)&&(i.insert(s.series),i[r]=s,s.isDirty=!0)}),i[r]||i.optionalAxis===r||error(18,!0,s)})}),fireEvent(this,"afterBindAxes")},updateParallelArrays:function(t,i){var e=t.series,s=arguments,r=isNumber(i)?function(s){var r="y"===s&&e.toYData?e.toYData(t):t[s];e[s+"Data"][i]=r}:function(t){Array.prototype[i].apply(e[t+"Data"],Array.prototype.slice.call(s,2))};e.parallelArrays.forEach(r)},hasData:function(){return this.visible&&void 0!==this.dataMax&&void 0!==this.dataMin||this.visible&&this.yData&&this.yData.length>0},autoIncrement:function(){var t,i,e=this.options,s=this.xIncrement,r=e.pointIntervalUnit,n=this.chart.time;return s=pick(s,e.pointStart,0),this.pointInterval=i=pick(this.pointInterval,e.pointInterval,1),r&&(t=new n.Date(s),"day"===r?n.set("Date",t,n.get("Date",t)+i):"month"===r?n.set("Month",t,n.get("Month",t)+i):"year"===r&&n.set("FullYear",t,n.get("FullYear",t)+i),i=t.getTime()-s),this.xIncrement=s+i,s},setDataSortingOptions:function(){var t=this.options;extend(this,{requireSorting:!1,sorted:!1,enabledDataSorting:!0,allowDG:!1}),defined(t.pointRange)||(t.pointRange=1)},setOptions:function(t){var i,e,s,r=this.chart,n=r.options,o=n.plotOptions,a=r.userOptions||{},h=merge(t),l=r.styledMode,p={plotOptions:o,userOptions:h};fireEvent(this,"setOptions",p);var c=p.plotOptions[this.type],d=a.plotOptions||{};return this.userOptions=p.userOptions,i=merge(c,o.series,a.plotOptions&&a.plotOptions[this.type],h),this.tooltipOptions=merge(defaultOptions.tooltip,defaultOptions.plotOptions.series&&defaultOptions.plotOptions.series.tooltip,defaultOptions.plotOptions[this.type].tooltip,n.tooltip.userOptions,o.series&&o.series.tooltip,o[this.type].tooltip,h.tooltip),this.stickyTracking=pick(h.stickyTracking,d[this.type]&&d[this.type].stickyTracking,d.series&&d.series.stickyTracking,!(!this.tooltipOptions.shared||this.noSharedTooltip)||i.stickyTracking),null===c.marker&&delete i.marker,this.zoneAxis=i.zoneAxis,e=this.zones=(i.zones||[]).slice(),!i.negativeColor&&!i.negativeFillColor||i.zones||(s={value:i[this.zoneAxis+"Threshold"]||i.threshold||0,className:"highcharts-negative"},l||(s.color=i.negativeColor,s.fillColor=i.negativeFillColor),e.push(s)),e.length&&defined(e[e.length-1].value)&&e.push(l?{}:{color:this.color,fillColor:this.fillColor}),fireEvent(this,"afterSetOptions",{options:i}),i},getName:function(){return pick(this.options.name,"Series "+(this.index+1))},getCyclic:function(t,i,e){var s,r,n=this.chart,o=this.userOptions,a=t+"Index",h=t+"Counter",l=e?e.length:pick(n.options.chart[t+"Count"],n[t+"Count"]);i||(r=pick(o[a],o["_"+a]),defined(r)?s=r:(n.series.length||(n[h]=0),o["_"+a]=s=n[h]%l,n[h]+=1),e&&(i=e[s])),void 0!==s&&(this[a]=s),this[t]=i},getColor:function(){this.chart.styledMode?this.getCyclic("color"):this.options.colorByPoint?this.options.color=null:this.getCyclic("color",this.options.color||defaultOptions.plotOptions[this.type].color,this.chart.options.colors)},getPointsCollection:function(){return(this.hasGroupedData?this.points:this.data)||[]},getSymbol:function(){var t=this.options.marker;this.getCyclic("symbol",t.symbol,this.chart.options.symbols)},findPointIndex:function(t,i){var e,s,r,n,o=t.id,a=t.x,h=this.points,l=this.options.dataSorting;if(o)e=this.chart.get(o);else if((this.linkedParent||this.enabledDataSorting)&&(n=l&&l.matchByName?"name":"index",!(e=find(h,function(i){return!i.touched&&i[n]===t[n]}))))return;return e&&void 0!==(r=e&&e.index)&&(s=!0),void 0===r&&isNumber(a)&&(r=this.xData.indexOf(a,i)),-1!==r&&void 0!==r&&this.cropped&&(r=r>=this.cropStart?r-this.cropStart:r),!s&&h[r]&&h[r].touched&&(r=void 0),r},drawLegendSymbol:LegendSymbolMixin.drawLineMarker,updateData:function(t,i){var e,s,r,n,o=this.options,a=o.dataSorting,h=this.points,l=[],p=this.requireSorting,c=t.length===h.length,d=!0;if(this.xIncrement=null,t.forEach(function(t,i){var s,r,d=defined(t)&&this.pointClass.prototype.optionsToObject.call({series:this},t)||{};s=d.x,d.id||isNumber(s)?(-1===(r=this.findPointIndex(d,n))||void 0===r?l.push(t):h[r]&&t!==o.data[r]?(h[r].update(t,!1,null,!1),h[r].touched=!0,p&&(n=r+1)):h[r]&&(h[r].touched=!0),(!c||i!==r||a&&a.enabled||this.hasDerivedData)&&(e=!0)):l.push(t)},this),e)for(s=h.length;s--;)(r=h[s])&&!r.touched&&r.remove&&r.remove(!1,i);else!c||a&&a.enabled?d=!1:(t.forEach(function(t,i){h[i].update&&t!==h[i].y&&h[i].update(t,!1,null,!1)}),l.length=0);return h.forEach(function(t){t&&(t.touched=!1)}),!!d&&(l.forEach(function(t){this.addPoint(t,!1,null,null,!1)},this),null===this.xIncrement&&this.xData&&this.xData.length&&(this.xIncrement=arrayMax(this.xData),this.autoIncrement()),!0)},setData:function(t,i,e,s){var r,n,o,a,h=this,l=h.points,p=l&&l.length||0,c=h.options,d=h.chart,u=c.dataSorting,f=null,g=h.xAxis,m=c.turboThreshold,y=this.xData,x=this.yData,v=h.pointArrayMap,b=v&&v.length,k=c.keys,A=0,D=1;if(r=(t=t||[]).length,i=pick(i,!0),u&&u.enabled&&(t=this.sortData(t)),!1!==s&&r&&p&&!h.cropped&&!h.hasGroupedData&&h.visible&&!h.isSeriesBoosting&&(a=this.updateData(t,e)),!a){if(h.xIncrement=null,h.colorCounter=0,this.parallelArrays.forEach(function(t){h[t+"Data"].length=0}),m&&r>m)if(f=h.getFirstValidPoint(t),isNumber(f))for(n=0;n<r;n++)y[n]=this.autoIncrement(),x[n]=t[n];else if(isArray(f))if(b)for(n=0;n<r;n++)o=t[n],y[n]=o[0],x[n]=o.slice(1,b+1);else for(k&&(A=(A=k.indexOf("x"))>=0?A:0,D=(D=k.indexOf("y"))>=0?D:1),n=0;n<r;n++)o=t[n],y[n]=o[A],x[n]=o[D];else error(12,!1,d);else for(n=0;n<r;n++)void 0!==t[n]&&(o={series:h},h.pointClass.prototype.applyOptions.apply(o,[t[n]]),h.updateParallelArrays(o,n));for(x&&isString(x[0])&&error(14,!0,d),h.data=[],h.options.data=h.userOptions.data=t,n=p;n--;)l[n]&&l[n].destroy&&l[n].destroy();g&&(g.minRange=g.userMinRange),h.isDirty=d.isDirtyBox=!0,h.isDirtyData=!!l,e=!1}"point"===c.legendType&&(this.processData(),this.generatePoints()),i&&d.redraw(e)},sortData:function(t){var i=this,e=i.options.dataSorting.sortKey||"y",s=function(t,i){return defined(i)&&t.pointClass.prototype.optionsToObject.call({series:t},i)||{}};return t.forEach(function(e,r){t[r]=s(i,e),t[r].index=r},this),t.concat().sort(function(t,i){var s=getNestedProperty(e,t),r=getNestedProperty(e,i);return r<s?-1:r>s?1:0}).forEach(function(t,i){t.x=i},this),i.linkedSeries&&i.linkedSeries.forEach(function(i){var e=i.options,r=e.data;e.dataSorting&&e.dataSorting.enabled||!r||(r.forEach(function(e,n){r[n]=s(i,e),t[n]&&(r[n].x=t[n].x,r[n].index=n)}),i.setData(r,!1))}),t},getProcessedData:function(t){var i,e,s,r,n,o,a,h,l=this.xData,p=this.yData,c=l.length,d=0,u=this.xAxis,f=this.options,g=f.cropThreshold,m=t||this.getExtremesFromAll||f.getExtremesFromAll,y=this.isCartesian,x=u&&u.val2lin,v=!(!u||!u.logarithmic),b=this.requireSorting;for(u&&(a=(o=u.getExtremes()).min,h=o.max),y&&this.sorted&&!m&&(!g||c>g||this.forceCrop)&&(l[c-1]<a||l[0]>h?(l=[],p=[]):this.yData&&(l[0]<a||l[c-1]>h)&&(l=(i=this.cropData(this.xData,this.yData,a,h)).xData,p=i.yData,d=i.start,e=!0)),n=l.length||1;--n;)(s=v?x(l[n])-x(l[n-1]):l[n]-l[n-1])>0&&(void 0===r||s<r)?r=s:s<0&&b&&(error(15,!1,this.chart),b=!1);return{xData:l,yData:p,cropped:e,cropStart:d,closestPointRange:r}},processData:function(t){var i,e=this.xAxis;if(this.isCartesian&&!this.isDirty&&!e.isDirty&&!this.yAxis.isDirty&&!t)return!1;i=this.getProcessedData(),this.cropped=i.cropped,this.cropStart=i.cropStart,this.processedXData=i.xData,this.processedYData=i.yData,this.closestPointRange=this.basePointRange=i.closestPointRange},cropData:function(t,i,e,s,r){var n,o,a=t.length,h=0,l=a;for(r=pick(r,this.cropShoulder),n=0;n<a;n++)if(t[n]>=e){h=Math.max(0,n-r);break}for(o=n;o<a;o++)if(t[o]>s){l=o+r;break}return{xData:t.slice(h,l),yData:i.slice(h,l),start:h,end:l}},generatePoints:function(){var t,i,e,s,r=this.options,n=r.data,o=this.data,a=this.processedXData,h=this.processedYData,l=this.pointClass,p=a.length,c=this.cropStart||0,d=this.hasGroupedData,u=r.keys,f=[];if(!o&&!d){var g=[];g.length=n.length,o=this.data=g}for(u&&d&&(this.options.keys=!1),s=0;s<p;s++)i=c+s,d?((e=(new l).init(this,[a[s]].concat(splat(h[s])))).dataGroup=this.groupMap[s],e.dataGroup.options&&(e.options=e.dataGroup.options,extend(e,e.dataGroup.options),delete e.dataLabels)):(e=o[i])||void 0===n[i]||(o[i]=e=(new l).init(this,n[i],a[s])),e&&(e.index=i,f[s]=e);if(this.options.keys=u,o&&(p!==(t=o.length)||d))for(s=0;s<t;s++)s!==c||d||(s+=p),o[s]&&(o[s].destroyElements(),o[s].plotX=void 0);this.data=o,this.points=f,fireEvent(this,"afterGeneratePoints")},getXExtremes:function(t){return{min:arrayMin(t),max:arrayMax(t)}},getExtremes:function(t,i){var e,s,r,n,o,a,h,l,p=this.xAxis,c=this.yAxis,d=this.processedXData||this.xData,u=[],f=0,g=0,m=0,y=this.requireSorting?this.cropShoulder:0,x=!!c&&c.positiveValuesOnly;for(e=(t=t||this.stackedYData||this.processedYData||[]).length,p&&(g=(s=p.getExtremes()).min,m=s.max),h=0;h<e;h++)if(o=d[h],a=t[h],r=(isNumber(a)||isArray(a))&&(a.length||a>0||!x),n=i||this.getExtremesFromAll||this.options.getExtremesFromAll||this.cropped||!p||(d[h+y]||o)>=g&&(d[h-y]||o)<=m,r&&n)if(l=a.length)for(;l--;)isNumber(a[l])&&(u[f++]=a[l]);else u[f++]=a;var v={dataMin:arrayMin(u),dataMax:arrayMax(u)};return fireEvent(this,"afterGetExtremes",{dataExtremes:v}),v},applyExtremes:function(){var t=this.getExtremes();return this.dataMin=t.dataMin,this.dataMax=t.dataMax,t},getFirstValidPoint:function(t){for(var i=null,e=t.length,s=0;null===i&&s<e;)i=t[s],s++;return i},translate:function(){this.processedXData||this.processData(),this.generatePoints();var t,i,e,s,r=this.options,n=r.stacking,o=this.xAxis,a=o.categories,h=this.enabledDataSorting,l=this.yAxis,p=this.points,c=p.length,d=!!this.modifyValue,u=this.pointPlacementToXValue(),f=Boolean(u),g=r.threshold,m=r.startFromThreshold?g:0,y=this.zoneAxis||"y",x=Number.MAX_VALUE;function v(t){return clamp(t,-1e5,1e5)}for(t=0;t<c;t++){var b,k,A=p[t],D=A.x,P=A.y,E=A.low,T=n&&l.stacking&&l.stacking.stacks[(this.negStacks&&P<(m?0:g)?"-":"")+this.stackKey];l.positiveValuesOnly&&null!==P&&P<=0&&(A.isNull=!0),A.plotX=i=correctFloat(v(o.translate(D,0,0,0,1,u,"flags"===this.type))),n&&this.visible&&T&&T[D]&&(s=this.getStackIndicator(s,D,this.index),A.isNull||(k=(b=T[D]).points[s.key])),isArray(k)&&(E=k[0],P=k[1],E===m&&s.key===T[D].base&&(E=pick(isNumber(g)&&g,l.min)),l.positiveValuesOnly&&E<=0&&(E=null),A.total=A.stackTotal=b.total,A.percentage=b.total&&A.y/b.total*100,A.stackY=P,this.irregularWidths||b.setOffset(this.pointXOffset||0,this.barW||0)),A.yBottom=defined(E)?v(l.translate(E,0,1,0,1)):null,d&&(P=this.modifyValue(P,A)),A.plotY="number"==typeof P&&P!==1/0?v(l.translate(P,0,1,0,1)):void 0,A.isInside=this.isPointInside(A),A.clientX=f?correctFloat(o.translate(D,0,0,0,1,u)):i,A.negative=A[y]<(r[y+"Threshold"]||g||0),A.category=a&&void 0!==a[A.x]?a[A.x]:A.x,A.isNull||!1===A.visible||(void 0!==e&&(x=Math.min(x,Math.abs(i-e))),e=i),A.zone=this.zones.length&&A.getZone(),!A.graphic&&this.group&&h&&(A.isNew=!0)}this.closestPointRangePx=x,fireEvent(this,"afterTranslate")},getValidPoints:function(t,i,e){var s=this.chart;return(t||this.points||[]).filter(function(t){return!(i&&!s.isInsidePlot(t.plotX,t.plotY,s.inverted))&&(!1!==t.visible&&(e||!t.isNull))})},getClipBox:function(t,i){var e,s=this.options,r=this.chart,n=r.inverted,o=this.xAxis,a=o&&this.yAxis,h=r.options.chart.scrollablePlotArea||{};return t&&!1===s.clip&&a?e=n?{y:-r.chartWidth+a.len+a.pos,height:r.chartWidth,width:r.chartHeight,x:-r.chartHeight+o.len+o.pos}:{y:-a.pos,height:r.chartHeight,width:r.chartWidth,x:-o.pos}:(e=this.clipBox||r.clipBox,i&&(e.width=r.plotSizeX,e.x=(r.scrollablePixelsX||0)*(h.scrollPositionX||0))),i?{width:e.width,x:e.x}:e},setClip:function(t){var i=this.chart,e=this.options,s=i.renderer,r=i.inverted,n=this.clipBox,o=this.getClipBox(t),a=this.sharedClipKey||["_sharedClip",t&&t.duration,t&&t.easing,o.height,e.xAxis,e.yAxis].join(","),h=i[a],l=i[a+"m"];t&&(o.width=0,r&&(o.x=i.plotHeight+(!1!==e.clip?0:i.plotTop))),h?i.hasLoaded||h.attr(o):(t&&(i[a+"m"]=l=s.clipRect(r?i.plotSizeX+99:-99,r?-i.plotLeft:-i.plotTop,99,r?i.chartWidth:i.chartHeight)),i[a]=h=s.clipRect(o),h.count={length:0}),t&&(h.count[this.index]||(h.count[this.index]=!0,h.count.length+=1)),(!1!==e.clip||t)&&(this.group.clip(t||n?h:i.clipRect),this.markerGroup.clip(l),this.sharedClipKey=a),t||(h.count[this.index]&&(delete h.count[this.index],h.count.length-=1),0===h.count.length&&a&&i[a]&&(n||(i[a]=i[a].destroy()),i[a+"m"]&&(i[a+"m"]=i[a+"m"].destroy())))},animate:function(t){var i,e,s,r=this.chart,n=animObject(this.options.animation);r.hasRendered||(t?this.setClip(n):(i=r[e=this.sharedClipKey],s=this.getClipBox(n,!0),i&&i.animate(s,n),r[e+"m"]&&r[e+"m"].animate({width:s.width+99,x:s.x-(r.inverted?0:99)},n)))},afterAnimate:function(){this.setClip(),fireEvent(this,"afterAnimate"),this.finishedAnimating=!0},drawPoints:function(){var t,i,e,s,r,n,o,a=this.points,h=this.chart,l=this.options.marker,p=this[this.specialGroup]||this.markerGroup,c=this.xAxis,d=pick(l.enabled,!(c&&!c.isRadial)||null,this.closestPointRangePx>=l.enabledThreshold*l.radius);if(!1!==l.enabled||this._hasPointMarkers)for(t=0;t<a.length;t++){if(s=(e=(i=a[t]).graphic)?"animate":"attr",r=i.marker||{},n=!!i.marker,(d&&void 0===r.enabled||r.enabled)&&!i.isNull&&!1!==i.visible){var u=pick(r.symbol,this.symbol);o=this.markerAttribs(i,i.selected&&"select"),this.enabledDataSorting&&(i.startXPos=c.reversed?-o.width:c.width);var f=!1!==i.isInside;e?e[f?"show":"hide"](f).animate(o):f&&(o.width>0||i.hasImage)&&(i.graphic=e=h.renderer.symbol(u,o.x,o.y,o.width,o.height,n?r:l).add(p),this.enabledDataSorting&&h.hasRendered&&(e.attr({x:i.startXPos}),s="animate")),e&&"animate"===s&&e[f?"show":"hide"](f).animate(o),e&&!h.styledMode&&e[s](this.pointAttribs(i,i.selected&&"select")),e&&e.addClass(i.getClassName(),!0)}else e&&(i.graphic=e.destroy())}},markerAttribs:function(t,i){var e,s,r,n=this.options,o=n.marker,a=t.marker||{},h=a.symbol||o.symbol,l=pick(a.radius,o.radius);return i&&(e=o.states[i],s=a.states&&a.states[i],l=pick(s&&s.radius,e&&e.radius,l+(e&&e.radiusPlus||0))),t.hasImage=h&&0===h.indexOf("url"),t.hasImage&&(l=0),r={x:n.crisp?Math.floor(t.plotX)-l:t.plotX-l,y:t.plotY-l},l&&(r.width=r.height=2*l),r},pointAttribs:function(t,i){var e,s,r,n,o=this.options.marker,a=t&&t.options,h=a&&a.marker||{},l=this.color,p=a&&a.color,c=t&&t.color,d=pick(h.lineWidth,o.lineWidth),u=t&&t.zone&&t.zone.color,f=1;return l=p||u||c||l,r=h.fillColor||o.fillColor||l,n=h.lineColor||o.lineColor||l,(i=i||"normal")&&(e=o.states[i],s=h.states&&h.states[i]||{},d=pick(s.lineWidth,e.lineWidth,d+pick(s.lineWidthPlus,e.lineWidthPlus,0)),r=s.fillColor||e.fillColor||r,n=s.lineColor||e.lineColor||n,f=pick(s.opacity,e.opacity,f)),{stroke:n,"stroke-width":d,fill:r,opacity:f}},destroy:function(t){var i,e,s,r=this,n=r.chart,o=/AppleWebKit\/533/.test(win.navigator.userAgent),a=r.data||[];for(fireEvent(r,"destroy"),this.removeEvents(t),(r.axisTypes||[]).forEach(function(t){(s=r[t])&&s.series&&(erase(s.series,r),s.isDirty=s.forceRedraw=!0)}),r.legendItem&&r.chart.legend.destroyItem(r),i=a.length;i--;)(e=a[i])&&e.destroy&&e.destroy();r.points=null,U.clearTimeout(r.animationTimeout),objectEach(r,function(t,i){t instanceof SVGElement&&!t.survive&&t[o&&"group"===i?"hide":"destroy"]()}),n.hoverSeries===r&&(n.hoverSeries=null),erase(n.series,r),n.orderSeries(),objectEach(r,function(i,e){t&&"hcEvents"===e||delete r[e]})},getGraphPath:function(t,i,e){var s,r,n=this,o=n.options,a=o.step,h=[],l=[];return(s=(t=t||n.points).reversed)&&t.reverse(),(a={right:1,center:2}[a]||a&&3)&&s&&(a=4-a),(t=this.getValidPoints(t,!1,!(o.connectNulls&&!i&&!e))).forEach(function(s,p){var c,d=s.plotX,u=s.plotY,f=t[p-1];(s.leftCliff||f&&f.rightCliff)&&!e&&(r=!0),s.isNull&&!defined(i)&&p>0?r=!o.connectNulls:s.isNull&&!i?r=!0:(0===p||r?c=[["M",s.plotX,s.plotY]]:n.getPointSpline?c=[n.getPointSpline(t,s,p)]:a?(c=1===a?[["L",f.plotX,u]]:2===a?[["L",(f.plotX+d)/2,f.plotY],["L",(f.plotX+d)/2,u]]:[["L",d,f.plotY]]).push(["L",d,u]):c=[["L",d,u]],l.push(s.x),a&&(l.push(s.x),2===a&&l.push(s.x)),h.push.apply(h,c),r=!1)}),h.xMap=l,n.graphPath=h,h},drawGraph:function(){var t=this,i=this.options,e=(this.gappedPath||this.getGraphPath).call(this),s=this.chart.styledMode,r=[["graph","highcharts-graph"]];s||r[0].push(i.lineColor||this.color||"#cccccc",i.dashStyle),(r=t.getZonesGraphs(r)).forEach(function(r,n){var o,a=r[0],h=t[a],l=h?"animate":"attr";h?(h.endX=t.preventGraphAnimation?null:e.xMap,h.animate({d:e})):e.length&&(t[a]=h=t.chart.renderer.path(e).addClass(r[1]).attr({zIndex:1}).add(t.group)),h&&!s&&(o={stroke:r[2],"stroke-width":i.lineWidth,fill:t.fillGraph&&t.color||"none"},r[3]?o.dashstyle=r[3]:"square"!==i.linecap&&(o["stroke-linecap"]=o["stroke-linejoin"]="round"),h[l](o).shadow(n<2&&i.shadow)),h&&(h.startX=e.xMap,h.isArea=e.isArea)})},getZonesGraphs:function(t){return this.zones.forEach(function(i,e){var s=["zone-graph-"+e,"highcharts-graph highcharts-zone-graph-"+e+" "+(i.className||"")];this.chart.styledMode||s.push(i.color||this.color,i.dashStyle||this.options.dashStyle),t.push(s)},this),t},applyZones:function(){var t,i,e,s,r,n,o,a,h,l,p,c=this,d=this.chart,u=d.renderer,f=this.zones,g=this.clips||[],m=this.graph,y=this.area,x=Math.max(d.chartWidth,d.chartHeight),v=this[(this.zoneAxis||"y")+"Axis"],b=d.inverted,k=!1;f.length&&(m||y)&&v&&void 0!==v.min?(r=v.reversed,n=v.horiz,m&&!this.showLine&&m.hide(),y&&y.hide(),s=v.getExtremes(),f.forEach(function(f,A){t=r?n?d.plotWidth:0:n?0:v.toPixels(s.min)||0,t=clamp(pick(i,t),0,x),i=clamp(Math.round(v.toPixels(pick(f.value,s.max),!0)||0),0,x),k&&(t=i=v.toPixels(s.max)),o=Math.abs(t-i),a=Math.min(t,i),h=Math.max(t,i),v.isXAxis?(e={x:b?h:a,y:0,width:o,height:x},n||(e.x=d.plotHeight-e.x)):(e={x:0,y:b?h:a,width:x,height:o},n&&(e.y=d.plotWidth-e.y)),b&&u.isVML&&(e=v.isXAxis?{x:0,y:r?a:h,height:e.width,width:d.chartWidth}:{x:e.y-d.plotLeft-d.spacingBox.x,y:0,width:e.height,height:d.chartHeight}),g[A]?g[A].animate(e):g[A]=u.clipRect(e),l=c["zone-area-"+A],p=c["zone-graph-"+A],m&&p&&p.clip(g[A]),y&&l&&l.clip(g[A]),k=f.value>s.max,c.resetZones&&0===i&&(i=void 0)}),this.clips=g):c.visible&&(m&&m.show(!0),y&&y.show(!0))},invertGroups:function(t){var i=this,e=i.chart;function s(){["group","markerGroup"].forEach(function(s){i[s]&&(e.renderer.isVML&&i[s].attr({width:i.yAxis.len,height:i.xAxis.len}),i[s].width=i.yAxis.len,i[s].height=i.xAxis.len,i[s].invert(!i.isRadialSeries&&t))})}i.xAxis&&(i.eventsToUnbind.push(addEvent(e,"resize",s)),s(),i.invertGroups=s)},plotGroup:function(t,i,e,s,r){var n=this[t],o=!n,a={visibility:e,zIndex:s||.1};return void 0===this.opacity||this.chart.styledMode||(a.opacity=this.opacity),o&&(this[t]=n=this.chart.renderer.g().add(r)),n.addClass("highcharts-"+i+" highcharts-series-"+this.index+" highcharts-"+this.type+"-series "+(defined(this.colorIndex)?"highcharts-color-"+this.colorIndex+" ":"")+(this.options.className||"")+(n.hasClass("highcharts-tracker")?" highcharts-tracker":""),!0),n.attr(a)[o?"attr":"animate"](this.getPlotBox()),n},getPlotBox:function(){var t=this.chart,i=this.xAxis,e=this.yAxis;return t.inverted&&(i=e,e=this.xAxis),{translateX:i?i.left:t.plotLeft,translateY:e?e.top:t.plotTop,scaleX:1,scaleY:1}},removeEvents:function(t){t?this.eventsToUnbind.length&&(this.eventsToUnbind.forEach(function(t){t()}),this.eventsToUnbind.length=0):removeEvent(this)},render:function(){var t,i=this,e=i.chart,s=i.options,r=!i.finishedAnimating&&e.renderer.isSVG&&animObject(s.animation).duration,n=i.visible?"inherit":"hidden",o=s.zIndex,a=i.hasRendered,h=e.seriesGroup,l=e.inverted;fireEvent(this,"render"),t=i.plotGroup("group","series",n,o,h),i.markerGroup=i.plotGroup("markerGroup","markers",n,o,h),r&&i.animate&&i.animate(!0),t.inverted=!(!i.isCartesian&&!i.invertable)&&l,i.drawGraph&&(i.drawGraph(),i.applyZones()),i.visible&&i.drawPoints(),i.drawDataLabels&&i.drawDataLabels(),i.redrawPoints&&i.redrawPoints(),i.drawTracker&&!1!==i.options.enableMouseTracking&&i.drawTracker(),i.invertGroups(l),!1===s.clip||i.sharedClipKey||a||t.clip(e.clipRect),r&&i.animate&&i.animate(),a||(i.animationTimeout=syncTimeout(function(){i.afterAnimate()},r||0)),i.isDirty=!1,i.hasRendered=!0,fireEvent(i,"afterRender")},redraw:function(){var t=this.chart,i=this.isDirty||this.isDirtyData,e=this.group,s=this.xAxis,r=this.yAxis;e&&(t.inverted&&e.attr({width:t.plotWidth,height:t.plotHeight}),e.animate({translateX:pick(s&&s.left,t.plotLeft),translateY:pick(r&&r.top,t.plotTop)})),this.translate(),this.render(),i&&delete this.kdTree},kdAxisArray:["clientX","plotY"],searchPoint:function(t,i){var e=this.xAxis,s=this.yAxis,r=this.chart.inverted;return this.searchKDTree({clientX:r?e.len-t.chartY+e.pos:t.chartX-e.pos,plotY:r?s.len-t.chartX+s.pos:t.chartY-s.pos},i,t)},buildKDTree:function(t){this.buildingKdTree=!0;var i=this,e=i.options.findNearestPointBy.indexOf("y")>-1?2:1;delete i.kdTree,syncTimeout(function(){i.kdTree=function t(e,s,r){var n,o,a=e&&e.length;if(a)return n=i.kdAxisArray[s%r],e.sort(function(t,i){return t[n]-i[n]}),{point:e[o=Math.floor(a/2)],left:t(e.slice(0,o),s+1,r),right:t(e.slice(o+1),s+1,r)}}(i.getValidPoints(null,!i.directTouch),e,e),i.buildingKdTree=!1},i.options.kdNow||t&&"touchstart"===t.type?0:1)},searchKDTree:function(t,i,e){var s=this,r=this.kdAxisArray[0],n=this.kdAxisArray[1],o=i?"distX":"dist",a=s.options.findNearestPointBy.indexOf("y")>-1?2:1;if(this.kdTree||this.buildingKdTree||this.buildKDTree(e),this.kdTree)return function t(i,e,a,h){var l,p,c,d,u,f,g,m,y,x=e.point,v=s.kdAxisArray[a%h],b=x;return g=x,m=defined((f=i)[r])&&defined(g[r])?Math.pow(f[r]-g[r],2):null,y=(m||0)+((defined(f[n])&&defined(g[n])?Math.pow(f[n]-g[n],2):null)||0),g.dist=defined(y)?Math.sqrt(y):Number.MAX_VALUE,g.distX=defined(m)?Math.sqrt(m):Number.MAX_VALUE,c=(l=i[v]-x[v])<0?"right":"left",e[p=l<0?"left":"right"]&&(b=(d=t(i,e[p],a+1,h))[o]<b[o]?d:x),e[c]&&Math.sqrt(l*l)<b[o]&&(b=(u=t(i,e[c],a+1,h))[o]<b[o]?u:b),b}(t,this.kdTree,a,a)},pointPlacementToXValue:function(){var t=this.options,i=t.pointPlacement,e=t.pointRange,s=this.xAxis,r=i;return"between"===r&&(r=s.reversed?-.5:.5),isNumber(r)?r*pick(e,s.pointRange):0},isPointInside:function(t){return void 0!==t.plotY&&void 0!==t.plotX&&t.plotY>=0&&t.plotY<=this.yAxis.len&&t.plotX>=0&&t.plotX<=this.xAxis.len}});