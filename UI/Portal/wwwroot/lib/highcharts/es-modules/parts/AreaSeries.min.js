"use strict";import H from"./Globals.js";import Color from"./Color.js";var color=Color.parse;import LegendSymbolMixin from"../mixins/legend-symbol.js";import U from"./Utilities.js";var objectEach=U.objectEach,pick=U.pick,seriesType=U.seriesType;import"./Series.js";import"./Options.js";var Series=H.Series;seriesType("area","line",{softThreshold:!1,threshold:0},{singleStacks:!1,getStackPoints:function(t){var i,s,e=[],o=[],r=this.xAxis,l=this.yAxis,a=l.stacking.stacks[this.stackKey],h={},n=this.index,p=l.series,c=p.length,f=pick(l.options.reversedStacks,!0)?1:-1;if(t=t||this.points,this.options.stacking){for(s=0;s<t.length;s++)t[s].leftNull=t[s].rightNull=void 0,h[t[s].x]=t[s];objectEach(a,function(t,i){null!==t.total&&o.push(i)}),o.sort(function(t,i){return t-i}),i=p.map(function(t){return t.visible}),o.forEach(function(t,p){var u,d,g=0;if(h[t]&&!h[t].isNull)e.push(h[t]),[-1,1].forEach(function(e){var r=1===e?"rightNull":"leftNull",l=1===e?"rightCliff":"leftCliff",g=0,m=a[o[p+e]];if(m)for(s=n;s>=0&&s<c;)(u=m.points[s])||(s===n?h[t][r]=!0:i[s]&&(d=a[t].points[s])&&(g-=d[1]-d[0])),s+=f;h[t][l]=g});else{for(s=n;s>=0&&s<c;){if(u=a[t].points[s]){g=u[1];break}s+=f}g=l.translate(g,0,1,0,1),e.push({isNull:!0,plotX:r.translate(t,0,0,0,1),x:t,plotY:g,yBottom:g})}})}return e},getGraphPath:function(t){var i,s,e,o,r,l,a,h,n=Series.prototype.getGraphPath,p=this.options,c=p.stacking,f=this.yAxis,u=[],d=[],g=this.index,m=f.stacking.stacks[this.stackKey],k=p.threshold,v=Math.round(f.getThreshold(p.threshold)),y=pick(p.connectNulls,"percent"===c),x=function(i,s,e){var o,r,a=t[i],h=c&&m[a.x].points[g],n=a[e+"Null"]||0,p=a[e+"Cliff"]||0,y=!0;p||n?(o=(n?h[0]:h[1])+p,r=h[0]+p,y=!!n):!c&&t[s]&&t[s].isNull&&(o=r=k),void 0!==o&&(d.push({plotX:l,plotY:null===o?v:f.getThreshold(o),isNull:y,isCliff:!0}),u.push({plotX:l,plotY:null===r?v:f.getThreshold(r),doCurve:!1}))};for(t=t||this.points,c&&(t=this.getStackPoints(t)),o=0;o<t.length;o++)c||(t[o].leftCliff=t[o].rightCliff=t[o].leftNull=t[o].rightNull=void 0),a=t[o].isNull,l=pick(t[o].rectPlotX,t[o].plotX),h=pick(t[o].yBottom,v),a&&!y||(y||x(o,o-1,"left"),a&&!c&&y||(d.push(t[o]),u.push({x:o,plotX:l,plotY:h})),y||x(o,o+1,"right"));s=n.call(this,d,!0,!0),u.reversed=!0;var C=(e=n.call(this,u,!0,!0))[0];return C&&"M"===C[0]&&(e[0]=["L",C[1],C[2]]),r=s.concat(e),i=n.call(this,d,!1,y),r.xMap=s.xMap,this.areaPath=r,i},drawGraph:function(){this.areaPath=[],Series.prototype.drawGraph.apply(this);var t=this,i=this.areaPath,s=this.options,e=this.zones,o=[["area","highcharts-area",this.color,s.fillColor]];e.forEach(function(i,e){o.push(["zone-area-"+e,"highcharts-area highcharts-zone-area-"+e+" "+i.className,i.color||t.color,i.fillColor||s.fillColor])}),o.forEach(function(e){var o=e[0],r=t[o],l=r?"animate":"attr",a={};r?(r.endX=t.preventGraphAnimation?null:i.xMap,r.animate({d:i})):(a.zIndex=0,(r=t[o]=t.chart.renderer.path(i).addClass(e[1]).add(t.group)).isArea=!0),t.chart.styledMode||(a.fill=pick(e[3],color(e[2]).setOpacity(pick(s.fillOpacity,.75)).get())),r[l](a),r.startX=i.xMap,r.shiftUnit=s.step?2:1})},drawLegendSymbol:LegendSymbolMixin.drawRectangle});