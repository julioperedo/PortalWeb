"use strict";import Axis from"./Axis.js";import Chart from"./Chart.js";import H from"./Globals.js";import Point from"./Point.js";import SVGRenderer from"./SVGRenderer.js";import U from"./Utilities.js";var addEvent=U.addEvent,arrayMax=U.arrayMax,arrayMin=U.arrayMin,clamp=U.clamp,defined=U.defined,extend=U.extend,find=U.find,format=U.format,getOptions=U.getOptions,isNumber=U.isNumber,isString=U.isString,merge=U.merge,pick=U.pick,splat=U.splat;import"./Pointer.js";import"./Series.js";import"./Navigator.js";import"./Scrollbar.js";import"./RangeSelector.js";var Series=H.Series,seriesProto=Series.prototype,seriesInit=seriesProto.init,seriesProcessData=seriesProto.processData,pointTooltipFormatter=Point.prototype.tooltipFormatter;H.StockChart=H.stockChart=function(t,i,s){var e,r=isString(t)||t.nodeName,a=arguments[r?1:0],o=a,n=a.series,h=getOptions(),l=pick(a.navigator&&a.navigator.enabled,h.navigator.enabled,!0);return a.xAxis=splat(a.xAxis||{}).map(function(t,i){return merge({minPadding:0,maxPadding:0,overscroll:0,ordinal:!0,title:{text:null},labels:{overflow:"justify"},showLastLabel:!0},h.xAxis,h.xAxis&&h.xAxis[i],t,{type:"datetime",categories:null},l?{startOnTick:!1,endOnTick:!1}:null)}),a.yAxis=splat(a.yAxis||{}).map(function(t,i){return e=pick(t.opposite,!0),merge({labels:{y:-2},opposite:e,showLastLabel:!(!t.categories&&"category"!==t.type),title:{text:null}},h.yAxis,h.yAxis&&h.yAxis[i],t)}),a.series=null,(a=merge({chart:{panning:{enabled:!0,type:"x"},pinchType:"x"},navigator:{enabled:l},scrollbar:{enabled:pick(h.scrollbar.enabled,!0)},rangeSelector:{enabled:pick(h.rangeSelector.enabled,!0)},title:{text:null},tooltip:{split:pick(h.tooltip.split,!0),crosshairs:!0},legend:{enabled:!1}},a,{isStock:!0})).series=o.series=n,r?new Chart(t,a,s):new Chart(a,i)},addEvent(Series,"setOptions",function(t){var i;this.chart.options.isStock&&(this.is("column")||this.is("columnrange")?i={borderWidth:0,shadow:!1}:this.is("scatter")||this.is("sma")||(i={marker:{enabled:!1,radius:2}}),i&&(t.plotOptions[this.type]=merge(t.plotOptions[this.type],i)))}),addEvent(Axis,"autoLabelAlign",function(t){var i,s=this.chart,e=this.options,r=s._labelPanes=s._labelPanes||{},a=this.options.labels;this.chart.options.isStock&&"yAxis"===this.coll&&!r[i=e.top+","+e.height]&&a.enabled&&(15===a.x&&(a.x=0),void 0===a.align&&(a.align="right"),r[i]=this,t.align="right",t.preventDefault())}),addEvent(Axis,"destroy",function(){var t=this.chart,i=this.options&&this.options.top+","+this.options.height;i&&t._labelPanes&&t._labelPanes[i]===this&&delete t._labelPanes[i]}),addEvent(Axis,"getPlotLinePath",function(t){var i,s,e,r,a,o,n,h,l,p=this,c=this.isLinked&&!this.series?this.linkedParent.series:this.series,d=p.chart,x=d.renderer,f=p.left,u=p.top,g=[],m=[],y=t.translatedValue,b=t.value,A=t.force;(d.options.isStock&&!1!==t.acrossPanes&&"xAxis"===p.coll||"yAxis"===p.coll)&&(t.preventDefault(),n=p.coll,h="xAxis"===n?"yAxis":"xAxis",l=p.options[h],m=isNumber(l)?[d[h][l]]:isString(l)?[d.get(l)]:c.map(function(t){return t[h]}),(p.isXAxis?d.yAxis:d.xAxis).forEach(function(t){if(!defined(t.options.id)||-1===t.options.id.indexOf("navigator")){var i=t.isXAxis?"yAxis":"xAxis",s=defined(t.options[i])?d[i][t.options[i]]:d[i][0];p===s&&m.push(t)}}),a=m.length?[]:[p.isXAxis?d.yAxis[0]:d.xAxis[0]],m.forEach(function(t){-1!==a.indexOf(t)||find(a,function(i){return i.pos===t.pos&&i.len===t.len})||a.push(t)}),o=pick(y,p.translate(b,null,null,t.old)),isNumber(o)&&(p.horiz?a.forEach(function(t){var a;s=t.pos,r=s+t.len,i=e=Math.round(o+p.transB),"pass"!==A&&(i<f||i>f+p.width)&&(A?i=e=clamp(i,f,f+p.width):a=!0),a||g.push(["M",i,s],["L",e,r])}):a.forEach(function(t){var a;i=t.pos,e=i+t.len,s=r=Math.round(u+p.height-o),"pass"!==A&&(s<u||s>u+p.height)&&(A?s=r=clamp(s,u,u+p.height):a=!0),a||g.push(["M",i,s],["L",e,r])})),t.path=g.length>0?x.crispPolyLine(g,t.lineWidth||1):null)}),SVGRenderer.prototype.crispPolyLine=function(t,i){for(var s=0;s<t.length;s+=2){var e=t[s],r=t[s+1];e[1]===r[1]&&(e[1]=r[1]=Math.round(e[1])-i%2/2),e[2]===r[2]&&(e[2]=r[2]=Math.round(e[2])+i%2/2)}return t},addEvent(Axis,"afterHideCrosshair",function(){this.crossLabel&&(this.crossLabel=this.crossLabel.hide())}),addEvent(Axis,"afterDrawCrosshair",function(t){if(defined(this.crosshair.label)&&this.crosshair.label.enabled&&this.cross){var i,s,e,r,a,o,n=this.chart,h=this.logarithmic,l=this.options.crosshair.label,p=this.horiz,c=this.opposite,d=this.left,x=this.top,f=this.crossLabel,u=l.format,g="",m="inside"===this.options.tickPosition,y=!1!==this.crosshair.snap,b=0,A=t.e||this.cross&&this.cross.e,v=t.point,k=this.min,P=this.max;h&&(k=h.lin2log(k),P=h.lin2log(P)),a=p?"center":c?"right"===this.labelAlign?"right":"left":"left"===this.labelAlign?"left":"center",f||(f=this.crossLabel=n.renderer.label(null,null,null,l.shape||"callout").addClass("highcharts-crosshair-label"+(this.series[0]&&" highcharts-color-"+this.series[0].colorIndex)).attr({align:l.align||a,padding:pick(l.padding,8),r:pick(l.borderRadius,3),zIndex:2}).add(this.labelGroup),n.styledMode||f.attr({fill:l.backgroundColor||this.series[0]&&this.series[0].color||"#666666",stroke:l.borderColor||"","stroke-width":l.borderWidth||0}).css(extend({color:"#ffffff",fontWeight:"normal",fontSize:"11px",textAlign:"center"},l.style))),p?(i=y?v.plotX+d:A.chartX,s=x+(c?0:this.height)):(i=c?this.width+d:0,s=y?v.plotY+x:A.chartY),u||l.formatter||(this.dateTime&&(g="%b %d, %Y"),u="{value"+(g?":"+g:"")+"}"),o=y?v[this.isXAxis?"x":"y"]:this.toValue(p?A.chartX:A.chartY),f.attr({text:u?format(u,{value:o},n):l.formatter.call(this,o),x:i,y:s,visibility:o<k||o>P?"hidden":"visible"}),e=f.getBBox(),isNumber(f.y)&&(p?(m&&!c||!m&&c)&&(s=f.y-e.height):s=f.y-e.height/2),r=p?{left:d-e.x,right:d+this.width-e.x}:{left:"left"===this.labelAlign?d:0,right:"right"===this.labelAlign?d+this.width:n.chartWidth},f.translateX<r.left&&(b=r.left-f.translateX),f.translateX+e.width>=r.right&&(b=-(f.translateX+e.width-r.right)),f.attr({x:i+b,y:s,anchorX:p?i:this.opposite?0:n.chartWidth,anchorY:p?this.opposite?n.chartHeight:0:s+e.height/2})}}),seriesProto.init=function(){seriesInit.apply(this,arguments),this.setCompare(this.options.compare)},seriesProto.setCompare=function(t){this.modifyValue="value"===t||"percent"===t?function(i,s){var e=this.compareValue;return void 0!==i&&void 0!==e?("value"===t?i-=e:i=i/e*100-(100===this.options.compareBase?0:100),s&&(s.change=i),i):0}:null,this.userOptions.compare=t,this.chart.hasRendered&&(this.isDirty=!0)},seriesProto.processData=function(t){var i,s,e,r,a,o=-1,n=!0===this.options.compareStart?0:1;if(seriesProcessData.apply(this,arguments),this.xAxis&&this.processedYData)for(s=this.processedXData,r=(e=this.processedYData).length,this.pointArrayMap&&(o=this.pointArrayMap.indexOf(this.options.pointValKey||this.pointValKey||"y")),i=0;i<r-n;i++)if(a=e[i]&&o>-1?e[i][o]:e[i],isNumber(a)&&s[i+n]>=this.xAxis.min&&0!==a){this.compareValue=a;break}},addEvent(Series,"afterGetExtremes",function(t){var i=t.dataExtremes;if(this.modifyValue&&i){var s=[this.modifyValue(i.dataMin),this.modifyValue(i.dataMax)];i.dataMin=arrayMin(s),i.dataMax=arrayMax(s)}}),Axis.prototype.setCompare=function(t,i){this.isXAxis||(this.series.forEach(function(i){i.setCompare(t)}),pick(i,!0)&&this.chart.redraw())},Point.prototype.tooltipFormatter=function(t){var i=this.series.chart.numberFormatter;return t=t.replace("{point.change}",(this.change>0?"+":"")+i(this.change,pick(this.series.tooltipOptions.changeDecimals,2))),pointTooltipFormatter.apply(this,[t])},addEvent(Series,"render",function(){var t,i=this.chart;if((!i.is3d||!i.is3d())&&!i.polar&&this.xAxis&&!this.xAxis.isRadial){if(t=this.yAxis.len,this.xAxis.axisLine){var s=i.plotTop+i.plotHeight-this.yAxis.pos-this.yAxis.len,e=Math.floor(this.xAxis.axisLine.strokeWidth()/2);s>=0&&(t-=Math.max(e-s,0))}!this.clipBox&&this.animate?(this.clipBox=merge(i.clipBox),this.clipBox.width=this.xAxis.len,this.clipBox.height=t):i[this.sharedClipKey]&&(i[this.sharedClipKey].animate({width:this.xAxis.len,height:t}),i[this.sharedClipKey+"m"]&&i[this.sharedClipKey+"m"].animate({width:this.xAxis.len}))}}),addEvent(Chart,"update",function(t){var i=t.options;"scrollbar"in i&&this.navigator&&(merge(!0,this.options.scrollbar,i.scrollbar),this.navigator.update({},!1),delete i.scrollbar)});