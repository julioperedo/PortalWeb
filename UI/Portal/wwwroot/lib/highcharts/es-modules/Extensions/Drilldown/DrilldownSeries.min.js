"use strict";import A from"../../Core/Animation/AnimationUtilities.js";const animObject=A["animObject"];import U from"../../Core/Utilities.js";const{addEvent,extend,fireEvent,merge,pick,pushUnique,syncTimeout}=U,composedMembers=[];function applyCursorCSS(o,i,n,t){o[n?"addClass":"removeClass"]("highcharts-drilldown-point"),t||o.css({cursor:i})}function columnAnimateDrilldown(o){const t=this,i=t.chart,e=i.drilldownLevels,r=animObject((i.options.drilldown||{}).animation),l=this.xAxis,a=i.styledMode;if(!o){let n;(e||[]).forEach(o=>{t.options._ddSeriesId===o.lowerSeriesOptions._ddSeriesId&&(n=o.shapeArgs,!a&&n&&(n.fill=o.color))}),n.x+=pick(l.oldPos,l.pos)-l.pos,t.points.forEach(o=>{const i=o.shapeArgs;a||(i.fill=o.color),o.graphic&&o.graphic.attr(n).animate(extend(o.shapeArgs,{fill:o.color||t.color}),r)}),i.drilldown&&i.drilldown.fadeInGroup(this.dataLabelsGroup),delete this.animate}}function columnAnimateDrillupFrom(e){const r=this,l=animObject((r.chart.options.drilldown||{}).animation);(r.trackerGroups||[]).forEach(o=>{r[o]&&r[o].on("mouseover")});let a=r.group;const s=a!==r.chart.columnGroup;s&&delete r.group,this.points.forEach(o=>{const i=o.graphic,n=e.shapeArgs;var t;i&&n&&(t=()=>{i.destroy(),a&&s&&(a=a.destroy())},delete o.graphic,r.chart.styledMode||(n.fill=e.color),l.duration?i.animate(n,merge(l,{complete:t})):(i.attr(n),t()))})}function columnAnimateDrillupTo(o){const n=this,r=n.drilldownLevel;o||(n.points.forEach(o=>{const i=o.dataLabel;o.graphic&&o.graphic.hide(),i&&(i.hidden="hidden"===i.attr("visibility"),i.hidden||(i.hide(),i.connector?.hide()))}),syncTimeout(()=>{if(n.points){let i=[];n.data.forEach(o=>{i.push(o)}),(i=n.nodes?i.concat(n.nodes):i).forEach((o,i)=>{const n=i===(r&&r.pointIndex)?"show":"fadeIn",t="show"==n||void 0,e=o.dataLabel;o.graphic&&o.visible&&o.graphic[n](t),e&&!e.hidden&&(e.fadeIn(),e.connector?.fadeIn())})}},Math.max(n.chart.options.drilldown.animation.duration-50,0)),delete this.animate)}function compose(o,i){var{column:i,map:n,pie:t}=i,e=o.prototype.pointClass;if(i&&pushUnique(composedMembers,i)){const r=i.prototype;r.animateDrilldown=columnAnimateDrilldown,r.animateDrillupFrom=columnAnimateDrillupFrom,r.animateDrillupTo=columnAnimateDrillupTo}if(n&&pushUnique(composedMembers,n)){const l=n.prototype;l.animateDrilldown=mapAnimateDrilldown,l.animateDrillupFrom=mapAnimateDrillupFrom,l.animateDrillupTo=mapAnimateDrillupTo}if(t&&pushUnique(composedMembers,t)){const a=t.prototype;a.animateDrilldown=pieAnimateDrilldown,a.animateDrillupFrom=columnAnimateDrillupFrom,a.animateDrillupTo=columnAnimateDrillupTo}if(pushUnique(composedMembers,e)){const s=e.prototype;addEvent(e,"afterInit",onPointAfterInit),addEvent(e,"afterSetState",onPointAfterSetState),addEvent(e,"update",onPointUpdate),s.doDrilldown=pointDoDrilldown,s.runDrilldown=pointRunDrilldown}pushUnique(composedMembers,o)&&(addEvent(o,"afterDrawDataLabels",onSeriesAfterDrawDataLabels),addEvent(o,"afterDrawTracker",onSeriesAfterDrawTracker))}function mapAnimateDrilldown(o){const i=this,n=i.chart,t=i.group;n&&t&&i.options&&n.options.drilldown&&n.options.drilldown.animation&&(o&&n.mapView?(t.attr({opacity:.01}),n.mapView.allowTransformAnimation=!1,i.options.inactiveOtherPoints=!0,i.options.enableMouseTracking=!1):(t.animate({opacity:1},n.options.drilldown.animation,()=>{i.options&&(i.options.inactiveOtherPoints=!1,i.options.enableMouseTracking=pick(i.userOptions&&i.userOptions.enableMouseTracking,!0),i.isDirty=!0,n.redraw())}),n.drilldown&&n.drilldown.fadeInGroup(this.dataLabelsGroup)))}function mapAnimateDrillupFrom(){const o=this,i=o.chart;i&&i.mapView&&(i.mapView.allowTransformAnimation=!1),o.options&&(o.options.inactiveOtherPoints=!0)}function mapAnimateDrillupTo(o){const i=this,n=i.chart,t=i.group;n&&t&&(o?(t.attr({opacity:.01}),i.options&&(i.options.inactiveOtherPoints=!0)):(t.animate({opacity:1},(n.options.drilldown||{}).animation),n.drilldown&&n.drilldown.fadeInGroup(i.dataLabelsGroup)))}function onPointAfterInit(){var o=this;return o.drilldown&&!o.unbindDrilldownClick&&(o.unbindDrilldownClick=addEvent(o,"click",onPointClick)),o}function onPointAfterSetState(){var o=this.series,i=o.chart.styledMode;this.drilldown&&o.halo&&"hover"===this.state?applyCursorCSS(o.halo,"pointer",!0,i):o.halo&&applyCursorCSS(o.halo,"auto",!1,i)}function onPointClick(o){const i=this.series;i.xAxis&&!1===(i.chart.options.drilldown||{}).allowPointDrilldown?i.xAxis.drilldownCategory(this.x,o):this.runDrilldown(void 0,void 0,o)}function onPointUpdate(o){var i=this,o=o.options||{};o.drilldown&&!i.unbindDrilldownClick?i.unbindDrilldownClick=addEvent(i,"click",onPointClick):!o.drilldown&&void 0!==o.drilldown&&i.unbindDrilldownClick&&(i.unbindDrilldownClick=i.unbindDrilldownClick())}function onSeriesAfterDrawDataLabels(){const o=this.chart,i=o.options.drilldown.activeDataLabelStyle,n=o.renderer,t=o.styledMode;for(const e of this.points){const r=e.options.dataLabels,l=pick(e.dlOptions,r&&r.style,{});e.drilldown&&e.dataLabel&&("contrast"!==i.color||t||(l.color=n.getContrast(e.color||this.color)),r&&r.color&&(l.color=r.color),e.dataLabel.addClass("highcharts-drilldown-data-label"),t||e.dataLabel.css(i).css(l))}}function onSeriesAfterDrawTracker(){var o=this.chart.styledMode;for(const i of this.points)i.drilldown&&i.graphic&&applyCursorCSS(i.graphic,"pointer",!0,o)}function pieAnimateDrilldown(o){const i=this,e=i.chart,r=i.points,l=e.drilldownLevels[e.drilldownLevels.length-1],a=e.options.drilldown.animation;if(i.is("item")&&(a.duration=0),i.center){const s=l.shapeArgs,d=s.start,n=s.end-d,p=n/i.points.length,c=e.styledMode;if(!o){let n,t;for(let o=0,i=r.length;o<i;++o)t=r[o],n=t.shapeArgs,c||(s.fill=l.color,n.fill=t.color),t.graphic&&t.graphic.attr(merge(s,{start:d+o*p,end:d+(o+1)*p}))[a?"animate":"attr"](n,a);e.drilldown&&e.drilldown.fadeInGroup(i.dataLabelsGroup),delete i.animate}}}function pointDoDrilldown(){this.runDrilldown()}function pointRunDrilldown(t,o,i){const n=this,e=n.series,r=e.chart,l=r.options.drilldown||{};let a=(l.series||[]).length,s;for(r.ddDupes||(r.ddDupes=[]),r.colorCounter=r.symbolCounter=0;a--&&!s;)l.series&&l.series[a].id===n.drilldown&&n.drilldown&&-1===r.ddDupes.indexOf(n.drilldown)&&(s=l.series[a],r.ddDupes.push(n.drilldown));fireEvent(r,"drilldown",{point:n,seriesOptions:s,category:o,originalEvent:i,points:void 0!==o&&e.xAxis.getDDPoints(o).slice(0)},o=>{const i=o.point.series&&o.point.series.chart,n=o.seriesOptions;i&&n&&(t?i.addSingleSeriesAsDrilldown(o.point,n):i.addSeriesAsDrilldown(o.point,n))})}const DrilldownSeries={compose:compose};export default DrilldownSeries;