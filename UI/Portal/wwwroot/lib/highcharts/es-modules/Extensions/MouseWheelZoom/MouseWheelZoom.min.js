"use strict";import U from"../../Core/Utilities.js";const{addEvent,isObject,pick,defined,merge,isNumber}=U;import NBU from"../Annotations/NavigationBindingsUtilities.js";const getAssignedAxis=NBU["getAssignedAxis"],composedClasses=[],defaultOptions={enabled:!0,sensitivity:1.1},optionsToObject=e=>isObject(e)?merge(defaultOptions,e):merge(defaultOptions,{enabled:!defined(e)||e}),fitToRange=(e,t,i,n)=>({rangeStart:i=(i=e+t<i+n?t<n?(n=t,e):e+t-n:i)<e?e:i,rangeWidth:n=t<n?t:n});let wheelTimer,startOnTick,endOnTick;const waitForAutomaticExtremes=function(i){const n=i.options;defined(wheelTimer)&&clearTimeout(wheelTimer),defined(startOnTick)||(startOnTick=n.startOnTick,endOnTick=n.endOnTick),(startOnTick||endOnTick)&&(n.startOnTick=!1,n.endOnTick=!1),wheelTimer=setTimeout(()=>{var e,t;defined(startOnTick)&&defined(endOnTick)&&(n.startOnTick=startOnTick,n.endOnTick=endOnTick,{min:e,max:t}=i.getExtremes(),i.forceRedraw=!0,i.setExtremes(e,t),startOnTick=endOnTick=void 0)},400)},getMouseAxisRatio=function(e,t,i){if(!defined(i))return.5;var i=(i-t.pos)/t.len,n=t.isXAxis;return n&&!t.reversed!=!e.inverted||!n&&t.reversed?1-i:i},zoomOnDirection=function(e,t,i,n,o){var s,a,r=t.isXAxis;let d=!1;return defined(t.max)&&defined(t.min)&&defined(t.dataMax)&&defined(t.dataMin)&&(r||waitForAutomaticExtremes(t),s=(r=t.max-t.min)*n,o=(isNumber(o)?o:t.min+r/2)-s*getMouseAxisRatio(e,t,i),r=pick(t.options.max,t.dataMax)-pick(t.options.min,t.dataMin),e=t.options.min?0:r*t.options.minPadding,i=t.options.max?0:r*t.options.maxPadding,a=pick(t.options.min,t.dataMin)-e,r=r+i+e,e=(i=fitToRange(a,r,o,s)).rangeStart<pick(t.options.min,a)||i.rangeStart===t.min&&i.rangeWidth>r&&i.rangeStart+i.rangeWidth<pick(t.options.max,Number.MIN_VALUE)||i.rangeWidth===t.max-t.min,defined(n)&&!e?(t.setExtremes(i.rangeStart,i.rangeStart+i.rangeWidth,!1),d=!0):t.setExtremes(void 0,void 0,!1)),d},zoomBy=function(e,t,i,n,o,s,a){var a=pick(a.type,e.zooming.type,""),r=/x/.test(a),a=/y/.test(a);let d=i.toValue(o),m=n.toValue(s);e.inverted&&(c=n.pos+n.len,d=i.toValue(s),m=n.toValue(o),p=o,o=s,s=c-p+n.pos);var c=r&&zoomOnDirection(e,i,o,t,d),p=a&&zoomOnDirection(e,n,s,t,m),r=c||p;return r&&e.redraw(!1),r};function onAfterGetContainer(){const s=this,a=optionsToObject(s.zooming.mouseWheel);a.enabled&&addEvent(this.container,"wheel",e=>{e=this.pointer.normalize(e);var t,i,n,o=!s.pointer.inClass(e.target,"highcharts-no-mousewheel");s.isInsidePlot(e.chartX-s.plotLeft,e.chartY-s.plotTop)&&o&&(o=a.sensitivity||1.1,t=e.detail||(e.deltaY||0)/120,i=getAssignedAxis(this.pointer.getCoordinates(e).xAxis),n=getAssignedAxis(this.pointer.getCoordinates(e).yAxis),zoomBy(s,Math.pow(o,t),i?i.axis:s.xAxis[0],n?n.axis:s.yAxis[0],e.chartX,e.chartY,a)&&e.preventDefault&&e.preventDefault())})}function compose(e){-1===composedClasses.indexOf(e)&&(composedClasses.push(e),addEvent(e,"afterGetContainer",onAfterGetContainer))}const MouseWheelZoomComposition={compose:compose};export default MouseWheelZoomComposition;