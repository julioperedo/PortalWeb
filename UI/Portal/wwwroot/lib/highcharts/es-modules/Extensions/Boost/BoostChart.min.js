"use strict";import BoostableMap from"./BoostableMap.js";import U from"../../Core/Utilities.js";const{addEvent,pick}=U,composedClasses=[];function compose(o,t){return t&&U.pushUnique(composedClasses,o)&&o.prototype.callbacks.push(onChartCallback),o}function getBoostClipRect(o,t){let e={x:o.plotLeft,y:o.plotTop,width:o.plotWidth,height:o.navigator?o.navigator.top+o.navigator.height-o.plotTop:o.plotHeight};var s,r,i;return t.getClipBox&&({xAxis:s,yAxis:r}=t,e=t.getClipBox(),o.inverted?(i=e.width,e.width=e.height,e.height=i,e.x=r.pos,e.y=s.pos):(e.x=s.pos,e.y=r.pos)),t===o&&(i=o.inverted?o.xAxis:o.yAxis).length<=1&&(e.y=Math.min(i[0].pos,e.y),e.height=i[0].pos-o.plotTop+i[0].len),e}function isChartSeriesBoosting(o){const t=o.series,e=o.boost=o.boost||{},s=o.options.boost||{},r=pick(s.seriesThreshold,50);if(t.length>=r)return!0;if(1===t.length)return!1;let i=s.allowForce;if(void 0===i){i=!0;for(const l of o.xAxis)if(pick(l.min,-1/0)>pick(l.dataMin,-1/0)||pick(l.max,1/0)<pick(l.dataMax,1/0)){i=!1;break}}if(void 0!==e.forceChartBoost){if(i)return e.forceChartBoost;e.forceChartBoost=void 0}let a=0,n=0,p;for(const h of t)0!==(p=h.options).boostThreshold&&!1!==h.visible&&"heatmap"!==h.type&&(BoostableMap[h.type]&&++a,patientMax(h.processedXData,p.data,h.points)>=(p.boostThreshold||Number.MAX_VALUE)&&++n);return e.forceChartBoost=i&&(a===t.length&&n===a||5<n),e.forceChartBoost}function onChartCallback(e){addEvent(e,"predraw",function(){e.boost=e.boost||{},e.boost.forceChartBoost=void 0,e.boosted=!1,e.boost.clear&&e.boost.clear(),e.boost.canvas&&e.boost.wgl&&isChartSeriesBoosting(e)&&e.boost.wgl.allocateBuffer(e),e.boost.markerGroup&&e.xAxis&&0<e.xAxis.length&&e.yAxis&&0<e.yAxis.length&&e.boost.markerGroup.translate(e.xAxis[0].pos,e.yAxis[0].pos)}),addEvent(e,"render",function(){e.boost&&e.boost.wgl&&isChartSeriesBoosting(e)&&e.boost.wgl.render(e)});let s=-1,r=-1;addEvent(e.pointer,"afterGetHoverData",()=>{var o,t=e.hoverSeries;e.boost=e.boost||{},e.boost.markerGroup&&t&&(o=e.inverted?t.yAxis:t.xAxis,t=e.inverted?t.xAxis:t.yAxis,(o&&o.pos!==s||t&&t.pos!==r)&&(e.boost.markerGroup.translate(o.pos,t.pos),s=o.pos,r=t.pos))})}function patientMax(...o){let t=-Number.MAX_VALUE;return o.forEach(function(o){if(null!=o&&void 0!==o.length&&0<o.length)return t=o.length,!0}),t}const BoostChart={compose:compose,getBoostClipRect:getBoostClipRect,isChartSeriesBoosting:isChartSeriesBoosting};export default BoostChart;