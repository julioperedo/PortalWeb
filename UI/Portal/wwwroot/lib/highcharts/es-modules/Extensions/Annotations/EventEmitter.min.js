"use strict";import H from"../../Core/Globals.js";const{doc,isTouchDevice}=H;import U from"../../Core/Utilities.js";const{addEvent,fireEvent,objectEach,pick,removeEvent}=U;class EventEmitter{addEvents(){function t(e){addEvent(e,isTouchDevice?"touchstart":"mousedown",e=>{o.onMouseDown(e)},{passive:!1})}const o=this;if(t(this.graphic.element),(o.labels||[]).forEach(e=>{e.options.useHTML&&e.graphic.text&&t(e.graphic.text.element)}),objectEach(o.options.events,(t,a)=>{function e(e){"click"===a&&o.cancelClick||t.call(o,o.chart.pointer.normalize(e),o.target)}-1===(o.nonDOMEvents||[]).indexOf(a)?o.graphic.on(a,e):addEvent(o,a,e,{passive:!1})}),o.options.draggable&&(addEvent(o,"drag",o.onDrag),!o.graphic.renderer.styledMode)){const a={cursor:{x:"ew-resize",y:"ns-resize",xy:"move"}[o.options.draggable]};o.graphic.css(a),(o.labels||[]).forEach(e=>{e.options.useHTML&&e.graphic.text&&e.graphic.text.css(a)})}o.isUpdating||fireEvent(o,"add")}destroy(){this.removeDocEvents(),removeEvent(this),this.hcEvents=null}mouseMoveToRadians(e,t,a){let o=e.prevChartY-a,r=e.prevChartX-t,s=e.chartY-a,i=e.chartX-t,n;return this.chart.inverted&&(n=r,r=o,o=n,n=i,i=s,s=n),Math.atan2(s,i)-Math.atan2(o,r)}mouseMoveToScale(e,t,a){var o=e.prevChartX-t,r=e.prevChartY-a;let s=(e.chartX-t||1)/(o||1),i=(e.chartY-a||1)/(r||1);return this.chart.inverted&&(t=i,i=s,s=t),{x:s,y:i}}mouseMoveToTranslation(e){let t=e.chartX-e.prevChartX,a=e.chartY-e.prevChartY,o;return this.chart.inverted&&(o=a,a=t,t=o),{x:t,y:a}}onDrag(e){if(this.chart.isInsidePlot(e.chartX-this.chart.plotLeft,e.chartY-this.chart.plotTop,{visiblePlotOnly:!0})){const t=this.mouseMoveToTranslation(e);"x"===this.options.draggable&&(t.y=0),"y"===this.options.draggable&&(t.x=0);e=this;e.points.length?e.translate(t.x,t.y):(e.shapes.forEach(e=>e.translate(t.x,t.y)),e.labels.forEach(e=>e.translate(t.x,t.y))),this.redraw(!1)}}onMouseDown(e){if(e.preventDefault&&e.preventDefault(),2!==e.button){const o=this,r=o.chart.pointer,s=e?.sourceCapabilities?.firesTouchEvents||!1;let t=(e=r.normalize(e)).chartX,a=e.chartY;o.cancelClick=!1,o.chart.hasDraggedAnnotation=!0,o.removeDrag=addEvent(doc,isTouchDevice||s?"touchmove":"mousemove",function(e){o.hasDragged=!0,(e=r.normalize(e)).prevChartX=t,e.prevChartY=a,fireEvent(o,"drag",e),t=e.chartX,a=e.chartY},isTouchDevice||s?{passive:!1}:void 0),o.removeMouseUp=addEvent(doc,isTouchDevice||s?"touchend":"mouseup",function(e){const t=pick(o.target&&o.target.annotation,o.target);t&&(t.cancelClick=o.hasDragged),o.cancelClick=o.hasDragged,o.hasDragged=!1,o.chart.hasDraggedAnnotation=!1,fireEvent(pick(t,o),"afterUpdate"),o.onMouseUp(e)},isTouchDevice||s?{passive:!1}:void 0)}}onMouseUp(e){const t=this.chart,a=this.target||this,o=t.options.annotations,r=t.annotations.indexOf(a);this.removeDocEvents(),o[r]=a.options}removeDocEvents(){this.removeDrag&&(this.removeDrag=this.removeDrag()),this.removeMouseUp&&(this.removeMouseUp=this.removeMouseUp())}}export default EventEmitter;