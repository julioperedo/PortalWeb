"use strict";import Chart from"../Core/Chart/Chart.js";import CU from"../Series/CenteredUtilities.js";import H from"../Core/Globals.js";import Pointer from"../Core/Pointer.js";import U from"../Core/Utilities.js";const{addEvent,correctFloat,defined,extend,merge,pick,splat}=U;Chart.prototype.collectionsWithUpdate.push("pane");class Pane{constructor(t,e){this.background=void 0,this.center=void 0,this.chart=void 0,this.options=void 0,this.coll="pane",this.defaultOptions={center:["50%","50%"],size:"85%",innerSize:"0%",startAngle:0},this.defaultBackgroundOptions={shape:"circle",borderWidth:1,borderColor:"#cccccc",backgroundColor:{linearGradient:{x1:0,y1:0,x2:0,y2:1},stops:[[0,"#ffffff"],[1,"#e6e6e6"]]},from:-Number.MAX_VALUE,innerRadius:0,to:Number.MAX_VALUE,outerRadius:"105%"},this.init(t,e)}init(t,e){this.chart=e,this.background=[],e.pane.push(this),this.setOptions(t)}setOptions(t){this.options=t=merge(this.defaultOptions,this.chart.angular?{background:{}}:void 0,t)}render(){let t=this.options,e=this.options.background,r=this.chart.renderer,o,i;if(this.group||(this.group=r.g("pane-group").attr({zIndex:t.zIndex||0}).add()),this.updateCenter(),e)for(e=splat(e),o=Math.max(e.length,this.background.length||0),i=0;i<o;i++)e[i]&&this.axis?this.renderBackground(merge(this.defaultBackgroundOptions,e[i]),i):this.background[i]&&(this.background[i]=this.background[i].destroy(),this.background.splice(i,1))}renderBackground(t,e){let r="animate",o={class:"highcharts-pane "+(t.className||"")};this.chart.styledMode||extend(o,{fill:t.backgroundColor,stroke:t.borderColor,"stroke-width":t.borderWidth}),this.background[e]||(this.background[e]=this.chart.renderer.path().add(this.group),r="attr"),this.background[e][r]({d:this.axis.getPlotBandPath(t.from,t.to,t)}).attr(o)}updateCenter(t){this.center=(t||this.axis||{}).center=CU.getCenter.call(this)}update(t,e){merge(!0,this.options,t),this.setOptions(this.options),this.render(),this.chart.axes.forEach(function(t){t.pane===this&&(t.pane=null,t.update({},e))},this)}}function isInsidePane(t,e,r,o,i){let n=!0;var a=r[0],s=r[1],h=Math.sqrt(Math.pow(t-a,2)+Math.pow(e-s,2));return defined(o)&&defined(i)&&(e=Math.atan2(correctFloat(e-s,8),correctFloat(t-a,8)),i!==o&&(n=i<o?o<=e&&e<=Math.PI||e<=i&&e>=-Math.PI:o<=e&&e<=correctFloat(i,8))),h<=Math.ceil(r[2]/2)&&n}Chart.prototype.getHoverPane=function(e){const r=this;let o;return e&&r.pane.forEach(t=>{isInsidePane(e.chartX-r.plotLeft,e.chartY-r.plotTop,t.center)&&(o=t)}),o},addEvent(Chart,"afterIsInsidePlot",function(e){this.polar&&(e.options.inverted&&([e.x,e.y]=[e.y,e.x]),e.isInsidePlot=this.pane.some(t=>isInsidePane(e.x,e.y,t.center,t.axis&&t.axis.normalizedStartAngleRad,t.axis&&t.axis.normalizedEndAngleRad)))}),addEvent(Pointer,"beforeGetHoverData",function(e){const r=this.chart;r.polar?(r.hoverPane=r.getHoverPane(e),e.filter=function(t){return t.visible&&!(!e.shared&&t.directTouch)&&pick(t.options.enableMouseTracking,!0)&&(!r.hoverPane||t.xAxis.pane===r.hoverPane)}):r.hoverPane=void 0}),addEvent(Pointer,"afterGetHoverData",function(t){var e=this.chart;t.hoverPoint&&t.hoverPoint.plotX&&t.hoverPoint.plotY&&e.hoverPane&&!isInsidePane(t.hoverPoint.plotX,t.hoverPoint.plotY,e.hoverPane.center)&&(t.hoverPoint=void 0)});export default H.Pane=Pane;