"use strict";import H from"../parts/Globals.js";import LegendSymbolMixin from"../mixins/legend-symbol.js";import SVGRenderer from"../parts/SVGRenderer.js";import U from"../parts/Utilities.js";var clamp=U.clamp,extend=U.extend,fireEvent=U.fireEvent,isNumber=U.isNumber,merge=U.merge,pick=U.pick,seriesType=U.seriesType;import"../parts/Options.js";import"../parts/Series.js";import"./ColorMapSeriesMixin.js";var colorMapPointMixin=H.colorMapPointMixin,colorMapSeriesMixin=H.colorMapSeriesMixin,noop=H.noop,Series=H.Series,seriesTypes=H.seriesTypes,symbols=SVGRenderer.prototype.symbols;seriesType("heatmap","scatter",{animation:!1,borderWidth:0,nullColor:"#f7f7f7",dataLabels:{formatter:function(){return this.point.value},inside:!0,verticalAlign:"middle",crop:!1,overflow:!1,padding:0},marker:{symbol:"rect",radius:0,lineColor:void 0,states:{hover:{lineWidthPlus:0},select:{}}},clip:!0,pointRange:null,tooltip:{pointFormat:"{point.x}, {point.y}: {point.value}<br/>"},states:{hover:{halo:!1,brightness:.2}}},merge(colorMapSeriesMixin,{pointArrayMap:["y","value"],hasPointSpecificOptions:!0,getExtremesFromAll:!0,directTouch:!0,init:function(){var t;Series.prototype.init.apply(this,arguments),(t=this.options).pointRange=pick(t.pointRange,t.colsize||1),this.yAxis.axisPointRange=t.rowsize||1,extend(symbols,{ellipse:symbols.circle,rect:symbols.square})},getSymbol:Series.prototype.getSymbol,setClip:function(t){var e=this.chart;Series.prototype.setClip.apply(this,arguments),(!1!==this.options.clip||t)&&this.markerGroup.clip((t||this.clipBox)&&this.sharedClipKey?e[this.sharedClipKey]:e.clipRect)},translate:function(){var t=(i=this.options).marker&&i.marker.symbol||"",e=symbols[t]?t:"rect",i=this.options,r=-1!==["circle","square"].indexOf(e);this.generatePoints(),this.points.forEach(function(i){var s,o,a,n=i.getCellAttributes(),l={x:Math.min(n.x1,n.x2),y:Math.min(n.y1,n.y2),width:Math.max(Math.abs(n.x2-n.x1),0),height:Math.max(Math.abs(n.y2-n.y1),0)};a=i.hasImage=0===(i.marker&&i.marker.symbol||t||"").indexOf("url"),r&&(o=Math.abs(l.width-l.height),l.x=Math.min(n.x1,n.x2)+(l.width<l.height?0:o/2),l.y=Math.min(n.y1,n.y2)+(l.width<l.height?o/2:0),l.width=l.height=Math.min(l.width,l.height)),s={plotX:(n.x1+n.x2)/2,plotY:(n.y1+n.y2)/2,clientX:(n.x1+n.x2)/2,shapeType:"path",shapeArgs:merge(!0,l,{d:symbols[e](l.x,l.y,l.width,l.height)})},a&&(i.marker={width:l.width,height:l.height}),extend(i,s)}),fireEvent(this,"afterTranslate")},pointAttribs:function(t,e){var i,r,s=Series.prototype.pointAttribs.call(this,t,e),o=this.options||{},a=this.chart.options.plotOptions||{},n=a.series||{},l=a.heatmap||{},h=o.borderColor||l.borderColor||n.borderColor,p=o.borderWidth||l.borderWidth||n.borderWidth||s["stroke-width"];return s.stroke=t&&t.marker&&t.marker.lineColor||o.marker&&o.marker.lineColor||h||this.color,s["stroke-width"]=p,e&&(r=(i=merge(o.states[e],o.marker&&o.marker.states[e],t.options.states&&t.options.states[e]||{})).brightness,s.fill=i.color||H.color(s.fill).brighten(r||0).get(),s.stroke=i.lineColor),s},markerAttribs:function(t,e){var i,r,s=t.marker||{},o=this.options.marker||{},a=t.shapeArgs||{},n=t.hasImage,l={};return n?{x:t.plotX,y:t.plotY}:(e&&(i=o.states[e]||{},r=s.states&&s.states[e]||{},[["width","x"],["height","y"]].forEach(function(t){l[t[0]]=(r[t[0]]||i[t[0]]||a[t[0]])+(r[t[0]+"Plus"]||i[t[0]+"Plus"]||0),l[t[1]]=a[t[1]]+(a[t[0]]-l[t[0]])/2})),e?l:a)},drawPoints:function(){var t=this;((this.options.marker||{}).enabled||this._hasPointMarkers)&&(Series.prototype.drawPoints.call(this),this.points.forEach(function(e){e.graphic&&e.graphic[t.chart.styledMode?"css":"animate"](t.colorAttribs(e))}))},hasData:function(){return!!this.processedXData.length},getValidPoints:function(t,e){return Series.prototype.getValidPoints.call(this,t,e,!0)},getBox:noop,drawLegendSymbol:LegendSymbolMixin.drawRectangle,alignDataLabel:seriesTypes.column.prototype.alignDataLabel,getExtremes:function(){var t=Series.prototype.getExtremes.call(this,this.valueData),e=t.dataMin,i=t.dataMax;return isNumber(e)&&(this.valueMin=e),isNumber(i)&&(this.valueMax=i),Series.prototype.getExtremes.call(this)}}),merge(colorMapPointMixin,{applyOptions:function(t,e){var i=H.Point.prototype.applyOptions.call(this,t,e);return i.formatPrefix=i.isNull||null===i.value?"null":"point",i},isValid:function(){return this.value!==1/0&&this.value!==-1/0},haloPath:function(t){if(!t)return[];var e=this.shapeArgs;return["M",e.x-t,e.y-t,"L",e.x-t,e.y+e.height+t,e.x+e.width+t,e.y+e.height+t,e.x+e.width+t,e.y-t,"Z"]},getCellAttributes:function(){var t=this.series,e=t.options,i=(e.colsize||1)/2,r=(e.rowsize||1)/2,s=t.xAxis,o=t.yAxis,a=this.options.marker||t.options.marker,n=t.pointPlacementToXValue(),l=pick(this.pointPadding,e.pointPadding,0),h={x1:clamp(Math.round(s.len-(s.translate(this.x-i,!1,!0,!1,!0,-n)||0)),-s.len,2*s.len),x2:clamp(Math.round(s.len-(s.translate(this.x+i,!1,!0,!1,!0,-n)||0)),-s.len,2*s.len),y1:clamp(Math.round(o.translate(this.y-r,!1,!0,!1,!0)||0),-o.len,2*o.len),y2:clamp(Math.round(o.translate(this.y+r,!1,!0,!1,!0)||0),-o.len,2*o.len)};return[["width","x"],["height","y"]].forEach(function(t){var e=t[0],i=t[1],r=i+"1",s=i+"2",o=Math.abs(h[r]-h[s]),n=a&&a.lineWidth||0,p=Math.abs(h[r]+h[s])/2;a[e]&&a[e]<o&&(h[r]=p-a[e]/2-n/2,h[s]=p+a[e]/2+n/2),l&&("y"===i&&(r=s,s=i+"1"),h[r]+=l,h[s]-=l)}),h}}));