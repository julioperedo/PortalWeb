"use strict";!function(t){"object"==typeof module&&module.exports?module.exports=t.default=t:"function"==typeof define&&define.amd?define("highcharts/indicators/volume-by-price",["highcharts","highcharts/modules/stock"],function(e){return t(e),t.Highcharts=e,t}):t("undefined"!=typeof Highcharts?Highcharts:void 0)}(function(e){var t=e?e._modules:{};function o(e,t,o,s){e.hasOwnProperty(t)||(e[t]=s.apply(null,o))}o(t,"indicators/volume-by-price.src.js",[t["parts/Globals.js"],t["parts/Point.js"],t["parts/Utilities.js"]],function(a,e,t){var i=t.addEvent,r=t.animObject,x=t.arrayMax,m=t.arrayMin,b=t.correctFloat,u=t.error,l=t.extend,d=t.isArray,o=t.seriesType;var V=Math.abs,s=a.noop,S=a.seriesTypes.column.prototype;o("vbp","sma",{params:{ranges:12,volumeSeriesID:"volume"},zoneLines:{enabled:!0,styles:{color:"#0A9AC9",dashStyle:"LongDash",lineWidth:1}},volumeDivision:{enabled:!0,styles:{positiveColor:"rgba(144, 237, 125, 0.8)",negativeColor:"rgba(244, 91, 91, 0.8)"}},animationLimit:1e3,enableMouseTracking:!1,pointPadding:0,zIndex:-1,crisp:!0,dataGrouping:{enabled:!1},dataLabels:{allowOverlap:!0,enabled:!0,format:"P: {point.volumePos:.2f} | N: {point.volumeNeg:.2f}",padding:0,style:{fontSize:"7px"},verticalAlign:"top"}},{nameBase:"Volume by Price",bindTo:{series:!1,eventName:"afterSetExtremes"},calculateOn:"render",markerAttribs:s,drawGraph:s,getColumnMetrics:S.getColumnMetrics,crispCol:S.crispCol,init:function(e){var t,o,s,i=this;return a.seriesTypes.sma.prototype.init.apply(i,arguments),t=i.options.params,o=i.linkedParent,s=e.get(t.volumeSeriesID),i.addCustomEvents(o,s),i},addCustomEvents:function(e,t){var o=this;function s(){o.chart.redraw(),o.setData([]),o.zoneStarts=[],o.zoneLinesSVG&&(o.zoneLinesSVG.destroy(),delete o.zoneLinesSVG)}return o.dataEventsToUnbind.push(i(e,"remove",function(){s()})),t&&o.dataEventsToUnbind.push(i(t,"remove",function(){s()})),o},animate:function(e){var t,o,s=this,i=s.chart.inverted,a=s.group,n={};!e&&a&&(t=i?"translateY":"translateX",o=i?s.yAxis.top:s.xAxis.left,a["forceAnimate:"+t]=!0,n[t]=o,a.animate(n,l(r(s.options.animation),{step:function(e,t){s.group.attr({scaleX:Math.max(.001,t.pos)})}})))},drawPoints:function(){var e=this;e.options.volumeDivision.enabled&&(e.posNegVolume(!0,!0),S.drawPoints.apply(e,arguments),e.posNegVolume(!1,!1)),S.drawPoints.apply(e,arguments)},posNegVolume:function(e,t){var o,s,i,a,n=this,r=t?["positive","negative"]:["negative","positive"],l=n.options.volumeDivision,p=n.points.length,h=[],u=[],d=0;for(e?(n.posWidths=h,n.negWidths=u):(h=n.posWidths,u=n.negWidths);d<p;d++)(a=n.points[d])[r[0]+"Graphic"]=a.graphic,a.graphic=a[r[1]+"Graphic"],e&&(o=a.shapeArgs.width,(i=(s=n.priceZones[d]).wholeVolumeData)?(h.push(o/i*s.positiveVolumeData),u.push(o/i*s.negativeVolumeData)):(h.push(0),u.push(0))),a.color=t?l.styles.positiveColor:l.styles.negativeColor,a.shapeArgs.width=t?n.posWidths[d]:n.negWidths[d],a.shapeArgs.x=t?a.shapeArgs.x:n.posWidths[d]},translate:function(){var e,t,o,s,i,a,n,r,l,p,h,u,d=this,c=d.options,m=d.chart,v=d.yAxis,g=v.min,f=d.options.zoneLines,y=d.priceZones,D=0;S.translate.apply(d),(e=d.points).length&&(l=c.pointPadding<.5?c.pointPadding:.1,t=d.volumeDataArray,o=x(t),s=m.plotWidth/2,p=m.plotTop,i=V(v.toPixels(g)-v.toPixels(g+d.rangeStep)),n=V(v.toPixels(g)-v.toPixels(g+d.rangeStep)),l&&(a=V(i*(1-2*l)),D=V((i-a)/2),i=V(a)),e.forEach(function(e,t){h=e.barX=e.plotX=0,u=e.plotY=v.toPixels(y[t].start)-p-(v.reversed?i-n:i)-D,r=b(s*y[t].wholeVolumeData/o),e.pointWidth=r,e.shapeArgs=d.crispCol.apply(d,[h,u,r,i]),e.volumeNeg=y[t].negativeVolumeData,e.volumePos=y[t].positiveVolumeData,e.volumeAll=y[t].wholeVolumeData}),f.enabled&&d.drawZones(m,v,d.zoneStarts,f.styles))},getValues:function(e,t){var o,s,i=e.processedXData,a=e.processedYData,n=this.chart,r=t.ranges,l=[],p=[],h=[];if(e.chart)if(s=n.get(t.volumeSeriesID)){if(!(o=d(a[0]))||4===a[0].length)return(this.priceZones=this.specifyZones(o,i,a,r,s)).forEach(function(e,t){l.push([e.x,e.end]),p.push(l[t][0]),h.push(l[t][1])}),{values:l,xData:p,yData:h};u("Type of "+e.name+" series is different than line, OHLC or candlestick.",!0,n)}else u("Series "+t.volumeSeriesID+" not found! Check `volumeSeriesID`.",!0,n);else u("Base series not found! In case it has been removed, add a new one.",!0,n)},specifyZones:function(e,t,o,s,i){var a,n,r=!!e&&function(e){for(var t,o=e.length,s=e[0][3],i=s,a=1;a<o;a++)(t=e[a][3])<s&&(s=t),i<t&&(i=t);return{min:s,max:i}}(o),l=r?r.min:m(o),p=r?r.max:x(o),h=this.zoneStarts=[],u=[],d=0,c=1;if(!l||!p)return this.points.length&&(this.setData([]),this.zoneStarts=[],this.zoneLinesSVG.destroy()),[];for(a=this.rangeStep=b(p-l)/s,h.push(l);d<s-1;d++)h.push(b(h[d]+a));for(h.push(p),n=h.length;c<n;c++)u.push({index:c-1,x:t[0],start:h[c-1],end:h[c]});return this.volumePerZone(e,u,i,t,o)},volumePerZone:function(t,e,o,s,i){var a,n,r,l,p,h=this,u=o.processedXData,d=o.processedYData,c=e.length-1,m=i.length,v=d.length;return V(m-v)&&(s[0]!==u[0]&&d.unshift(0),s[m-1]!==u[v-1]&&d.push(0)),h.volumeDataArray=[],e.forEach(function(e){for(e.wholeVolumeData=0,e.positiveVolumeData=0,e.negativeVolumeData=0,p=0;p<m;p++)r=n=!1,l=t?i[p][3]:i[p],a=p?t?i[p-1][3]:i[p-1]:l,l<=e.start&&0===e.index&&(n=!0),l>=e.end&&e.index===c&&(r=!0),(l>e.start||n)&&(l<e.end||r)&&(e.wholeVolumeData+=d[p],l<a?e.negativeVolumeData+=d[p]:e.positiveVolumeData+=d[p]);h.volumeDataArray.push(e.wholeVolumeData)}),e},drawZones:function(t,o,e,s){var i,a=t.renderer,n=this.zoneLinesSVG,r=[],l=t.plotWidth,p=t.plotTop;e.forEach(function(e){i=o.toPixels(e)-p,r=r.concat(t.renderer.crispLine([["M",0,i],["L",l,i]],s.lineWidth))}),n?n.animate({d:r}):n=this.zoneLinesSVG=a.path(r).attr({"stroke-width":s.lineWidth,stroke:s.color,dashstyle:s.dashStyle,zIndex:this.group.zIndex+.1}).add(this.group)}},{destroy:function(){return this.negativeGraphic&&(this.negativeGraphic=this.negativeGraphic.destroy()),e.prototype.destroy.apply(this,arguments)}})}),o(t,"masters/indicators/volume-by-price.src.js",[],function(){})});