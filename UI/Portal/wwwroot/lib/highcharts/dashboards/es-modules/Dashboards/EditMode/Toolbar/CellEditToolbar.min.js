import U from"../../../Core/Utilities.js";import EditGlobals from"../EditGlobals.js";import EditToolbar from"./EditToolbar.js";import GUIElement from"../../Layout/GUIElement.js";const{merge,fireEvent,objectEach}=U;class CellEditToolbar extends EditToolbar{static getItemsConfig(e,t){const l=[];return e.dragDrop?.enabled&&l.push({id:"drag",type:"icon",icon:t+"drag.svg",events:{onmousedown:function(e){var t=this.menu.parent;const l=t.editMode.dragDrop;l&&t.cell&&l.onDragStart(e,t.cell)}}}),e.settings?.enabled&&l.push({id:"settings",type:"icon",icon:t+"settings.svg",events:{click:function(e){this.menu.parent.editMode.setEditOverlay(),this.menu.parent.onCellOptions()}}}),l.push({id:"destroy",type:"icon",className:EditGlobals.classNames.menuDestroy,icon:t+"destroy.svg",events:{click:function(e){const t=this.menu.parent,l=this.menu.parent.editMode,o=l.confirmationPopup;o.show({confirmButton:{value:l.lang.confirmButton,callback:t.onCellDestroy,context:t},cancelButton:{value:l.lang.cancelButton,callback:()=>{o.closePopup()}},text:l.lang.confirmDestroyCell})}}}),l}constructor(e){super(e,merge(CellEditToolbar.defaultOptions,(e.options.toolbars||{}).cell,{menu:{items:CellEditToolbar.getItemsConfig(e.options,e.iconsURLPrefix)}})),this.menu.initItems({})}showToolbar(e){var t,l,o=this;e.container&&o.editMode.isActive()&&!(o.editMode.dragDrop||{}).isActive?(t=(l=GUIElement.getOffsets(e,o.editMode.board.container)).right-30-10,l=l.top+10,objectEach(o.menu.items,e=>{e.activate()}),o.setPosition(t,l),o.cell=e,o.refreshOutline()):o.isVisible&&o.hide()}refreshOutline(){var e=this;e.cell&&e.cell.container&&e.outline&&super.refreshOutline(-e.cell.container.offsetWidth,0,this.cell,-1)}onCellOptions(){var e=this;e.editMode.sidebar&&(e.editMode.sidebar.show(e.cell),this.cell&&this.cell.setHighlight())}onCellDestroy(){var e,t=this;t.cell&&(e=t.cell.row,t.resetEditedCell(),t.cell.destroy(),t.cell=void 0,t.editMode.hideToolbars(["cell","row"]),e&&e.cells&&e.cells.length&&(fireEvent(t.editMode.board,"cellResize",{cell:e.cells[0]}),fireEvent(e,"cellChange",{cell:e.cells[0],row:e})))}resetEditedCell(){this.editedCell=void 0}}CellEditToolbar.defaultOptions={enabled:!0,className:EditGlobals.classNames.editToolbar,outline:!1,outlineClassName:EditGlobals.classNames.editToolbarCellOutline,menu:{className:EditGlobals.classNames.editToolbarCell,itemsClassName:EditGlobals.classNames.editToolbarItem,items:[]}};export default CellEditToolbar;