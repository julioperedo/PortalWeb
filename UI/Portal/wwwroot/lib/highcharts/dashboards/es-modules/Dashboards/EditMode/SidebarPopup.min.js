"use strict";import AccordionMenu from"./AccordionMenu.js";import BaseForm from"../../Shared/BaseForm.js";import Bindings from"../Actions/Bindings.js";import EditGlobals from"./EditGlobals.js";import EditRenderer from"./EditRenderer.js";import GUIElement from"../Layout/GUIElement.js";import Layout from"../Layout/Layout.js";import U from"../../Core/Utilities.js";const{addEvent,createElement,merge}=U;class SidebarPopup extends BaseForm{constructor(e,t,o){super(e,t),this.isVisible=!1,this.editMode=o,this.accordionMenu=new AccordionMenu(this.iconsURL,this.hide.bind(this))}detectRightSidebar(e){var t=this.editMode.board.layoutsWrapper;return GUIElement.getOffsets(e,t).left<t.offsetWidth/2-10}removeClassNames(){const e=EditGlobals.classNames,t=this.container.classList;t.remove(e.editSidebarShow),t.remove(e.editSidebarRightShow)}addClassNames(e){const t=this.container.classList;e?t.add(EditGlobals.classNames.editSidebarRight):t.remove(EditGlobals.classNames.editSidebarRight),setTimeout(()=>{t.add(EditGlobals.classNames[e?"editSidebarRightShow":"editSidebarShow"])})}show(e){const t=this.editMode,o=!(!e||!this.detectRightSidebar(e));this.showPopup(EditGlobals.classNames.editSidebarShow),this.addClassNames(o),t.resizer&&t.resizer.disableResizer(),t.editCellContext&&t.editCellContext.row&&t.editCellContext.row.setHighlight(!0),t.hideToolbars(["cell","row"]),t.stopContextDetection(),this.isVisible=!0,this.generateContent(e)}generateContent(e){this.renderHeader(e?this.editMode.lang.settings:this.editMode.lang.addComponent,""),e?"cell"===e.getType()&&(e=e.mountedComponent)&&this.accordionMenu.renderContent(this.container,e):this.renderAddComponentsList()}renderAddComponentsList(){const a=this,l=SidebarPopup.components;let t;var o=createElement("div",{className:EditGlobals.classNames.editGridItems},{},a.container);for(let d=0,e=l.length;d<e;++d)(t=createElement("div",{},{},o)).addEventListener("mousedown",e=>{if(a.editMode.dragDrop){const r=()=>{a.hide()};a.container.addEventListener("mouseleave",r),a.editMode.dragDrop.onDragStart(e,void 0,e=>{if(0===this.editMode.board.layouts.length){const o=this.editMode.board,i=GUIElement.createElementId("layout"),n=new Layout(o,{id:i,copyId:"",parentContainerId:o.container.id,rows:[{}],style:{}});n&&o.layouts.push(n),e=n.rows[0]}const t=l[d].onDrop(a,e);if(t){const s=t.mountedComponent;s.options?.connector?.id&&s.initConnector(),a.editMode.setEditCellContext(t),a.show(t),t.setHighlight()}a.container.removeEventListener("mouseleave",r)})}}),t.innerHTML=l[d].text}onDropNewComponent(e,t){const o=this.editMode.dragDrop;if(o){const i="cell"===e.getType()?e.row:e,n=i.addCell({id:GUIElement.createElementId("col")});o.onCellDragEnd(n);e=merge(t,{cell:n.id});return Bindings.addComponent(e,n),this.editMode.setEditOverlay(),n}}hide(){const e=this.editMode,t=e.editCellContext;this.removeClassNames(),e.isEditOverlayActive&&e.setEditOverlay(!0),t&&t.row&&(e.showToolbars(["cell","row"],t),t.row.setHighlight(),t.isHighlighted&&t.setHighlight(!0)),e.isContextDetectionActive=!0,this.isVisible=!1}closeButtonEvents(){this.hide()}renderHeader(e,t){const o=EditRenderer.renderIcon(this.container,{icon:t,className:EditGlobals.classNames.editSidebarTitle});o&&(o.textContent=e)}addCloseButton(e=EditGlobals.classNames.popupCloseButton){return super.addCloseButton.call(this,e)}createPopupContainer(e,t=EditGlobals.classNames.editSidebar){return super.createPopupContainer.call(this,e,t)}}SidebarPopup.components=[{text:"HTML",onDrop:function(e,t){if(e&&t)return e.onDropNewComponent(t,{cell:"",type:"HTML",elements:[{tagName:"img",attributes:{src:"https://www.highcharts.com/samples/graphics/stock-dark.svg"}}]})}},{text:"layout",onDrop:function(e,t){if(t){const o="cell"===t.getType()?t.row:t,i=o.layout.board,n=GUIElement.createElementId("layout"),s=GUIElement.createElementId("cell"),r=new Layout(i,{id:n,copyId:"",parentContainerId:i.container.id,rows:[{cells:[{id:s}]}],style:{}});r&&i.layouts.push(r),Bindings.addComponent({type:"HTML",cell:s,elements:[{tagName:"div",style:{"text-align":"center"},textContent:"Placeholder text"}]})}}},{text:"chart",onDrop:function(t,o){if(t&&o){var i=t.editMode.board.dataPool.getConnectorIds();let e={cell:"",type:"Highcharts",chartOptions:{chart:{animation:!1,type:"column",zooming:{}}}};return i.length&&(e={...e,connector:{id:i[0]}}),t.onDropNewComponent(o,e)}}},{text:"datagrid",onDrop:function(t,o){if(t&&o){var i=t.editMode.board.dataPool.getConnectorIds();let e={cell:"",type:"DataGrid"};return i.length&&(e={...e,connector:{id:i[0]}}),t.onDropNewComponent(o,e)}}},{text:"KPI",onDrop:function(t,o){if(t&&o){var i=t.editMode.board.dataPool.getConnectorIds();let e={cell:"",type:"KPI"};return i.length&&(e={...e,connector:{id:i[0]}}),t.onDropNewComponent(o,e)}}}];export default SidebarPopup;