"use strict";import EditRenderer from"./EditRenderer.js";import U from"../../Core/Utilities.js";import EditGlobals from"./EditGlobals.js";const{createElement,merge,error}=U;class AccordionMenu{constructor(e,t){this.changedOptions={},this.chartOptionsJSON={},this.iconsURLPrefix=e,this.closeSidebar=t}renderContent(e,r){const n=this;var o,s,i=r.editableOptions.getOptions(),a=createElement("div",{className:EditGlobals.classNames.accordionMenu},{},e);for(let e=0,t=i.length;e<t;e++)o=i[e],s=EditRenderer.renderCollapseHeader(a,{name:o.name,iconsURLPrefix:n.iconsURLPrefix,lang:(r.board?.editMode||EditGlobals).lang}).content,this.renderAccordion(o,s,r);e=createElement("div",{className:EditGlobals.classNames.accordionMenuButtonsContainer},{},a);EditRenderer.renderButton(e,{text:(r.board?.editMode||EditGlobals).lang.confirmButton,className:EditGlobals.classNames.popupConfirmBtn,callback:()=>{var e=this.changedOptions;r.update(merge(e,{chartOptions:this.chartOptionsJSON})),n.changedOptions={},n.chartOptionsJSON={},n.closeSidebar()}}),EditRenderer.renderButton(e,{text:(r.board?.editMode||EditGlobals).lang.cancelButton,className:EditGlobals.classNames.popupCancelBtn,callback:()=>{n.changedOptions={},n.chartOptionsJSON={},n.closeSidebar()}})}updateOptions(t,e){var r=t.length-1;let n=this.changedOptions;if(0==r&&"chartOptions"===t[0])try{var o=JSON.parse(e);this.chartOptionsJSON=o}catch(e){error("Dashboards Error: Wrong JSON config structure passed as a chart options.")}for(let e=0;e<r;e++){var s=t[e];n[s]||(n[s]={}),n=n[s]}n[t[r]]=e}renderAccordion(t,e,r){if("nested"===t.type)return this.renderNested(e,t,r);const n=EditRenderer.getRendererFunction(t.type);n&&n(e,{...t,iconsURLPrefix:this.iconsURLPrefix,value:r.getEditableOptionValue(t.propertyPath),onchange:e=>this.updateOptions(t.propertyPath||[],e)})}renderNested(r,e,n){if(r&&e.nestedOptions){var o=e.nestedOptions;for(let e=0,t=o.length;e<t;++e){var s=o[e].name,i=o[e].options,a=!!o[e].showToggle;const c=o[e].propertyPath||[];var d=EditRenderer.renderCollapseHeader(r,{name:s,isEnabled:!!n.getEditableOptionValue(c),iconsURLPrefix:this.iconsURLPrefix,showToggle:a,onchange:e=>this.updateOptions(c,e),isNested:!0,lang:(n.board?.editMode||EditGlobals).lang});for(let e=0,t=i.length;e<t;++e)this.renderAccordion(i[e],d.content,n)}}}}export default AccordionMenu;