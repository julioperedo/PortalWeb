"use strict";import U from"../../Core/Utilities.js";const addEvent=U["addEvent"];function getModifiedTableOffset(e,t){const i=t["ranges"];if(i){t=i.reduce((e,t)=>e=t.minValue>e.minValue?t:e,i[0]),e=e.getRowIndexBy(t.column,t.minValue);if(e)return e}return 0}const configs={emitters:{highlightEmitter:["highlightEmitter",function(){if("Highcharts"===this.type){const{chart:e,board:t}=this;if(t){const s=t["dataCursor"];return this.on("afterRender",()=>{const o=this.connector&&this.connector.table;e&&e.series&&o&&e.series.forEach(i=>{i.update({point:{events:{mouseOver:function(){let e=0;var t=o.getModifier();t&&"Range"===t.options.type&&(e=getModifiedTableOffset(o,t.options)),s.emitCursor(o,{type:"position",row:e+this.index,column:i.name,state:"point.mouseOver"})},mouseOut:function(){let e=0;var t=o.getModifier();t&&"Range"===t.options.type&&(e=getModifiedTableOffset(o,t.options)),s.emitCursor(o,{type:"position",row:e+this.index,column:i.name,state:"point.mouseOut"})}}}})})}),function(){e&&e.series&&e.series.forEach(e=>{e.update({point:{events:{mouseOver:void 0,mouseOut:void 0}}})})}}}}],seriesVisibilityEmitter:function(){if("Highcharts"===this.type){const n=this;return this.on("afterRender",()=>{var{chart:e,connector:t,board:i}=n;const o=t&&t.table;if(o&&i&&e){const s=i["dataCursor"],r=e["series"];r.forEach(e=>{e.update({events:{show:function(){s.emitCursor(o,{type:"position",state:"series.show",column:this.name})},hide:function(){s.emitCursor(o,{type:"position",state:"series.hide",column:this.name})}}})})}})}},extremesEmitter:function(){if("Highcharts"===this.type){const n=this,d=[];return this.on("afterRender",()=>{const{chart:e,connector:t,board:i}=n,a=t&&t.table,c=i["dataCursor"];if(a&&e){const o=e=>{var t=!!e.resetSelection;if((!e.trigger||e.trigger&&"dashboards-sync"!==e.trigger)&&!t){const o=e.target;t=o.series.filter(e=>a.hasColumns([e.name]));const[s]=t.length?t:o.series;if(s){var i=s.points.filter(e=>e.isInside||!1);const r={type:"position",state:o.coll+".extremes.min"},n={type:"position",state:o.coll+".extremes.max"};t.length&&"xAxis"===o.coll&&i.length&&(t=o.dateTime&&a.hasColumns(["x"])?"x":s.name,r.row=i[0].index,r.column=t,n.row=i[i.length-1].index,n.column=t),c.emitCursor(a,r,e,!0).emitCursor(a,n,e,!0)}}},s=()=>e.axes.map(e=>addEvent(e,"afterSetExtremes",o));let t=s();const r=()=>{t.forEach(e=>{e()}),t=[]};d.push(addEvent(e,"selection",e=>{e.resetSelection&&(r(),c.emitCursor(a,{type:"position",state:"chart.zoomOut"},e),t.push(...s()))})),d.push(()=>{c.remitCursor(a.id,{type:"position",state:"xAxis.extremes.min"}),c.remitCursor(a.id,{type:"position",state:"xAxis.extremes.max"}),r()})}}),function(){d.forEach(e=>e())}}}},handlers:{seriesVisibilityHandler:function(){const o=this,i=this["board"],s=(e,t)=>{for(const i of e)if(i.name===t)return i},r=e=>{var t=o.chart;if(t&&"position"===e.cursor.type&&void 0!==e.cursor.column){const i=s(t.series,e.cursor.column);i&&i.setVisible(!0,!0)}},n=e=>{var t=o.chart;if(t&&"position"===e.cursor.type&&void 0!==e.cursor.column){const i=s(t.series,e.cursor.column);i&&i.setVisible(!1,!0)}},e=()=>{const e=i["dataCursor"];var t;!e||(t=this.connector&&this.connector.table)&&(e.addListener(t.id,"series.show",r),e.addListener(t.id,"series.hide",n))},t=()=>{var e=this.connector&&this.connector.table;e&&(i.dataCursor.removeListener(e.id,"series.show",r),i.dataCursor.removeListener(e.id,"series.hide",n))};i&&(e(),this.on("setConnector",()=>t()),this.on("afterSetConnector",()=>e()))},highlightHandler:function(){const{chart:r,board:i}=this,o=t=>{const i=this.connector&&this.connector.table;if(i){let e=0;var o=i.getModifier();if(o&&"Range"===o.options.type&&(e=getModifiedTableOffset(i,o.options)),r&&r.series.length){const s=t.cursor;"position"===s.type&&([o]=1<r.series.length&&s.column?r.series.filter(e=>e.name===s.column):r.series,o&&o.visible&&void 0!==s.row&&((t=o.points[s.row-e])&&r.tooltip&&r.tooltip.refresh(t)))}}},s=()=>{r&&r.series.length&&r.tooltip&&r.tooltip.hide()},e=()=>{const e=i["dataCursor"];var t;e&&(t=this.connector&&this.connector.table)&&(e.addListener(t.id,"point.mouseOver",o),e.addListener(t.id,"dataGrid.hoverRow",o),e.addListener(t.id,"point.mouseOut",s),e.addListener(t.id,"dataGrid.hoverOut",s))},t=()=>{var e=this.connector&&this.connector.table;e&&(i.dataCursor.removeListener(e.id,"point.mouseOver",o),i.dataCursor.removeListener(e.id,"dataGrid.hoverRow",o),i.dataCursor.removeListener(e.id,"point.mouseOut",s),i.dataCursor.removeListener(e.id,"dataGrid.hoverOut",s))};i&&(e(),this.on("setConnector",()=>t()),this.on("afterSetConnector",()=>e()))},extremesHandler:function(){const{chart:a,board:c}=this;if(a&&c&&a.zooming?.type){const e=a.zooming.type.split("").map(e=>e+"Axis");e.forEach(s=>{const r=[],n=e=>{var{cursor:e,event:t}=e;if("position"===e.type){const i=t&&t.target;if(i&&a){const o=a[s];let t=!1;o.forEach(e=>{i.coll!==e.coll||i===e||null===i.min||null===i.max||e.max===i.max&&e.min===i.min||(e.setExtremes(i.min,i.max,!1,void 0,{trigger:"dashboards-sync"}),t=!0)}),t&&!a.resetZoomButton&&a.showResetZoom(),a.redraw()}}},e=()=>{const e=c["dataCursor"];var t=this["connector"];if(t){const i=t["table"],o=(e.addListener(i.id,s+".extremes.min",n),e.addListener(i.id,s+".extremes.max",n),()=>{a.zoomOut(),setTimeout(()=>{const e=this.element.querySelectorAll(".highcharts-reset-zoom");e.forEach(e=>{e.remove()})})});e.addListener(i.id,"chart.zoomOut",o),r.push(()=>{e.removeListener(i.id,s+".extremes.min",n),e.removeListener(i.id,s+".extremes.max",n),e.removeListener(i.id,"chart.zoomOut",o)})}};c&&(e(),this.on("setConnector",()=>{r.forEach(e=>e())}),this.on("afterSetConnector",()=>e()))})}}}},defaults={extremes:{emitter:configs.emitters.extremesEmitter,handler:configs.handlers.extremesHandler},highlight:{emitter:configs.emitters.highlightEmitter,handler:configs.handlers.highlightHandler},visibility:{emitter:configs.emitters.seriesVisibilityEmitter,handler:configs.handlers.seriesVisibilityHandler}};export default defaults;