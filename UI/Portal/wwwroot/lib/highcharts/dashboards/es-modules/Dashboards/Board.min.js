"use strict";import Bindings from"./Actions/Bindings.js";import ComponentRegistry from"./Components/ComponentRegistry.js";import DashboardsAccessibility from"./Accessibility/DashboardsAccessibility.js";import DataCursor from"../Data/DataCursor.js";import DataCursorHelper from"./SerializeHelper/DataCursorHelper.js";import DataPool from"../Data/DataPool.js";import EditMode from"./EditMode/EditMode.js";import Fullscreen from"./EditMode/Fullscreen.js";import Globals from"./Globals.js";import Layout from"./Layout/Layout.js";import Serializable from"./Serializable.js";import U from"../Core/Utilities.js";import HTMLComponent from"./Components/HTMLComponent.js";const{merge,addEvent,error,objectEach,uniqueKey,createElement}=U;class Board{static board(t,o,e){return new Board(t,o).init(e)}constructor(t,o){this.boardWrapper=void 0,this.container=void 0,this.options=merge(Board.defaultOptions,o),this.dataPool=new DataPool(o.dataPool),this.id=uniqueKey(),this.guiEnabled=(this.options.gui||{}).enabled,this.layouts=[],this.mountedComponents=[],this.initContainer(t),this.layoutsWrapper=createElement("div",{className:Globals.classNames.layoutsWrapper},{},this.container),!EditMode||this.options.editMode&&!this.options.editMode.enabled||(this.editMode=new EditMode(this,this.options.editMode)),this.dataCursor=new DataCursor,this.fullscreen=new Fullscreen(this),this.index=Globals.boards.length,Globals.boards.push(this),this.a11y=new DashboardsAccessibility(this)}init(t){var o=this.options,o=(o.gui&&this.options.gui&&this.setLayouts(this.options.gui),o.layoutsJSON&&!this.layouts.length&&this.setLayoutsFromJSON(o.layoutsJSON),o.components?this.setComponents(o.components):[]);return this.initEvents(),t?Promise.all(o).then(()=>this):this}initEvents(){const t=this,o=()=>{t.reflow()};var e;"function"==typeof ResizeObserver?(this.resizeObserver=new ResizeObserver(o),this.resizeObserver.observe(t.container)):(e=addEvent(window,"resize",o),addEvent(this,"destroy",e))}initContainer(t){(t="string"==typeof t?window.document.getElementById(t):t)||error(13,!0),t.innerHTML="",this.boardWrapper=t,this.container=createElement("div",{className:Globals.classNames.boardContainer},{},this.boardWrapper)}setLayouts(e){var s=e.layouts;for(let t=0,o=s.length;t<o;++t)this.layouts.push(new Layout(this,merge({},e.layoutOptions,s[t])))}setLayoutsFromJSON(e){var s;for(let t=0,o=e.length;t<o;++t)(s=Layout.fromJSON(e[t],this))&&this.layouts.push(s)}setComponents(e){const s=[];for(let t=0,o=e.length;t<o;++t)s.push(Bindings.addComponent(e[t]));return s}getLayoutContainerSize(){var t=this.options.responsiveBreakpoints,o=(this.layoutsWrapper||{}).clientWidth;let e=Globals.responsiveBreakpoints.large;return t&&(o<=t.small?e=Globals.responsiveBreakpoints.small:o>t.small&&o<=t.medium&&(e=Globals.responsiveBreakpoints.medium)),e}destroy(){const e=this;for(let t=0,o=e.layouts.length;t<o;++t)e.layouts[t].destroy();this.resizeObserver?.unobserve(e.container),e.container.remove(),objectEach(e,function(t,o){delete e[o]}),Globals.boards[this.index]=void 0}exportLocal(){localStorage.setItem(Globals.classNamePrefix+"1",JSON.stringify(this.toJSON()))}importLayoutLocal(t){return Layout.importLocal(t,this)}reflow(){var e=this,s=e.getLayoutContainerSize();e.editMode&&(e.editMode.hideToolbars(["cell","row"]),e.editMode.hideContextPointer());for(let t=0,o=e.layouts.length;t<o;++t)this.reflowLayout(e.layouts[t],s)}reflowLayout(s,i){let r,n;for(let e=0,t=s.rows.length;e<t;++e)for(let t=0,o=(r=s.rows[e]).cells.length;t<o;++t)(n=r.cells[t]).reflow(i),n.nestedLayout&&this.reflowLayout(n.nestedLayout,i)}fromJSON(t){const o=t.options,e=new Board(o.containerId,{componentOptions:o.componentOptions,responsiveBreakpoints:o.responsiveBreakpoints,dataPool:o.dataPool,layoutsJSON:o.layouts});return e.dataCursor=DataCursorHelper.fromJSON(t.dataCursor),e}toJSON(){const e=this,s=[];for(let t=0,o=e.layouts.length;t<o;++t)s.push(e.layouts[t].toJSON());return{$class:"Board",dataCursor:DataCursorHelper.toJSON(e.dataCursor),options:{containerId:e.container.id,dataPool:e.options.dataPool,guiEnabled:e.guiEnabled,layouts:s,componentOptions:e.options.componentOptions,responsiveBreakpoints:e.options.responsiveBreakpoints}}}getOptions(){const e=this,s=[],i=[];for(let t=0,o=e.layouts.length;t<o;++t)s.push(e.layouts[t].getOptions());for(let t=0,o=e.mountedComponents.length;t<o;++t)e.mountedComponents[t].cell&&e.mountedComponents[t].cell.mountedComponent&&i.push(e.mountedComponents[t].component.getOptions());return{...this.options,gui:{layouts:s},components:i}}}!function(t){t.defaultOptions={gui:{enabled:!0,layoutOptions:{rowClassName:void 0,cellClassName:void 0},layouts:[]},components:[],responsiveBreakpoints:{small:576,medium:992,large:1200}},t.componentTypes=ComponentRegistry.types,t.importLocal=function(){var t=localStorage.getItem(Globals.classNamePrefix+"1");if(t)try{return Serializable.fromJSON(JSON.parse(t))}catch(t){}}}(Board=Board||{}),Serializable.registerClassPrototype("Board",Board.prototype),ComponentRegistry.registerComponent("HTML",HTMLComponent);export default Board;