"use strict";import Serializable from"../Serializable.js";import U from"../../Core/Utilities.js";const{addEvent,fireEvent,merge}=U;class SharedComponentState{constructor(){this.columnVisibilityMap={},this.hiddenRowIndexes=[],this.selection={}}emit(e){fireEvent(this,e.type,e)}getColumnOrder(){return(this.columnOrder||[]).slice()}getColumnVisibility(e){return this.columnVisibilityMap[e]}getColumnSorter(){const t=(this.columnOrder||[]).slice();return t.length?(e,i)=>{e=t.indexOf(e),i=t.indexOf(i);return-1<e&&-1<i?e-i:-1<i?1:-1<e?-1:0}:()=>0}isSet(){return!0===this.isModified}on(e,i){return addEvent(this,e,i)}setColumnOrder(e,i){var t=this,o=(t.columnOrder||[]).slice(),e=e.slice();t.emit({type:"columnOrderChange",detail:i,newColumnOrder:e,oldColumnOrder:o}),t.columnOrder=e,t.isModified=!0,t.emit({type:"afterColumnOrderChange",detail:i,newColumnOrder:e,oldColumnOrder:o})}setColumnVisibility(e,i){this.columnVisibilityMap=merge(this.columnVisibilityMap,e),this.emit({type:"afterColumnVisibilityChange",visibilityMap:this.columnVisibilityMap,detail:i})}setHiddenRows(e,i=!0){e.forEach(e=>{-1===this.hiddenRowIndexes.indexOf(e)&&i&&this.hiddenRowIndexes.push(e),-1<this.hiddenRowIndexes.indexOf(e)&&!i&&this.hiddenRowIndexes.splice(this.hiddenRowIndexes.indexOf(e),1)}),this.emit({type:"afterSetHiddenRows",hiddenRows:this.hiddenRowIndexes})}getHiddenRows(){return this.hiddenRowIndexes}setHoverPoint(e,i){var t=i&&i.isDataGrid;this.hoverPoint=t?void 0:e,e instanceof HTMLElement&&(this.hoverRow=t?e:void 0),this.emit({type:"afterHoverPointChange",hoverPoint:t?void 0:this.hoverPoint,hoverRow:t?this.hoverRow:void 0,detail:i})}getHoverPoint(){return this.hoverPoint}getSelection(){return this.selection}setSelection(i,e=!1,t){const o=Object.keys(i);o.forEach(e=>{this.selection[e]=i[e]}),this.emit({type:"afterSelectionChange",selection:this.selection,reset:e,detail:t})}fromJSON(e){const i=new SharedComponentState;var{columnOrder:e,visibilityMap:t,selection:o,hoverpoint:n}=e;return e&&i.setColumnOrder(e),t&&i.setColumnVisibility(t),o&&i.setSelection(o),n&&i.setHoverPoint(n),i}toJSON(){const e={$class:"Dashboards.SharedComponentState"};var i,t,o;return this.columnOrder&&(e.columnOrder=this.columnOrder.slice()),this.hoverPoint&&({x:i,y:t,id:o}=this.hoverPoint,e.hoverPoint={x:i,y:t,id:o}),this.selection&&(e.selection=this.selection),this.columnVisibilityMap&&(e.columnVisibility=this.columnVisibilityMap),e}}Serializable.registerClassPrototype("Dashboards.SharedComponentState",SharedComponentState.prototype);export default SharedComponentState;