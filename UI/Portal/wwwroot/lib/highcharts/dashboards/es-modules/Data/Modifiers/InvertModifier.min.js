"use strict";import DataModifier from"./DataModifier.js";import U from"../../Core/Utilities.js";const merge=U["merge"];class InvertModifier extends DataModifier{constructor(e){super(),this.options=merge(InvertModifier.defaultOptions,e)}modifyCell(e,t,o,l,i){const n=e.modified,s=n.getRowIndexBy("columnNames",t);return void 0===s?n.setColumns(this.modifyTable(e.clone()).getColumns(),void 0,i):n.setCell(""+o,s,l,i),e}modifyColumns(e,n,s,m){const r=e.modified,o=r.getColumn("columnNames")||[];let f=e.getColumnNames(),l=e.getRowCount()!==o.length;if(!l)for(let e=0,t=f.length;e<t;++e)if(f[e]!==o[e]){l=!0;break}if(l)return this.modifyTable(e,m);for(let e=0,t=(f=Object.keys(n)).length,l,o,i;e<t;++e){l=n[o=f[e]],i=r.getRowIndexBy("columnNames",o)||r.getRowCount();for(let e=0,t=s,o=l.length;e<o;++e,++t)r.setCell(""+t,i,l[e],m)}return e}modifyRows(e,i,n,s){const m=e.getColumnNames(),r=e.modified,o=r.getColumn("columnNames")||[];let l=e.getRowCount()!==o.length;if(!l)for(let e=0,t=m.length;e<t;++e)if(m[e]!==o[e]){l=!0;break}if(l)return this.modifyTable(e,s);for(let e=0,o=n,t=i.length,l;e<t;++e,++o)if((l=i[e])instanceof Array)r.setColumn(""+o,l);else for(let e=0,t=m.length;e<t;++e)r.setCell(""+o,e,l[m[e]],s);return e}modifyTable(l,e){this.emit({type:"modify",detail:e,table:l});const t=l.modified;if(l.hasColumns(["columnNames"])){const i=((l.deleteColumns(["columnNames"])||{}).columnNames||[]).map(e=>""+e),n={};for(let e=0,t=l.getRowCount(),o;e<t;++e)(o=l.getRow(e))&&(n[i[e]]=o);t.deleteColumns(),t.setColumns(n)}else{const s={};for(let e=0,t=l.getRowCount(),o;e<t;++e)(o=l.getRow(e))&&(s[""+e]=o);s.columnNames=l.getColumnNames(),t.deleteColumns(),t.setColumns(s)}return this.emit({type:"afterModify",detail:e,table:l}),l}}InvertModifier.defaultOptions={type:"Invert"},DataModifier.registerType("Invert",InvertModifier);export default InvertModifier;