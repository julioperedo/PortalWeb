!function(t){"object"==typeof module&&module.exports?module.exports=t.default=t:"function"==typeof define&&define.amd?define("dashboards/modules/math-modifier",["dashboards"],function(e){return t(e),t.Dashboards=e,t}):t("undefined"!=typeof Dashboards?Dashboards:void 0)}(function(e){"use strict";e=e?e._modules:{};function t(e,t,r,n){e.hasOwnProperty(t)||(e[t]=n.apply(null,r),"function"==typeof CustomEvent&&window.dispatchEvent(new CustomEvent("DashboardsModuleLoaded",{detail:{path:t,module:e[t]}})))}t(e,"Data/Formula/FormulaParser.js",[],function(){const F=/^(?:FALSE|TRUE)/,p=/^[+-]?\d+(?:\.\d+)?(?:e[+-]\d+)?/,b=/^[+-]?\d+(?:,\d+)?(?:e[+-]\d+)?/,h=/^([A-Z][A-Z\d\.]*)\(/,d=/^(?:[+\-*\/^<=>]|<=|=>)/,c=/^(\$?[A-Z]+)(\$?\d+)\:(\$?[A-Z]+)(\$?\d+)/,l=/^R(\d*|\[\d+\])C(\d*|\[\d+\])\:R(\d*|\[\d+\])C(\d*|\[\d+\])/,N=/^(\$?[A-Z]+)(\$?\d+)(?![\:C])/,y=/^R(\d*|\[\d+\])C(\d*|\[\d+\])(?!\:)/;function j(o){let s=0;for(let e=0,t=o.length,r,n=1;e<t;++e)if("("===(r=o[e]))s||(n=e+1),++s;else if(")"===r&&!--s)return o.substring(n,e);if(0<s){const e=new Error("Incomplete parantheses.");throw e.name="FormulaParseError",e}return""}function D(o){let s=-1;for(let e=0,t=o.length,r,n=!1;e<t;++e)if("\\"===(r=o[e]))n=!n;else if(n)n=!1;else if('"'===r){if(!(s<0))return o.substring(s+1,e);s=e}const e=new Error("Incomplete string.");throw e.name="FormulaParseError",e}function A(e,t){let r;if(r=e.match(l)){var n=""===r[2]||"["===r[2][0],o=""===r[1]||"["===r[1][0],s=""===r[4]||"["===r[4][0],a=""===r[3]||"["===r[3][0];const u={type:"range",beginColumn:n?parseInt(r[2].substring(1,-1)||"0",10):parseInt(r[2],10)-1,beginRow:o?parseInt(r[1].substring(1,-1)||"0",10):parseInt(r[1],10)-1,endColumn:s?parseInt(r[4].substring(1,-1)||"0",10):parseInt(r[4],10)-1,endRow:a?parseInt(r[3].substring(1,-1)||"0",10):parseInt(r[3],10)-1};return n&&(u.beginColumnRelative=!0),o&&(u.beginRowRelative=!0),s&&(u.endColumnRelative=!0),a&&(u.endRowRelative=!0),u}if(r=e.match(c)){n="$"!==r[1][0],o="$"!==r[2][0],s="$"!==r[3][0],a="$"!==r[4][0];const i={type:"range",beginColumn:R(n?r[1]:r[1].substring(1))-1,beginRow:parseInt(o?r[2]:r[2].substring(1),10)-1,endColumn:R(s?r[3]:r[3].substring(1))-1,endRow:parseInt(a?r[4]:r[4].substring(1),10)-1};return n&&(i.beginColumnRelative=!0),o&&(i.beginRowRelative=!0),s&&(i.endColumnRelative=!0),a&&(i.endRowRelative=!0),i}n=w(e,t);return 1===n.length&&"string"!=typeof n[0]?n[0]:n}function w(e,t){const r=t?b:p,n=[];let o,s=("="===e[0]?e.substring(1):e).trim();for(;s;)if(o=s.match(y)){var a=""===o[2]||"["===o[2][0],u=""===o[1]||"["===o[1][0];const c={type:"reference",column:a?parseInt(o[2].substring(1,-1)||"0",10):parseInt(o[2],10)-1,row:u?parseInt(o[1].substring(1,-1)||"0",10):parseInt(o[1],10)-1};a&&(c.columnRelative=!0),u&&(c.rowRelative=!0),n.push(c),s=s.substring(o[0].length).trim()}else if(o=s.match(N)){a="$"!==o[1][0],u="$"!==o[2][0];const l={type:"reference",column:R(a?o[1]:o[1].substring(1))-1,row:parseInt(u?o[2]:o[2].substring(1),10)-1};a&&(l.columnRelative=!0),u&&(l.rowRelative=!0),n.push(l),s=s.substring(o[0].length).trim()}else if(o=s.match(d))n.push(o[0]),s=s.substring(o[0].length).trim();else if(o=s.match(F))n.push("TRUE"===o[0]),s=s.substring(o[0].length).trim();else if(o=s.match(r))n.push(parseFloat(o[0])),s=s.substring(o[0].length).trim();else if('"'===s[0]){const f=D(s);n.push(f.substring(1,-1)),s=s.substring(f.length+2).trim()}else{if(!(o=s.match(h))){if("("===s[0]){var i=j(s);if(i){n.push(w(i,t)),s=s.substring(i.length+2).trim();continue}}const m=e.length-s.length,g=new Error("Unexpected character `"+e.substring(m,1+m)+"` at position "+(1+m)+". (`..."+e.substring(m-5,6+m)+"...`)");throw g.name="FormulaParseError",g}i=j(s=s.substring(o[1].length).trim());n.push({type:"function",name:o[1],args:function(n,o){const s=[],a=o?";":",";let u=0,i="";for(let e=0,t=n.length,r;e<t;++e){var c;(r=n[e])===a&&!u&&i?(s.push(A(i,o)),i=""):'"'!==r||u||i?" "!==r&&(i+=r,"("===r?++u:")"===r&&--u):(c=D(n.substring(e)),s.push(c),e+=c.length+1)}return!u&&i&&s.push(A(i,o)),s}(i,t)}),s=s.substring(i.length+2).trim()}return n}function R(o){let s=0;for(let e=0,t=o.length,r,n=o.length-1;e<t;++e)65<=(r=o.charCodeAt(e))&&r<=90&&(s+=(r-64)*Math.pow(26,n)),--n;return s}return{parseFormula:w}}),t(e,"Data/Formula/FormulaTypes.js",[],function(){const t=["+","-","*","/","^","=","<","<=",">",">="];return{isFormula:function(e){return e instanceof Array},isFunction:function(e){return"object"==typeof e&&!(e instanceof Array)&&"function"===e.type},isOperator:function(e){return"string"==typeof e&&0<=t.indexOf(e)},isRange:function(e){return"object"==typeof e&&!(e instanceof Array)&&"range"===e.type},isReference:function(e){return"object"==typeof e&&!(e instanceof Array)&&"reference"===e.type},isValue:function(e){return"boolean"==typeof e||"number"==typeof e||"string"==typeof e}}}),t(e,"Data/Formula/FormulaProcessor.js",[e["Data/Formula/FormulaTypes.js"]],function(e){const{isFormula:l,isFunction:f,isOperator:m,isRange:u,isReference:g,isValue:F}=e,t=/ */,r=Number.MAX_VALUE/1.000000000001,n=Number.MAX_VALUE/1.000000000002,o=Number.MAX_VALUE,p={"^":3,"*":2,"/":2,"+":1,"-":1,"=":0,"<":0,"<=":0,">":0,">=":0},s={},a=/^[A-Z][A-Z\.]*$/;function i(e){switch(typeof e){case"boolean":return e?o:r;case"string":return n;case"number":return e;default:return NaN}}function c(e){return"string"==typeof e?e.toLowerCase().replace(t,"\0"):e}function b(e){switch(typeof e){case"boolean":return e?1:0;case"string":return parseFloat(e.replace(",","."));case"number":return e;default:return NaN}}function h(e,t,r){switch(e){case"=":return c(t)===c(r);case"<":return typeof t==typeof r?c(t)<c(r):i(t)<i(r);case"<=":return typeof t==typeof r?c(t)<=c(r):i(t)<=i(r);case">":return typeof t==typeof r?c(t)>c(r):i(t)>i(r);case">=":return typeof t==typeof r?c(t)>=c(r):i(t)>=i(r)}t=b(t),r=b(r);let n;switch(e){case"+":n=t+r;break;case"-":n=t-r;break;case"*":n=t*r;break;case"/":n=t/r;break;case"^":n=Math.pow(t,r);break;default:return NaN}return n%1?Math.round(1e9*n)/1e9:n}function d(e,t){return F(e)?e:u(e)?t&&N(e,t)||[]:f(e)?D(e,t):j(l(e)?e:[e],t)}function N(o,s){const a=s.getColumnNames().slice(o.beginColumn,o.endColumn+1),u=[];for(let r=0,e=a.length,n;r<e;++r){var i=s.getColumn(a[r],!0)||[];for(let e=o.beginRow,t=o.endRow+1;e<t;++e)"string"==typeof(n=i[e])&&"="===n[0]&&s!==s.modified&&(n=s.modified.getCell(a[r],e)),u.push(F(n)?n:NaN)}return u}function y(e,t){var r,n=t.getColumnNames()[e.column];return n?"string"==typeof(r=t.getCell(n,e.row))&&"="===r[0]&&t!==t.modified?(t=t.modified.getCell(n,e.row),F(t)?t:NaN):F(r)?r:NaN:NaN}function j(a,u){let i;for(let e=0,t=a.length,r,n,o,s;e<t;++e)if(r=a[e],m(r))n=r;else if(F(r)?s=r:l(r)?s=j(a,u):f(r)?(o=D(r,u),s=F(o)?o:NaN):g(r)&&(s=u&&y(r,u)),void 0!==s){if(void 0===i)i=n?h(n,0,s):s;else{if(!n)return NaN;var c=a[e+1];m(c)&&p[c]>p[n]&&(s=h(c,s,j(a.slice(e+2))),e=t),i=h(n,i,s)}n=void 0,s=void 0}return F(i)?i:NaN}function D(e,t){const r=s[e.name];if(r)try{return r(e.args,t)}catch{return NaN}const n=new Error(`Function "${e.name}" not found.`);throw n.name="FormulaProcessError",n}return{asNumber:b,getArgumentValue:d,getArgumentsValues:function(r,n){const o=[];for(let e=0,t=r.length;e<t;++e)o.push(d(r[e],n));return o},getRangeValues:N,getReferenceValue:y,processFormula:j,processorFunctions:s,registerProcessorFunction:function(e,t){return a.test(e)&&!s[e]&&!!(s[e]=t)},translateReferences:function n(o,s=0,a=0){for(let e=0,t=o.length,r;e<t;++e)(r=o[e])instanceof Array?n(r,s,a):f(r)?n(r.args,s,a):u(r)?(r.beginColumnRelative&&(r.beginColumn+=s),r.beginRowRelative&&(r.beginRow+=a),r.endColumnRelative&&(r.endColumn+=s),r.endRowRelative&&(r.endRow+=a)):g(r)&&(r.columnRelative&&(r.column+=s),r.rowRelative&&(r.row+=a));return o}}}),t(e,"Data/Formula/Functions/ABS.js",[e["Data/Formula/FormulaProcessor.js"]],function(e){const r=e["getArgumentValue"];function t(e,t){var n=r(e[0],t);switch(typeof n){case"number":return Math.abs(n);case"object":{const o=[];for(let e=0,t=n.length,r;e<t;++e){if("number"!=typeof(r=n[e]))return NaN;o.push(Math.abs(r))}return o}default:return NaN}}return e.registerProcessorFunction("ABS",t),t}),t(e,"Data/Formula/Functions/AND.js",[e["Data/Formula/FormulaProcessor.js"]],function(e){const s=e["getArgumentValue"];function a(n,o){for(let e=0,t=n.length,r;e<t;++e)if(!(r=s(n[e],o))||"object"==typeof r&&!a(r,o))return!1;return!0}return e.registerProcessorFunction("AND",a),a}),t(e,"Data/Formula/Functions/AVERAGE.js",[e["Data/Formula/FormulaProcessor.js"]],function(e){const n=e["getArgumentsValues"];function t(e,t){var r=n(e,t);let o=0,s=0;for(let e=0,t=r.length,n;e<t;++e)switch(typeof(n=r[e])){case"number":isNaN(n)||(++o,s+=n);break;case"object":for(let e=0,t=n.length,r;e<t;++e)"number"!=typeof(r=n[e])||isNaN(r)||(++o,s+=r)}return o?s/o:0}return e.registerProcessorFunction("AVERAGE",t),t}),t(e,"Data/Formula/Functions/AVERAGEA.js",[e["Data/Formula/FormulaProcessor.js"]],function(e){const u=e["getArgumentValue"];function t(r,o){let s=0,a=0;for(let e=0,t=r.length,n;e<t;++e)switch(typeof(n=u(r[e],o))){case"boolean":++s,a+=n?1:0;continue;case"number":isNaN(n)||(++s,a+=n);continue;case"string":++s;continue;default:for(let e=0,t=n.length,r;e<t;++e)switch(typeof(r=n[e])){case"boolean":++s,a+=r?1:0;continue;case"number":isNaN(r)||(++s,a+=r);continue;case"string":++s;continue}continue}return s?a/s:0}return e.registerProcessorFunction("AVERAGEA",t),t}),t(e,"Data/Formula/Functions/COUNT.js",[e["Data/Formula/FormulaProcessor.js"]],function(t){function a(e,n){var o=t.getArgumentsValues(e,n);let s=0;for(let e=0,t=o.length,r;e<t;++e)switch(typeof(r=o[e])){case"number":isNaN(r)||++s;break;case"object":s+=a(r,n)}return s}return t.registerProcessorFunction("COUNT",a),a}),t(e,"Data/Formula/Functions/COUNTA.js",[e["Data/Formula/FormulaProcessor.js"]],function(t){function a(e,n){var o=t.getArgumentsValues(e,n);let s=0;for(let e=0,t=o.length,r;e<t;++e){switch(typeof(r=o[e])){case"number":if(isNaN(r))continue;break;case"object":s+=a(r,n);continue;case"string":if(r)break;continue}++s}return s}return t.registerProcessorFunction("COUNTA",a),a}),t(e,"Data/Formula/Functions/IF.js",[e["Data/Formula/FormulaProcessor.js"]],function(e){const r=e["getArgumentValue"];function t(e,t){return r(e[0],t)?r(e[1],t):r(e[2],t)}return e.registerProcessorFunction("IF",t),t}),t(e,"Data/Formula/Functions/ISNA.js",[e["Data/Formula/FormulaProcessor.js"]],function(e){const r=e["getArgumentValue"];function t(e,t){e=r(e[0],t);return"number"!=typeof e||isNaN(e)}return e.registerProcessorFunction("ISNA",t),t}),t(e,"Data/Formula/Functions/MAX.js",[e["Data/Formula/FormulaProcessor.js"]],function(e){const r=e["getArgumentsValues"];function s(e,t){var n=r(e,t);let o=Number.NEGATIVE_INFINITY;for(let e=0,t=n.length,r;e<t;++e)switch(typeof(r=n[e])){case"number":r>o&&(o=r);break;case"object":(r=s(r))>o&&(o=r)}return isFinite(o)?o:0}return e.registerProcessorFunction("MAX",s),s}),t(e,"Data/Formula/Functions/MEDIAN.js",[e["Data/Formula/FormulaProcessor.js"]],function(n){function e(e,t){const o=[],r=n.getArgumentsValues(e,t);for(let e=0,t=r.length,n;e<t;++e)switch(typeof(n=r[e])){case"number":isNaN(n)||o.push(n);break;case"object":for(let e=0,t=n.length,r;e<t;++e)"number"!=typeof(r=n[e])||isNaN(r)||o.push(r)}e=o.length;if(!e)return NaN;t=Math.floor(e/2);return e%2?o[t]:(o[t-1]+o[t])/2}return n.registerProcessorFunction("MEDIAN",e),e}),t(e,"Data/Formula/Functions/MIN.js",[e["Data/Formula/FormulaProcessor.js"]],function(e){const r=e["getArgumentsValues"];function s(e,t){var n=r(e,t);let o=Number.POSITIVE_INFINITY;for(let e=0,t=n.length,r;e<t;++e)switch(typeof(r=n[e])){case"number":r<o&&(o=r);break;case"object":(r=s(r))<o&&(o=r)}return isFinite(o)?o:0}return e.registerProcessorFunction("MIN",s),s}),t(e,"Data/Formula/Functions/MOD.js",[e["Data/Formula/FormulaProcessor.js"]],function(e){const o=e["getArgumentValue"];function t(e,t){let r=o(e[0],t),n=o(e[1],t);return"object"==typeof r&&(r=r[0]),"object"==typeof n&&(n=n[0]),"number"!=typeof r||"number"!=typeof n||0===n?NaN:r%n}return e.registerProcessorFunction("MOD",t),t}),t(e,"Data/Formula/Functions/MODE.js",[e["Data/Formula/FormulaProcessor.js"]],function(n){function r(e,t){const o={},r=n.getArgumentsValues(e,t);for(let e=0,t=r.length,n;e<t;++e)switch(typeof(n=r[e])){case"number":isNaN(n)||(o[n]=(o[n]||0)+1);break;case"object":for(let e=0,t=n.length,r;e<t;++e)"number"!=typeof(r=n[e])||isNaN(r)||(o[r]=(o[r]||0)+1)}return o}function e(e,t){var o=r(e,t),s=Object.keys(o);if(!s.length)return NaN;let a=[parseFloat(s[0])],u=o[s[0]];for(let e=1,t=s.length,r,n;e<t;++e)n=o[r=s[e]],u<n?(a=[parseFloat(r)],u=n):u===n&&a.push(parseFloat(r));return 1<u?a:NaN}function t(e,t){var s=r(e,t),a=Object.keys(s);if(!a.length)return NaN;let u=parseFloat(a[0]),i=s[a[0]];for(let e=1,t=a.length,r,n,o;e<t;++e)o=s[r=a[e]],i<o?(u=parseFloat(r),i=o):i===o&&(n=parseFloat(r),u>n&&(u=n,i=o));return 1<i?u:NaN}return n.registerProcessorFunction("MODE",t),n.registerProcessorFunction("MODE.MULT",e),n.registerProcessorFunction("MODE.SNGL",t),{MULT:e,SNGL:t}}),t(e,"Data/Formula/Functions/NOT.js",[e["Data/Formula/FormulaProcessor.js"]],function(e){const n=e["getArgumentValue"];function t(e,t){let r=n(e[0],t);switch(typeof(r="object"==typeof r?r[0]:r)){case"boolean":case"number":return!r}return NaN}return e.registerProcessorFunction("NOT",t),t}),t(e,"Data/Formula/Functions/OR.js",[e["Data/Formula/FormulaProcessor.js"]],function(e){const s=e["getArgumentValue"];function a(n,o){for(let e=0,t=n.length,r;e<t;++e)if("object"==typeof(r=s(n[e],o))){if(a(r,o))return!0}else if(r)return!0;return!1}return e.registerProcessorFunction("OR",a),a}),t(e,"Data/Formula/Functions/PRODUCT.js",[e["Data/Formula/FormulaProcessor.js"]],function(e){const t=e["getArgumentsValues"];function u(e,n){var o=t(e,n);let s=1,a=!1;for(let e=0,t=o.length,r;e<t;++e)switch(typeof(r=o[e])){case"number":isNaN(r)||(a=!0,s*=r);break;case"object":a=!0,s*=u(r,n)}return a?s:0}return e.registerProcessorFunction("PRODUCT",u),u}),t(e,"Data/Formula/Functions/SUM.js",[e["Data/Formula/FormulaProcessor.js"]],function(t){function a(e,n){var o=t.getArgumentsValues(e,n);let s=0;for(let e=0,t=o.length,r;e<t;++e)switch(typeof(r=o[e])){case"number":isNaN(r)||(s+=r);break;case"object":s+=a(r,n)}return s}return t.registerProcessorFunction("SUM",a),a}),t(e,"Data/Formula/Functions/XOR.js",[e["Data/Formula/FormulaProcessor.js"]],function(e){const a=e["getArgumentValue"];function t(r,s){for(let e=0,t=r.length,n,o;e<t;++e)switch(typeof(o=a(r[e],s))){case"boolean":case"number":if(void 0===n)n=!!o;else if(!!o!==n)return!0;break;case"object":for(let e=0,t=o.length,r;e<t;++e)switch(typeof(r=o[e])){case"boolean":case"number":if(void 0===n)n=!!r;else if(!!r!==n)return!0}}return!1}return e.registerProcessorFunction("XOR",t),t}),t(e,"Data/Formula/Formula.js",[e["Data/Formula/FormulaParser.js"],e["Data/Formula/FormulaProcessor.js"],e["Data/Formula/FormulaTypes.js"]],function(e,t,r){return{...e,...t,...r}}),t(e,"Data/Modifiers/MathModifier.js",[e["Data/Modifiers/DataModifier.js"],e["Data/Formula/FormulaParser.js"],e["Data/Formula/FormulaProcessor.js"]],function(e,c,u){class t extends e{constructor(e){super(),this.options={...t.defaultOptions,...e}}modifyTable(o,e){var s=this;s.emit({type:"modify",detail:e,table:o});const a=s.options.alternativeSeparators,n=s.options.formulaColumns||o.getColumnNames(),u=o.modified;for(let e=0,t=n.length,r;e<t;++e)r=n[e],0<=n.indexOf(r)&&u.setColumn(r,s.processColumn(o,r));var i=s.options.columnFormulas||[];for(let e=0,t=i.length,r,n;e<t;++e)r=i[e],n=c.parseFormula(r.formula,a),u.setColumn(r.column,s.processColumnFormula(n,o,r.rowStart,r.rowEnd));return s.emit({type:"afterModify",detail:e,table:o}),o}processColumn(o,e,t=0){const s=this.options.alternativeSeparators,a=(o.getColumn(e,!0)||[]).slice(0<t?t:0);for(let e=0,t=a.length,r=[],n;e<t;++e)if("string"==typeof(n=a[e])&&"="===n[0])try{r=""===n?r:c.parseFormula(n.substring(1),s),a[e]=u.processFormula(r,o)}catch{a[e]=NaN}return a}processColumnFormula(r,e,n=0,o=e.getRowCount()){n=0<=n?n:0,o=0<=o?o:e.getRowCount()+o;const s=[],a=e.modified;for(let e=0,t=o-n;e<t;++e)try{s[e]=u.processFormula(r,a)}catch{s[e]=NaN}finally{r=u.translateReferences(r,0,1)}return s}}return t.defaultOptions={type:"Math",alternativeSeparators:!1},e.registerType("Math",t),t}),t(e,"masters/modules/math-modifier.src.js",[e["Dashboards/Globals.js"],e["Data/Formula/Formula.js"]],function(e,t){const r=e;return r.Formula=t,r})});