!function(t){"object"==typeof module&&module.exports?module.exports=t.default=t:"function"==typeof define&&define.amd?define("highcharts/modules/sankey",["highcharts"],function(o){return t(o),t.Highcharts=o,t}):t("undefined"!=typeof Highcharts?Highcharts:void 0)}(function(o){"use strict";o=o?o._modules:{};function t(o,t,e,i){o.hasOwnProperty(t)||(o[t]=i.apply(null,e),"function"==typeof CustomEvent&&window.dispatchEvent(new CustomEvent("HighchartsModuleLoaded",{detail:{path:t,module:o[t]}})))}t(o,"Series/NodesComposition.js",[o["Core/Series/SeriesRegistry.js"],o["Core/Utilities.js"]],function(o,s){const{prototype:i,prototype:{pointClass:{prototype:a}}}=o["series"],{defined:n,extend:r,find:l,merge:d,pick:h}=s;var t;{o=t=t||{};const f=[];function p(){return this.data=[].concat(this.points||[],this.nodes),i.destroy.apply(this,arguments)}function c(){this.nodes&&(this.nodes.forEach(o=>{o.destroy()}),this.nodes.length=0),i.setData.apply(this,arguments)}function u(o){const t=arguments,e=this.isNode?this.linksTo.concat(this.linksFrom):[this.fromNode,this.toNode];"select"!==o&&e.forEach(o=>{o&&o.series&&(a.setState.apply(o,t),o.isNode||(o.fromNode.graphic&&a.setState.apply(o.fromNode,t),o.toNode&&o.toNode.graphic&&a.setState.apply(o.toNode,t)))}),a.setState.apply(this,t)}function m(o,t,e,i){const s=this.series.options.nodes,n=this.series.options.data,r=n&&n.length||0,l=n&&n[this.index];a.update.call(this,o,!this.isNode&&t,e,i),this.isNode&&(o=(s||[]).reduce((o,t,e)=>this.id===t.id?e:o,-1),i=d(s&&s[o]||{},n&&n[this.index]||{}),n&&(l?n[this.index]=l:n.length=r),s?0<=o?s[o]=i:s.push(i):this.series.options.nodes=[i],h(t,!0)&&this.series.chart.redraw(e))}o.compose=function(o,t){if(s.pushUnique(f,o)){const e=o.prototype;e.setNodeState=u,e.setState=u,e.update=m}if(s.pushUnique(f,t)){const i=t.prototype;i.destroy=p,i.setData=c}return t},o.createNode=function(o){const t=this.pointClass,e=(o,t)=>l(o,o=>o.id===t);let i=e(this.nodes,o),s;if(!i){s=this.options.nodes&&e(this.options.nodes,o);const n=(new t).init(this,r({className:"highcharts-node",isNode:!0,id:o,y:1},s));n.linksTo=[],n.linksFrom=[],n.getSum=function(){let t=0,e=0;return n.linksTo.forEach(o=>{t+=o.weight||0}),n.linksFrom.forEach(o=>{e+=o.weight||0}),Math.max(t,e)},n.offset=function(t,e){let i=0;for(let o=0;o<n[e].length;o++){if(n[e][o]===t)return i;i+=n[e][o].weight}},n.hasShape=function(){let t=0;return n.linksTo.forEach(o=>{o.outgoing&&t++}),!n.linksTo.length||t!==n.linksTo.length},n.index=this.nodes.push(n)-1,i=n}return i.formatPrefix="node",i.name=i.name||i.options.id||"",i.mass=h(i.options.mass,i.options.marker&&i.options.marker.radius,this.options.marker&&this.options.marker.radius,4),i},o.destroy=p,o.generatePoints=function(){const t=this.chart,e={};i.generatePoints.call(this),this.nodes||(this.nodes=[]),this.colorCounter=0,this.nodes.forEach(o=>{o.linksFrom.length=0,o.linksTo.length=0,o.level=o.options.level}),this.points.forEach(o=>{n(o.from)&&(e[o.from]||(e[o.from]=this.createNode(o.from)),e[o.from].linksFrom.push(o),o.fromNode=e[o.from],t.styledMode?o.colorIndex=h(o.options.colorIndex,e[o.from].colorIndex):o.color=o.options.color||e[o.from].color),n(o.to)&&(e[o.to]||(e[o.to]=this.createNode(o.to)),e[o.to].linksTo.push(o),o.toNode=e[o.to]),o.name=o.name||o.id},this),this.nodeLookup=e},o.setNodeState=u,o.updateNode=m}return t}),t(o,"Series/Sankey/SankeyPoint.js",[o["Core/Series/Point.js"],o["Core/Series/SeriesRegistry.js"],o["Core/Utilities.js"]],function(e,o,t){o=o.seriesTypes.column;const i=t["defined"];class s extends o.prototype.pointClass{constructor(){super(...arguments),this.className=void 0,this.fromNode=void 0,this.level=void 0,this.linkBase=void 0,this.linkColorMode=void 0,this.linksFrom=void 0,this.linksTo=void 0,this.mass=void 0,this.nodeX=void 0,this.nodeY=void 0,this.options=void 0,this.series=void 0,this.toNode=void 0}applyOptions(o,t){return e.prototype.applyOptions.call(this,o,t),i(this.options.level)&&(this.options.column=this.column=this.options.level),this}getClassName(){return(this.isNode?"highcharts-node ":"highcharts-link ")+e.prototype.getClassName.call(this)}getFromNode(){let t=-1,e;for(let o=0;o<this.linksTo.length;o++){var i=this.linksTo[o];i.fromNode.column>t&&i.fromNode!==this&&(e=i.fromNode,t=e.column)}return{fromNode:e,fromColumn:t}}setNodeColumn(){var o=this;i(o.options.column)||(0===o.linksTo.length?o.column=0:o.column=o.getFromNode().fromColumn+1)}isValid(){return this.isNode||"number"==typeof this.weight}}return s}),t(o,"Series/Sankey/SankeySeriesDefaults.js",[],function(){return{borderWidth:0,colorByPoint:!0,curveFactor:.33,dataLabels:{enabled:!0,backgroundColor:"none",crop:!1,nodeFormat:void 0,nodeFormatter:function(){return this.point.name},format:void 0,formatter:function(){},inside:!0},inactiveOtherPoints:!0,linkColorMode:"from",linkOpacity:.5,opacity:1,minLinkWidth:0,nodeAlignment:"center",nodeWidth:20,nodePadding:10,showInLegend:!1,states:{hover:{linkOpacity:1,opacity:1},inactive:{linkOpacity:.1,opacity:.1,animation:{duration:50}}},tooltip:{followPointer:!0,headerFormat:'<span style="font-size: 0.8em">{series.name}</span><br/>',pointFormat:"{point.fromNode.name} â†’ {point.toNode.name}: <b>{point.weight}</b><br/>",nodeFormat:"{point.name}: <b>{point.sum}</b><br/>"}}}),t(o,"Series/Sankey/SankeyColumnComposition.js",[o["Core/Utilities.js"]],function(o){const{defined:c,relativeLength:u}=o;var t;{(o=t=t||{}).compose=function(o,t){const e=o;return e.sankeyColumn=new i(e,t),e};class i{constructor(o,t){this.points=o,this.series=t}getTranslationFactor(o){const t=this.points,e=t.slice(),i=o.chart,s=o.options.minLinkWidth||0;let n,r=0,l,a=(i.plotSizeY||0)-(o.options.borderWidth||0)-(t.length-1)*o.nodePadding;for(;t.length;){for(r=a/t.sankeyColumn.sum(),n=!1,l=t.length;l--;)t[l].getSum()*r<s&&(t.splice(l,1),a=Math.max(0,a-s),n=!0);if(!n)break}t.length=0;for(const d of e)t.push(d);return r}top(e){const i=this.series,s=i.nodePadding,o=this.points.reduce((o,t)=>{return 0<o&&(o+=s),o+=Math.max(t.getSum()*e,i.options.minLinkWidth||0)},0);return{top:0,center:.5,bottom:1}[i.options.nodeAlignment||"center"]*((i.chart.plotSizeY||0)-o)}left(e){const i=this.series,o=i.chart,s=i.options.equalNodes,n=o.inverted?o.plotHeight:o.plotWidth,r=i.nodePadding,t=this.points.reduce((o,t)=>{return 0<o&&(o+=r),o+=s?n/t.series.nodes.length-r:Math.max(t.getSum()*e,i.options.minLinkWidth||0)},0);return((o.plotSizeX||0)-Math.round(t))/2}sum(){return this.points.reduce((o,t)=>o+t.getSum(),0)}offset(t,e){const i=this.points,s=this.series,n=s.nodePadding;let r=0,l;if(s.is("organization")&&t.hangsFrom)return{absoluteTop:t.hangsFrom.nodeY};for(let o=0;o<i.length;o++){var a=i[o].getSum(),d=Math.max(a*e,s.options.minLinkWidth||0),h=t.options[s.chart.inverted?"offsetHorizontal":"offsetVertical"],p=t.options.offset||0;if(l=a?d+n:0,i[o]===t)return{relativeTop:r+(c(h)?u(h,d):u(p,l))};r+=l}}}o.SankeyColumnAdditions=i}return t}),t(o,"Series/TreeUtilities.js",[o["Core/Color/Color.js"],o["Core/Utilities.js"]],function(y,o){const{extend:m,isArray:a,isNumber:d,isObject:h,merge:p,pick:k}=o;return{getColor:function(o,t){const e=t.index,i=t.mapOptionsToLevel,s=t.parentColor,n=t.parentColorIndex,r=t.series,l=t.colors,a=t.siblings,d=r.points,h=r.chart.options.chart;let p,c,u,m,f,g;var v;return o&&(p=d[o.i],c=i[o.level]||{},p&&c.colorByPoint&&(m=p.index%(l?l.length:h.colorCount),u=l&&l[m]),r.chart.styledMode||(f=k(p&&p.options.color,c&&c.color,u,s&&(o=s,(v=c&&c.colorVariation)&&"brightness"===v.key&&e&&a?y.parse(o).brighten(v.to*(e/a)).get():o),r.color)),g=k(p&&p.options.colorIndex,c&&c.colorIndex,m,n,t.colorIndex)),{color:f,colorIndex:g}},getLevelOptions:function(o){let t={},n,e,i,r,s,l;if(h(o))for(r=d(o.from)?o.from:1,l=o.levels,e={},n=h(o.defaults)?o.defaults:{},a(l)&&(e=l.reduce((o,t)=>{let e,i,s;return h(t)&&d(t.level)&&(s=p({},t),i=k(s.levelIsConstant,n.levelIsConstant),delete s.levelIsConstant,delete s.level,e=t.level+(i?0:r-1),h(o[e])?p(!0,o[e],s):o[e]=s),o},{})),s=d(o.to)?o.to:1,i=0;i<=s;i++)t[i]=p({},n,h(e[i])?e[i]:{});return t},setTreeValues:function i(s,n){const o=n.before,t=n.idRoot,e=n.mapIdToNode,r=e[t],l=!1!==n.levelIsConstant,a=n.points,d=a[s.i],h=d&&d.options||{},p=[];let c=0;s.levelDynamic=s.level-(l?0:r.level),s.name=k(d&&d.name,""),s.visible=t===s.id||!0===n.visible,(s="function"==typeof o?o(s,n):s).children.forEach((o,t)=>{var e=m({},n);m(e,{index:t,siblings:s.children.length,visible:s.visible}),o=i(o,e),p.push(o),o.visible&&(c+=o.val)});var u=k(h.value,c);return s.visible=0<=u&&(0<c||s.visible),s.children=p,s.childrenTotal=c,s.isLeaf=s.visible&&!c,s.val=u,s},updateRootId:function(o){let t,e;return h(o)&&(e=h(o.options)?o.options:{},t=k(o.rootNode,e.rootId,""),h(o.userOptions)&&(o.userOptions.rootId=t),o.rootNode=t),t}}}),t(o,"Series/Sankey/SankeySeries.js",[o["Core/Globals.js"],o["Series/NodesComposition.js"],o["Series/Sankey/SankeyPoint.js"],o["Series/Sankey/SankeySeriesDefaults.js"],o["Core/Series/SeriesRegistry.js"],o["Series/Sankey/SankeyColumnComposition.js"],o["Core/Color/Color.js"],o["Series/TreeUtilities.js"],o["Core/Utilities.js"]],function(o,t,e,i,s,n,d,r,l){const{column:a,line:h}=s.seriesTypes,I=d["parse"],p=r["getLevelOptions"],{clamp:u,extend:c,isObject:m,merge:f,pick:Y,relativeLength:g,stableSort:v}=l;class y extends a{constructor(){super(...arguments),this.colDistance=void 0,this.data=void 0,this.group=void 0,this.nodeLookup=void 0,this.nodePadding=void 0,this.nodes=void 0,this.nodeWidth=void 0,this.options=void 0,this.points=void 0,this.translationFactor=void 0}static getDLOptions(o){var t=m(o.optionsPoint)?o.optionsPoint.dataLabels:{},o=m(o.level)?o.level.dataLabels:{};return f({style:{}},o,t)}createNodeColumns(){const t=[];for(const o of this.nodes)o.setNodeColumn(),t[o.column]||(t[o.column]=n.compose([],this)),t[o.column].push(o);for(let o=0;o<t.length;o++)void 0===t[o]&&(t[o]=n.compose([],this));return t}order(o,t){if(void 0===o.level){o.level=t;for(const e of o.linksFrom)e.toNode&&this.order(e.toNode,t+1)}}generatePoints(){if(t.generatePoints.apply(this,arguments),this.orderNodes){for(const o of this.nodes)0===o.linksTo.length&&this.order(o,0);v(this.nodes,(o,t)=>o.level-t.level)}}getNodePadding(){let o=this.options.nodePadding||0;var t;return o=this.nodeColumns&&(t=this.nodeColumns.reduce((o,t)=>Math.max(o,t.length),0))*o>this.chart.plotSizeY?this.chart.plotSizeY/t:o}hasData(){return!!this.processedXData.length}pointAttribs(o,t){if(!o)return{};const e=this,i=(o.isNode?o:o.fromNode).level,s=e.mapOptionsToLevel[i||0]||{},n=o.options,r=s.states&&s.states[t||""]||{},l=["colorByPoint","borderColor","borderWidth","linkOpacity","opacity"].reduce((o,t)=>(o[t]=Y(r[t],n[t],s[t],e.options[t]),o),{}),a=Y(r.color,n.color,(l.colorByPoint?o:s).color);return o.isNode?{fill:a,stroke:l.borderColor,"stroke-width":l.borderWidth,opacity:l.opacity}:{fill:d.parse(a).setOpacity(l.linkOpacity).get()}}drawTracker(){a.prototype.drawTracker.call(this,this.points),a.prototype.drawTracker.call(this,this.nodes)}drawPoints(){a.prototype.drawPoints.call(this,this.points),a.prototype.drawPoints.call(this,this.nodes)}drawDataLabels(){a.prototype.drawDataLabels.call(this,this.points),a.prototype.drawDataLabels.call(this,this.nodes)}translate(){this.processedXData||this.processData(),this.generatePoints(),this.nodeColumns=this.createNodeColumns(),this.nodeWidth=g(this.options.nodeWidth,this.chart.plotSizeX);const e=this,o=this.chart,t=this.options,i=this.nodeWidth,s=this.nodeColumns;this.nodePadding=this.getNodePadding(),this.translationFactor=s.reduce((o,t)=>Math.min(o,t.sankeyColumn.getTranslationFactor(e)),1/0),this.colDistance=(o.plotSizeX-i-t.borderWidth)/Math.max(1,s.length-1),e.mapOptionsToLevel=p({from:1,levels:t.levels,to:s.length-1,defaults:{borderColor:t.borderColor,borderRadius:t.borderRadius,borderWidth:t.borderWidth,color:e.color,colorByPoint:t.colorByPoint,levelIsConstant:!0,linkColor:t.linkColor,linkLineWidth:t.linkLineWidth,linkOpacity:t.linkOpacity,states:t.states}});for(const n of s)for(const r of n)e.translateNode(r,n);for(const l of this.nodes)for(const a of l.linksFrom)(a.weight||a.isNull)&&a.to&&(e.translateLink(a),a.allowShadow=!1)}translateLink(e){var o,t,i,s,n,r,l,a,d,h,p,c,u,m,f,g,v,y,k=(o,t)=>{t=o.offset(e,t)*x;return Math.min(o.nodeY+t,o.nodeY+(o.shapeArgs&&o.shapeArgs.height||0)-M)};const C=e.fromNode,S=e.toNode,N=this.chart,b=N["inverted"],x=this.translationFactor,L=this.options,T=Y(e.linkColorMode,L.linkColorMode),P=(N.inverted?-this.colDistance:this.colDistance)*L.curveFactor,w=C.nodeX,j=S.nodeX,O=e.outgoing;let M=Math.max(e.weight*x,this.options.minLinkWidth),F=k(C,"linksFrom"),W=k(S,"linksTo"),D=this.nodeWidth,z=j>w+D;N.inverted&&(F=N.plotSizeY-F,W=(N.plotSizeY||0)-W,D=-D,M=-M,z=j<w),e.shapeType="path",e.linkBase=[F,F+M,W,W+M],z&&"number"==typeof W?e.shapeArgs={d:[["M",w+D,F],["C",w+D+P,F,j-P,W,j,W],["L",j+(O?D:0),W+M/2],["L",j,W+M],["C",j-P,W+M,w+D+P,F+M,w+D,F+M],["Z"]]}:"number"==typeof W&&(k=N.plotHeight-F-M,o=j-20-M,t=j-20,n=(s=(i=w+D)+20)+M,d=(a=(k=(l=(r=(v=F)+M)+20)+k)+20)+M,c=(p=(h=W)+M)+20,y=r-.7*M,u=a+.7*M,m=p-.7*M,f=j-.7*M,g=i+.7*M,e.shapeArgs={d:[["M",i,v],["C",g,v,n,y,n,l],["L",n,k],["C",n,u,g,d,i,d],["L",j,d],["C",f,d,o,u,o,k],["L",o,c],["C",o,m,f,h,j,h],["L",j,p],["C",t,p,t,p,t,c],["L",t,k],["C",t,a,t,a,j,a],["L",i,a],["C",s,a,s,a,s,k],["L",s,l],["C",s,r,s,r,i,r],["Z"]]}),e.dlBox={x:w+(j-w+D)/2,y:F+(W-F)/2,height:M,width:0},e.tooltipPos=N.inverted?[N.plotSizeY-e.dlBox.y-M/2,N.plotSizeX-e.dlBox.x]:[e.dlBox.x,e.dlBox.y+M/2],e.y=e.plotY=1,e.x=e.plotX=1,e.options.color||("from"===T?e.color=C.color:"to"===T?e.color=S.color:"gradient"===T&&(v=I(C.color).get(),y=I(S.color).get(),e.color={linearGradient:{x1:1,x2:0,y1:0,y2:0},stops:[[0,b?v:y],[1,b?y:v]]}))}translateNode(s,n){var o=this.translationFactor,r=this.chart,l=this.options,{borderRadius:a,borderWidth:d=0}=l,t=s.getSum(),h=Math.max(Math.round(t*o),this.options.minLinkWidth),p=Math.round(this.nodeWidth),e=Math.round(d)%2/2,c=n.sankeyColumn.offset(s,o),n=Math.floor(Y(c.absoluteTop,n.sankeyColumn.top(o)+c.relativeTop))+e,o=Math.floor(this.colDistance*s.column+d/2)+g(s.options[r.inverted?"offsetVertical":"offsetHorizontal"]||0,p)+e,c=r.inverted?r.plotSizeX-o:o;if(s.sum=t){s.shapeType="roundedRect";let o=s.nodeX=c,t=s.nodeY=n,e=s.options.width||l.width||p,i=s.options.height||l.height||h;d=u(g("object"==typeof a?a.radius:a||0,e),0,h/2);r.inverted&&(o=c-p,t=r.plotSizeY-n-h,e=s.options.height||l.height||p,i=s.options.width||l.width||h),s.dlOptions=y.getDLOptions({level:this.mapOptionsToLevel[s.level],optionsPoint:s.options}),s.plotX=1,s.plotY=1,s.tooltipPos=r.inverted?[r.plotSizeY-t-i/2,r.plotSizeX-o-e/2]:[o+e/2,t+i/2],s.shapeArgs={x:o,y:t,width:e,height:i,r:d,display:s.hasShape()?"":"none"}}else s.dlOptions={enabled:!1}}}return y.defaultOptions=f(a.defaultOptions,i),t.compose(e,y),c(y.prototype,{animate:h.prototype.animate,createNode:t.createNode,forceDL:!0,invertible:!0,isCartesian:!1,orderNodes:!0,noSharedTooltip:!0,pointArrayMap:["from","to","weight"],pointClass:e,searchPoint:o.noop}),s.registerSeriesType("sankey",y),y}),t(o,"masters/modules/sankey.src.js",[],function(){})});