!function(e){"object"==typeof module&&module.exports?module.exports=e.default=e:"function"==typeof define&&define.amd?define("highcharts/modules/geoheatmap",["highcharts"],function(t){return e(t),e.Highcharts=t,e}):e("undefined"!=typeof Highcharts?Highcharts:void 0)}(function(t){"use strict";t=t?t._modules:{};function e(t,e,i,o){t.hasOwnProperty(e)||(t[e]=o.apply(null,i),"function"==typeof CustomEvent&&window.dispatchEvent(new CustomEvent("HighchartsModuleLoaded",{detail:{path:e,module:t[e]}})))}e(t,"Series/GeoHeatmap/GeoHeatmapPoint.js",[t["Core/Utilities.js"],t["Core/Series/SeriesRegistry.js"]],function(t,e){var{pointClass:e}=e.seriesTypes["map"]["prototype"];const r=t["isNumber"];class i extends e{constructor(){super(...arguments),this.lat=void 0,this.lon=void 0,this.options=void 0,this.series=void 0}applyOptions(t,e){const i=super.applyOptions.call(this,t,e),{lat:o,lon:a}=i.options;var n,s;return r(a)&&r(o)&&({colsize:t=1,rowsize:e=1}=this.series.options,n=a-t/2,s=o-e/2,i.geometry=i.options.geometry={type:"Polygon",coordinates:[[[n,s],[n+t,s],[n+t,s+e],[n,s+e],[n,s]]]}),i}}return i}),e(t,"Series/InterpolationUtilities.js",[t["Core/Globals.js"],t["Core/Utilities.js"]],function(t,e){const o=t["doc"],{defined:a,pick:n}=e;return{colorFromPoint:function(t,e){const i=e.series.colorAxis;if(i){const o=i.toColor(t||0,e).split(")")[0].split("(")[1].split(",").map(t=>n(parseFloat(t),parseInt(t,10)));return o[3]=255*n(o[3],1),a(t)&&e.visible||(o[3]=0),o}return[0,0,0,0]},getContext:function(t){const{canvas:e,context:i}=t;return e&&i?(i.clearRect(0,0,e.width,e.height),i):(t.canvas=o.createElement("canvas"),t.context=t.canvas.getContext("2d",{willReadFrequently:!0})||void 0,t.context)}}}),e(t,"Series/GeoHeatmap/GeoHeatmapSeries.js",[t["Core/Animation/AnimationUtilities.js"],t["Series/GeoHeatmap/GeoHeatmapPoint.js"],t["Core/Globals.js"],t["Series/InterpolationUtilities.js"],t["Core/Series/SeriesRegistry.js"],t["Core/Utilities.js"]],function(t,e,i,o,a,n){const{animObject:R,stop:z}=t;t=i.noop;const{colorFromPoint:k,getContext:E}=o;var i=a["seriesTypes"]["map"];const{addEvent:s,extend:r,isNumber:M,isObject:p,merge:N,pick:F}=n;function m(t){return t-360*Math.floor((t+180)/360)}class l extends i{constructor(){super(...arguments),this.options=void 0,this.data=void 0,this.points=void 0,this.canvas=void 0,this.context=void 0,this.isDirtyCanvas=!0}update(){var t=this;t.options=N(t.options,arguments[0]),t.getInterpolation().enabled&&(t.isDirtyCanvas=!0,t.points.forEach(t=>{t.graphic&&(t.graphic.destroy(),delete t.graphic)})),super.update.apply(t,arguments)}translate(){this.getInterpolation().enabled&&this.image&&!this.isDirty&&!this.isDirtyData||super.translate.apply(this,arguments)}getInterpolation(){return p(this.options.interpolation)?this.options.interpolation:{blur:1,enabled:this.options.interpolation}}drawPoints(){const t=this,e=t.chart,i=e.mapView,o=t.options;if(t.getInterpolation().enabled&&i&&t.bounds){const m=t.context||E(t),{canvas:y,colorAxis:f,image:v,chart:e,points:x}=t,[b,w]=[F(o.colsize,1),F(o.rowsize,1)],C=i.projectedUnitsToPixels({x:t.bounds.x1,y:t.bounds.y2}),D=i.projectedUnitsToPixels({x:t.bounds.x2,y:t.bounds.y1});if(y&&m&&f&&C&&D){const j={x:C.x,y:C.y,width:D.x-C.x,height:D.y-C.y};if(t.isDirtyCanvas||t.isDirtyData||"Orthographic"===i.projection.options.name){t.isDirtyCanvas=!0;const I=y.width=1+~~(360/b),P=y.height=1+~~(180/w),U=I*P,T=new Uint8ClampedArray(4*U);t.directTouch=!1;for(let t=0;t<x.length;t++){var a=x[t],n=new Uint8ClampedArray(k(a.value,a)),{lon:a,lat:s}=a.options;M(a)&&M(s)&&T.set(n,4*(n=a,a=s,s=I,c=P,u=b,g=w,Math.ceil(s*(c-1-(a+90)/g)+(n+180)/u)))}var r=t.getInterpolation().blur,r=0===r?1:11*r,p=~~(I*r),r=~~(P*r),l=~~j.width,h=~~j.height,d=new ImageData(T,I,P),p=(y.width=p,y.height=r,m.putImageData(d,0,0),m.globalCompositeOperation="copy",m.drawImage(y,0,0,d.width,d.height,0,0,y.width,y.height),m.getImageData(0,0,y.width,y.height)),r=this.getProjectedImageData(i,l,h,p,y,j.x,j.y),d=new ImageData(r,l,h);m.globalCompositeOperation="copy",y.width=l,y.height=h,m.putImageData(d,0,0)}if(v)if(e.renderer.globalAnimation&&e.hasRendered){const A=Number(v.attr("x")),L=Number(v.attr("y")),S=Number(v.attr("width")),H=Number(v.attr("height")),O=N(R(e.renderer.globalAnimation)),G=O.step;O.step=function(){G&&G.apply(this,arguments),((t,e)=>{v.attr({x:A+(j.x-A)*e.pos,y:L+(j.y-L)*e.pos,width:S+(j.width-S)*e.pos,height:H+(j.height-H)*e.pos})}).apply(this,arguments)},v.attr(N({animator:0},t.isDirtyCanvas?{href:y.toDataURL("image/png",1)}:void 0)).animate({animator:1},O)}else z(v),v.attr(N(j,t.isDirtyCanvas?{href:y.toDataURL("image/png",1)}:void 0));else t.image=e.renderer.image(y.toDataURL("image/png",1)).attr(j).add(t.group);t.isDirtyCanvas=!1}}else super.drawPoints.apply(t,arguments);var c,u,g}getProjectedImageData(e,i,t,o,a,n,s){const r=new Uint8ClampedArray(i*t*4),p=F(e.projection.options.rotation?.[0],0),l=a.width/360,h=-1*a.height/180;let d=-1;for(let t=0;t<r.length;t+=4){var c,u=t/4%i;0==u&&d++;const g=e.pixelsToLonLat({x:n+u,y:s+d});g&&(g.lon>-180-p&&g.lon<180-p&&(g.lon=m(g.lon)),c=(u=[g.lon,g.lat])[0]*l+a.width/2,u=u[1]*h+a.height/2,0<=c&&c<=a.width&&0<=u&&u<=a.height&&(u=Math.floor(u)*a.width*4+4*Math.round(c),r[t]=o.data[u],r[t+1]=o.data[1+u],r[t+2]=o.data[2+u],r[t+3]=o.data[3+u]))}return r}searchPoint(t,e){const i=this,o=this.chart,a=o.mapView;if(a&&i.bounds&&i.image&&o.tooltip&&o.tooltip.options.enabled)if(!1===o.pointer.hasDragged&&(+i.image.attr("animator")<=.01||.99<=+i.image.attr("animator"))){var n=a.projectedUnitsToPixels({x:i.bounds.x1,y:i.bounds.y2}),s=a.projectedUnitsToPixels({x:i.bounds.x2,y:i.bounds.y1});if(o.pointer.normalize(t),t.lon&&t.lat&&n&&s&&t.chartX-o.plotLeft>n.x&&t.chartX-o.plotLeft<s.x&&t.chartY-o.plotTop>n.y&&t.chartY-o.plotTop<s.y)return this.searchKDTree({clientX:t.chartX,lon:m(t.lon),lat:t.lat},e,t)}else o.tooltip.destroy()}}return l.defaultOptions=N(i.defaultOptions,{nullColor:"transparent",tooltip:{pointFormat:"Lat: {point.lat}, Lon: {point.lon}, Value: {point.value}<br/>"},borderWidth:0,colsize:1,rowsize:1,stickyTracking:!0,interpolation:{enabled:!1,blur:1}}),s(l,"afterDataClassLegendClick",function(){this.isDirtyCanvas=!0,this.drawPoints()}),r(l.prototype,{type:"geoheatmap",applyJitter:t,pointClass:e,pointArrayMap:["lon","lat","value"],kdAxisArray:["lon","lat"]}),a.registerSeriesType("geoheatmap",l),l}),e(t,"masters/modules/geoheatmap.src.js",[],function(){})});