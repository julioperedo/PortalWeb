!function(e){"object"==typeof module&&module.exports?module.exports=e.default=e:"function"==typeof define&&define.amd?define("highcharts/modules/marker-clusters",["highcharts"],function(t){return e(t),e.Highcharts=t,e}):e("undefined"!=typeof Highcharts?Highcharts:void 0)}(function(t){function e(t,e,a,i){t.hasOwnProperty(e)||(t[e]=i.apply(null,a))}e(t=t?t._modules:{},"modules/marker-clusters.src.js",[t["parts/Chart.js"],t["parts/Globals.js"],t["parts/Options.js"],t["parts/Point.js"],t["parts/SVGRenderer.js"],t["parts/Utilities.js"]],function(t,e,a,i,s,r){function P(t){for(var e=t.length,a=0,i=0,s=0;s<e;s++)a+=t[s].x,i+=t[s].y;return{x:a/e,y:i/e}}function o(t,e){var a=[];return a.length=e,t.clusters.forEach(function(t){t.data.forEach(function(t){a[t.dataIndex]=t})}),t.noise.forEach(function(t){a[t.data[0].dataIndex]=t.data[0]}),a}function x(t,e,a,i,s){t.point&&(i&&t.point.graphic&&(t.point.graphic.show(),t.point.graphic.attr({opacity:e}).animate({opacity:1},a)),s&&t.point.dataLabel&&(t.point.dataLabel.show(),t.point.dataLabel.attr({opacity:e}).animate({opacity:1},a)))}function g(t,e,a){t.point&&(e&&t.point.graphic&&t.point.graphic.hide(),a&&t.point.dataLabel&&t.point.dataLabel.hide())}function y(t,e,a,i){x(t,i,a,!0,!0),e.forEach(function(t){t.point&&t.point.destroy&&t.point.destroy()})}a=a.defaultOptions;var C=r.addEvent,I=r.animObject,X=r.defined,k=r.error,b=r.isArray,S=r.isFunction,A=r.isObject,M=r.isNumber,D=r.merge,v=r.objectEach,Y=r.relativeLength,L=r.syncTimeout;r=e.Series;var n=e.seriesTypes.scatter,z=r.prototype.generatePoints,E=0,l=[],O={enabled:!1,allowOverlap:!0,animation:{duration:500},drillToCluster:!0,minimumClusterSize:2,layoutAlgorithm:{gridSize:50,distance:40,kmeansThreshold:100},marker:{symbol:"cluster",radius:15,lineWidth:0,lineColor:"#ffffff"},dataLabels:{enabled:!0,format:"{point.clusterPointsAmount}",verticalAlign:"middle",align:"center",style:{color:"contrast"},inside:!0}};(a.plotOptions||{}).series=D((a.plotOptions||{}).series,{cluster:O,tooltip:{clusterFormat:"<span>Clustered points: {point.clusterPointsAmount}</span><br/>"}}),s.prototype.symbols.cluster=function(t,e,a,i){a/=2,i/=2;var s=this.arc(t+a,e+i,a-4,i-4,{start:.5*Math.PI,end:2.5*Math.PI,open:!1}),r=this.arc(t+a,e+i,a-3,i-3,{start:.5*Math.PI,end:2.5*Math.PI,innerR:a-2,open:!1});return this.arc(t+a,e+i,a-1,i-1,{start:.5*Math.PI,end:2.5*Math.PI,innerR:a,open:!1}).concat(r,s)},n.prototype.animateClusterPoint=function(t){var e,a,i=this.xAxis,s=this.yAxis,r=this.chart,o=I((this.options.cluster||{}).animation),n=o.duration||500,l=(this.markerClusterInfo||{}).pointsState,p=(l||{}).newState,u=(l||{}).oldState,d=[],h=l=0,c=0,f=!1,m=!1;u&&p&&(e=p[t.stateId],h=i.toPixels(e.x)-r.plotLeft,c=s.toPixels(e.y)-r.plotTop,1===e.parentsId.length?(t=(p||{})[t.stateId].parentsId[0],a=u[t],e.point&&e.point.graphic&&a&&a.point&&a.point.plotX&&a.point.plotY&&a.point.plotX!==e.point.plotX&&a.point.plotY!==e.point.plotY&&(l=(t=e.point.graphic.getBBox()).width/2,e.point.graphic.attr({x:a.point.plotX-l,y:a.point.plotY-l}),e.point.graphic.animate({x:h-e.point.graphic.radius,y:c-e.point.graphic.radius},o,function(){m=!0,a.point&&a.point.destroy&&a.point.destroy()}),e.point.dataLabel&&e.point.dataLabel.alignAttr&&a.point.dataLabel&&a.point.dataLabel.alignAttr&&(e.point.dataLabel.attr({x:a.point.dataLabel.alignAttr.x,y:a.point.dataLabel.alignAttr.y}),e.point.dataLabel.animate({x:e.point.dataLabel.alignAttr.x,y:e.point.dataLabel.alignAttr.y},o)))):0===e.parentsId.length?(g(e,!0,!0),L(function(){x(e,.1,o,!0,!0)},n/2)):(g(e,!0,!0),e.parentsId.forEach(function(t){u&&u[t]&&(a=u[t],d.push(a),a.point&&a.point.graphic&&(f=!0,a.point.graphic.show(),a.point.graphic.animate({x:h-a.point.graphic.radius,y:c-a.point.graphic.radius,opacity:.4},o,function(){m=!0,y(e,d,o,.7)}),a.point.dataLabel&&-9999!==a.point.dataLabel.y&&e.point&&e.point.dataLabel&&e.point.dataLabel.alignAttr&&(a.point.dataLabel.show(),a.point.dataLabel.animate({x:e.point.dataLabel.alignAttr.x,y:e.point.dataLabel.alignAttr.y,opacity:.4},o))))}),L(function(){m||y(e,d,o,.85)},n),f||L(function(){y(e,d,o,.1)},n/2)))},n.prototype.getGridOffset=function(){var t=this.chart,e=this.xAxis,a=this.yAxis;return{plotLeft:e=this.dataMinX&&this.dataMaxX?e.reversed?e.toPixels(this.dataMaxX):e.toPixels(this.dataMinX):t.plotLeft,plotTop:t=this.dataMinY&&this.dataMaxY?a.reversed?a.toPixels(this.dataMinY):a.toPixels(this.dataMaxY):t.plotTop}},n.prototype.getScaledGridSize=function(t){var e=this.xAxis,a=!0,i=1,s=1;for(t=t.processedGridSize||O.layoutAlgorithm.gridSize,this.gridValueSize||(this.gridValueSize=Math.abs(e.toValue(t)-e.toValue(0))),e=+(t/(e=e.toPixels(this.gridValueSize)-e.toPixels(0))).toFixed(14);a&&1!==e;){var r=Math.pow(2,i);.75<e&&e<1.25?a=!1:1/r<=e&&e<1/r*2?(a=!1,s=r):e<=r&&r/2<e&&(a=!1,s=1/r),i++}return t/s/e},n.prototype.getRealExtremes=function(){var t=this.chart,e=this.xAxis,a=this.yAxis,i=e?e.toValue(t.plotLeft):0,e=e?e.toValue(t.plotLeft+t.plotWidth):0,s=a?a.toValue(t.plotTop):0,t=a?a.toValue(t.plotTop+t.plotHeight):0;return e<i&&(e=(i=[i,e])[0],i=i[1]),t<s&&(t=(s=[s,t])[0],s=s[1]),{minX:i,maxX:e,minY:s,maxY:t}},n.prototype.onDrillToCluster=function(t){(t.point||t.target).firePointEvent("drillToCluster",t,function(t){var e,a,i,s,r,o=t.point||t.target,n=o.series.xAxis,l=o.series.yAxis,p=o.series.chart;(o.series.options.cluster||{}).drillToCluster&&o.clusteredData&&(a=o.clusteredData.map(function(t){return t.x}).sort(function(t,e){return t-e}),s=o.clusteredData.map(function(t){return t.y}).sort(function(t,e){return t-e}),o=a[0],e=a[a.length-1],a=s[0],i=s[s.length-1],s=Math.abs(.1*(e-o)),r=Math.abs(.1*(i-a)),p.pointer.zoomX=!0,p.pointer.zoomY=!0,e<o&&(o=(e=[e,o])[0],e=e[1]),i<a&&(a=(i=[i,a])[0],i=i[1]),p.zoom({originalEvent:t,xAxis:[{axis:n,min:o-s,max:e+s}],yAxis:[{axis:l,min:a-r,max:i+r}]}))})},n.prototype.getClusterDistancesFromPoint=function(t,e,a){for(var i=this.xAxis,s=this.yAxis,r=[],o=0;o<t.length;o++){var n=Math.sqrt(Math.pow(i.toPixels(e)-i.toPixels(t[o].posX),2)+Math.pow(s.toPixels(a)-s.toPixels(t[o].posY),2));r.push({clusterIndex:o,distance:n})}return r.sort(function(t,e){return t.distance-e.distance})},n.prototype.getPointsState=function(t,e,a){e=e?o(e,a):[],a=o(t,a);var i,s={};for(l=[],t.clusters.forEach(function(t){s[t.stateId]={x:t.x,y:t.y,id:t.stateId,point:t.point,parentsId:[]}}),t.noise.forEach(function(t){s[t.stateId]={x:t.x,y:t.y,id:t.stateId,point:t.point,parentsId:[]}}),i=0;i<a.length;i++){t=a[i];var r=e[i];t&&r&&t.parentStateId&&r.parentStateId&&s[t.parentStateId]&&-1===s[t.parentStateId].parentsId.indexOf(r.parentStateId)&&(s[t.parentStateId].parentsId.push(r.parentStateId),-1===l.indexOf(r.parentStateId)&&l.push(r.parentStateId))}return s},n.prototype.markerClusterAlgorithms={grid:function(t,e,a,i){var s,r=this.xAxis,o=this.yAxis,n={},l=this.getGridOffset();for(i=this.getScaledGridSize(i),s=0;s<t.length;s++){var p=r.toPixels(t[s])-l.plotLeft,u=o.toPixels(e[s])-l.plotTop,p=Math.floor(p/i);n[u=(u=Math.floor(u/i))+"-"+p]||(n[u]=[]),n[u].push({dataIndex:a[s],x:t[s],y:e[s]})}return n},kmeans:function(t,e,a,i){var s,r=[],o=[],n={},l=i.processedDistance||O.layoutAlgorithm.distance,p=i.iterations,u=0,d=!0,h=0,c=0,f=[];for(s in i.processedGridSize=i.processedDistance,h=this.markerClusterAlgorithms?this.markerClusterAlgorithms.grid.call(this,t,e,a,i):{})1<h[s].length&&(f=P(h[s]),r.push({posX:f.x,posY:f.y,oldX:0,oldY:0,startPointsLen:h[s].length,points:[]}));for(;d;){for(r.map(function(t){return t.points.length=0,t}),d=o.length=0;d<t.length;d++)h=t[d],c=e[d],(f=this.getClusterDistancesFromPoint(r,h,c)).length&&f[0].distance<l?r[f[0].clusterIndex].points.push({x:h,y:c,dataIndex:a[d]}):o.push({x:h,y:c,dataIndex:a[d]});for(s=0;s<r.length;s++)1===r[s].points.length&&((f=this.getClusterDistancesFromPoint(r,r[s].points[0].x,r[s].points[0].y))[1].distance<l&&(r[f[1].clusterIndex].points.push(r[s].points[0]),r[f[0].clusterIndex].points.length=0));for(d=!1,s=0;s<r.length;s++)f=P(r[s].points),r[s].oldX=r[s].posX,r[s].oldY=r[s].posY,r[s].posX=f.x,r[s].posY=f.y,(r[s].posX>r[s].oldX+1||r[s].posX<r[s].oldX-1||r[s].posY>r[s].oldY+1||r[s].posY<r[s].oldY-1)&&(d=!0);p&&(d=u<p-1),u++}return r.forEach(function(t,e){n["cluster"+e]=t.points}),o.forEach(function(t,e){n["noise"+e]=[t]}),n},optimizedKmeans:function(t,e,a,i){var s,r,o=this.xAxis,n=this.yAxis,l=i.processedDistance||O.layoutAlgorithm.gridSize,p={},u=this.getRealExtremes(),d=(this.options.cluster||{}).marker;return!this.markerClusterInfo||this.initMaxX&&this.initMaxX<u.maxX||this.initMinX&&this.initMinX>u.minX||this.initMaxY&&this.initMaxY<u.maxY||this.initMinY&&this.initMinY>u.minY?(this.initMaxX=u.maxX,this.initMinX=u.minX,this.initMaxY=u.maxY,this.initMinY=u.minY,p=this.markerClusterAlgorithms?this.markerClusterAlgorithms.kmeans.call(this,t,e,a,i):{},this.baseClusters=null):(this.baseClusters||(this.baseClusters={clusters:this.markerClusterInfo.clusters,noise:this.markerClusterInfo.noise}),this.baseClusters.clusters.forEach(function(a){a.pointsOutside=[],a.pointsInside=[],a.data.forEach(function(t){s=Math.sqrt(Math.pow(o.toPixels(t.x)-o.toPixels(a.x),2)+Math.pow(n.toPixels(t.y)-n.toPixels(a.y),2)),(r=a.clusterZone&&a.clusterZone.marker&&a.clusterZone.marker.radius?a.clusterZone.marker.radius:d&&d.radius?d.radius:O.marker.radius)+(0<=l-r?l-r:r)<s&&X(a.pointsOutside)?a.pointsOutside.push(t):X(a.pointsInside)&&a.pointsInside.push(t)}),a.pointsInside.length&&(p[a.id]=a.pointsInside),a.pointsOutside.forEach(function(t,e){p[a.id+"_noise"+e]=[t]})}),this.baseClusters.noise.forEach(function(t){p[t.id]=t.data})),p}},n.prototype.preventClusterCollisions=function(t){var a,i,s,r,o,n,l,p=this.xAxis,u=this.yAxis,d=(e=t.key.split("-").map(parseFloat))[0],h=e[1],c=t.gridSize,f=t.groupedData,m=t.defaultRadius,x=t.clusterRadius,g=h*c,y=d*c,C=p.toPixels(t.x),I=u.toPixels(t.y),e=[],k=0,b=0,S=(this.options.cluster||{}).marker,A=(this.options.cluster||{}).zones,M=this.getGridOffset();for(C-=M.plotLeft,I-=M.plotTop,s=1;s<5;s++){var D=s%2?-1:1,v=s<3?-1:1,D=Math.floor((C+D*x)/c);for(D=[(v=Math.floor((I+v*x)/c))+"-"+D,v+"-"+h,d+"-"+D],v=0;v<D.length;v++)-1===e.indexOf(D[v])&&D[v]!==t.key&&e.push(D[v])}return e.forEach(function(t){if(f[t]){f[t].posX||(n=P(f[t]),f[t].posX=n.x,f[t].posY=n.y),a=p.toPixels(f[t].posX||0)-M.plotLeft,i=u.toPixels(f[t].posY||0)-M.plotTop;var e=t.split("-").map(parseFloat);if(o=e[0],r=e[1],A)for(k=f[t].length,s=0;s<A.length;s++)k>=A[s].from&&k<=A[s].to&&(b=X((A[s].marker||{}).radius)?A[s].marker.radius||0:S&&S.radius?S.radius:O.marker.radius);1<f[t].length&&0===b&&S&&S.radius?b=S.radius:1===f[t].length&&(b=m),l=x+b,b=0,r!==h&&Math.abs(C-a)<l&&(C=r-h<0?g+x:g+c-x),o!==d&&Math.abs(I-i)<l&&(I=o-d<0?y+x:y+c-x)}}),e=p.toValue(C+M.plotLeft),v=u.toValue(I+M.plotTop),{x:f[t.key].posX=e,y:f[t.key].posY=v}},n.prototype.isValidGroupedDataObject=function(t){var e,a=!1;return!!A(t)&&(v(t,function(t){if(a=!0,b(t)&&t.length){for(e=0;e<t.length;e++)if(!A(t[e])||!t[e].x||!t[e].y){a=!1;break}}else a=!1}),a)},n.prototype.getClusteredData=function(t,e){var a,i=[],s=[],r=[],o=[],n=[],l=0,p=Math.max(2,e.minimumClusterSize||2);if(S(e.layoutAlgorithm.type)&&!this.isValidGroupedDataObject(t))return k("Highcharts marker-clusters module: The custom algorithm result is not valid!",!1,this.chart),!1;for(a in t)if(t[a].length>=p){var u,d,h,c=t[a],f=Math.random().toString(36).substring(2,7)+"-"+E++,m=c.length;if(e.zones)for(g=0;g<e.zones.length;g++){m>=e.zones[g].from&&m<=e.zones[g].to&&((u=e.zones[g]).zoneIndex=g,d=e.zones[g].marker,h=e.zones[g].className)}for(var x=P(c),x="grid"!==e.layoutAlgorithm.type||e.allowOverlap?{x:x.x,y:x.y}:(g=this.options.marker||{},this.preventClusterCollisions({x:x.x,y:x.y,key:a,groupedData:t,gridSize:this.getScaledGridSize(e.layoutAlgorithm),defaultRadius:g.radius||3+(g.lineWidth||0),clusterRadius:d&&d.radius?d.radius:(e.marker||{}).radius||O.marker.radius})),g=0;g<m;g++)c[g].parentStateId=f;if(r.push({x:x.x,y:x.y,id:a,stateId:f,index:l,data:c,clusterZone:u,clusterZoneClassName:h}),i.push(x.x),s.push(x.y),n.push({options:{formatPrefix:"cluster",dataLabels:e.dataLabels,marker:D(e.marker,{states:e.states},d||{})}}),this.options.data&&this.options.data.length)for(g=0;g<m;g++)A(this.options.data[c[g].dataIndex])&&(c[g].options=this.options.data[c[g].dataIndex]);l++,d=null}else for(g=0;g<t[a].length;g++)c=t[a][g],f=Math.random().toString(36).substring(2,7)+"-"+E++,m=((this.options||{}).data||[])[c.dataIndex],i.push(c.x),s.push(c.y),c.parentStateId=f,o.push({x:c.x,y:c.y,id:a,stateId:f,index:l,data:t[a]}),f=m&&"object"==typeof m&&!b(m)?D(m,{x:c.x,y:c.y}):{userOptions:m,x:c.x,y:c.y},n.push({options:f}),l++;return{clusters:r,noise:o,groupedXData:i,groupedYData:s,groupMap:n}},n.prototype.destroyClusteredData=function(){(this.markerClusterSeriesData||[]).forEach(function(t){t&&t.destroy&&t.destroy()}),this.markerClusterSeriesData=null},n.prototype.hideClusteredData=function(){var t=this.markerClusterSeriesData,e=((this.markerClusterInfo||{}).pointsState||{}).oldState||{},a=l.map(function(t){return(e[t].point||{}).id||""});(t||[]).forEach(function(t){t&&-1!==a.indexOf(t.id)?(t.graphic&&t.graphic.hide(),t.dataLabel&&t.dataLabel.hide()):t&&t.destroy&&t.destroy()})},n.prototype.generatePoints=function(){var t,e,a,i,s,r=this,o=r.chart,n=r.xAxis,l=r.yAxis,p=r.options.cluster,u=r.getRealExtremes(),d=[],h=[],c=[];if(p&&p.enabled&&r.xData&&r.yData&&!o.polar){var f,m,x=p.layoutAlgorithm.type,g=p.layoutAlgorithm;for(g.processedGridSize=Y(g.gridSize||O.layoutAlgorithm.gridSize,o.plotWidth),g.processedDistance=Y(g.distance||O.layoutAlgorithm.distance,o.plotWidth),o=g.kmeansThreshold||O.layoutAlgorithm.kmeansThreshold,n=Math.abs(n.toValue(g.processedGridSize/2)-n.toValue(0)),l=Math.abs(l.toValue(g.processedGridSize/2)-l.toValue(0)),i=0;i<r.xData.length;i++){r.dataMaxX||(X(f)&&X(t)&&X(m)&&X(e)?M(r.yData[i])&&M(m)&&M(e)&&(f=Math.max(r.xData[i],f),t=Math.min(r.xData[i],t),m=Math.max(r.yData[i]||m,m),e=Math.min(r.yData[i]||e,e)):(f=t=r.xData[i],m=e=r.yData[i])),r.xData[i]>=u.minX-n&&r.xData[i]<=u.maxX+n&&(r.yData[i]||u.minY)>=u.minY-l&&(r.yData[i]||u.maxY)<=u.maxY+l&&(d.push(r.xData[i]),h.push(r.yData[i]),c.push(i))}X(f)&&X(t)&&M(m)&&M(e)&&(r.dataMaxX=f,r.dataMinX=t,r.dataMaxY=m,r.dataMinY=e),g=(d=(u=S(x)?x:r.markerClusterAlgorithms?x&&r.markerClusterAlgorithms[x]?r.markerClusterAlgorithms[x]:d.length<o?r.markerClusterAlgorithms.kmeans:r.markerClusterAlgorithms.grid:function(){return!1}).call(this,d,h,c,g))?r.getClusteredData(d,p):d,d=p.animation&&r.markerClusterInfo&&r.markerClusterInfo.pointsState&&r.markerClusterInfo.pointsState.oldState?((s=r.markerClusterInfo.pointsState.oldState)&&v(s,function(t){t.point&&t.point.destroy&&t.point.destroy()}),r.markerClusterInfo.pointsState.newState):{},h=r.xData.length,c=r.markerClusterInfo,g&&(r.processedXData=g.groupedXData,r.processedYData=g.groupedYData,r.hasGroupedData=!0,r.markerClusterInfo=g,r.groupMap=g.groupMap),z.apply(this),g&&r.markerClusterInfo&&((r.markerClusterInfo.clusters||[]).forEach(function(t){(a=r.points[t.index]).isCluster=!0,a.clusteredData=t.data,a.clusterPointsAmount=t.data.length,t.point=a,C(a,"click",r.onDrillToCluster)}),(r.markerClusterInfo.noise||[]).forEach(function(t){t.point=r.points[t.index]}),p.animation&&r.markerClusterInfo&&(r.markerClusterInfo.pointsState={oldState:d,newState:r.getPointsState(g,c,h)}),p.animation?this.hideClusteredData():this.destroyClusteredData(),this.markerClusterSeriesData=this.hasGroupedData?this.points:null)}else z.apply(this)},C(t,"render",function(){(this.series||[]).forEach(function(e){var t;e.markerClusterInfo&&(t=((e.markerClusterInfo||{}).pointsState||{}).oldState,(e.options.cluster||{}).animation&&e.markerClusterInfo&&0===e.chart.pointer.pinchDown.length&&"pan"!==(e.xAxis.eventArgs||{}).trigger&&t&&Object.keys(t).length&&(e.markerClusterInfo.clusters.forEach(function(t){e.animateClusterPoint(t)}),e.markerClusterInfo.noise.forEach(function(t){e.animateClusterPoint(t)})))})}),C(i,"update",function(){if(this.dataGroup)return k("Highcharts marker-clusters module: Running `Point.update` when point belongs to clustered series is not supported.",!1,this.series.chart),!1}),C(r,"destroy",n.prototype.destroyClusteredData),C(r,"afterRender",function(){var e=(this.options.cluster||{}).drillToCluster;this.markerClusterInfo&&this.markerClusterInfo.clusters&&this.markerClusterInfo.clusters.forEach(function(t){t.point&&t.point.graphic&&(t.point.graphic.addClass("highcharts-cluster-point"),e&&t.point&&(t.point.graphic.css({cursor:"pointer"}),t.point.dataLabel&&t.point.dataLabel.css({cursor:"pointer"})),X(t.clusterZone)&&t.point.graphic.addClass(t.clusterZoneClassName||"highcharts-cluster-zone-"+t.clusterZone.zoneIndex))})}),C(i,"drillToCluster",function(t){var e=(((t.point||t.target).series.options.cluster||{}).events||{}).drillToCluster;S(e)&&e.call(this,t)}),C(e.Axis,"setExtremes",function(){var e,t=this.chart,a=0;t.series.forEach(function(t){t.markerClusterInfo&&(e=I((t.options.cluster||{}).animation),a=e.duration||0)}),L(function(){t.tooltip&&t.tooltip.destroy()},a)})}),e(t,"masters/modules/marker-clusters.src.js",[],function(){})});