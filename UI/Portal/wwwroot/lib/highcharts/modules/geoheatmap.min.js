!function(e){"object"==typeof module&&module.exports?module.exports=e.default=e:"function"==typeof define&&define.amd?define("highcharts/modules/geoheatmap",["highcharts"],function(t){return e(t),e.Highcharts=t,e}):e("undefined"!=typeof Highcharts?Highcharts:void 0)}(function(t){"use strict";t=t?t._modules:{};function e(t,e,i,o){t.hasOwnProperty(e)||(t[e]=o.apply(null,i),"function"==typeof CustomEvent&&window.dispatchEvent(new CustomEvent("HighchartsModuleLoaded",{detail:{path:e,module:t[e]}})))}e(t,"Series/GeoHeatmap/GeoHeatmapPoint.js",[t["Core/Utilities.js"],t["Core/Series/SeriesRegistry.js"]],function(t,e){let{prototype:{pointClass:i}}=e.seriesTypes["map"],r=t["isNumber"];return class extends i{constructor(){super(...arguments),this.lat=void 0,this.lon=void 0,this.options=void 0,this.series=void 0}applyOptions(t,e){let i=super.applyOptions.call(this,t,e),{lat:o,lon:a}=i.options;var s,n;return r(a)&&r(o)&&({colsize:t=1,rowsize:e=1}=this.series.options,s=a-t/2,n=o-e/2,i.geometry=i.options.geometry={type:"Polygon",coordinates:[[[s,n],[s+t,n],[s+t,n+e],[s,n+e],[s,n]]]}),i}}}),e(t,"Series/InterpolationUtilities.js",[t["Core/Globals.js"],t["Core/Utilities.js"]],function(t,e){let o=t["doc"],{defined:a,pick:s}=e;return{colorFromPoint:function(e,i){let o=i.series.colorAxis;if(o){let t=o.toColor(e||0,i).split(")")[0].split("(")[1].split(",").map(t=>s(parseFloat(t),parseInt(t,10)));return t[3]=255*s(t[3],1),a(e)&&i.visible||(t[3]=0),t}return[0,0,0,0]},getContext:function(t){let{canvas:e,context:i}=t;return e&&i?(i.clearRect(0,0,e.width,e.height),i):(t.canvas=o.createElement("canvas"),t.context=t.canvas.getContext("2d",{willReadFrequently:!0})||void 0,t.context)}}}),e(t,"Series/GeoHeatmap/GeoHeatmapSeries.js",[t["Core/Animation/AnimationUtilities.js"],t["Series/GeoHeatmap/GeoHeatmapPoint.js"],t["Core/Globals.js"],t["Series/InterpolationUtilities.js"],t["Core/Series/SeriesRegistry.js"],t["Core/Utilities.js"]],function(t,e,i,o,a,s){let{animObject:w,stop:C}=t,n=i["noop"],{colorFromPoint:D,getContext:j}=o,{map:r}=a["seriesTypes"],{addEvent:l,extend:h,isNumber:I,isObject:p,merge:P,pick:U}=s;function m(t){return t-360*Math.floor((t+180)/360)}class d extends r{constructor(){super(...arguments),this.options=void 0,this.data=void 0,this.points=void 0,this.canvas=void 0,this.context=void 0,this.isDirtyCanvas=!0}update(){this.options=P(this.options,arguments[0]),this.getInterpolation().enabled&&(this.isDirtyCanvas=!0,this.points.forEach(t=>{t.graphic&&(t.graphic.destroy(),delete t.graphic)})),super.update.apply(this,arguments)}translate(){this.getInterpolation().enabled&&this.image&&!this.isDirty&&!this.isDirtyData||super.translate.apply(this,arguments)}getInterpolation(){return p(this.options.interpolation)?this.options.interpolation:{blur:1,enabled:this.options.interpolation}}drawPoints(){let t=this.chart,c=t.mapView,o=this.options;if(this.getInterpolation().enabled&&c&&this.bounds){let a=this.context||j(this),{canvas:r,colorAxis:t,image:l,chart:h,points:s}=this,[p,d]=[U(o.colsize,1),U(o.rowsize,1)],e=c.projectedUnitsToPixels({x:this.bounds.x1,y:this.bounds.y2}),i=c.projectedUnitsToPixels({x:this.bounds.x2,y:this.bounds.y1});if(r&&a&&t&&e&&i){let n={x:e.x,y:e.y,width:i.x-e.x,height:i.y-e.y};if(this.isDirtyCanvas||this.isDirtyData||"Orthographic"===c.projection.options.name){this.isDirtyCanvas=!0;let e=r.width=1+~~(360/p),i=r.height=1+~~(180/d),t=e*i,o=new Uint8ClampedArray(4*t);this.directTouch=!1;for(let t=0;t<s.length;t++){var u=s[t],g=new Uint8ClampedArray(D(u.value,u)),{lon:u,lat:m}=u.options;I(u)&&I(m)&&o.set(g,4*Math.ceil(e*(i-1-(m+90)/d)+(u+180)/p))}var y=this.getInterpolation().blur,y=0===y?1:11*y,f=~~(e*y),y=~~(i*y),v=~~n.width,x=~~n.height,b=new ImageData(o,e,i),f=(r.width=f,r.height=y,a.putImageData(b,0,0),a.globalCompositeOperation="copy",a.drawImage(r,0,0,b.width,b.height,0,0,r.width,r.height),a.getImageData(0,0,r.width,r.height)),y=this.getProjectedImageData(c,v,x,f,r,n.x,n.y),b=new ImageData(y,v,x);a.globalCompositeOperation="copy",r.width=v,r.height=x,a.putImageData(b,0,0)}if(l)if(h.renderer.globalAnimation&&h.hasRendered){let i=Number(l.attr("x")),o=Number(l.attr("y")),a=Number(l.attr("width")),s=Number(l.attr("height")),t=P(w(h.renderer.globalAnimation)),e=t.step;t.step=function(){e&&e.apply(this,arguments),((t,e)=>{l.attr({x:i+(n.x-i)*e.pos,y:o+(n.y-o)*e.pos,width:a+(n.width-a)*e.pos,height:s+(n.height-s)*e.pos})}).apply(this,arguments)},l.attr(P({animator:0},this.isDirtyCanvas?{href:r.toDataURL("image/png",1)}:void 0)).animate({animator:1},t)}else C(l),l.attr(P(n,this.isDirtyCanvas?{href:r.toDataURL("image/png",1)}:void 0));else this.image=h.renderer.image(r.toDataURL("image/png",1)).attr(n).add(this.group);this.isDirtyCanvas=!1}}else super.drawPoints.apply(this,arguments)}getProjectedImageData(i,o,t,a,s,n,r){let l=new Uint8ClampedArray(o*t*4),h=U(i.projection.options.rotation?.[0],0),p=s.width/360,d=-1*s.height/180,c=-1;for(let e=0;e<l.length;e+=4){var u,g=e/4%o;0==g&&c++;let t=i.pixelsToLonLat({x:n+g,y:r+c});t&&(t.lon>-180-h&&t.lon<180-h&&(t.lon=m(t.lon)),u=(g=[t.lon,t.lat])[0]*p+s.width/2,g=g[1]*d+s.height/2,0<=u&&u<=s.width&&0<=g&&g<=s.height&&(g=Math.floor(g)*s.width*4+4*Math.round(u),l[e]=a.data[g],l[e+1]=a.data[1+g],l[e+2]=a.data[2+g],l[e+3]=a.data[3+g]))}return l}searchPoint(t,e){let i=this.chart,o=i.mapView;if(o&&this.bounds&&this.image&&i.tooltip&&i.tooltip.options.enabled)if(!1===i.pointer.hasDragged&&(+this.image.attr("animator")<=.01||.99<=+this.image.attr("animator"))){var a=o.projectedUnitsToPixels({x:this.bounds.x1,y:this.bounds.y2}),s=o.projectedUnitsToPixels({x:this.bounds.x2,y:this.bounds.y1});if(i.pointer.normalize(t),t.lon&&t.lat&&a&&s&&t.chartX-i.plotLeft>a.x&&t.chartX-i.plotLeft<s.x&&t.chartY-i.plotTop>a.y&&t.chartY-i.plotTop<s.y)return this.searchKDTree({clientX:t.chartX,lon:m(t.lon),lat:t.lat},e,t)}else i.tooltip.destroy()}}return d.defaultOptions=P(r.defaultOptions,{nullColor:"transparent",tooltip:{pointFormat:"Lat: {point.lat}, Lon: {point.lon}, Value: {point.value}<br/>"},borderWidth:0,colsize:1,rowsize:1,stickyTracking:!0,interpolation:{enabled:!1,blur:1}}),l(d,"afterDataClassLegendClick",function(){this.isDirtyCanvas=!0,this.drawPoints()}),h(d.prototype,{type:"geoheatmap",applyJitter:n,pointClass:e,pointArrayMap:["lon","lat","value"],kdAxisArray:["lon","lat"]}),a.registerSeriesType("geoheatmap",d),d}),e(t,"masters/modules/geoheatmap.src.js",[],function(){})});