!function(o){"object"==typeof module&&module.exports?module.exports=o.default=o:"function"==typeof define&&define.amd?define("highcharts/modules/sankey",["highcharts"],function(t){return o(t),o.Highcharts=t,o}):o("undefined"!=typeof Highcharts?Highcharts:void 0)}(function(t){function o(t,o,e,i){t.hasOwnProperty(o)||(t[o]=i.apply(null,e))}o(t=t?t._modules:{},"mixins/nodes.js",[t["parts/Globals.js"],t["parts/Point.js"],t["parts/Utilities.js"]],function(t,i,o){var n=o.defined,s=o.extend,r=o.find,a=o.pick;t.NodesMixin={createNode:function(t){function o(t,o){return r(t,function(t){return t.id===o})}var e,n=o(this.nodes,t),i=this.pointClass;return n||(e=this.options.nodes&&o(this.options.nodes,t),(n=(new i).init(this,s({className:"highcharts-node",isNode:!0,id:t,y:1},e))).linksTo=[],n.linksFrom=[],n.formatPrefix="node",n.name=n.name||n.options.id||"",n.mass=a(n.options.mass,n.options.marker&&n.options.marker.radius,this.options.marker&&this.options.marker.radius,4),n.getSum=function(){var o=0,e=0;return n.linksTo.forEach(function(t){o+=t.weight}),n.linksFrom.forEach(function(t){e+=t.weight}),Math.max(o,e)},n.offset=function(t,o){for(var e=0,i=0;i<n[o].length;i++){if(n[o][i]===t)return e;e+=n[o][i].weight}},n.hasShape=function(){var o=0;return n.linksTo.forEach(function(t){t.outgoing&&o++}),!n.linksTo.length||o!==n.linksTo.length},this.nodes.push(n)),n},generatePoints:function(){var o=this.chart,e={};t.Series.prototype.generatePoints.call(this),this.nodes||(this.nodes=[]),this.colorCounter=0,this.nodes.forEach(function(t){t.linksFrom.length=0,t.linksTo.length=0,t.level=t.options.level}),this.points.forEach(function(t){n(t.from)&&(e[t.from]||(e[t.from]=this.createNode(t.from)),e[t.from].linksFrom.push(t),t.fromNode=e[t.from],o.styledMode?t.colorIndex=a(t.options.colorIndex,e[t.from].colorIndex):t.color=t.options.color||e[t.from].color),n(t.to)&&(e[t.to]||(e[t.to]=this.createNode(t.to)),e[t.to].linksTo.push(t),t.toNode=e[t.to]),t.name=t.name||t.id},this),this.nodeLookup=e},setData:function(){this.nodes&&(this.nodes.forEach(function(t){t.destroy()}),this.nodes.length=0),t.Series.prototype.setData.apply(this,arguments)},destroy:function(){return this.data=[].concat(this.points||[],this.nodes),t.Series.prototype.destroy.apply(this,arguments)},setNodeState:function(t){var o=arguments,e=this.isNode?this.linksTo.concat(this.linksFrom):[this.fromNode,this.toNode];"select"!==t&&e.forEach(function(t){t&&t.series&&(i.prototype.setState.apply(t,o),t.isNode||(t.fromNode.graphic&&i.prototype.setState.apply(t.fromNode,o),t.toNode&&t.toNode.graphic&&i.prototype.setState.apply(t.toNode,o)))}),i.prototype.setState.apply(this,o)}}}),o(t,"mixins/tree-series.js",[t["parts/Color.js"],t["parts/Utilities.js"]],function(m,t){var d=t.extend,r=t.isArray,a=t.isNumber,l=t.isObject,h=t.merge,g=t.pick;return{getColor:function(t,o){var e,i,n,s,r=o.index,a=o.mapOptionsToLevel,l=o.parentColor,h=o.parentColorIndex,d=o.series,c=o.colors,p=o.siblings,u=d.points,f=d.chart.options.chart;return t&&(u=u[t.i],t=a[t.level]||{},(a=u&&t.colorByPoint)&&(i=u.index%(c?c.length:f.colorCount),n=c&&c[i]),d.chart.styledMode||(c=u&&u.options.color,f=t&&t.color,(e=l)&&(e=(e=t&&t.colorVariation)&&"brightness"===e.key?m.parse(l).brighten(r/p*e.to).get():l),e=g(c,f,n,e,d.color)),s=g(u&&u.options.colorIndex,t&&t.colorIndex,i,h,o.colorIndex)),{color:e,colorIndex:s}},getLevelOptions:function(t){var o=null;if(l(t)){o={};var n=a(t.from)?t.from:1,e=t.levels,i={},s=l(t.defaults)?t.defaults:{};for(r(e)&&(i=e.reduce(function(t,o){var e,i;return l(o)&&a(o.level)&&(i="boolean"==typeof(e=h({},o)).levelIsConstant?e.levelIsConstant:s.levelIsConstant,delete e.levelIsConstant,delete e.level,o=o.level+(i?0:n-1),l(t[o])?d(t[o],e):t[o]=e),t},{})),e=a(t.to)?t.to:1,t=0;t<=e;t++)o[t]=h({},s,l(i[t])?i[t]:{})}return o},setTreeValues:function i(n,s){var t=s.before,o=s.idRoot,e=s.mapIdToNode[o],r=s.points[n.i],a=r&&r.options||{},l=0,h=[];return d(n,{levelDynamic:n.level-("boolean"!=typeof s.levelIsConstant||s.levelIsConstant?0:e.level),name:g(r&&r.name,""),visible:o===n.id||"boolean"==typeof s.visible&&s.visible}),"function"==typeof t&&(n=t(n,s)),n.children.forEach(function(t,o){var e=d({},s);d(e,{index:o,siblings:n.children.length,visible:n.visible}),t=i(t,e),h.push(t),t.visible&&(l+=t.val)}),n.visible=0<l||n.visible,t=g(a.value,l),d(n,{children:h,childrenTotal:l,isLeaf:n.visible&&!l,val:t}),n},updateRootId:function(t){var o;return l(t)&&(o=l(t.options)?t.options:{},o=g(t.rootNode,o.rootId,""),l(t.userOptions)&&(t.userOptions.rootId=o),t.rootNode=o),o}}}),o(t,"modules/sankey.src.js",[t["parts/Globals.js"],t["parts/Color.js"],t["parts/Point.js"],t["parts/Utilities.js"],t["mixins/tree-series.js"]],function(o,a,e,t,i){var r=t.defined,l=t.find,h=t.isObject,d=t.merge,c=t.pick,p=t.relativeLength,n=t.seriesType,s=t.stableSort,u=i.getLevelOptions;n("sankey","column",{borderWidth:0,colorByPoint:!0,curveFactor:.33,dataLabels:{enabled:!0,backgroundColor:"none",crop:!1,nodeFormat:void 0,nodeFormatter:function(){return this.point.name},format:void 0,formatter:function(){},inside:!0},inactiveOtherPoints:!0,linkOpacity:.5,minLinkWidth:0,nodeWidth:20,nodePadding:10,showInLegend:!1,states:{hover:{linkOpacity:1},inactive:{linkOpacity:.1,opacity:.1,animation:{duration:50}}},tooltip:{followPointer:!0,headerFormat:'<span style="font-size: 10px">{series.name}</span><br/>',pointFormat:"{point.fromNode.name} â†’ {point.toNode.name}: <b>{point.weight}</b><br/>",nodeFormat:"{point.name}: <b>{point.sum}</b><br/>"}},{isCartesian:!1,invertable:!0,forceDL:!0,orderNodes:!0,pointArrayMap:["from","to"],createNode:o.NodesMixin.createNode,searchPoint:o.noop,setData:o.NodesMixin.setData,destroy:o.NodesMixin.destroy,getNodePadding:function(){var t,o=this.options.nodePadding||0;return!this.nodeColumns||(t=this.nodeColumns.reduce(function(t,o){return Math.max(t,o.length)},0))*o>this.chart.plotSizeY&&(o=this.chart.plotSizeY/t),o},createNodeColumn:function(){var a=this,o=this.chart,l=[];return l.sum=function(){return this.reduce(function(t,o){return t+o.getSum()},0)},l.offset=function(t,o){for(var e=0,i=a.nodePadding,n=0;n<l.length;n++){r=l[n].getSum();var s=Math.max(r*o,a.options.minLinkWidth),r=r?s+i:0;if(l[n]===t)return{relativeTop:e+p(t.options.offset||0,r)};e+=r}},l.top=function(e){var i=a.nodePadding,t=this.reduce(function(t,o){return 0<t&&(t+=i),t+(o=Math.max(o.getSum()*e,a.options.minLinkWidth))},0);return(o.plotSizeY-t)/2},l},createNodeColumns:function(){var s=[];this.nodes.forEach(function(e){var i,t=-1;if(!r(e.options.column))if(0===e.linksTo.length)e.column=0;else{for(i=0;i<e.linksTo.length;i++){var o,n=e.linksTo[0];n.fromNode.column>t&&(t=(o=n.fromNode).column)}e.column=t+1,o&&"hanging"===o.options.layout&&(e.hangsFrom=o,i=-1,l(o.linksFrom,function(t,o){return(t=t.toNode===e)&&(i=o),t}),e.column+=i)}s[e.column]||(s[e.column]=this.createNodeColumn()),s[e.column].push(e)},this);for(var t=0;t<s.length;t++)void 0===s[t]&&(s[t]=this.createNodeColumn());return s},hasData:function(){return!!this.processedXData.length},pointAttribs:function(t,o){var e=this,i=e.mapOptionsToLevel[(t.isNode?t.level:t.fromNode.level)||0]||{},n=t.options,s=i.states&&i.states[o]||{};o=["colorByPoint","borderColor","borderWidth","linkOpacity"].reduce(function(t,o){return t[o]=c(s[o],n[o],i[o],e.options[o]),t},{});var r=c(s.color,n.color,o.colorByPoint?t.color:i.color);return t.isNode?{fill:r,stroke:o.borderColor,"stroke-width":o.borderWidth}:{fill:a.parse(r).setOpacity(o.linkOpacity).get()}},generatePoints:function(){o.NodesMixin.generatePoints.apply(this,arguments),this.orderNodes&&(this.nodes.filter(function(t){return 0===t.linksTo.length}).forEach(function(t){!function o(t,e){void 0===t.level&&(t.level=e,t.linksFrom.forEach(function(t){t.toNode&&o(t.toNode,e+1)}))}(t,0)}),s(this.nodes,function(t,o){return t.level-o.level}))},translateNode:function(t,o){var e=this.translationFactor,i=this.chart,n=this.options,s=t.getSum(),r=Math.max(Math.round(s*e),this.options.minLinkWidth),a=Math.round(n.borderWidth)%2/2,l=o.offset(t,e);o=Math.floor(c(l.absoluteTop,o.top(e)+l.relativeTop))+a,a=Math.floor(this.colDistance*t.column+n.borderWidth/2)+a,a=i.inverted?i.plotSizeX-a:a,e=Math.round(this.nodeWidth),(t.sum=s)?(t.shapeType="rect",t.nodeX=a,t.nodeY=o,t.shapeArgs=i.inverted?{x:a-e,y:i.plotSizeY-o-r,width:t.options.height||n.height||e,height:t.options.width||n.width||r}:{x:a,y:o,width:t.options.width||n.width||e,height:t.options.height||n.height||r},t.shapeArgs.display=t.hasShape()?"":"none",n=this.mapOptionsToLevel[t.level],s=t.options,s=h(s)?s.dataLabels:{},n=h(n)?n.dataLabels:{},n=d({style:{}},n,s),t.dlOptions=n,t.plotY=1,t.tooltipPos=i.inverted?[i.plotSizeY-t.shapeArgs.y-t.shapeArgs.height/2,i.plotSizeX-t.shapeArgs.x-t.shapeArgs.width/2]:[t.shapeArgs.x+t.shapeArgs.width/2,t.shapeArgs.y+t.shapeArgs.height/2]):t.dlOptions={enabled:!1}},translateLink:function(i){var t,o,e,n,s,r,a,l,h,d,c,p,u,f=function(t,o){var e;return o=t.offset(i,o)*y,Math.min(t.nodeY+o,t.nodeY+(null===(e=t.shapeArgs)||void 0===e?void 0:e.height)-k)},m=i.fromNode,g=i.toNode,v=this.chart,y=this.translationFactor,k=Math.max(i.weight*y,this.options.minLinkWidth),b=(v.inverted?-this.colDistance:this.colDistance)*this.options.curveFactor,N=f(m,"linksFrom"),f=f(g,"linksTo"),x=m.nodeX,C=this.nodeWidth,g=g.column*this.colDistance,S=i.outgoing,L=x+C<g;v.inverted&&(N=v.plotSizeY-N,f=(v.plotSizeY||0)-f,g=v.plotSizeX-g,C=-C,k=-k,L=g<x),i.shapeType="path",i.linkBase=[N,N+k,f,f+k],L&&"number"==typeof f?i.shapeArgs={d:[["M",x+C,N],["C",x+C+b,N,g-b,f,g,f],["L",g+(S?C:0),f+k/2],["L",g,f+k],["C",g-b,f+k,x+C+b,N+k,x+C,N+k],["Z"]]}:"number"==typeof f&&(b=g-20-k,S=g-20,L=g,e=(o=(t=x+C)+20)+k,l=(a=(r=(s=(n=N+k)+20)+(v.plotHeight-N-k))+20)+k,d=(h=f+k)+20,c=a+.7*k,p=L-.7*k,u=t+.7*k,i.shapeArgs={d:[["M",t,N],["C",u,N,e,n-.7*k,e,s],["L",e,r],["C",e,c,u,l,t,l],["L",L,l],["C",p,l,b,c,b,r],["L",b,d],["C",b,h-.7*k,p,f,L,f],["L",L,h],["C",S,h,S,h,S,d],["L",S,r],["C",S,a,S,a,L,a],["L",t,a],["C",o,a,o,a,o,r],["L",o,s],["C",o,n,o,n,t,n],["Z"]]}),i.dlBox={x:x+(g-x+C)/2,y:N+(f-N)/2,height:k,width:0},i.tooltipPos=v.inverted?[v.plotSizeY-i.dlBox.y-k/2,v.plotSizeX-i.dlBox.x]:[i.dlBox.x,i.dlBox.y+k/2],i.y=i.plotY=1,i.color||(i.color=m.color)},translate:function(){var a=this;this.processedXData||this.processData(),this.generatePoints(),this.nodeColumns=this.createNodeColumns(),this.nodeWidth=p(this.options.nodeWidth,this.chart.plotSizeX);var l=this,h=this.chart,d=this.options,t=this.nodeWidth,o=this.nodeColumns;this.nodePadding=this.getNodePadding(),this.translationFactor=o.reduce(function(t,o){return Math.min(t,function(o){for(var t,e,i=o.slice(),n=a.options.minLinkWidth||0,s=0,r=h.plotSizeY-d.borderWidth-(o.length-1)*l.nodePadding;o.length;){for(s=r/o.sum(),t=!1,e=o.length;e--;)o[e].getSum()*s<n&&(o.splice(e,1),r-=n,t=!0);if(!t)break}return o.length=0,i.forEach(function(t){return o.push(t)}),s}(o))},1/0),this.colDistance=(h.plotSizeX-t-d.borderWidth)/Math.max(1,o.length-1),l.mapOptionsToLevel=u({from:1,levels:d.levels,to:o.length-1,defaults:{borderColor:d.borderColor,borderRadius:d.borderRadius,borderWidth:d.borderWidth,color:l.color,colorByPoint:d.colorByPoint,levelIsConstant:!0,linkColor:d.linkColor,linkLineWidth:d.linkLineWidth,linkOpacity:d.linkOpacity,states:d.states}}),o.forEach(function(o){o.forEach(function(t){l.translateNode(t,o)})},this),this.nodes.forEach(function(t){t.linksFrom.forEach(function(t){(t.weight||t.isNull)&&t.to&&(l.translateLink(t),t.allowShadow=!1)})})},render:function(){var t=this.points;this.points=this.points.concat(this.nodes||[]),o.seriesTypes.column.prototype.render.call(this),this.points=t},animate:o.Series.prototype.animate},{applyOptions:function(t,o){return e.prototype.applyOptions.call(this,t,o),r(this.options.level)&&(this.options.column=this.column=this.options.level),this},setState:o.NodesMixin.setNodeState,getClassName:function(){return(this.isNode?"highcharts-node ":"highcharts-link ")+e.prototype.getClassName.call(this)},isValid:function(){return this.isNode||"number"==typeof this.weight}})}),o(t,"masters/modules/sankey.src.js",[],function(){})});