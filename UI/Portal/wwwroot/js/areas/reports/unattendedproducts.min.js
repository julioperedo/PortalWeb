function initPage(){setupControls();setGridHeight("Listado",_gridMargin)}function setupControls(){var n={dataTextField:"Text",dataValueField:"Value",optionLabel:"Cualquiera",dataSource:[{Text:"Si",Value:"Y"},{Text:"No",Value:"N"}]};$("#Enabled").kendoDropDownList(n);$("#Stock").kendoDropDownList(n);$("#Comments").kendoDropDownList(n);$("#Transit").kendoDropDownList(n);$("#Price").kendoDropDownList(n);$("#ShowInWeb").kendoDropDownList(n);$("#WithImage").kendoDropDownList(n);$("#WithLink").kendoDropDownList(n);$("#WithRotation").kendoDropDownList(n);$("#Manager").kendoDropDownList({dataTextField:"name",dataValueField:"shortName",optionLabel:"Todos",dataSource:{transport:{read:{url:urlGetPMs}}}});$("#Listado").kendoGrid({columns:[{title:"Line",hidden:!0,field:"line",aggregates:["count"],groupHeaderTemplate:"Línea: #= value #    ( Total: #= count# )"},{title:"Category",hidden:!0,field:"category",aggregates:["count"],groupHeaderTemplate:"Categoría: #= value #    ( Total: #= count# )"},{title:"Sub Category",hidden:!0,field:"subCategory",aggregates:["count"],groupHeaderTemplate:"Subcategoría: #= value #    ( Total: #= count# )"},{title:"Item",width:170,footerTemplate:"Total : #= count#",field:"itemCode",aggregates:["count"]},{title:"Nombre",field:"name",width:230},{title:"Product Manager",hidden:!0,field:"productManager",aggregates:["count"],groupHeaderTemplate:"PM: #= value #    ( Total: #= count# )"},{title:"Habilitado",attributes:alignCenter,headerAttributes:alignCenter,width:100,template:'# if(enabled) {# <i class="fas fa-check"><\/i> #} #',field:"enabled"},{title:"En Web",attributes:alignCenter,headerAttributes:alignCenter,width:100,template:'# if(showInWeb) {# <i class="fas fa-check"><\/i> #} #',field:"showInWeb"},{title:"Link",attributes:alignCenter,headerAttributes:alignCenter,width:80,template:'# if(link && link !== "") {# <i class="fas fa-check"><\/i> #} #',field:"link"},{title:"Comentarios",attributes:alignCenter,headerAttributes:alignCenter,width:120,template:'# if(commentaries && commentaries !== "") {# <i class="fas fa-check"><\/i> #} #',field:"commentaries"},{title:" ",attributes:alignCenter,width:30,template:'# if(imageURL !== null && $.trim(imageURL) !== "") {# <i class="fas fa-image"><\/i> #} #',field:"imageURL"},{title:"Precios",headerAttributes:{style:"text-align: center;",colSpan:3},columns:[{title:"Central",attributes:alignRight,headerAttributes:alignRight,width:100,field:"priceSantaCruz",format:"{0:N2}"},{title:"LA",attributes:alignRight,headerAttributes:alignRight,width:100,field:"priceMiami",format:"{0:N2}"},{title:"Iquique",attributes:alignRight,headerAttributes:alignRight,width:100,field:"priceIquique",format:"{0:N2}"}]},{title:"Stock",headerAttributes:{style:"text-align: center;",colSpan:3},columns:[{title:"Central",attributes:alignRight,headerAttributes:alignRight,width:100,template:"# if(santaCruz) {# #=santaCruz# #} # # if(reservedSantaCruz) {# (-#=reservedSantaCruz#) #} #",field:"santaCruz"},{title:"LA",attributes:alignRight,headerAttributes:alignRight,width:100,template:"# if(miami) {# #=miami# #} # # if(reservedMiami) {# (-#=reservedMiami#) #} #",field:"miami"},{title:"Iquique",attributes:alignRight,headerAttributes:alignRight,width:100,template:"# if(iquique) {# #=iquique# #} # # if(reservedIquique) {# (-#=reservedIquique#) #} #",field:"iquique"}]},{title:"Tránsito",headerAttributes:{style:"text-align: center;",colSpan:3},columns:[{title:"Central",attributes:alignRight,headerAttributes:alignRight,width:80,field:"transitSantaCruz"},{title:"LA",attributes:alignRight,headerAttributes:alignRight,width:80,field:"transitMiami"},{title:"Iquique",attributes:alignRight,headerAttributes:alignRight,width:80,field:"transitIquique"}]},{title:"Rotación",headerAttributes:{style:"text-align: center;",colSpan:3},columns:[{title:"Central",attributes:alignRight,headerAttributes:alignRight,width:90,field:"rotationSantaCruz"},{title:"LA",attributes:alignRight,headerAttributes:alignRight,width:90,field:"rotationMiami"},{title:"Iquique",attributes:alignRight,headerAttributes:alignRight,width:90,field:"rotationIquique"}]}],sortable:!0,selectable:"Single, Row",noRecords:{template:'<div class="w-100 text-center p-3">No hay resultados para el criterio de búsqueda.<\/div>'},dataSource:getDatasource([])})}function getDatasource(n){return new kendo.data.DataSource({data:n,group:[{field:"productManager",dir:"asc",aggregates:[{field:"productManager",aggregate:"count"},{field:"line",aggregate:"count"},{field:"category",aggregate:"count"},{field:"subCategory",aggregate:"count"},{field:"itemCode",aggregate:"count"}]},{field:"line",dir:"asc",aggregates:[{field:"productManager",aggregate:"count"},{field:"line",aggregate:"count"},{field:"category",aggregate:"count"},{field:"subCategory",aggregate:"count"},{field:"itemCode",aggregate:"count"}]},{field:"category",dir:"asc",aggregates:[{field:"productManager",aggregate:"count"},{field:"line",aggregate:"count"},{field:"category",aggregate:"count"},{field:"subCategory",aggregate:"count"},{field:"itemCode",aggregate:"count"}]},{field:"subCategory",dir:"asc",aggregates:[{field:"productManager",aggregate:"count"},{field:"line",aggregate:"count"},{field:"category",aggregate:"count"},{field:"subCategory",aggregate:"count"},{field:"itemCode",aggregate:"count"}]}],aggregate:[{field:"productManager",aggregate:"count"},{field:"line",aggregate:"count"},{field:"category",aggregate:"count"},{field:"subCategory",aggregate:"count"},{field:"itemCode",aggregate:"count"}]})}function loadResults(n){var i,r,t;i=$("#Listado").data("kendoGrid");r=getDatasource(n);i.setDataSource(r);t=_gridMargin;n&&n.length>0?($("#filter-box").collapse("hide"),$("#action-excel").removeClass("d-none"),t-=20):$("#action-excel").addClass("d-none");setTimeout(()=>{setGridHeight("Listado",t)},200)}function cleanFilters(){$("#Enabled").getKendoDropDownList().value("");$("#Stock").getKendoDropDownList().value("");$("#Transit").getKendoDropDownList().value("");$("#Price").getKendoDropDownList().value("");$("#Manager").getKendoDropDownList().value("");$("#Comments").getKendoDropDownList().value("");$("#ShowInWeb").getKendoDropDownList().value("");$("#WithImage").getKendoDropDownList().value("");$("#WithLink").getKendoDropDownList().value("");loadResults([])}function filterData(n){var t;n.preventDefault();var r=$("#Enabled").val(),u=$("#Stock").val(),f=$("#Transit").val(),e=$("#Price").val(),c=$("#Comments").val(),i="",o=$("#ShowInWeb").val(),s=$("#WithImage").val(),h=$("#WithLink").val(),l=$("#WithRotation").val();$("#Manager").getKendoDropDownList().value()!=""&&(i=$("#Manager").getKendoDropDownList().text());t=[];r=="Y"&&t.push("Habilitados");r=="N"&&t.push("Deshabilitados");u=="Y"&&t.push("Con Stock");u=="N"&&t.push("Sin Stock");f=="Y"&&t.push("Con Tránsito");f=="N"&&t.push("Sin Tránsito");e=="Y"&&t.push("Con Precio");e=="N"&&t.push("Sin Precio");o=="Y"&&t.push("Visible en Web");o=="N"&&t.push("No visible en Web");i!=""&&t.push("De "+i);s!==""&&t.push(s==="Y"?"Con Imagen":"Sin Imagen");h!==""&&t.push(h==="Y"?"Con Vínculo":"Sin Vínculo");WithRotation!==""&&t.push(WithRotation==="Y"?"Con Rotación":"Sin Rotación");$.get(urlFilter,{Enabled:r,WithStock:u,InTransit:f,WithPrice:e,WithCommentaries:c,ProductManager:i,InWeb:o,WithImage:s,WithLink:h,WithRotation:l},function(n){n.message===""?(loadResults(n.items),t.length>0?$("#title").text(" - "+t.join(", ")):$("#title").text(""),n.items.length===0&&showInfo("No existen resultados para ese criterio de búsqueda.")):showError(n.message)})}function exportExcel(n){n.preventDefault();var i=$("#Enabled").val(),r=$("#Stock").val(),u=$("#Transit").val(),f=$("#Price").val(),e=$("#Comments").val(),t="",o=$("#ShowInWeb").val(),s=$("#WithImage").val(),h=$("#WithLink").val(),c=$("#WithRotation").val();$("#Manager").getKendoDropDownList().value()!==""&&(t=$("#Manager").getKendoDropDownList().text());window.location.href=urlExport+"?"+$.param({Enabled:i,WithStock:r,InTransit:u,WithPrice:f,WithCommentaries:e,ProductManager:t,InWeb:o,WithImage:s,WithLink:h,WithRotation:c})}const alignCenter={style:"text-align: center;"},alignRight={style:"text-align: right;"},dateFormat="{0:dd-MM-yyyy HH:mm:ss}",_gridMargin=20;$(()=>initPage());$(window).resize(function(){setGridHeight("Listado",_gridMargin)});$("#action-clean").click(cleanFilters);$("#action-filter").click(filterData);$("#action-excel").click(exportExcel);