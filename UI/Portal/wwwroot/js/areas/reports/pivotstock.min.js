function setupControls(){$("#Subsidiary").multipleSelect({placeholder:"Seleccione una Sucursal",onUncheckAll:()=>{$("#Storehouse").empty().multipleSelect("refresh").multipleSelect("disable")},onCheckAll:()=>{loadStoreHouses()},onClick:()=>{loadStoreHouses()}});$("#Storehouse").multipleSelect({placeholder:"Seleccione algún Almacén"}).multipleSelect("disable");$("#Category").multipleSelect({placeholder:"Seleccione alguna Categoría",onClick:function(){loadSubcategories()},onCheckAll:function(){loadSubcategories()},onUncheckAll:function(){loadSubcategories()}});$("#SubCategory").multipleSelect({placeholder:"Seleccione alguna Subcategoría"});$("#Line").multipleSelect({placeholder:"Seleccione alguna Línea"});$("#GP").kendoDropDownList({dataTextField:"name",dataValueField:"name",optionLabel:"Seleccione un Valor ...",dataSource:{transport:{read:{url:urlPManagers}}}});$.get(urlGetSubsidiaries,{},n=>{if(n.message===""){var t=$("#Subsidiary");n.items.forEach(n=>{t.append(new Option(n.name,n.id,!1,!1))});t.multipleSelect("refresh")}else showError(`Ha ocurrido el siguiente error al traer las Sucursales: <br />${n.message}.`)});$.get(urlLines,{},n=>{if(n){var t=$("#Line");n.forEach(n=>{t.append(new Option(n.name,n.id,!1,!1))});t.multipleSelect("refresh")}});$.get(urlCategories,{},n=>{if(n){var t=$("#Category");n.forEach(n=>{t.append(new Option(n.name,n.id,!1,!1))});t.multipleSelect("refresh")}})}function loadStoreHouses(){var n,t;$("#Storehouse").empty();n=$("#Subsidiary").multipleSelect("getSelects","text");n&&n.length>0?(t=Enumerable.From(n).Select(function(n){return`'${n}'`}).ToArray().join(),$.get(urlWarehouses,{Subsidiary:t},n=>{n.message!==""?(showError(n.message),$("#Storehouse").multipleSelect("disable")):n.items.length>0?($.each(n.items,function(n,t){$("#Storehouse").append(new Option(t.name,t.name,!0,!0))}),$("#Storehouse").multipleSelect("enable")):$("#Storehouse").multipleSelect("disable"),$("#Storehouse").multipleSelect("refresh")})):$("#Storehouse").multipleSelect("refresh").multipleSelect("disable")}function loadSubcategories(){var n,t;$("#SubCategory").empty();n=$("#Category").multipleSelect("getSelects","text");n&&n.length>0?(t=Enumerable.From(n).Select(function(n){return`'${n}'`}).ToArray().join(),$.get(urlSubcategories,{Categories:t},n=>{n.message!==""?(showError(n.message),$("#SubCategory").multipleSelect("disable")):n.items.length>0?($.each(n.items,function(n,t){$("#SubCategory").append(new Option(t.name,t.name,!1,!1))}),$("#SubCategory").multipleSelect("enable")):$("#SubCategory").multipleSelect("disable"),$("#SubCategory").multipleSelect("refresh")})):$("#SubCategory").multipleSelect("refresh").multipleSelect("disable")}function getFilters(){var t="",i="",r="",u="",f="",e="",n=$("#Subsidiary").multipleSelect("getSelects","text");return n&&n.length>0&&(t=Enumerable.From(n).Select(n=>`'${n}'`).ToArray().join()),n=$("#Storehouse").multipleSelect("getSelects"),n&&n.length>0&&(i=Enumerable.From(n).Select(n=>`'${n}'`).ToArray().join()),n=$("#Category").multipleSelect("getSelects","text"),n&&n.length>0&&(r=Enumerable.From(n).Select(n=>`'${n}'`).ToArray().join()),n=$("#Subcategory").multipleSelect("getSelects","text"),n&&n.length>0&&(u=Enumerable.From(n).Select(n=>`'${n}'`).ToArray().join()),n=$("#Line").multipleSelect("getSelects","text"),n&&n.length>0&&(f=Enumerable.From(n).Select(n=>`'${n}'`).ToArray().join()),e=$("#GP").getKendoDropDownList().value(),{Regionals:t,Warehouses:i,Categories:r,SubCategories:u,Lines:f,ProductManager:e}}function loadPivot(n){var t=$(window).height()-$(".navbar").height()-$(".toolbar").height()-50,i=$("#ColapsedRows").prop("checked");$.map(_options.pivot.xfields,function(n){n.state=i?"closed":"opened"});_options.height=t;_options.data=n;$(".datagrid-row-selected, .datagrid-row-checked").removeClass("datagrid-row-checked").removeClass("datagrid-row-selected");$("#action-excel").toggleClass("d-none",n.length<=0);$("#pivot").pivotgrid(_options);_loaded=!0}var _loaded=!1,_reconfigured=!1,_options={pivot:{rows:["GP","Linea","Marca","Descripcion","Item"],columns:["Sucursal"],values:[{field:"Stock"},{field:"Costo"}],xfields:[{field:"Sucursal",state:$("#ColapsedRows").prop("checked")?"closed":"opened"},{field:"Almacen",state:$("#ColapsedRows").prop("checked")?"closed":"opened"},{field:"GP",state:$("#ColapsedRows").prop("checked")?"closed":"opened"},{field:"Linea",state:$("#ColapsedRows").prop("checked")?"closed":"opened"},{field:"Categoria",state:$("#ColapsedRows").prop("checked")?"closed":"opened"},{field:"Subcategoria",state:$("#ColapsedRows").prop("checked")?"closed":"opened"},{field:"Item",state:$("#ColapsedRows").prop("checked")?"closed":"opened"},{field:"Descripcion",state:$("#ColapsedRows").prop("checked")?"closed":"opened"},{field:"Marca",state:$("#ColapsedRows").prop("checked")?"closed":"opened"},{field:"Stock",op:"sum",formatter:function(n){return kendo.toString(+n,"#,##0")}},{field:"Costo",op:"sum",formatter:function(n){return kendo.toString(+n,"#,##0.00")}}]},forzenColumnTitle:'<span style="font-weight:bold">Detalle<\/span>',valueFormatter:function(n){return kendo.toString(+n,"#,##0.00")},valuePrecision:2,valueFieldWidth:100,showFooter:!0,FooterTitle:"TOTAL",showColumnsTotals:!0,i18n:{fields:"Campos",filters:"Filtros",rows:"Filas",columns:"Columnas",values:"Valores",ok:"Aceptar",cancel:"Cancelar"},onDblClickRow:function(){$(this).pivotgrid("unselectAll")}};$(function(){setupControls()});$(window).resize(function(){var n=$(window).height()-$(".navbar").height()-$(".toolbar").height()-50;$("#pivot").pivotgrid("resize",{height:n})});$("#action-config").click(function(n){n.preventDefault();$("#pivot").pivotgrid("layout")});$("#action-clean").click(function(){$("#Subsidiary").multipleSelect("uncheckAll");$("#Category").multipleSelect("uncheckAll");$("#Line").multipleSelect("uncheckAll");$("#GP").data("kendoDropDownList").value("");loadPivot([])});$("#action-filter").click(function(){var n=getFilters();$("#pivot-container").empty();$.ajaxSetup({cache:!1});$.get(urlFilter,n,function(n){$("#filter-box").collapse("hide");n.message===""?loadPivot(n.items):showError(`Se ha producido el siguiente error al traer los datos: <br />${n.message}`)})});$("#action-excel").click(function(){var n=getFilters();window.location.href=urlExport+"?"+$.param(n)});