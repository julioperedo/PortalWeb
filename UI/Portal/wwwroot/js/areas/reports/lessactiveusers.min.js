function setupControls(){$("#Salesman").kendoDropDownList({dataSource:{transport:{read:{url:urlSellers}}},dataTextField:"name",dataValueField:"id",optionLabel:"Seleccione un Vendedor..."});$("#Listado").kendoGrid({columns:[{title:"Days",hidden:!0,field:"days",aggregates:["count"],groupHeaderTemplate:"#= showPeriod(value, count) #"},{title:"Cliente",template:'# if(lastLog) {# <a class="sessions action action-link">#=clientName#<\/a> #} else {# #=clientName# #} #',field:"clientName"},{title:"Correo",field:"eMail"},{title:"Vendedor",field:"seller"},{title:"Ultimo Ingreso",width:150,template:'<a class="sessions action action-link"># if(lastLog) {# #=kendo.toString(lastLog, "dd-MM-yyyy HH:mm:ss")# #} #<\/a>',field:"LastLog"}],sortable:!0,selectable:"Single, Row",noRecords:{template:'<div class="w-100 text-center p-4">No hay resultados para el criterio de b&uacute;squeda.<\/div>'},dataSource:{group:[{field:"days",dir:"desc",aggregates:[{field:"days",aggregate:"count"}]}],aggregate:[{field:"days",aggregate:"count"}]}});$("#Sessions").kendoGrid({columns:[{title:"Usuario",field:"userName"},{title:"Hora",headerAttributes:alignCenter,attributes:alignCenter,field:"logDate",format:"{0:HH:mm.ss}",width:150}],sortable:!0,selectable:"Single, Row",dataSource:[]});$("#Detail").kendoWindow({visible:!1,modal:!0,scrollable:!0,pinned:!1,title:"Accesos",resizable:!1,width:800,actions:["Close"],open:onRefreshWindow})}function loadGrid(n){var i,r,t;n.forEach(n=>{n.lastLog=JSON.toDate(n.lastLog)});i=$("#Listado").getKendoGrid();r=new kendo.data.DataSource({data:n,group:[{field:"days",dir:"desc",aggregates:[{field:"days",aggregate:"count"}]}]});i.setDataSource(r);t=_gridMargin;n&&n.length>0?($("#filter-box").collapse("hide"),$("#action-excel").removeClass("d-none"),t-=20):$("#action-excel").addClass("d-none");setTimeout(()=>{setGridHeight("Listado",t)},200)}function showPeriod(n,t){return n<1100?n<1e3?n===0?"Ultimo Ingreso: Menor a 15 días    ( Total: "+t+" )":"Ultimo Ingreso: Mayor a "+n+" días    ( Total: "+t+" )":"Ultimo Ingreso: Nunca    ( Total: "+t+" )":"Clientes Sin Usuario      ( Total: "+t+" )"}const alignCenter={style:"text-align: center;"},alignRight={style:"text-align: right;"},dateFormat="{0:dd-MM-yyyy HH:mm:ss}",_gridMargin=30;$(function(){setupControls()});$(window).resize(function(){setGridHeight("Listado",_gridMargin)});$("#action-search").click(function(){var n=$.trim($("#Client").val()),t=$("#Salesman").val();$.get(urlFilter,{SellerCode:t,ClientName:n},function(n){n.message===""?loadGrid(n.items):showError(n.message)})});$("#action-excel").click(function(){var n=$.trim($("#Client").val()),t=$("#Salesman").val();window.location.href=urlExport+"?"+$.param({SellerCode:t,ClientName:n})});$("#Listado").on("click",".sessions",function(n){var t;n.preventDefault();var u=$("#Detail").data("kendoWindow"),i=$("#Listado").data("kendoGrid"),r=$(n.currentTarget).closest("tr");i.select(r);t=i.dataItem(r);t.lastLog&&$.get(urlDetail,{CardCode:t.cardCode,LogDate:t.lastLog.toISOString()},function(n){var t=[],i,r;n.message===""?(t=n.items,t.forEach(n=>{n.logDate=JSON.toDate(n.logDate)}),i=$("#Sessions").getKendoGrid(),r=new kendo.data.DataSource({data:t}),i.setDataSource(r),u.center().open()):showError(`Se ha producido el siguiente error al traer los datos: <br /> ${n.message}`)})});