function setupControls(){$.get(urlGetOrder,{},function(n){if(n.message===""){if($(".no-items").toggleClass("d-none",n.item.details.length>0),n.item.details.length>0){var t,i=0,r="";n.item.details.forEach(n=>{t=n.quantity*n.price,i+=t,r+=`<tr>
    <td>
        <span class="item-code">${n.product.itemCode}</span>
        <input type="hidden" class="product-id" value="${n.idProduct}" />
        <input type="hidden" class="detail-id" value="${n.id}" />
        <input type="hidden" class="detail-data" value='${JSON.stringify(n.dataExtra)}' />
    </td>
    <td>${n.product.name}</td>
    <td><input id="subsidiaries_${n.id}" data-subsidiary="${n.idSubsidiary}" data-product="${n.idProduct}" required class="w-100 subsidiary" /></td>
    <td><input class="k-textbox price" type="number" value="${n.price}" step="0.1" min="0" style="width: 80px;" lang="en-us" /></td>
    <td><input class="k-textbox item-quantity" type="number" value="${n.quantity}" min="1" style="width: 80px;" /></td>
    <td class="text-right"><span class="text-right stock">${n.stock}</span> </td>
    <td class="text-right"><span class="subtotal">${kendo.toString(t,"N2")}</span></td>
    <td class="text-center"><span class="fas fa-trash-alt delete-item action action-link" title="Quitar Producto"></span></td>
</tr>`});$(".table tbody").append(r);$(".table tfoot .total").text(kendo.toString(i,"N2"));$(".subsidiary").each(function(){var n=this.dataset;$(this).kendoDropDownList({change:onSubsidiaryChange,dataSource:{transport:{read:{url:urlGetSubsidiaries,data:{ProductId:n.product}}}},ignoreCase:!0,optionLabel:"Seleccione una Sucursal...",filter:"contains",dataTextField:"name",dataValueField:"id",value:n.subsidiary})})}}else showError("Se ha producido un error al traer los datos del servidor")})}function onSubsidiaryChange(){var i=this.value(),u=$(this.element).attr("id"),n=$("#"+u).closest("tr"),f=JSON.parse(n.find(".detail-data").val()),t=i!==""?f.find(n=>n.id===+i):{price:0,stock:0},r=parseInt(n.find(".item-quantity").val()),e=parseFloat(n.find(".subtotal").text().replace(",","")),o=parseFloat(n.closest("table").find(".total").text().replace(",",""));n.find(".price").val(t.price);n.find(".subtotal").text(kendo.toString(r*t.price,"#,##0.00"));n.find(".stock").text(t.stock);n.closest("table").find(".total").text(kendo.toString(o-e+r*t.price,"N2"));validateTempSale()}function validateTempSale(){var n=!0;return $.each($(".table tbody tr"),function(t,i){$(i).find("*").removeClass("k-invalid");$(i).find(".item-quantity").val()<=0&&($(i).find(".item-quantity").addClass("k-invalid"),n=!1);$(i).find(".price").val()<=0&&($(i).find(".price").addClass("k-invalid"),n=!1);$(i).find("[id^='subsidiaries_']").getKendoDropDownList().value()==""&&($(i).find(".item-subsidiary").parent().find(".k-dropdown-wrap").addClass("k-invalid"),n=!1)}),n}function onQuantityChange(){var n=$(this).closest("tr"),t=parseInt($(this).val()),i=parseFloat(n.find(".price").val()),r=parseFloat(n.find(".subtotal").text().replace(",","")),u=parseFloat($(this).closest("table").find(".total").text().replace(",",""));n.find(".subtotal").text(kendo.toString(t*i,"#,##0.00"));$(this).closest("table").find(".total").text(kendo.toString(u-r+t*i,"N2"))}function onPriceChange(){var n=$(this).closest("tr"),t=parseInt(n.find(".item-quantity").val()),i=parseFloat($(this).val()),r=parseFloat(n.find(".subtotal").text().replace(",","")),u=parseFloat($(this).closest("table").find(".total").text().replace(",",""));n.find(".subtotal").text(kendo.toString(t*i,"#,##0.00"));$(this).closest("table").find(".total").text(kendo.toString(u-r+t*i,"N2"))}function deleteItem(){var t=$(this).closest("tr"),i=parseFloat(t.find(".subtotal").text().replace(",","")),r=parseFloat($(this).closest("table").find(".total").text().replace(",","")),u=t.find(".item-code").text(),n=this;showConfirm(`¿Está seguro que desea eliminar el item <b>${u}</b>?`,function(){$(n).closest("table").find(".total").text(kendo.toString(r-i,"N2"));$(n).closest("tbody").find("tr").length===1?($(n).closest(".tempsale").find(".send-tempsale").addClass("disabled"),parseFloat($(n).closest(".tempsale").find(".items-count").val())<=0&&$(n).closest(".tempsale").find(".save-tempsale, .delete-tempsale").addClass("disabled"),$(n).closest("table").parent().find(".no-items").removeClass("d-none"),$(n).closest("table").remove()):$(n).closest("tr").remove()})}const alignCenter={style:"text-align: center;"},alignRight={style:"text-align: right;"};var permission;$(()=>setupControls());$("body").on("change",".item-quantity",onQuantityChange);$("body").on("change",".price",onPriceChange);$("body").on("click",".delete-item",deleteItem);