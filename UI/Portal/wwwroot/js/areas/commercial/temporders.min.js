function onSubsidiaryChange(){var i=this.value(),u=$(this.element).attr("id"),n=$("#"+u).closest("tr"),f=JSON.parse(n.find(".detail-data").val()),t;t=i!=""?Enumerable.From(f).Where("$.Id == "+i).FirstOrDefault():{Price:0,Stock:0};n.find(".price").val(t.Price);var r=parseInt(n.find(".item-quantity").val()),e=parseFloat(n.find(".subtotal").text().replace(",","")),o=parseFloat(n.closest("table").find(".total").text().replace(",",""));n.find(".subtotal").text(kendo.toString(r*t.Price,"#,##0.00"));n.find(".stock").text(t.Stock);n.closest("table").find(".total").text(kendo.toString(o-e+r*t.Price,"N2"));validateTempSale()}function deleteItem(){var t=$(this).closest("tr"),i=parseFloat(t.find(".subtotal").text().replace(",","")),r=parseFloat($(this).closest("table").find(".total").text().replace(",","")),u=t.find(".item-code").text(),n=this;showConfirm(`¿Está seguro que desea eliminar el item <b>${u}</b>?`,function(){$(n).closest("table").find(".total").text(kendo.toString(r-i,"N2"));$(n).closest("tbody").find("tr").length===1?($(n).closest(".tempsale").find(".send-tempsale").addClass("disabled"),parseFloat($(n).closest(".tempsale").find(".items-count").val())<=0&&$(n).closest(".tempsale").find(".save-tempsale, .delete-tempsale").addClass("disabled"),$(n).closest("table").parent().find(".no-items").removeClass("d-none"),$(n).closest("table").remove()):$(n).closest("tr").remove()})}function onQuantityChange(){var n=$(this).closest("tr"),t=parseInt($(this).val()),i=parseFloat(n.find(".price").val()),r=parseFloat(n.find(".subtotal").text().replace(",","")),u=parseFloat($(this).closest("table").find(".total").text().replace(",",""));n.find(".subtotal").text(kendo.toString(t*i,"#,##0.00"));$(this).closest("table").find(".total").text(kendo.toString(u-r+t*i,"N2"))}function onPriceChange(){var n=$(this).closest("tr"),t=parseInt(n.find(".item-quantity").val()),i=parseFloat($(this).val()),r=parseFloat(n.find(".subtotal").text().replace(",","")),u=parseFloat($(this).closest("table").find(".total").text().replace(",",""));n.find(".subtotal").text(kendo.toString(t*i,"#,##0.00"));$(this).closest("table").find(".total").text(kendo.toString(u-r+t*i,"N2"))}function SaveTempSale(){var n=getTempSaleItems();$.post(urlEdit,{Items:n},function(n){n.message===""?($("#tempsale").find(".tempsale-id").val(n.id),showMessage("Los Items en el Carrito de Compras fueron guardados correctamente.")):showError("Se ha producido el siguiente error al intentar guardar el Carrito de Compras: <br />"+n.message)})}function DeleteTempSale(){showConfirm("¿Está seguro que desea limpiar los items del carrito?",()=>{$.post(urlDelete,function(n){n.message===""?($(".tempsale table").remove(),$(".no-items").removeClass("d-none"),$(".save-tempsale, .send-tempsale, .delete-tempsale").addClass("disabled"),showMessage("Los Items en el Carrito se limpiaron correctamente.")):showError("Se ha producido el siguiente error al intentar limpiar el Carrito de Compras: <br />"+n.message)})})}function SendTempSale(){validateTempSale()?showConfirm('¿Est&aacute; seguro que desea enviar el correo y limpiar el carrito?<br /><input type="checkbox" id="send-comments" /><label for="send-comments" class="control-label">&nbsp;Enviar con comentarios<\/label>',()=>{var n=getTempSaleItems(),t=$("#send-comments").prop("checked");$.post(urlSend,{Items:n,WithComments:t},function(n){n.message===""?($(".tempsale table").remove(),$(".no-items").removeClass("d-none"),$(".save-tempsale, .send-tempsale, .delete-tempsale").addClass("disabled"),showMessage("Se enviaron los datos carrito correctamente.")):showError("Se ha producido el siguiente error al intentar enviar el Carrito de Compras: <br />"+n.message)})}):showError("Existen Items que requieren atenci&oacute;n.")}function getTempSaleItems(){var n=[];return $.each($(".tempsale tbody tr"),function(t,i){var r,u,f,e,o;r=$(i).find(".detail-id").val();f=$(i).find(".product-id").val();u=$(i).find(".item-quantity").val();e=$(i).find(".price").val();o=$(i).find("[id^='subsidiaries_']").getKendoDropDownList().value();n.push({id:r,idProduct:f,idSubsidiary:o,quantity:u,price:e,warehouse:""})}),n}function validateTempSale(){var n=!0;return $.each($("#tempsale tbody tr"),function(t,i){$(i).find("*").removeClass("k-invalid");$(i).find(".item-quantity").val()<=0&&($(i).find(".item-quantity").addClass("k-invalid"),n=!1);$(i).find(".price").val()<=0&&($(i).find(".price").addClass("k-invalid"),n=!1);$(i).find("[id^='subsidiaries_']").getKendoDropDownList().value()==""&&($(i).find(".item-subsidiary").parent().find(".k-dropdown-wrap").addClass("k-invalid"),n=!1)}),n}$(".save-tempsale").click(SaveTempSale);$(".send-tempsale").click(SendTempSale);$(".delete-tempsale").click(DeleteTempSale);$("body").on("change",".item-quantity",onQuantityChange);$("body").on("change",".price",onPriceChange);$("body").on("click",".delete-item",deleteItem);