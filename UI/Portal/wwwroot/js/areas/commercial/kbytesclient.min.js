function setupControls(){$("#report").kendoWindow({visible:!1,width:1100,title:"Nota de Venta",modal:!0});loadDetail($("#clients").val())}function loadDetail(n){cleanDetail();var t=$("#resumes");$.get(urlDetail,{CardCode:n},function(n){var u,i;if(n.message===""){var f=`<div class="panel slide">
                                <div class="">
                                    <div class="text-center details-title">
                                        <div>
                                            <span class="small-label">año</span><br />
                                            <span class="year-title">#=year#</span><br />
                                        </div>                    
                                        <a class="see-details" data-type="N" data-year="#=year#"><span class="small-label action">ver detalle</span></a>
                                    </div>
                                    <div class="text-right details">
                                        <div>
                                            <span class="year-values">#=kendo.toString(amount, "N2")#</span><br />
                                            <span class="small-label">monto acumulado</span>
                                        </div>
                                        <div>
                                            <span class="year-values">#=kendo.toString(points, "N0")#</span><br />
                                            <span class="small-label">puntos acumulados</span>
                                        </div>
                                        <div>
                                            <span class="year-values">#=status#</span><br />
                                            <span class="small-label">status</span>
                                        </div>
                                    </div>
                                </div>
                            </div>`,e=kendo.template(f),r=$("<div>").addClass("width-panel"),o=`<div class="panel available width-panel">
                                <div class="row">
                                    <div class="col text-center">
                                        <div>                                                
                                            <span class="points-title">${kendo.toString(n.availablePoints,"N0")}</span><br />                                       
                                            <span class="small-label">puntos disponibles</span>
                                        </div>
                                    </div>                                       
                                </div>
                            </div>`;r.append(o);n.claimedPoints>0&&(u=`<div class="panel  width-panel">
                                   <div class="row">
                                       <div class="col text-center">
                                            <div>
                                                <span class="small-label">puntos usados</span>
                                                <span class="points-title">${kendo.toString(n.claimedPoints,"N0")}</span>                                                
                                            </div>
                                            <a class="see-details" data-type="UP" data-year="0"><span class="small-label action">ver detalle</span></a>
                                       </div>                                       
                                   </div>
                               </div>`,r.append(u));t.append(r);i=$("<div>").attr("id","years-slider").addClass("slider-2");n.years.forEach(n=>{i.append(e(n))});i.append(`<div onclick="prev()" class="control-btn prev"><i class="fas fa-arrow-left"></i></div>
               <div onclick="next()" class="control-btn next"><i class="fas fa-arrow-right"></i></div>`);t.append(i);$("#action-excel").removeClass("d-none")}else showError(`Se ha producido el siguiente error al intentar traer los datos: <br /> ${n.message}.`)})}function loadGridNotes(n){var t,i;n.forEach(n=>{n.date=JSON.toDate(n.date)});$("#notesContainer").removeClass("d-none");$("#awardsContainer").addClass("d-none");t=$("#listNotes").data("kendoGrid");t?(i=new kendo.data.DataSource({data:n,aggregate:[{field:"itemPoints",aggregate:"sum"}]}),t.setDataSource(i)):$("#listNotes").kendoGrid({dataSource:{data:n,aggregate:[{field:"Amount",aggregate:"sum"},{field:"ItemPoints",aggregate:"sum"}]},sortable:!0,selectable:!0,pageable:!1,noRecords:{template:"No hay registros para el criterio de búsqueda"},columns:[{field:"subsidiary",title:"Sucursal"},{field:"number",title:"No. Nota",template:'# if(id) { # <a class="sale-note action action-link">#=number#<\/a> # } else { # <span>Canje Puntos<\/span>  # } #'},{field:"date",title:"Fecha",format:"{0:dd-MM-yyyy}",attributes:alignCenter,headerAttributes:alignCenter},{field:"amount",title:"Monto",format:"{0:N2}",attributes:alignRight,headerAttributes:alignRight},{field:"itemPoints",title:"Puntos",format:"{0:N0}",attributes:alignRight,headerAttributes:alignRight}]})}function loadGridAwards(n){var t,i;n.forEach(n=>{n.claimDate=JSON.toDate(n.claimDate)});$("#notesContainer").addClass("d-none");$("#awardsContainer").removeClass("d-none");t=$("#listAwards").data("kendoGrid");t?(i=new kendo.data.DataSource({data:n}),t.setDataSource(i)):$("#listAwards").kendoGrid({dataSource:{data:n},sortable:!0,selectable:!0,pageable:!1,noRecords:{template:"No hay registros para el criterio de búsqueda"},columns:[{field:"claimDate",title:"Fecha",format:"{0:dd-MM-yyyy}",width:100,attributes:alignCenter,headerAttributes:alignCenter},{field:"quantity",title:"Cantidad",width:80,attributes:alignRight,headerAttributes:alignRight},{field:"award",title:"Premio"},{field:"points",title:"Puntos Usados",width:120,format:"{0:N0}",attributes:alignRight,headerAttributes:alignRight}]})}function cleanDetail(){$("#resumes").empty();loadGridNotes([]);$("#notesContainer").addClass("d-none");loadGridAwards([]);$("#awardsContainer").addClass("d-none");$("#action-excel").addClass("d-none");$("#action-add").addClass("d-none")}function loadReport(n,t){var u=$.trim($(".user-info > .user-name").first().text()),r={report:"SaleNote.trdp",parameters:{Subsidiary:t,DocNumber:n,User:u}},i=$("#reportViewer1").data("telerik_ReportViewer");if(i)try{i.reportSource(r);i.refreshReport()}catch(f){showInfo("El servidor está ocupado, espere un momento y vuelva a intentar.")}else $("#reportViewer1").telerik_ReportViewer({serviceUrl:urlService,reportSource:r,viewMode:telerikReportViewer.ViewModes.INTERACTIVE,scaleMode:telerikReportViewer.ScaleModes.FIT_PAGE_WIDTH})}function openSaleNote(n){var u=$("#report").data("kendoWindow"),t=$(n.currentTarget).closest(".k-grid").data("kendoGrid"),i=$(n.currentTarget).closest("tr"),r=t.dataItem(i);t.select(i);loadReport(r.number,r.subsidiary);u.open().center()}function seeDetails(){$("#resumes .selected").removeClass("selected");$(this).closest(".panel").addClass("selected");var n=$("#clients").val(),t=this.dataset;t.type==="N"?$.get(urlNotes,{CardCode:n,Year:t.year},function(n){n.message===""?loadGridNotes(n.items):(console.error(n.message),showError("Se ha producido un error al traer los datos del servidor"))}):$.get(urlAwards,{CardCode:n},function(n){n.message===""?loadGridAwards(n.items):(console.error(n.message),showError("Se ha producido un error al traer los datos del servidor"))})}function prev(){document.getElementById("years-slider").scrollLeft-=270}function next(){document.getElementById("years-slider").scrollLeft+=270}const alignCenter={style:"text-align: center;"},alignRight={style:"text-align: right;"};$(()=>setupControls());$(document).ajaxError(onReportError);$("#listNotes").on("click",".sale-note",openSaleNote);$("#resumes").on("click",".see-details",seeDetails);