function setupControls(){$("#portal-users").kendoGrid({columns:[{field:"name",title:"Nombre"},{field:"eMail",title:"Correo Electrónico"},{field:"profile",title:"Perfil"},{field:"enabled",title:"Habilitado",template:'# if(enabled) {# <i class="fas fa-check"><\/i> #} #',width:90,attributes:alignCenter,headerAttributes:alignCenter}],mobile:!0,sortable:!0,selectable:!0,noRecords:{template:"No se encontraron registros para el criterio de búsqueda."}});$("#contact-list").kendoListView({dataSource:[],selectable:"single",change:function(n){var t=n.sender.select();console.log(t)},template:kendo.template($("#contact-template").html())});$("#address-list").kendoTreeView({dataTextField:["name","name"],change:function(n){var r=n.sender,t=r.dataItem(this.select()),i;t.hasChildren||(i=$("#Client").data("kendoDropDownList").value(),$.get(urlAddressData,{CardCode:i,Name:t.name,Type:t.id},function(n){n.message!==""&&showError("Se ha producido un error al traer los datos del servidor, por favor intente nuevamente.");loadAddressData(n.item)}))}});$("#attach-list").kendoGrid({dataSource:[],columns:[{field:"line",title:"No.",width:70},{field:"path",title:"Vía de Acceso"},{field:"fileName",title:"Nombre del archivo"},{field:"date",title:"Fecha",format:dateFormat,width:90,attributes:alignCenter,headerAttributes:alignCenter},{field:"enabled",title:" ",template:'<a class="download-file action"><i class="fas fa-download"><\/i><\/a>',width:40,attributes:alignCenter,headerAttributes:alignCenter}],mobile:!0,sortable:!0,selectable:!0,noRecords:{template:"No se encontraron registros para el criterio de búsqueda."}});$("#mail-list").kendoGrid({dataSource:[],columns:[{field:"name",title:"Nombre"},{field:"eMail",title:"Correo Electrónico"},{field:"typeDesc",title:"Tipo"},{field:"logDate",title:"Fecha",format:"{0:dd-MM-yyyy HH:mm}",attributes:alignCenter,headerAttributes:alignCenter},{field:"blackList",title:"En Lista Negra",attributes:alignCenter,headerAttributes:alignCenter,template:'# if(blackList) {# <i class="fas fa-check"><\/i> #} #'}],mobile:!0,sortable:!0,selectable:!0,noRecords:{template:"No se encontraron registros para el criterio de búsqueda."}});$("#listYears").kendoGrid({dataSource:[],mobile:!0,sortable:!0,selectable:"Single, Row",scrollable:{height:200},noRecords:{template:"No se encontraron registros para el criterio de búsqueda."},width:750,columns:[{field:"year",title:"Año",attributes:alignRight,headerAttributes:alignRight},{field:"quantity",title:"# Compras",attributes:alignRight,headerAttributes:alignRight},{field:"total",title:"Total $Us",format:"{0:N2}",attributes:alignRight,headerAttributes:alignRight},{field:"average",title:"Promedio por mes",format:"{0:N2}",attributes:alignRight,headerAttributes:alignRight},{field:"percentageMargin",title:"Margen",format:"{0:N2} %",attributes:alignRight,headerAttributes:alignRight}],dataBound:function(n){var t=n.sender;showMargin?t.showColumn("percentageMargin"):t.hideColumn("percentageMargin")},detailInit:function(n){$.get(urlMonths,{CardCode:n.data.cardCode,Year:n.data.year},function(t){t.message===""?(t.months.forEach(n=>{n.average=n.total/n.quantity,n.percentageMargin=n.taxlessTotal>0?100*(n.margin/n.taxlessTotal):0}),$("<div>").appendTo(n.detailCell).kendoGrid({scrollable:!1,sortable:!0,pageable:!1,selectable:!0,columns:[{field:"month",title:"Mes",attributes:alignRight,headerAttributes:alignRight},{field:"quantity",title:"# Compras",attributes:alignRight,headerAttributes:alignRight},{field:"total",title:"Total $Us",format:"{0:N2}",attributes:alignRight,headerAttributes:alignRight},{field:"average",title:"Promedio por compra",format:"{0:N2}",attributes:alignRight,headerAttributes:alignRight},{field:"percentageMargin",title:"Margen",format:"{0:N2} %",attributes:alignRight,headerAttributes:alignRight}],dataSource:t.months,dataBound:function(n){var t=n.sender;showMargin?t.showColumn("percentageMargin"):t.hideColumn("percentageMargin")}})):(console.error(t.message),showError("Se ha producido un error al traer los datos del servidor."))})}})}function loadDetail(n){var u,t,i,r,f,e,o,s,h,c;n.client.createDate=JSON.toDate(n.client.createDate);n.staticts.first=JSON.toDate(n.staticts.first);n.staticts.last=JSON.toDate(n.staticts.last);u=n.client.cardName;n.client.disabled==="Y"&&(u+='&nbsp;&nbsp;&nbsp;<b style="color: #F00;">( Deshabilitado )<\/b>');$("#name").html(u);$("#legalName").text(n.client.cardFName);$("#nit").text(n.client.nit);$("#orders").text(kendo.toString(n.client.ordersBalance,"N2"));$("#accountBalance").text(kendo.toString(n.client.balance,"N2"));$("#phone1").text(n.client.phone1);$("#phone2").text(n.client.phone2);$("#fax").text(n.client.fax);$("#mobile").text(n.client.cellular);$("#email").text(n.client.eMail);$("#contactPerson").text(n.client.contactPerson);$("#accpac").text(n.client.accpac);$("#seller").text(n.client.sellerName);$("#creditLimit").text(kendo.toString(n.client.creditLimit,"N2"));$("#terms").text(n.client.terms);$("#createDate").text(kendo.toString(n.client.createDate,"dd-MM-yyyy"));$("#firstInvoice").text(kendo.toString(n.staticts.first,"dd-MM-yyyy"));$("#lastInvoice").text(kendo.toString(n.staticts.last,"dd-MM-yyyy"));$("#totalInvoice").text(kendo.toString(n.staticts.total,"N2"));$("#margin").text(kendo.toString(100*(n.staticts.margin/n.staticts.taxlessTotal),"N2")+" %");$("#averageInvoice").text(kendo.toString(n.staticts.average,"N2"));$("#quantityInvoice").text(n.staticts.quantity);$("#dueDays").text(n.avgDueDays);t=Enumerable.From(n.extras).Where("$.subsidiary === 'Santa Cruz'").FirstOrDefault();t&&($("#sa-acredited1").text(t.acredited1),$("#sa-acredited2").text(t.acredited2),$("#sa-acredited3").text(t.acredited3),$("#sa-acredited4").text(t.acredited4),$("#sa-acredited5").text(t.acredited5),$("#sa-acredited6").text(t.acredited6),$("#sa-acredited7").text(t.acredited7),$("#sa-acredited8").text(t.acredited8),$("#sa-ciacredited1").text(t.ciAcredited1),$("#sa-ciacredited2").text(t.ciAcredited2),$("#sa-ciacredited3").text(t.ciAcredited3),$("#sa-ciacredited4").text(t.ciAcredited4),$("#sa-ciacredited5").text(t.ciAcredited5),$("#sa-ciacredited6").text(t.ciAcredited6),$("#sa-ciacredited7").text(t.ciAcredited7),$("#sa-ciacredited8").text(t.ciAcredited8));i=Enumerable.From(n.extras).Where("$.subsidiary === 'Iquique'").FirstOrDefault();i&&($("#iq-acredited1").text(i.acredited1),$("#iq-acredited2").text(i.acredited2),$("#iq-acredited3").text(i.acredited3),$("#iq-acredited4").text(i.acredited4),$("#iq-acredited5").text(i.acredited5),$("#iq-acredited6").text(i.acredited6),$("#iq-acredited7").text(i.acredited7),$("#iq-acredited8").text(i.acredited8),$("#iq-ciacredited1").text(i.ciAcredited1),$("#iq-ciacredited2").text(i.ciAcredited2),$("#iq-ciacredited3").text(i.ciAcredited3),$("#iq-ciacredited4").text(i.ciAcredited4),$("#iq-ciacredited5").text(i.ciAcredited5),$("#iq-ciacredited6").text(i.ciAcredited6),$("#iq-ciacredited7").text(i.ciAcredited7),$("#iq-ciacredited8").text(i.ciAcredited8));r=Enumerable.From(n.extras).Where("$.subsidiary === 'Miami'").FirstOrDefault();r&&($("#la-acredited1").text(r.acredited1),$("#la-acredited2").text(r.acredited2),$("#la-acredited3").text(r.acredited3),$("#la-acredited4").text(r.acredited4),$("#la-acredited5").text(r.acredited5),$("#la-acredited6").text(r.acredited6),$("#la-acredited7").text(r.acredited7),$("#la-acredited8").text(r.acredited8),$("#la-ciacredited1").text(r.ciAcredited1),$("#la-ciacredited2").text(r.ciAcredited2),$("#la-ciacredited3").text(r.ciAcredited3),$("#la-ciacredited4").text(r.ciAcredited4),$("#la-ciacredited5").text(r.ciAcredited5),$("#la-ciacredited6").text(r.ciAcredited6),$("#la-ciacredited7").text(r.ciAcredited7),$("#la-ciacredited8").text(r.ciAcredited8));f=$("#portal-users").data("kendoGrid");f.setDataSource(new kendo.data.DataSource({data:n.users}));e=$("#contact-list").data("kendoListView");e.setDataSource(new kendo.data.DataSource({data:n.contacts}));o=$("#address-list").data("kendoTreeView");o.setDataSource(new kendo.data.HierarchicalDataSource({data:n.addresses,schema:{model:{id:"type",children:"items"}}}));s=$("#attach-list").data("kendoGrid");n.files.forEach(n=>n.date=JSON.toDate(n.date));s.setDataSource(new kendo.data.DataSource({data:n.files}));h=$("#mail-list").data("kendoGrid");n.mailContacts.forEach(n=>{n.logDate=JSON.toDate(n.logDate),n.typeDesc=n.type===1?"Recordatorio de Vencimientos":n.type===2?"Copia de Notas de Venta":n.type===3?"Ofertas":"Transferencias de Propiedad"});h.setDataSource(new kendo.data.DataSource({data:n.mailContacts}));n.years.forEach(n=>n.percentageMargin=n.taxlessTotal>0?100*(n.margin/n.taxlessTotal):0);c=$("#listYears").data("kendoGrid");c.setDataSource(new kendo.data.DataSource({data:n.years}))}function loadContactData(n){$(".contact-detail i").removeClass("fa-check").text("");n&&($("#cnt-name").text(n.name),$("#cnt-firstName").text(n.firstName),$("#cnt-middleName").text(n.middleName),$("#cnt-lastName").text(n.lastName),$("#cnt-title").text(n.title),$("#cnt-position").text(n.position),$("#cnt-address").text(n.address),$("#cnt-phone1").text(n.phone1),$("#cnt-phone2").text(n.phone2),$("#cnt-mobile").text(n.cellular),$("#cnt-fax").text(n.fax),$("#cnt-email").text(n.eMail),$("#cnt-identityCard").text(n.identityCard),n.enabled==="Y"&&$("#cnt-active").addClass("fa-check"))}function loadAddressData(n){$(".address-detail span").text("");n&&($("#add-name").text(n.name),$("#add-address1").text(n.address1),$("#add-address2").text(n.address2),$("#add-address3").text(n.address3),$("#add-contact").text(n.contact),$("#add-country").text(n.country),$("#add-state").text(n.state),$("#add-city").text(n.city),$("#add-tax").text(n.taxCode))}function onClientChanged(){var n=this.value(),t={client:{cardName:"",cardFName:"",nit:"",ordersBalance:0,balance:0,phone1:"",phone2:"",fax:"",cellular:"",eMail:"",contactPerson:"",accpac:"",sellerName:""},extras:[],users:[]};n!=""?$.get(urlClient,{CardCode:n},function(n){n.message!==""&&(console.error(n.message),showError("Se ha producido un error al traer los datos del cliente, por favor intente de nuevo."),n.item=t);loadDetail(n.item)}):loadDetail(t)}function clientMapper(n){var t=$("#Client").data("kendoDropDownList").dataSource.data(),i=Enumerable.From(t).Where(t=>t.code===n.value).FirstOrDefault(),r=Enumerable.From(t).IndexOf(i);n.success(r)}function showHideData(n){var t=$(".k-grid"),n=$(this).find("i");$.each(t,function(t,i){var r=$(i).data("kendoGrid");n.hasClass("fa-eye-slash")?r.hideColumn("percentageMargin"):r.showColumn("percentageMargin")});n.hasClass("fa-eye-slash")?n.removeClass("fa-eye-slash").addClass("fa-eye"):n.removeClass("fa-eye").addClass("fa-eye-slash");$("#margin, #margin-label").toggleClass("d-none");showMargin=!showMargin}function showContact(){var n=$(this).data("id");$.get(urlContactData,{Code:n},function(n){n.message!==""&&showError("Se ha producido un error al traer los datos del servidor, por favor intente nuevamente.");loadContactData(n.data)})}function downloadFile(){var n=$(this).closest(".k-grid").data("kendoGrid"),t=$(this).closest("tr"),i,r;n.select(t);i=n.dataItem(t);r=$("#Client").data("kendoDropDownList").value();window.location.href=urlAttachsData+"?"+$.param({CardCode:r,Line:i.line})}const alignCenter={style:"text-align: center;"},alignRight={style:"text-align: right;"},gridMargin=30,numberFormat="{0:#,##0.00}",dateFormat="{0:dd-MM-yyyy}";var showMargin=!1;$(()=>setupControls());$("#action-show-all").click(showHideData);$("#contact-list").on("click",".client-contact",showContact);$("#attach-list").on("click",".download-file",downloadFile);