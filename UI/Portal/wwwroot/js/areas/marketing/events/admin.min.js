function initForm(){setupControls();setTimeout(function(){setGridHeight("Listado",_gridMargin)},800);filterData(!0)}function setupControls(){var n=$("#final-date").data("kendoDatePicker"),t=$("#initial-date").data("kendoDatePicker");_maxDate=n.max();_minDate=t.min();n.min(t.value());t.max(n.value());$("#Listado").kendoGrid({noRecords:{template:'<div class="text-center w-100">No se encontraron registros para el criterio de b&uacute;squeda.<\/div>'},columns:[{title:"Nombre",width:350,field:"name"},{title:"Descripción",field:"description"},{title:"Fecha",attributes:alignCenter,headerAttributes:alignCenter,width:120,field:"date",format:dateFormat},{field:"id",title:" ",attributes:alignCenter,width:50,sortable:!1,headerAttributes:alignCenter,headerTemplate:'<i class="fas fa-plus action new-item" title="Nuevo Evento"><\/i>',template:'<i class="fas fa-pen action action-edit" title="Editar Evento"><\/i>&nbsp;&nbsp;<i class="fas fa-trash-alt action action-delete" title="Eliminar Evento"><\/i>'}],sortable:!0,selectable:"Single, Row",dataSource:{schema:{model:{id:"id",fields:{id:{type:"number"},name:{type:"string"},description:{type:"string"},date:{type:"date"}}}},data:[]}})}function cleanFilters(){var n=new Date;$("#initial-date").data("kendoDatePicker").value(n.addMonths(-1));$("#final-date").data("kendoDatePicker").value(n)}function getFilters(){var i="",n=$("#initial-date").data("kendoDatePicker").value(),t=$("#final-date").data("kendoDatePicker").value();return n&&(n=n.toISOString()),t&&(t=t.toISOString()),n===""&t===""&&(i="Debe escoger algún criterio de búsqueda."),{message:i,data:{InitialDate:n,FinalDate:t}}}function filterData(n){var t=getFilters();t.message===""?$.get(urlFilter,t.data,function(n){loadGrid(n.items);n.message!==""&&showError(`Se ha producido el siguiente error al traer los datos: ${n.message}`)}):n||(setGridHeight("Listado",_gridMargin),showInfo(`Se deben ingresar los siguientes campos: <br />${t.message}`))}function loadGrid(n){if(n){n.forEach(n=>{n.date=JSON.toDate(n.date)});var t=$("#Listado").data("kendoGrid"),i=new kendo.data.DataSource({data:n});t.setDataSource(i);n&&n.length>0?($("#filter-box").collapse("hide"),$("#action-excel").removeClass("d-none")):$("#action-excel").addClass("d-none");setGridHeight("Listado",_gridMargin)}}function onSinceChange(n){var t=this.value();t===null&&this.value("");$(n.sender.element).closest(".row").find("input.final-date").data("kendoDatePicker").min(t?t:_minDate)}function onUntilChange(n){var t=this.value();t===null&&this.value("");$(n.sender.element).closest(".row").find("input.initial-date").data("kendoDatePicker").max(t?t:_maxDate)}function openDetail(n){var i=$("#DetailEvent").data("kendoWindow"),t=$("#Listado").data("kendoGrid"),u=0;if(n){var r=$(n.currentTarget).closest("tr"),f=t.dataItem(r),u=f.id;t.select(r)}else t.clearSelection();i.refresh({url:urlEdit,data:{Id:u}});i.center().open()}function onRefresh(n){$("#Detail").kendoEditor({resizable:{content:!0},encoded:!1,tools:["bold","italic","underline","strikethrough","fontSize","foreColor","backColor","justifyLeft","justifyCenter","justifyRight","justifyFull","insertUnorderedList","insertOrderedList","indent","outdent","createLink","unlink","insertImage","tableWizard","createTable","addRowAbove","addRowBelow","addColumnLeft","addColumnRight","deleteRow","deleteColumn","viewHtml","formatting","cleanFormatting"],imageBrowser:{fileTypes:"*.png,*.gif,*.jpg,*.jpeg",path:"events",transport:{read:urlImageRead,destroy:{url:urlImageDestroy,type:"POST"},create:{url:urlImageCreate,type:"POST"},uploadUrl:urlImageUpload,imageUrl:urlImage,type:"filebrowser-aspnetmvc"}}});onRefreshWindow(n)}function onDelete(n){var t=$("#Listado").data("kendoGrid").dataItem($(n.currentTarget).closest("tr"));showConfirm("¿Está seguro que desea aliminar el evento?",function(){var n=$("#initial-date").getKendoDatePicker().value(),i=$("#final-date").getKendoDatePicker().value();n&&(n=n.toISOString());i&&(i=i.toISOString());$.post(urlDelete,{Id:t.id,InitialDate:n,FinalDate:i},function(n){n.message===""?(loadGrid(n.items),showMessage("Se ha eliminado el Evento correctamente.")):showError(n.message)})})}function onSaveEvent(n){var r,u;if(n.preventDefault(),r=$(n.target).closest("form"),u=r.kendoValidator(objConfig).data("kendoValidator"),u.validate()){var f=r.serializeObject(),t=$("#initial-date").getKendoDatePicker().value(),i=$("#final-date").getKendoDatePicker().value();t&&(t=t.toISOString());i&&(i=i.toISOString());$.post(urlEdit,{Item:f,InitialDate:t,FinalDate:i},function(n){n.message===""?(loadGrid(n.items),$("#DetailEvent").data("kendoWindow").close(),showMessage("Se realizaron los cambios correctamente.")):showError(n.message)})}}function fixFolderUrl(){var n=$("#k-editor-image-url")[0];n&&/%2F/.test(n.value)&&(n.value=n.value.replace(/%2F/g,"/").replace("events/",""))}var _minDate,_maxDate;const alignCenter={style:"text-align: center;"},alignRight={style:"text-align: right;"},numberFormat="{0:#,##0.00}",dateFormat="{0:dd-MM-yyyy}",_gridMargin=30,objConfig={messages:{required:"*"}};$(()=>initForm());$(window).resize(()=>setGridHeight("Listado",_gridMargin));$("#filter-box").on("hidden.bs.collapse",()=>setGridHeight("Listado",_gridMargin));$("#filter-box").on("shown.bs.collapse",()=>setGridHeight("Listado",_gridMargin));$("#action-clean").click(()=>cleanFilters());$("#action-filter").click(()=>filterData(!1));$("#Listado").on("click",".new-item",()=>openDetail());$("#Listado").on("click",".action-edit",n=>openDetail(n));$("#Listado").on("click",".action-delete",n=>onDelete(n));$("#DetailEvent").on("click","#cancel-event",n=>{n.preventDefault(),$("#DetailEvent").data("kendoWindow").close()});$("#DetailEvent").on("click","#save-event",n=>onSaveEvent(n));$(document).on("click",".k-imagebrowser>.k-filemanager-listview>.k-listview-content>.k-listview-item",n=>fixFolderUrl(n));