function setupControls(){$("#Detail").kendoWindow({visible:!1,title:"Detalle Premio",modal:!0,width:900});$("#Listado").kendoGrid({noRecords:{template:'<div class="text-enter w-100">No se encontraron registros para el criterio de búsqueda.<\/div>'},columns:[{title:"Nombre",field:"name"},{title:"Puntos",field:"points",attributes:alignRight,headerAttributes:alignRight,width:100,format:"{0:N0}"},{title:"Habilitado",attributes:alignCenter,headerAttributes:alignCenter,width:80,template:'# if(enabled) {# <i class="fas fa-check"><\/i> #} #',field:"enabled"},{field:"imageUrl",title:" ",attributes:alignCenter,width:30,template:'# if($.trim(imageUrl) != "") {# <i class="fas fa-image" title="Tiene Imagen"><\/i> #} #'},{field:"id",title:" ",attributes:alignCenter,width:70,sortable:!1,headerAttributes:alignCenter,headerTemplate:'<a class="action action-link action-new" title="Nuevo Clasificador"><i class="fas fa-plus"><\/i><\/a>',template:'<a class="action action-link action-edit" title="Editar Clasificador"><i class="fas fa-pen"><\/i><\/a><a class="action action-link action-delete" title="Eliminar Clasificador"><i class="fas fa-trash-alt"><\/i><\/a>'}],sortable:!0,selectable:"Single, Row",dataSource:[]});$("#points").kendoNumericTextBox({decimals:0,format:"N0",label:"Puntos"});$("#enabled").kendoSwitch({checked:!0,size:"small"});$("#photos").kendoUpload({"async":{saveUrl:urlSaveImage,removeUrl:urlDeleteImage},validation:{maxFileSize:41943040},success:function(n){var t=n.files[0].name;$("#new-image").val(t);$("#imageUrl").attr("src",`${urlImages}${t}`)}})}function getFilters(){var n=$("#filter").val();return{message:"",data:{FilterData:n}}}function filterData(){var n=getFilters();$.get(urlFilter,n.data,function(n){loadGrid(n.items);n.message!==""&&showError(`Se ha producido el siguiente error al traer los datos: ${n.message}`)})}function loadGrid(n){if(n){var t=$("#Listado").data("kendoGrid"),i=new kendo.data.DataSource({data:n,schema:{model:{id:"id"}}});t.setDataSource(i);n&&n.length>0?($("#filter-box").collapse("hide"),$("#action-excel").removeClass("d-none")):$("#action-excel").addClass("d-none");setGridHeight("Listado",_gridMargin)}}function onItemClick(n){var r=$("#Detail").data("kendoWindow"),i=$("#Listado").data("kendoGrid"),u=$(n.currentTarget).closest("tr"),t=i.dataItem(u);n.currentTarget.classList.contains("action-new")&&(t={id:0,name:"",description:"",points:"",enabled:!0,imageUrl:""},loadDetail(t),r.open().center());n.currentTarget.classList.contains("action-edit")&&(loadDetail(t),i.select(u),r.open().center());n.currentTarget.classList.contains("action-delete")&&showConfirm(`¿Está seguro que desea eliminar el premio <b>${t.name}</b>?`,function(){$.post(urlDelete,{Id:t.id},n=>{n.message===""?(showMessage("Se ha eliminado el premio."),t=i.dataSource.get(t.id),i.dataSource.remove(t),i.refresh()):(console.error(data.message),showError("Se ha producido un error al eliminar el premio."))})})}function loadDetail(n){$("#id").val(n.id);$("#name").val(n.name);$("#description").val(n.description);$("#points").data("kendoNumericTextBox").value(n.points);$("#enabled").data("kendoSwitch").check(n.enabled);$("#new-image").val(n.imageUrl);$("#imageUrl").attr("src",$.trim(n.imageUrl)!==""?`${urlImages}${n.imageUrl}`:urlNoImage)}function onDeleteImage(){$("#new-image").val("");$("#imageUrl").attr("src",urlNoImage);$("#photos").data("kendoUpload").clearAllFiles()}function onSavingPrize(n){var i,r,t;n.preventDefault();i=$(n.currentTarget).closest("form");r=i.kendoValidator({messages:{required:"",email:"no es un correo electrónico válido"}}).data("kendoValidator");r.validate()&&(t=i.serializeObject(),t.enabled=$("#enabled").data("kendoSwitch").check(),t.imageUrl=t["new-image"],console.log(t),$.post(urlEdit,{Item:t},function(n){if(n.message===""){var i=$("#Listado").data("kendoGrid");t.id=n.id;i.dataSource.pushUpdate(t);$("#Detail").data("kendoWindow").close()}else console.error(n.message),showError("Se ha producido un error al guardar el premio")}))}var newId=0;const alignCenter={"class":"k-text-center !k-justify-content-center"},alignRight={style:"text-align: right;"},numberFormat="{0:#,##0.00}",dateFormat="{0:dd-MM-yyyy}",_gridMargin=30;$(()=>{setupControls(),setTimeout(function(){setGridHeight("Listado",_gridMargin)},800),filterData(!0)});$("#Listado").on("click",".action",onItemClick);$("#delete-image").click(onDeleteImage);$("#cancel-update").click(()=>$("#Detail").data("kendoWindow").close());$("#save-prize").click(onSavingPrize);