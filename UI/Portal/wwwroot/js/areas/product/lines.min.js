function setupControls(){$("#Listado").kendoGrid({columns:[{title:"Nombre",field:"name"},{title:"Descripci&oacute;n",field:"description"},{title:"Detalle",field:"hasDetail",attributes:alignCenter,headerAttributes:alignCenter,width:70,template:'# if(hasDetail) {# <i class="fas fa-check"><\/i> #} #'},{title:"Tipo Filtro",field:"filterType",attributes:alignCenter,headerAttributes:alignCenter,width:200,template:n=>n.filterType=="AllBut"?"Todos menos selección":"Ninguno menos selección"},{title:"Mostrar data en filtrado",field:"whenFilteredShowInfo",attributes:alignCenter,headerAttributes:alignCenter,width:200,template:'# if(whenFilteredShowInfo) {# <i class="fas fa-check"><\/i> #} #'},{title:" ",field:"imageURL",attributes:{style:"text-align: center;"},width:50,template:'# if(imageURL != null) {# <i class="fas fa-image" title="Tiene Imagen"><\/i> #} #'},{field:"id",title:" ",attributes:alignCenter,width:70,sortable:!1,headerAttributes:alignCenter,headerTemplate:'<a class="action action-link action-new" title="Nueva línea"><i class="fas fa-plus"><\/i><\/a>',template:'<a class="action action-link action-edit" title="Editar línea"><i class="fas fa-pen"><\/i><\/a><a class="action action-link action-delete" title="Eliminar línea"><i class="fas fa-trash-alt"><\/i><\/a>'}],sortable:!0,selectable:"Single, Row",scrollable:{height:"200px"},messages:{noRecords:"No hay registros para el criterio de búsqueda."},dataSource:{schema:{data:"Data",total:"Total",errors:"Errors",model:{id:"id"}},data:[]}});filterData();setGridHeight("Listado",marginGrid)}function cleanFilters(){$("#FilName").val("")}function loadGrid(n){var t=$("#Listado").data("kendoGrid"),i=getDataSource(n);t.setDataSource(i);n&&n.length>0?($("#filter-box").collapse("hide"),$("#action-excel").removeClass("d-none")):$("#action-excel").addClass("d-none");setGridHeight("Listado",marginGrid)}function filterData(){var n=getFilters();n.message===""?$.get(urlFilter,n.data,function(n){n.message!==""?(showError(n.message),loadGrid([])):loadGrid(n.items)}):showInfo(`Debe seleccionar los siguientes campos: <br />${n.message}`)}function getDataSource(n){return new kendo.data.DataSource({data:n,pageSize:500})}function getFilters(){var n=$("#FilName").val();return{message:"",data:{filterData:n}}}function onSelect(n){var t=n.files[0].extension.toLowerCase();Enumerable.From([".jpg",".gif",".png",".bmp"]).Where(`$ === '${t}'`).Count()===0&&(n.preventDefault(),showInfo("Debe ser una imagen."))}function onUploadSucceded(n){var i=n.files,t;n.operation==="upload"?$.each(i,function(n,t){$("#Photo").attr("src",urlImages+t.name);$("#DeletePhoto").hide();$("#NewImageURL").val(t.name)}):(t=$("#ImageURL").val(),$("#NewImageURL").val(""),t===""?($("#Photo").attr("src",urlNoImage),$("#DeletePhoto").hide()):($("#Photo").attr("src",urlImages+t),$("#DeletePhoto").show()))}function onRefresh(n){var t,i;$("#Footer").kendoEditor({resizable:{content:!0},tools:["bold","italic","underline","strikethrough","fontSize","foreColor","backColor","justifyLeft","justifyCenter","justifyRight","justifyFull","insertUnorderedList","insertOrderedList","indent","outdent","createLink","unlink","tableWizard","createTable","addRowAbove","addRowBelow","addColumnLeft","addColumnRight","deleteRow","deleteColumn","viewHtml","formatting","cleanFormatting"],messages:{dialogCancel:"Cancelar",dialogInsert:"Agregar",dialogUpdate:"Aceptar",viewHtml:"Ver HTML"}});n.sender.center();t=0;tabs=$(".tab-content.main-tab > .tab-pane");$.each(tabs,function(){this.classList.add("active");t=this.clientHeight>t?this.clientHeight:t;$(this).hasClass("show")||this.classList.remove("active")});i=JSON.parse($("#item-data").val());$("#SAPLines").kendoMultiSelect({dataTextField:"name",dataValueField:"id",value:i.SAPLines,placeholder:"Seleccione las Líneas",filter:"contains",dataSource:{serverFiltering:!1,transport:{read:{url:urlSAPLines,data:function(){return{LineId:$("#Id").val()}}}}}});$.each(tabs,function(){$(this).height(t)})}function onNew(){var n=$("#Detail").data("kendoWindow");n.refresh({url:urlEdit,data:{Id:0}});n.open()}function onEdit(){var t=$("#Listado").data("kendoGrid"),i=t.dataItem($(this).closest("tr")),n=$("#Detail").data("kendoWindow");n.refresh({url:urlEdit,data:{Id:i.id}});n.open()}function onDelete(){var t=$("#Listado").data("kendoGrid"),n=t.dataItem($(this).closest("tr")),i=getFilters();showConfirm(`¿Está seguro que desea eliminar la línea <b>${n.name}</b>?`,()=>{$.post(urlDelete,{Id:n.id,Filters:i.data},function(t){t.message===""?(loadGrid(t.items),showMessage(`Se ha eliminado la línea <b>${n.name}</b> correctamente.`)):showError(t.message)})})}function onSave(n){var i,r,t;n.preventDefault();i=$(this).closest("form");r=i.kendoValidator().data("kendoValidator");r.validate()&&(t=i.serializeObject(),t.Footer=$("#Footer").getKendoEditor().value(),t.SAPLines=$("#SAPLines").data("kendoMultiSelect").value(),$.post(urlEdit,{Line:t},function(n){n.message===""?(loadGrid(n.items),$("#FilName").val(""),$("#NewImageURL").val(""),$("#Detail").data("kendoWindow").close(),showMessage("Se realizaron los cambios correctamente.")):showError(n.message)}))}const marginGrid=30,alignCenter={style:"text-align: center;"},alignRight={style:"text-align: right;"};$(()=>setupControls());$(window).resize(()=>setGridHeight("Listado",marginGrid));$("#filter-box").on("hidden.bs.collapse",()=>setGridHeight("Listado",marginGrid));$("#filter-box").on("shown.bs.collapse",()=>setGridHeight("Listado",marginGrid));$("#action-clean").click(()=>cleanFilters());$("#action-filter").click(()=>filterData());$("#Listado").on("click",".action-new",onNew);$("#Listado").on("click",".action-edit",onEdit);$("#Listado").on("click",".action-delete",onDelete);$("#Detail").on("click",".action-save",onSave);