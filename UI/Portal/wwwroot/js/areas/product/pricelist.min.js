function setupControls(){var n,t,i;setTimeout(()=>$("#layouts .btn-info").first().addClass("active"),600);localUser=$("#LocalUser").val();seeStock=$("#SeeStock").val();$("#Lines").kendoDropDownList({dataTextField:"name",dataValueField:"id",optionLabel:"Seleccione una Línea ...",dataSource:{transport:{read:{url:urlGetLines}}}});$("#Category").kendoDropDownList({dataTextField:"name",dataValueField:"id",optionLabel:"Seleccione un Categoría...",dataSource:{transport:{read:{url:urlGetCategories}}}});$("#SubCategory").kendoDropDownList({autoBind:!1,cascadeFrom:"Category",dataTextField:"name",dataValueField:"id",enable:!1,optionLabel:"Seleccione un Subcategoría...",dataSource:{transport:{read:{url:urlGetSubcategories,data:()=>({CategoryId:$("#Category").val()})}},serverFiltering:!0}});$("#cart-subsidiary").kendoDropDownList({dataTextField:"name",dataValueField:"id",change:function(){var n=this.value(),t=JSON.parse($("#cart-pricedata").val()),i=t.find(t=>t.id===n);$("#cart-price").text(kendo.toString(i.price,"N2"))}});$("#Detail").kendoWindow({refresh:onRefreshWindow,scrollable:!0,visible:!1,width:1180,actions:["Close"],resizable:!1,title:"Detalle Producto",modal:!0});$("#CartDetail").kendoWindow({refresh:onRefreshWindow,visible:!1,width:800,actions:["Close"],resizable:!1,title:"Agregar al carrito",modal:!0});n=$("#ItemFilter").magicSuggest({hideTrigger:!0,placeholder:"Escriba su criterio de búsqueda, separado por comas si desea ingresar más de uno",minChars:50,allowFreeEntries:!0});$(n).on("keydown",function(n,t,i){i.keyCode==13&&filterData()});setToolbar("I");notification=$("#notification").kendoNotification({position:{pinned:!0,top:60,right:30},autoHideAfter:1e4,stacking:"down",templates:[{type:"error",template:$("#errorTemplate").html()},{type:"success",template:$("#successTemplate").html()}]}).data("kendoNotification");$("#Report").kendoWindow({visible:!1,width:1100,title:"",modal:!0,activate:function(){var n=this;setTimeout(()=>n.center(),300)}});$("#RequestDetail").kendoWindow({title:"Agregar Solicitud de Producto",visible:!1,scrollable:!0,modal:!0,width:750,iframe:!1,activate:function(n){var t=this;setTimeout(()=>{onRefreshWindow(n),t.center()},300)}});t=$("#IdSubsidiary").kendoDropDownList({dataTextField:"name",dataValueField:"id",optionLabel:"Seleccione una Sucursal...",filter:"contains"}).data("kendoDropDownList");i=$("#CardCode").kendoDropDownList({dataTextField:"name",dataValueField:"code",optionLabel:"Seleccione un Cliente...",filter:"contains",dataSource:{data:[]},virtual:{itemHeight:45,valueMapper:function(n){var t=clients||[],i=t.findIndex(t=>t.code===n.value);n.success(i)}},template:'<span class="k-state-default">#: data.name.replace(data.code + " - ", "") #<p>#: data.code #<\/p><\/span>'}).data("kendoDropDownList");$.get(urlGetSubsidiaries,{},n=>{if(n.message===""){var i=$("#AvailableIn");subsidiaries=n.items;n.items.forEach(n=>{i.append(new Option(n.name,n.name))});i.multipleSelect({selectAll:!1,width:155,allSelected:"Todos",placeholder:"Disponible en",onClick:function(n){var t=n.value.toLowerCase().split(" ").join("-");$("#products-content").toggleClass("available-"+t)}});setToolbar("I");localUser==="Y"&&t.setDataSource(n.items)}else showError(`Se ha producido el siguiente error al traer los datos del servidor: <br /> ${n.message}`)});$.get(urlGetAvailableLines,{},n=>{n.message===""?$("#LineList").kendoListView({dataSource:n.items,template:kendo.template($("#templateLine").html())}):showError(`Se ha producido el siguiente error al traer los datos del servidor: <br /> ${n.message}`)});localUser==="Y"&&$.get(urlClients,{},n=>i.setDataSource(n));$("#products-content").toggleClass("with-requirement",$("#ProductRequirements").val()==="Y")}function filterData(){var n=$("#Lines").data("kendoDropDownList").value(),f=$("#ItemFilter").magicSuggest();$("#ItemFilter").blur();var t=$("#Category").data("kendoDropDownList"),i=$("#SubCategory").data("kendoDropDownList"),r=f.getValue().join().replaceAll("'",""),u=t.value()!==""?t.text():"",e=i.value()!==""?i.text():"";$("#filter-box").collapse("hide");n!==""|u!=""|r!==""?(loadLineContent(n,u,e,r,""),cleanFilters()):$("#divContent").html("<p>Debe seleccionar al menos un criterio de b&uacute;squeda aparte del Stock.<\/p>")}function loadLineContent(n,t,i,r){var u;$("#show-all").find("i").removeClass("far fa-square").addClass("fas fa-check-square");$("#show-all").attr("data-selected","N");$("#LastSearch").val(JSON.stringify({IdLine:n,Category:t,Subcategory:i,Filter:r,OpenBox:!1}));u={};n&&n!="-1"&&(u.idLine=n);t&&(u.Category=t);i&&(u.Subcategory=i);r&&(u.Filter=r);u._=new Date;var f=$("#LocalUser").val()==="Y",e=$("#SeeStock").val()==="Y",o=$("#SeeProviderOrders").val()==="Y";$(containerName).empty();$.get(urlLine,u,t=>{t.message===""?t.items&&t.items.length>0?(t.items.forEach(t=>{var u=$("<div>").addClass("card"),i,s;$(containerName).append(u);u.append(`<div class="card-header" id="headingLine-${t.id}"><h5 class="mb-0"><button class="d-flex align-items-center justify-content-between btn btn-link collapsed" type="button" data-toggle="collapse" data-target="#contentLine-${t.id}" aria-expanded="false" aria-controls="contentLine-${t.id}">${t.name}<i class="fas fa-angle-up"></i></button></h5></div>`);var r=$("<div>").addClass("col"),h="",c="",l,a="";$.trim(t.imageURL)!=""&&(h=`<img src="${urlImagesLine}${t.imageURL}" class="d-none d-sm-inline" />`,c="d-sm-none");t.manager&&(a+=`<img src="../images/staff/${t.manager.photo}" class="d-none d-sm-inline float-right" /><div class="float-right"><span class="font-weight-bold">${t.manager.name}</span><br /><span class="font-italic">${t.manager.position}</span><br /><a href="mailto:${t.manager.email}" class="action-link">${t.manager.email}</a><br /><span>Interno: ${t.manager.phone}</span></div>`);i="";t.usedGroups.length>0&&(i+='<div class="col-12 text-right mb-2"><div class="btn-group btn-group-toggle" data-toggle="buttons">',t.usedGroups.forEach(n=>i+=`<label class="btn btn-warning ${n=="Portal"?"active":""}"><input type="radio" name="options" id="op-${n}"> ${n}</label>`),i+='<\/div>&nbsp;&nbsp;&nbsp;<a class="see-clients action action-link">Ver clientes<\/a><\/div>');l=`<div class="row line-header" data-idline="${t.id}">
                        <div class="col-12 col-sm-4 col-md-3 col-lg-2">${h}<br class="d-sm-none" /><br class="d-sm-none" /><span class="${c}">${t.name}</span></div><div class="d-none d-sm-inline-block col-sm-4 col-md-4 col-lg-5"><p>${t.description}</p><p>${t.header}</p></div><div class="d-none d-sm-inline-block col-sm-4 col-md-5 col-lg-5 text-right">${a}</div>
                        ${i}                        
                    </div>`;r.append(l);s=$("<div>").addClass("col");r.append($("<div>").addClass("line-body").addClass("row").append(s));t.categories&&t.categories.length>0&&t.categories.forEach(i=>{var r=$("<div>").addClass("card"),u;s.append(r);r.append(`<div class="card-header" id="headingCategory-${t.id}-${i.id}"><h5 class="mb-0"><button class="d-flex align-items-center justify-content-between btn btn-link collapsed" type="button" data-toggle="collapse" data-target="#contentCategory-${t.id}-${i.id}" aria-expanded="false" aria-controls="contentCategory-${t.id}-${i.id}">${i.name}<i class="fas fa-angle-up"></i></button></h5></div>`);u=$("<div>").addClass("col");i.subcategories&&i.subcategories.length>0&&i.subcategories.forEach(r=>{var c=$("<div>").addClass("card"),h;u.append(c);c.append(`<div class="card-header" id="headingSubcategory-${t.id}-${i.id}-${r.id}"><h5 class="mb-0"><button class="d-flex align-items-center justify-content-between btn btn-link collapsed" type="button" data-toggle="collapse" data-target="#contentSubcategory-${t.id}-${i.id}-${r.id}" aria-expanded="false" aria-controls="contentSubcategory-${t.id}-${i.id}-${r.id}">${r.name}<i class="fas fa-angle-up"></i></button></h5></div>`);var l=$("<div>").addClass("col").addClass("subcategory"),a=kendo.template(productTemplate),s=[];for(r.products&&r.products.length>0&&r.products.forEach(n=>{$(l).append(a(n)),s.push(`'${n.itemCode}'`)}),c.append($("<div>").addClass("collapse").addClass("show").attr("id",`contentSubcategory-${t.id}-${i.id}-${r.id}`).attr("aria-labelledby",`headingSubcategory-${t.id}-${i.id}-${r.id}`).append($("<div>").addClass("card-body").append($("<div>").addClass("row").append(l)))),h=[];s.length>0;)s.length>50?(h=s.slice(0,50),s=s.slice(50,s.length)):(h=s,s=[]),$.get(urlGetStock,{ItemCodes:h.join(),_:new Date},t=>{t.message===""?(t.items.forEach(t=>{var i=$(`[data-id="${t.itemCode}"]`),r;i.length>0&&(i.find(".product-prices .price").each(function(){var r=this.dataset,n,a,u;if(f||r.price==="Y")if(t.subsidiaries&&t.subsidiaries.length>0)if(n=t.subsidiaries.find(n=>n.name===r.subsidiary),n){var c=n.name==="Iquique"?"primary":"",s=n.name!=="Iquique"?"primary":"",l=0,h=$(this).find(".stock");n.items&&n.items.length>0?(a="$.stock",l=Enumerable.From(n.items).Select(a).Sum(),l<1?($(this).find(".offer, .offer-desc").remove(),$(this).find(".regular").removeClass("with-offer")):i.addClass(`available-${n.name.toLowerCase().replace(" ","-")}`),u="",n.items.forEach(n=>{var i,t,r,h;f||e?(i=n.reserved>0&&f?"detail-reserve action":"",t=n.clientVisible?"":`class="not-for-clients"`,f?(r=n.arrivalDate!=null?`<br />(Fecha estimada de arribo: ${kendo.toString(JSON.toDate(n.arrivalDate),"dd-MM-yyyy")})`:"",u+=`<tr ${t}><td>${n.warehouse}${r}</td><td class="text-right ${c}">${n.stock}</td><td class="text-right ${i}">${n.reserved}</td><td class="text-right ${s}">${n.available2}</td><td class="text-right ${o&&n.requested>0?"action action-see-order":""}">${n.requested}</td></tr>`):n.clientVisible&&(u+=`<tr ${t}><td>${n.warehouse}</td><td class="text-right ${s}">${n.available2}</td></tr>`)):n.clientVisible?(h=n.percentage!=null?`${kendo.toString(n.percentage,"N0")}`:`n/a`,u+=`<tr><td>${n.warehouse}</td><td class="text-right">${h}</td></tr>`):n.arrivalDate!=null&&(u+=`<tr><td colspan="2">Fecha estimada de arribo: ${kendo.toString(JSON.toDate(n.arrivalDate),"dd-MM-yyyy")}</td</tr>`)}),f||e?f?h.append(`<div class="stock-detail"><table style="width: 100%;"><tr><td></td><td class="text-right ${c}">Stock</td><td class="text-right">Reserva</td><td class="text-right ${s}">Disponible</td><td class="text-right">Pedido</td></tr>${u}</table></div>`):h.append(`<div class="stock-detail"><table style="width: 100%;"><tr><td></td><td class="text-right ${s}">Disponible</td></tr>${u}</table></div>`):h.append(`<div class="stock-detail"><table style="width: 100%;"><tr><td></td><td class="text-right">Stock</td></tr>${u}</table></div>`)):($(this).find(".offer, .offer-desc").remove(),$(this).find(".regular").removeClass("with-offer"),r.price==="N"?$(this).remove():$(this).find(".stock").append(r.digital==="Y"?"Stock Disponible":`Sin Stock`))}else $(this).find(".offer, .offer-desc").remove(),$(this).find(".regular").removeClass("with-offer"),r.price==="N"?$(this).remove():$(this).find(".stock").append(r.digital==="Y"?"Stock Disponible":`Sin Stock`);else r.price==="N"?$(this).remove():($(this).find(".offer, .offer-desc").remove(),$(this).find(".regular").removeClass("with-offer"),$(this).find(".stock").append(r.digital==="Y"?"Stock Disponible":`Sin Stock`));else $(this).remove()}),r=function(n,t){var i,r,u,f;n.find(`${t}.offer`).length===0&&(i=n.closest(".card"),n.remove(),i.find(".product").length===0&&(r=i.parent().closest(".card"),i.remove(),r.find(".product").length===0&&(u=r.parent().closest(".card"),r.remove(),u.find(".product").length===0&&(u.remove(),f="Ahora si Rosita trae ese culito"))))},n==="-10"&&r(i,""),n==="-11"&&r(i,".santa-cruz "),n==="-12"&&r(i,".miami "),n==="-13"&&r(i,".iquique "))}),s.length===0&&setTimeout(()=>setProductHeight(),600)):notification.show({title:"Error de conección",message:"No se puede llegar al servidor remoto."},"error")})});r.append($("<div>").addClass("collapse").addClass("show").attr("id",`contentCategory-${t.id}-${i.id}`).attr("aria-labelledby",`headingCategory-${t.id}-${i.id}`).append($("<div>").addClass("card-body").append($("<div>").addClass("row").append(u))))});$.trim(t.footer)!==""&&r.append(`<div class="row line-footer"><div class="col">${t.footer}</div></div>`);u.append($("<div>").addClass("collapse").addClass("show").attr("id",`contentLine-${t.id}`).attr("aria-labelledby",`headingLine-${t.id}`).append($("<div>").addClass("card-body").append($("<div>").addClass("row").append(r))))}),setToolbar("P"),setTimeout(()=>setProductHeight(),500)):(setToolbar("I"),$(containerName).append(`<div class="no-items">No se encontraron resultados para el criterio de b&uacute;squeda.</div>`)):(setToolbar("I"),$(containerName).append(`<div class="no-items">No se encontraron resultados para el criterio de b&uacute;squeda.</div>`),showError(`Se ha producido el siguiente error al traer los datos del servidor: <br /> ${t.message}`))})}function loadOpenBoxes(){var n=kendo.template(`<div class="product open-box">
                                       <div class="product-body">
                                           <div class="product-image">
                                               <img src="#=imageUrl#" />
                                           </div>
                                           <div class="product-desc">
                                               <input id="productId" name="productId" type="hidden" value="#=id#">
                                               <div class="product-code">
                                                   # if ($.trim(link) !== "") { #
                                                   <a href="#=link#" target="_blank" class="action-link"><strong>#=itemCode#</strong></a>
                                                   # } else { #
                                                   <strong>#=itemCode#</strong>
                                                   # } #
                                               </div>
                                               <div class="product-name">#=productName#</div>
                                               # if ($.trim(productComments) !== "") { #
                                               <div class="product-comments">
                                                   <a class="action-link" data-toggle="collapse" href="\\\\#product-comments-#=id#" role="button" aria-expanded="false" aria-controls="product-comments-#=id#">Mostrar Comentarios</a>
                                                   <div id="product-comments-#=id#" class="collapse">#=productComments#</div>
                                               </div>
                                               # } #
                                               <div>#=comments#</div>
                                           </div>
                                           <div class="product-prices">
                                               <div class="#=subsidiary.toLowerCase().replace(' ', '-')#">
                                                   <b>#=subsidiary#</b><br>
                                                   Precio: <b><span class="price">#=kendo.toString(price,"N2")#</span> $us</b><br>
                                                   Unidades disponibles: <span class="quantity">#=quantity#</span>
                                               </div>
                                           </div>
                                       </div>
                                       <div class="product-footer">
                                           <a class="add-cart" title="Agregar al carrito"><i class="fa fa-cart-plus"></i> <span>Agregar al carrito</span></a>
                                       </div>
                                   </div>`);$("#LastSearch").val(JSON.stringify({IdLine:0,Category:"",Subcategory:"",Filter:"",Available:"",OpenBox:!0}));$(containerName).empty();$.get(urlOpenBoxes,{},t=>{t.message===""?(t.items.forEach(t=>{t.imageUrl=$.trim(t.imageUrl)===""?urlNoImage:`${urlImagesProduct}/${t.imageUrl}`,$(containerName).append(n(t)),$(containerName).scrollTop(0)}),$(".product-comments a").click(n=>n.target.text=n.target.text==="Mostrar Comentarios"?"Ocultar Comentarios":"Mostrar Comentarios"),setToolbar("OP"),setTimeout(()=>setProductHeight(),300)):(showError(`Se ha producido el siguiente error al traer los datos del servidor: <br /> ${t.message}`),setToolbar("I"))})}function cleanFilters(){$("#Lines").getKendoDropDownList().value("");$("#Category").getKendoDropDownList().value("");var n=$("#ItemFilter").magicSuggest();n.clear();n.collapse()}function setToolbar(n){$("#action-excel, #action-table").toggleClass("d-none",n==="I"||n==="OP");$(".ms-parent.InToolbox").toggleClass("d-none",n==="I"||n==="OP");$("#show-all").toggleClass("d-none",n==="I"||n==="OP");$("#action-filters").toggleClass("d-none",n!=="I");$("#action-back").toggleClass("d-none",n==="I")}function setProductHeight(){var t=$(".subcategory"),n;t.length>0?t.each(function(){var n=0;$(this).find(".product-body").each(function(){$(this).find(".product-desc").css("min-height","");var t=+$(this).outerHeight().toFixed(0)+1;n=t>n?t:n});$(containerName).hasClass("old-list")||$(this).find(".product-body").each(function(){var r=$(this).outerHeight(),i=$(this).find(".product-image").outerHeight(),t=$(this).find(".product-desc").outerHeight(),u=$("#products-content").hasClass("list")?i>t?i:t:t;$(this).find(".product-desc").css("min-height",Math.round((u+n-r)*100)/100)})}):(n=0,$(".product.open-box .product-body").each(function(){$(this).find(".product-desc").css("min-height","");var t=+$(this).outerHeight().toFixed(0)+1;n=t>n?t:n}),$(".product.open-box .product-body").each(function(){var r=$(this).outerHeight(),i=$(this).find(".product-image").outerHeight(),t=$(this).find(".product-desc").outerHeight(),u=$("#products-content").hasClass("list")?i>t?i:t:t;$(this).find(".product-desc").css("min-height",Math.round((u+n-r)*100)/100)}))}function loadReport(n,t,i){var f={Subsidiary:t,DocNumber:n,User:$.trim($(".user-info > .user-name").first().text())},r="SaleOrder.trdp",u;if(i==="Note"&&(r="SaleNote.trdp"),i==="Delivery"&&(r="DeliveryNote.trdp",f.SearchType=1),i==="Bill"&&(r="Bill.trdp"),u=$("#reportViewer1").data("telerik_ReportViewer"),u)try{u.reportSource({report:r,parameters:f});u.refreshReport()}catch(e){console.error(`Error al recargar el reporte: ${e}`);showInfo("El servidor está ocupado, espere un momento y vuelva a intentar.")}else try{$("#reportViewer1").telerik_ReportViewer({serviceUrl:urlService,reportSource:{report:r,parameters:f},viewMode:telerikReportViewer.ViewModes.INTERACTIVE,scaleMode:telerikReportViewer.ScaleModes.FIT_PAGE_WIDTH})}catch(e){console.error(`Error al cargar el reporte: ${e}`);showInfo("El servidor está ocupado, espere un momento y vuelva a intentar.")}}function catchErrors(n,t){if(t.responseText&&(t.responseText.includes("Document/refresh with ID")||t.responseText.includes("not found. Expired"))){var i=$("#reportViewer1").data("telerik_ReportViewer");i&&i.refreshReport()}}function onScroll(n){var t=$(n.target).scrollTop();t>51?$(".tool-box").addClass("fixed"):$(".tool-box").removeClass("fixed")}function onChangeLayout(n){$(containerName).removeClass("grid").removeClass("list").removeClass("old-list").addClass($(n.target).parent().find("input").val());setProductHeight()}function onClickInnerLine(){var t=$(this).find(".lineId").val(),s=$(this).closest(".k-listview").width(),i=$(this).parent(),h=i.width(),r=Math.floor(s/h),n=i.find(".submenu"),c=n.hasClass("d-none"),u="auto";if($(".submenu").addClass("d-none"),$(".k-listview .line").height("auto"),n.length>0)c?(n.removeClass("d-none"),u=$(this).parent().height()):n.addClass("d-none");else if(t=="-1"){var f=$("<div>").kendoWindow({activate:onRefreshWindow,scrollable:!0,visible:!1,width:1180,actions:["Close"],resizable:!1,title:"Staff",modal:!0}).data("kendoWindow"),e=$("<div>"),l=kendo.template($("#department-template").html());$.get(urlStaff,{},n=>{n.departments.forEach(n=>{n.managers.forEach(n=>{n.photo=urlImagesStaff+n.photo}),n.members.forEach(n=>{n.photo=urlImagesStaff+n.photo}),e.append(l(n))}),f.content(e),setTimeout(()=>f.open().center(),300)})}else t=="-3"?($("#filter-box").collapse("hide"),loadOpenBoxes(),cleanFilters()):($("#filter-box").collapse("hide"),loadLineContent(t,null,null,"",""),cleanFilters());var o=$(".k-listview .line"),a=o.index(i),v=Math.floor(a/r);$.each(o,function(n,t){var i=Math.floor(n/r);v==i?$(t).height(u):$(t).height("auto")})}function onClickSubmenuItem(){$("#filter-box").collapse("hide");loadLineContent($(this).attr("id"),null,null,"","");cleanFilters()}function onExportExcel(n){var t;if(n.preventDefault(),t=[],$.each($(".product:visible"),(n,i)=>{$(i).find(".local-only").length===0&&t.push($(i).find("#productId").val())}),t.length>0){var i=t.join(","),r=function(){var n=$("#export-detail").prop("checked"),t=$("#export-transit").prop("checked");window.location.href=urlExportExcel+"?"+$.param({Ids:i,WithDetail:n,WithTransit:t})},u=`<p>¿Desea exportar con la descripci&oacute;n de los productos?</p>
<input type="checkbox" id="export-detail" /><label for="export-detail" class="control-label">&nbsp;Exportar con detalle</label><br />
${localUser==="Y"?`<input type="checkbox" id="export-transit" /><label for="export-transit" class="control-label">&nbsp;Exportar con tr&aacute;nsito</label>`:""}`;showConfirm(u,r)}}function showTable(n){var t,i;n.preventDefault();t=[];$.each($(".product:visible"),(n,i)=>{t.push($(i).find("#productId").val())});t.length>0&&(i=t.join(","),$.get(urlGetItems,{Ids:i},n=>{if(n.message===""){if(n.lines.length>0){var t=$("<table>").addClass("copy-table");n.lines.forEach(i=>{t.append(`<tr class="line-header"><td colspan="9">${i.name}</td></tr>`),i.categories.forEach(i=>{t.append(`<tr class="category-header"><td colspan="9">${i.name}</td></tr>`),i.subcategories.forEach(i=>{t.append(`<tr class="subcategory-header"><td colspan="9">${i.name}</td></tr>`),t.append(`<tr class="item-header"><td rowspan="2">Item</td><td rowspan="2">Nombre</td><td rowspan="2">Garantía</td><td colspan="2" class="text-center">Santa Cruz</td><td colspan="2" class="text-center">Iquique</td><td colspan="2" class="text-center">Miami</td></tr>`),t.append(`<tr class="item-header"><td class="text-right text-nowrap">Precio ($US)</td><td class="text-right">Stock<td class="text-right text-nowrap">Precio ($US)</td><td class="text-right">Stock<td class="text-right text-nowrap">Precio ($US)</td><td class="text-right">Stock</tr>`),i.products.forEach(i=>{var f="",e="",o="",s="",h="",c="",r,u;r=i.prices.find(n=>n.subsidiary.toLowerCase()==="santa cruz");r&&(r.offer>0?f+=`<span class="offer">${kendo.toString(r.offer,"N2")}</span><span class="regular with-offer">${kendo.toString(r.regular,"N2")}</span>`:r.regular>0&&(f+=kendo.toString(r.regular,"N2")),r.volume&&r.volume.length>0&&(f+=`<br /><table><thead><tr><td class="text-right">Cantidad</td><td class="text-right">Precio</td></tr></thead>`,r.volume.forEach(n=>f+=`<tr><td class="text-right">${n.quantity}</td><td class="text-right">${kendo.toString(n.price,"N2")}</td></tr>`),f+=`</table>`));r=i.prices.find(n=>n.subsidiary.toLowerCase()==="iquique");r&&(r.offer>0?e+=`<span class="offer">${kendo.toString(r.offer,"N2")}</span><span class="regular with-offer">${kendo.toString(r.regular,"N2")}</span>`:r.regular>0&&(e+=kendo.toString(r.regular,"N2")),r.volume&&r.volume.length>0&&(e+=`<br /><table><thead><tr><td class="text-right">Cantidad</td><td class="text-right">Precio</td></tr></thead>`,r.volume.forEach(n=>e+=`<tr><td class="text-right">${n.quantity}</td><td class="text-right">${kendo.toString(n.price,"N2")}</td></tr>`),e+=`</table>`));r=i.prices.find(n=>n.subsidiary.toLowerCase()==="miami");r&&(r.offer>0?o+=`<span class="offer">${kendo.toString(r.offer,"N2")}</span><span class="regular with-offer">${kendo.toString(r.regular,"N2")}</span>`:r.regular>0&&(o+=kendo.toString(r.regular,"N2")),r.volume&&r.volume.length>0&&(o+=`<br /><table><thead><tr><td class="text-right">Cantidad</td><td class="text-right">Precio</td></tr></thead>`,r.volume.forEach(n=>o+=`<tr><td class="text-right">${n.quantity}</td><td class="text-right">${kendo.toString(n.price,"N2")}</td></tr>`),o+=`</table>`));u=n.stockItems.filter(n=>n.itemCode===i.itemCode&n.subsidiary.toLowerCase()==="santa cruz");u&&u.length>0&&(s+=`<table><thead><tr><td></td><td class="text-right">Stock</td><td class="text-right">Reserva</td><td class="text-right">Disponible</td><td class="text-right">Tránsito</td></tr></thead>`,u.forEach(n=>{s+=`<tr><td>${n.warehouse}</td><td class="text-right">${n.stock}</td><td class="text-right">${n.reserved}</td><td class="text-right">${n.available2}</td><td class="text-right">${n.requested}</td></tr>`}),s+="<\/table>");u=n.stockItems.filter(n=>n.itemCode===i.itemCode&n.subsidiary.toLowerCase()==="iquique");u&&u.length>0&&(h+=`<table><thead><tr><td></td><td class="text-right">Stock</td><td class="text-right">Reserva</td><td class="text-right">Disponible</td><td class="text-right">Tránsito</td></tr></thead>`,u.forEach(n=>{h+=`<tr><td>${n.warehouse}</td><td class="text-right">${n.stock}</td><td class="text-right">${n.reserved}</td><td class="text-right">${n.available2}</td><td class="text-right">${n.requested}</td></tr>`}),h+="<\/table>");u=n.stockItems.filter(n=>n.itemCode===i.itemCode&n.subsidiary.toLowerCase()==="miami");u&&u.length>0&&(c+=`<table><thead><tr><td></td><td class="text-right">Stock</td><td class="text-right">Reserva</td><td class="text-right">Disponible</td><td class="text-right">Tránsito</td></tr></thead>`,u.forEach(n=>{c+=`<tr><td>${n.warehouse}</td><td class="text-right">${n.stock}</td><td class="text-right">${n.reserved}</td><td class="text-right">${n.available2}</td><td class="text-right">${n.requested}</td></tr>`}),c+="<\/table>");t.append(`<tr><td>${i.itemCode}</td><td>${i.name}</td><td>${i.warranty}</td><td class="text-right">${f}</td><td class="text-right">${s}</td><td class="text-right">${e}</td><td class="text-right">${h}</td><td class="text-right">${o}</td><td class="text-right">${c}</td></tr>`)})})})});$("<div>").append(t).kendoWindow({visible:!0,scrollable:!0,modal:!0,width:1400,iframe:!1,activate:function(n){var t=this;setTimeout(()=>{onRefreshWindow(n),t.center()},300)}})}}else console.error(`Se he producido el siguiente error al traer los datos del servidor: ${n.message}`),showError("Se he producido el siguiente error al traer los datos del servidor")}))}function showHiddenContent(n){n.preventDefault();$(this).find("i").toggleClass("fas fa-check-square far fa-square");$(this).attr("data-selected",$(this).attr("data-selected")==="Y"?"N":"Y");$(".volume-price, .commentaries").toggleClass("d-none");setProductHeight()}function onClickBackButton(){$(containerName).empty();setToolbar("I")}function seeReservedDetail(){var t=+this.textContent;if(t>0&&localUser==="Y"){var i=$.trim($(this).closest(".product").find(".product-code").text()),n=$(this).closest(".price").data("subsidiary"),r=$.trim($(this).closest("tr").find("td").first().text());$.get(urlReservedItems,{Subsidiary:n,Warehouse:r,ItemCode:i},function(t){var u,i,r;t.message===""?(u=n.toLowerCase()==="iquique"?"<th>Autorizado<\/th><th>Correlativo<\/th>":"",i=`<table class="table"><thead class="thead-light"><tr><th scope="col">Ejecutivo</th><th scope="col">Cliente</th><th scope="col">Orden</th><th scope="col">Fecha</th><th scope="col" class="text-right">Cantidad</th><th scope="col" class="text-right">Precio</th>${u}<th>&nbsp;</th></thead><tbody>`,$.each(t.items,function(t,r){var u=n.toLowerCase()==="iquique"?`<td class="text-center">${r.authorized==="Y"?'<i class="fas fa-check"><\/i>':""}</td><td>${r.correlative}</td>`:"";i+=`<tr><td>${r.sellerName}</td><td><strong>${r.clientCode}</strong> - ${r.clientName}</td><td><a class="sale-order action action-link" data-subsidiary="${r.subsidiary}" data-number="${r.docNum}">${r.docNum}</a></td><td>${kendo.toString(JSON.toDate(r.docDate),"dd-MM-yyyy")}</td><td class="text-right">${r.quantity}</td><td class="text-right">${r.price!==null?kendo.toString(r.price,"N2"):""}</td>${u}<td>`;r.hasFiles&&$.each(r.files,function(n,t){i+=`<a href="#" title="${t}" class="open-file" data-subsidiary="${r.subsidiary}" data-code="${r.docEntry}" data-file="${t}"><span class="glyphicon glyphicon-paperclip"></span></a>&nbsp;&nbsp;&nbsp;`});i+=`</td></tr>`}),i+="<\/tbody><\/table>",r=$("#Detail").data("kendoWindow"),r.setOptions({title:"Detalle Reservas"}),r.content(i),r.open().center()):showError(`Se ha producido el siguiente error al traer los datos: ${t.message}`)})}}function seeProductDetail(n){var t=$(n.target).closest(".product").find("#productId").val();$("<div>").kendoWindow({visible:!0,scrollable:!0,modal:!0,width:1180,iframe:!1,content:{url:urlGetDetailPopup,data:{Id:t}},activate:function(n){var t=this;setTimeout(()=>{onRefreshWindow(n),t.center()},300)}})}function addToCart(n){var s=$(n.currentTarget).closest(".product").find("#productId").val(),c=$(n.currentTarget).closest(".product").find(".product-code").text(),l=$(n.currentTarget).closest(".product").find(".product-name").text(),i=$(n.currentTarget).closest(".product").hasClass("open-box"),r=0,u=0,f,e,t,o,h;i&&(f=$(n.currentTarget).closest(".product").find(".product-prices div"),r=f.find("span.price").text().replace(",",""),u=f.find("span.quantity").text().replace(",",""));e=$("#CartDetail").data("kendoWindow");t=$("#cart-subsidiary").data("kendoDropDownList");$("#cart-idproduct").val(s);$("#cart-openbox").val(i?"Y":"N");$("#cart-quantity").val("1");$("#cart-quantity").removeAttr("max");$("#cart-itemcode").text(c);$("#cart-itemname").text(l);i?(o=[{Id:1,Name:"Santa Cruz",Price:r,Max:u}],h=new kendo.data.DataSource({data:o}),t.setDataSource(h),t.select(0),$("#cart-price").text(kendo.toString(r,"N2")),$("#cart-pricedata").val(JSON.stringify(o)),$("#cart-quantity").attr("max",u),e.center().open()):$.get(urlGetSubsidiariesByProduct,{ProductId:s},n=>{var i=new kendo.data.DataSource({data:n});t.setDataSource(i);t.select(0);n.length>0&&$("#cart-price").text(kendo.toString(n[0].price,"N2"));$("#cart-pricedata").val(JSON.stringify(n));e.center().open()})}function addItemToCart(n){var t,i;if(n.preventDefault(),t=$(this).closest("form"),i=t.kendoValidator().data("kendoValidator"),i.validate()){var e=$("#cart-idproduct").val(),o=$("#cart-openbox").val()==="Y",s=JSON.parse($("#cart-pricedata").val()),r=$("#cart-subsidiary").data("kendoDropDownList").value(),u,h=$("#cart-itemcode").text(),c=$("#cart-quantity").val(),f;u=s.find(n=>n.id===r);f=$("#LocalUser").val()==="Y"?urlAddItemTS:urlAddItemSC;$.post(f,{IdSubsidiary:r,IdProduct:e,Price:u.price,Quantity:c,OpenBox:o,Warehouse:""},function(n){n.message===""?($("#CartDetail").data("kendoWindow").close(),notification.show({title:"Item Agregado",message:`Producto (<strong>${h}</strong>) agregado correctamente.`},"success")):notification.show({title:"Error",message:n.message},"error")})}}function showSaleOrder(n){var t=n.currentTarget.dataset,i=$("#Report").getKendoWindow();i.title("Orden de Venta");loadReport(t.number,t.subsidiary,"Order");i.open().center()}function showProviderOrders(){var n=+this.textContent;if(n>0){var t=$.trim($(this).closest(".product").find(".product-code").text()),i=$(this).closest(".price").data("subsidiary"),r=$.trim($(this).closest("tr").find("td").first().text());$.get(urlGetProviderOrders,{Subsidiary:i,Warehouse:r,ItemCode:t},function(n){var t,i;n.message===""?(t="",n.items&&n.items.length>0&&(t=`<table class="table"><thead class="thead-light"><tr><th scope="col">#</th><th scope="col">Proveedor</th><th scope="col" class="text-center">Fecha</th><th scope="col">Referencia</th><th scope="col" class="text-right">Cantidad</th><th scope="col" class="text-right">Cantidad Abierta</th><th scope="col" class="text-right">Precio</th></thead><tbody>`,n.items.forEach(n=>t+=`<tr><td>${n.docNumber}</td><td>${n.providerName}</td><td class="text-center">${kendo.toString(JSON.toDate(n.docDate),"dd-MM-yyyy")}</td><td>${$.trim(n.referenceOrder)}</td><td class="text-right">${n.quantity}</td><td class="text-right">${n.openQuantity}</td><td class="text-right">${kendo.toString(n.price,"N2")}</td></tr>`),t+="<\/tbody><\/table>"),i=$("#Detail").data("kendoWindow"),i.setOptions({title:"Detalle Ordenes a Proveedor"}),i.content(t),i.open().center()):showError(`Se ha producido el siguiente error al traer los datos: ${n.message}`)})}}function addRequirement(n){var t=$(n.currentTarget).closest(".product").find("#productId").val(),i=$.trim($(n.currentTarget).closest(".product").find(".product-code").text()),r=$(n.currentTarget).closest(".product").find(".product-name").text();$("#ProductName").text(`( ${i} ) ${r}`);$("#IdProduct").val(t);$("#CardCode").data("kendoDropDownList").value("");$("#IdSubsidiary").data("kendoDropDownList").value(1);$("#Quantity").val(1);$("#Description").val("");$("#RequestDetail").data("kendoWindow").open()}function onSavingRequest(n){var t,i;if(n.preventDefault(n),t=$(this).closest("form"),i=t.kendoValidator({messages:{required:""}}).data("kendoValidator"),i.validate()){var r=$("#IdProduct").val(),u=$("#CardCode").data("kendoDropDownList").value(),f=$("#IdSubsidiary").data("kendoDropDownList").value(),e=$("#Quantity").val(),o=$("#Description").val(),s=$("#ProductName").text(),h={Id:0,IdProduct:r,IdSubsidiary:f,CardCode:u,Quantity:e,Description:o};$.post(urlAddRequest,{Item:h},function(n){n.message===""?(notification.show({title:"Solicitud guardada",message:`Producto (<strong>${s}</strong>) agregado correctamente.`},"success"),$("#RequestDetail").data("kendoWindow").close()):(console.error(n.message),notification.show({title:"Error",message:"Se produjo un error al guardar los datos, intente nuevamente por favor."},"error"))})}}function handleImageError(n){n.src=urlNoImage}function onListSelected(n){var t=n.currentTarget.id.replace("op-","").toLowerCase();$(n.currentTarget).closest(".card-body").find(".regular").each((n,i)=>{var r=$(i).data();$(i).text(kendo.toString(r[t],"N2")+" $Us")})}function onShowingClients(){var r=$(this).parent().find(".active input"),u=$(this).closest(".line-header").data(),t=r[0].id.replace("op-",""),i=$("<div>").kendoWindow({title:`Clientes ${t}`,width:500,close:function(){this.destroy()}}).data("kendoWindow"),n="";$.get(urlClientsByGroup,{ListName:t.toLowerCase(),LineId:u.idline},function(r){r.message==""?r.items.length>0?(n='<div class="w-100 p-3">',r.items.forEach(t=>n+=`<div>( <b>${t.code}</b> ) ${t.name}</div>`),n+="<\/div>"):n=`<div class="w-100 p-3">${t=="Portal"?"No es necesario subscribir clientes en esta lista.":"No existen clientes subscritos a esta lista."}</div>`:n='<div class="w-100 p-3">Se ha producido un error al traer la lista de clientes.<\/div>';i.content(n);i.center().open()})}var subsidiaries=[],clients=[],localUser,seeStock,notification;const containerName="#products-content",productTemplate=`# var productClass = isNew ? "new-product" : ""; #
    <div class="product" data-id="#=itemCode#" data-show-always="#=showAlways#">
        <div class="product-body">
            <div class="product-image">
                # if($.trim(imageURL) !== "") { #
                <img src="${urlImagesProduct}/#=imageURL#" loading="lazy" onerror="handleImageError(this);" />
                # } else { #
                <img src="${urlNoImage}" loading="lazy" />
                # } #
                # if (isNew) { # <img src="${urlNewImage}" class="new" loading="lazy" /> # } #
            </div>
            <div class="product-desc">
                <input id="productId" name="productId" type="hidden" value="#=id#">
                # if (localUser === "Y" && showTeamOnly) { #
                <div class="local-only">
                    <div>
                        # if ($.trim(link) !== "") { #
                        <a href="#=link#" target="_blank" class="product-code action-link"><strong>#=itemCode#</strong></a>
                        # } else { #
                        <b>#=itemCode#</b>
                        # } #
                        <span>(S&oacute;lo visible por el equipo DMC)</span>
                    </div>
                </div>
                # } else { #
                <div class="product-code">
                    # if ($.trim(link) != "") { #
                    <a href="#=link#" target="_blank" class="action-link"><strong>#=itemCode#</strong></a>
                    # } else { #
                    <b>#=itemCode#</b>
                    # } #
                </div>
                # } #
                <div class="product-name">#=name#</div>
                # if ($.trim(description) != "") { # <div>#=description#</div>	# } #
                # if ($.trim(extraComments) != "") { #	<div>#=extraComments#</div>	# } #
                # if ($.trim(commentaries) != "") { #
                <div class="product-comments">
                    <a class="action-link" data-toggle="collapse" href="\\#product-comments-#=id#" role="button" aria-expanded="false" aria-controls="product-comments-#=id#">Mostrar Comentarios</a>
                    <div id="product-comments-#=id#" class="collapse">#=commentaries#</div>
                </div>
                # } #
                # if ($.trim(consumables) !== "") { # <div>#=consumables#</div>	# } #
                # if ($.trim(warranty) !== "") { # <div>#=warranty#</div> # } #
            </div>
            <div class="product-prices">
                # for (var i = 0; i < prices.length; i++) { #
                #   var price = prices[i]; #
                #   var dataPrice = (price.regular > 0 || price.offer > 0 || $.trim(price.offerDescription) !== "") ? "Y" : "N"; #
                #   var fob = price.subsidiary.toLowerCase() !== "santa cruz" ? "FOB" : ""; #
                <div class="price #=price.subsidiary.toLowerCase().replace(' ', '-')#" data-price="#=dataPrice#" data-subsidiary="#=price.subsidiary#" data-digital="#=(isDigital ? 'Y' : 'N')#">
                    <b>#=prices[i].subsidiary#</b><br>
                    # if (price.offer > 0) { #
                    <div class="offer">Oferta: <span>#=fob# #=kendo.toString(price.offer, "N2")# $Us</span> 
                        #if(price.offerSince) {# <br />Desde: #=kendo.toString(JSON.toDate(price.offerSince), "dd-MM-yyyy")# #}#
                        #if(price.offerUntil) {# <br />Hasta: #=kendo.toString(JSON.toDate(price.offerUntil), "dd-MM-yyyy")# #}#
                    </div>
                    #   if ($.trim(price.offerDescription) !== "") { #
                    <div class="offer-desc">#=price.offerDescription#</div>
                    #   } #
                    # } #
                    # if (price.regular > 0) { #
                    #   var offerClass = price.offer > 0 ? "with-offer" : "", dataPrices = ''; #
                    #   for (var ipr = 0; ipr < price.otherPrices.length; ipr++) { #
                    #      dataPrices += 'data-' + price.otherPrices[ipr].name + '="' + price.otherPrices[ipr].price + '"'; #
                    #   } #
                    <div class="regular #=offerClass#" #=dataPrices#>#=fob# #=kendo.toString(price.regular, "N2")# $Us</div>
                    # } #
                    # if (localUser === "Y" && price.suggested > 0) { #
                    <div class="suggested">Precio sugerido: #=kendo.toString(price.suggested, "N2")# $Us</div>
                    # } #
                    # if (localUser === "Y" && price.volume && price.volume.length > 0) { #
                    #   for (var j = 0; j < price.volume.length; j++) { #
                    #       var vol = price.volume[j]; #
                    <div class="volume-price">
                        <p>
                            #=vol.quantity# items: #=vol.price# $Us
                            # if ($.trim(vol.observations) !== "") { #
                            <br />#=vol.observations#
                            # } #
                        </p>
                    </div>
                    #   } #
                    # } #
                    # if ($.trim(price.observations) !== "") { #
                    # var obsClass = price.regular <= 0 && !(price.offer && price.offer > 0) ? "highlighted" : "" #
                    <div class="observations #=obsClass#">#=price.observations#</div>
                    # } #
                    # if (localUser === "Y" && $.trim(price.commentaries) !== "") { #
                    <div class="commentaries"><span>Comentario Interno:</span> #=price.commentaries#</div>
                    # } #
                    <div class="stock">
                    </div>
                </div>
                # } #
            </div>
        </div>
        <div class="product-footer">
            <a class="add-cart" title="Agregar al carrito"><i class="fa fa-cart-plus"></i> <span>Agregar al carrito</span></a>
            <a class="detail-product" title="Vista Preliminar"><i class="fas fa-window-restore"></i></a>
            # var urlProduct = urlDetailProduct + "?Id=" + id; #
            <a title="Detalle completo del producto" target="_blank" href="#=urlProduct#"><i class="fas fa-external-link-alt"></i></a>
            <a class="add-requirement" title="Agregar requerimiento del producto"><i class="fas fa-plus-circle"></i></a>
        </div>
    </div>`;$(()=>setupControls());$(document).ajaxError(catchErrors);$(containerName).on("hide.bs.collapse show.bs.collapse",n=>$(n.target).prev().find("i:last-child").toggleClass("fa-angle-up fa-angle-down"));document.addEventListener("scroll",onScroll,!0);$("#LineList").on("click",".line-inner",onClickInnerLine);$("#LineList").on("click",".submenu-item",onClickSubmenuItem);$("[name='layouts']").on("change",onChangeLayout);$("#filter-box").on("shown.bs.collapse",()=>$(document).scrollTop(0));$("#action-excel").click(onExportExcel);$("#action-table").click(showTable);$("#show-all").click(showHiddenContent);$("#action-back").click(onClickBackButton);$(containerName).on("click",".product-comments a",n=>n.target.innerHTML=n.target.innerHTML==="Mostrar Comentarios"?"Ocultar Comentarios":"Mostrar Comentarios");$(containerName).on("click",".detail-reserve",seeReservedDetail);$(containerName).on("click",".detail-product",seeProductDetail);$(containerName).on("click",".action-see-order",showProviderOrders);$("#search-products").click(filterData);$(containerName).on("click",".add-cart",addToCart);$(containerName).on("click",".add-requirement",addRequirement);$("#cart-additem").click(addItemToCart);$("body").on("click",".sale-order",showSaleOrder);$("#save-request").click(onSavingRequest);$(containerName).on("click",'[name="options"]',onListSelected);$(containerName).on("click",".see-clients",onShowingClients);