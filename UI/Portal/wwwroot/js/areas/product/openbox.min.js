function setupControls(){$("#FilSubsidiary").kendoDropDownList({dataTextField:"name",dataValueField:"id",optionLabel:"Seleccione una Sucursal...",dataSource:{transport:{read:{url:urlSubsidiaries}}}});$("#Listado").kendoGrid({columns:[{title:"Sucursal",width:"150px",field:"subsidiary"},{title:"Almacén",width:"150px",field:"warehouse"},{title:"Cod.",width:"200px",field:"itemCode"},{title:"Producto",field:"itemName"},{title:"Cantidad",attributes:alignRight,headerAttributes:alignRight,width:"100px",field:"quantity"},{title:"Precio",attributes:alignRight,headerAttributes:alignRight,width:"100px",field:"price",format:"{0:N2}",groupable:!1},{title:"Habilitado",attributes:alignCenter,headerAttributes:alignCenter,width:"100px",template:'# if(enabled) {# <i class="fas fa-check"><\/i> #} #',field:"enabled"},{title:"Con Stock",attributes:alignCenter,headerAttributes:alignCenter,width:"100px",template:'# if(withStock) {# <i class="fas fa-check"><\/i> #} #',field:"withStock"},{field:"id",title:" ",attributes:alignCenter,width:80,sortable:!1,headerAttributes:alignCenter,headerTemplate:'<i class="fas fa-plus action new-product" title="Nuevo Producto"><\/i>',template:'<i class="fas fa-pen action action-edit" title="Editar Producto"><\/i>&nbsp;&nbsp;<i class="fas fa-trash-alt action action-delete" title="Eliminar Producto"><\/i>'}],sortable:!0,selectable:"Single, Row",noRecords:{template:"No existen resultados para el criterio de búsqueda."},dataSource:[]});$("#Detail").kendoWindow({visible:!1,modal:!0,iframe:!1,scrollable:!0,title:"Producto Abierto",resizable:!1,width:800,actions:["Close"],refresh:function(n){$("#IdProduct").kendoDropDownList({dataTextField:"name",dataValueField:"id",ignoreCase:!0,optionLabel:"Seleccione un Producto...",filter:"contains",virtual:{itemHeight:26,valueMapper:function(n){var t=$("#IdProduct").data("kendoDropDownList").dataSource.data(),i=Enumerable.From(t).Where(t=>t.id===n.value).FirstOrDefault(),r=Enumerable.From(t).IndexOf(i);n.success(r)}},dataSource:{transport:{read:{url:urlProducts}}}});$("#IdSubsidiary").kendoDropDownList({dataTextField:"name",dataValueField:"id",ignoreCase:!0,optionLabel:"Seleccione una Sucursal...",dataSource:{transport:{read:{url:urlSubsidiaries}}}});$("#Warehouse").kendoDropDownList({autoBind:!1,cascadeFrom:"IdSubsidiary",dataTextField:"name",dataValueField:"name",enable:!1,ignoreCase:!0,optionLabel:"Seleccione un Almacén...",dataSource:{transport:{read:{url:urlWarehouses,data:()=>({Subsidiary:$("#IdSubsidiary").data("kendoDropDownList").text()})}},serverFiltering:!0}});onRefreshWindow(n)}})}function getFilters(){var n=$("#FilSubsidiary").data("kendoDropDownList").value(),t=$("#FilProduct").val(),i=$("#FilEnabled").prop("checked"),r=$("#FilWithStock").prop("checked");return{IdSubsidiary:n,Product:t,Enabled:i,WithStock:r}}function filterData(){var n=getFilters();$.get(urlFilter,n,function(n){n.message!==""?(showError(n.message),loadGrid([])):loadGrid(n.items)})}function loadGrid(n){var i=$("#Listado").getKendoGrid(),r=new kendo.data.DataSource({data:n}),t;i.setDataSource(r);t=_gridMargin;n&&n.length>0&&($("#filter-box").collapse("hide"),t-=20);setTimeout(()=>{setGridHeight("Listado",t)},200)}function getWarehousesFilter(){return{Subsidiary:$("#IdSubsidiary").data("kendoDropDownList").text()}}const alignCenter={style:"text-align: center;"},alignRight={style:"text-align: right;"},dateFormat="{0:dd-MM-yyyy HH:mm:ss}",_gridMargin=30;$(function(){setupControls();filterData()});$(window).resize(function(){setGridHeight("Listado",_gridMargin)});$("#action-search").click(function(){filterData()});$("#action-clean").click(()=>{$("#FilSubsidiary").data("kendoDropDownList").value(""),$("#FilProduct").val(""),$("#FilEnabled").prop("checked",!0),$("#FilWithStock").prop("checked",!0),loadGrid([])});$("#Listado").on("click",".new-product",function(){var n=$("#Detail").data("kendoWindow");n.refresh({url:urlEdit,data:{Id:0}});n.open()});$("#Listado").on("click",".action-edit",function(){var t=$("#Listado").data("kendoGrid"),i=t.dataItem($(this).closest("tr")),n=$("#Detail").data("kendoWindow");n.setOptions({title:"Detalle de Producto",width:900});n.refresh({url:urlEdit,data:{Id:i.id}});n.open()});$("#Listado").on("click",".action-delete",function(){var t=$("#Listado").data("kendoGrid"),n=t.dataItem($(this).closest("tr")),i=getFilters();showConfirm(`¿Está seguro que desea eliminar el producto <b>${n.itemCode}</b>?`,()=>{$.post(urlDelete,{Id:n.id,Filters:i},function(t){t.message===""?(loadGrid(t.items),showMessage(`Se ha eliminado el producto <b>${n.itemCode}</b> correctamente.`)):showError(t.message)})})});$("#Detail").on("click","#action-cancel",function(){$("#Detail").data("kendoWindow").close()});$("#Detail").on("click","#action-save",function(){var r={rules:{amounts:n=>n.is("#Quantity")||n.is("#Price")?n.val()>0:!0},messages:{required:"*",amounts:"Debe ser mayor a 0."}},n=$(this).closest("form"),u=n.kendoValidator(r).data("kendoValidator"),t=$("#Detail").data("kendoWindow"),f=getFilters(),i;u.validate()?(i=n.serializeObject(),$.post(urlEdit,{Item:i,Filters:f},function(n){n.message===""?(showMessage("Sus datos se actualizaron correctamente."),t.close(),loadGrid(n.items)):showError(n.message)})):t.center()});