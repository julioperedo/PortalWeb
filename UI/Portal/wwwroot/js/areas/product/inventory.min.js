function loadWarehouses(){var n,t;$("#FilWarehouses").empty();n=$("#FilSubsidiaries").multipleSelect("getSelects");n&&n.length>0?(t=Enumerable.From(n).Select(function(n){return`'${n}'`}).ToArray().join(),$.get(urlWarehouses,{Subsidiary:t},function(n){n.message!==""?(showError(n.message),$("#FilWarehouses").multipleSelect("disable")):n.items.length>0?($.each(n.items,function(n,t){$("#FilWarehouses").append(new Option(t.name,t.name))}),$("#FilWarehouses").multipleSelect("enable")):$("#FilWarehouses").multipleSelect("disable");$("#FilWarehouses").multipleSelect("refresh").multipleSelect("uncheckAll")})):$("#FilWarehouses").multipleSelect("refresh").multipleSelect("disable")}function filterSubcategories(){return{CategoryId:$("#FilCategory").val()}}function cleanFilters(){$("#FilSubsidiaries").multipleSelect("uncheckAll");$("#FilItemCode").val("");$("#FilDescription").val("");$("#FilCategory").data("kendoDropDownList").value("");$("#FilLines").multipleSelect("uncheckAll");$("#FilAvailable").prop("checked",!0);$("#FilBlocked").prop("checked",!1)}function loadGrid(n){var t=$("#Listado").data("kendoGrid"),i=getDataSource(n);t.setDataSource(i);n&&n.length>0?($("#filter-box").collapse("hide"),$("#action-excel").removeClass("d-none")):$("#action-excel").addClass("d-none");setGridHeight("Listado",gridMargin)}function filterData(){var n=getFilters();n.message===""?$.get(urlFilter,n.data,function(n){n.message!==""?(showError(n.message),loadGrid([])):loadGrid(n.items)}):showInfo(`Los siguientes campos son necesarios: <br />${n.message}`)}function setupGrid(n,t){var i={style:"text-align: right"},r=[{field:"category",title:"Categoría",hidden:!0,width:120,aggregates:["count"],groupHeaderTemplate:"Categoría: #=value#    (Total: #=count#)"},{field:"subcategory",title:"Subcategoría",width:120,aggregates:["count"],groupHeaderTemplate:"Subcategoría: #= value #    (Total: #= count#)"},{field:"subsidiary",title:"Sucursal",width:120,aggregates:["count"],groupHeaderTemplate:"Sucursal: #= value #    (Total: #= count#)"},{field:"warehouse",title:"Almacén",hidden:!0,width:250,aggregates:["count"],groupHeaderTemplate:"Almacén: #= value #    (Total: #= count#)"},{field:"itemCode",title:"Item",width:160,groupable:!1,template:"<a class='item-code action action-link'>#:itemCode#<\/a>"},{field:"itemName",title:"Descripción",width:300,groupable:!1}];n?r.push({field:"stock",title:"Stock",width:90,groupable:!1,attributes:i,headerAttributes:i},{field:"reserved",title:"Reserva",width:90,groupable:!1,attributes:i,headerAttributes:i},{field:"requested",title:"Pedido",width:90,groupable:!1,attributes:i,headerAttributes:i},{field:"available",title:"Disponible",width:110,groupable:!1,attributes:i,headerAttributes:i}):t?r.push({field:"available2",title:"Disponible",width:110,groupable:!1,attributes:i,headerAttributes:i}):r.push({field:"percentage",title:"Disponible",width:110,groupable:!1,attributes:i,headerAttributes:i});$("#Listado").kendoGrid({dataBound:n=>{for(var t=n.sender,i=0;i<t.columns.length;i++)t.showColumn(i);$("div.k-group-indicator").each(function(n,i){t.hideColumn($(i).data("field"))});t.element.find("table").attr("style","")},groupable:{enabled:!0,messages:{empty:"Arrastre un encabezado de columna y colóquela aquí para agrupar por esa columna"}},pageable:{enabled:!0},noRecords:{template:"No existen resultados para el criterio de búsqueda."},scrollable:!0,sortable:!0,selectable:!0,columns:r,dataSource:getDataSource([])})}function getDataSource(n){return new kendo.data.DataSource({data:n,pageSize:500,aggregate:[{aggregate:"count",field:"subsidiary"},{aggregate:"count",field:"warehouse"},{aggregate:"count",field:"category"},{aggregate:"count",field:"subcategory"}],group:[{field:"category",dir:"asc",aggregates:[{field:"category",aggregate:"count"}]},{field:"subcategory",dir:"asc",aggregates:[{field:"subcategory",aggregate:"count"}]}]})}function ExportExcel(){var n=getFilters();n.message===""?window.location.href=urlExcel+"?"+$.param(n.data):showInfo(`Los siguientes campos son necesarios <br />${n.message}`)}function getFilters(){var n,o,t,i,r,u,f,s,h,c,e="";return n=Enumerable.From($("#FilSubsidiaries").multipleSelect("getSelects")).Select(function(n){return`'${n}'`}).ToArray().join(),o=Enumerable.From($("#FilWarehouses").multipleSelect("getSelects")).Select(function(n){return`'${n}'`}).ToArray().join(),$.trim(n)===""&&(e+=" - Al menos una Sucursal <br />"),t=$.trim($("#FilItemCode").val()),i=$.trim($("#FilDescription").val()),$("#FilCategory").data("kendoDropDownList").value()!==""&&(r=$("#FilCategory").data("kendoDropDownList").text()),$("#FilSubcategory").data("kendoDropDownList").value()!==""&&(u=$("#FilSubcategory").data("kendoDropDownList").text()),f=Enumerable.From($("#FilLines").multipleSelect("getSelects")).Select(function(n){return`'${n}'`}).ToArray().join(),s=$("#FilAvailable").prop("checked"),h=$("#FilStock").prop("checked"),c=$("#FilBlocked").prop("checked"),t===""&&i===""&&r===""&&u===""&&f===""&&(e+=" - Al menos un criterio de búsqueda que no sea de localización"),{message:e,data:{Subsidiaries:n,WareHouses:o,ItemCode:t,Description:i,Category:r,Subcategory:u,Line:f,Available:s,Stock:h,Blocked:c}}}const gridMargin=30;$(function(){$.get(urlSubsidiaries,{},function(n){var t=$("#FilSubsidiaries");$.each(n.items,function(n,i){t.append(new Option(i.name,i.name))});t.multipleSelect({onUncheckAll:()=>$("#FilWarehouses").empty().multipleSelect("refresh").multipleSelect("disable"),onCheckAll:()=>loadWarehouses(),onClick:()=>loadWarehouses()}).multipleSelect("uncheckAll")});$("#FilWarehouses").multipleSelect().multipleSelect("disable");$.get(urlLines,{},function(n){var t=$("#FilLines");$.each(n,function(n,i){t.append(new Option(i.name,i.name,!1,!1))});t.multipleSelect().multipleSelect("uncheckAll")});setupGrid($("#IsLocal").val()==="Y",$("#IsClientAllowed").val()==="Y");setGridHeight("Listado",gridMargin)});$(window).resize(function(){setGridHeight("Listado",gridMargin)});$("#filter-box").on("hidden.bs.collapse",function(){setGridHeight("Listado",gridMargin)});$("#filter-box").on("shown.bs.collapse",function(){setGridHeight("Listado",gridMargin)});$("#action-clean").click(function(){cleanFilters()});$("#action-filter").click(function(){filterData()});$("#Listado").on("click",".item-code",function(n){var i=$("#Detail").data("kendoWindow"),r=$("#Listado").data("kendoGrid"),u=$(n.currentTarget).closest("tr"),t;r.select(u);t=r.dataItem(u);i.refresh({url:urlDetail,data:{ItemCode:t.itemCode,Subsidiary:t.subsidiary}});i.open()});$("#action-excel").on("click",function(){ExportExcel()});