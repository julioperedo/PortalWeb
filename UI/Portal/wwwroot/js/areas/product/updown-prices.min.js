function setupControls(){roundOptions=$("#round-options").kendoRadioGroup({layout:"horizontal",items:[{value:"N",label:"Sin redondeo"},{value:"U",label:"Redondeo hacia arriba"},{value:"D",label:"Redondeo hacia abajo"}],value:"N",change:function(n){spreadsheet.activeSheet().range(4,5,productsCount,1).formula(roundBy("E5*((100+$E$4)/100)",n.newValue));spreadsheet.activeSheet().range(4,7,productsCount,1).formula(roundBy("G5*((100+$G$4)/100)",n.newValue));spreadsheet.activeSheet().range(4,10,productsCount,1).formula(roundBy("J5*((100+$J$4)/100)",n.newValue));spreadsheet.activeSheet().range(4,12,productsCount,1).formula(roundBy("L5*((100+$L$4)/100)",n.newValue));spreadsheet.activeSheet().range(4,15,productsCount,1).formula(roundBy("O5*((100+$O$4)/100)",n.newValue));spreadsheet.activeSheet().range(4,17,productsCount,1).formula(roundBy("Q5*((100+$Q$4)/100)",n.newValue))}}).data("kendoRadioGroup");$.get(urlLines,{},function(n){n.forEach(n=>ddlLines.append(new Option(n.name,n.id)));ddlLines.multipleSelect({minimumCountSelected:5,onUncheckAll:noLineChecked,onCheckAll:lineChanged,onClick:lineChanged})});spreadsheet=$("#items-list").kendoSpreadsheet({toolbar:!1,sheetsbar:!1,defaultCellStyle:{fontSize:11},rows:2500,sheets:[{columns:[{width:150},{width:150},{width:150},{width:150},{width:75},{width:75},{width:75},{width:75},{width:75},{width:75},{width:75},{width:75},{width:75}]}]}).data("kendoSpreadsheet");var n=[];n.push(["","","","","Santa Cruz","","","","","Iquique","","","","","Miami","","","",""]);n.push(["","","","","Regular","","Oferta","","Volumen","Regular","","Oferta","","Volumen","Regular","","Oferta","","Volumen"]);n.push(["","","","","Original","Modificado","Original","Modificado","","Original","Modificado","Original","Modificado","","Original","Modificado","Original","Modificado",""]);n.push(["Linea","Categoria","Subcategoria","Item",0,"",0,"",0,0,"",0,"",0,0,"",0,"",0]);spreadsheet.activeSheet().range(0,0,4,19).values(n);spreadsheet.activeSheet().range(0,4,1,5).textAlign("center").merge();spreadsheet.activeSheet().range(0,9,1,5).textAlign("center").merge();spreadsheet.activeSheet().range(0,14,1,5).textAlign("center").merge();spreadsheet.activeSheet().range(1,4,1,2).textAlign("center").merge();spreadsheet.activeSheet().range(1,6,1,2).textAlign("center").merge();spreadsheet.activeSheet().range(1,9,1,2).textAlign("center").merge();spreadsheet.activeSheet().range(1,11,1,2).textAlign("center").merge();spreadsheet.activeSheet().range(1,14,1,2).textAlign("center").merge();spreadsheet.activeSheet().range(1,16,1,2).textAlign("center").merge();spreadsheet.activeSheet().range(2,4,1,15).textAlign("right");spreadsheet.activeSheet().range(3,4,1,2).merge();spreadsheet.activeSheet().range(3,6,1,2).merge();spreadsheet.activeSheet().range(3,9,1,2).merge();spreadsheet.activeSheet().range(3,11,1,2).merge();spreadsheet.activeSheet().range(3,14,1,2).merge();spreadsheet.activeSheet().range(3,16,1,2).merge();spreadsheet.activeSheet().range(0,0,3,19).background("#0059B2").color("#FFFFFF");spreadsheet.activeSheet().range(3,0,1,4).background("#0059B2").color("#FFFFFF");spreadsheet.activeSheet().range(3,4,1,15).background("#BFDFFF");spreadsheet.activeSheet().frozenRows(4)}function lineChanged(){var n=spreadsheet.activeSheet();n.range(4,0,productsCount,16).value("");$.get(urlProducts,{LineIds:ddlLines.multipleSelect("getSelects").join()},function(t){if(t.message==""){if(t.items.length>0){var i=[],r=Enumerable.From(t.items).GroupBy("{ line: $.line + ' ' + $.category }",null,function(n,t){var r={line:n.line},u=0;return t.source.forEach(n=>{u++<11&&i.push([n.line,n.category,n.subcategory,n.itemCode,n.priceSA,"",n.offerSA,"","Sin Preview",n.priceIQ,"",n.offerIQ,"","Sin Preview",n.priceLA,"",n.offerLA,"","Sin Preview"])}),r},"$.line + ' ' + $.category").ToArray();n.range(4,0,i.length,19).values(i);n.range(4,5,i.length,1).formula(roundBy("E5*((100+$E$4)/100)",roundOptions.value()));n.range(4,7,i.length,1).formula(roundBy("G5*((100+$G$4)/100)",roundOptions.value()));n.range(4,10,i.length,1).formula(roundBy("J5*((100+$J$4)/100)",roundOptions.value()));n.range(4,12,i.length,1).formula(roundBy("L5*((100+$L$4)/100)",roundOptions.value()));n.range(4,15,i.length,1).formula(roundBy("O5*((100+$O$4)/100)",roundOptions.value()));n.range(4,17,i.length,1).formula(roundBy("Q5*((100+$Q$4)/100)",roundOptions.value()));n.range(4,4,i.length,15).format("#,##0.00");n.range(4,0,i.length,20).enable(!1);productsCount=i.length}}else showError("Se ha producido iun error al traer los datos del servidor.")})}function roundBy(n,t){var i=n;return t=="U"&&(i=`ROUNDUP(${n}, 0)`),t=="D"&&(i=`ROUNDDOWN(${n}, 0)`),i}function savePrices(n){n.preventDefault();var t=spreadsheet.activeSheet(),i=t.range("E4").value(),r=t.range("G4").value(),u=t.range("I4").value(),f=t.range("J4").value(),e=t.range("L4").value(),o=t.range("N4").value(),s=t.range("O4").value(),h=t.range("Q4").value(),c=t.range("S4").value(),l=ddlLines.multipleSelect("getSelects").join();$.post(urlSave,{LineIds:l,RegularSA:i,OfferSA:r,VolumeSA:u,RegularIQ:f,OfferIQ:e,VolumeIQ:o,RegularLA:s,OfferLA:h,VolumeLA:c,RoundType:roundOptions.value()},function(n){n.message==""?showMessage("Se han guardado los precios correctamente"):(console.error(n.message),showError("Se ha producido un error al guardar los precios"))})}var ddlLines=$("#lines"),spreadsheet,productsCount=0,roundOptions;const marginGrid=45,alignCenter={"class":"k-text-center !k-justify-content-center"},alignRight={style:"text-align: right;"},alignRight2={"class":"table-header-cell !k-text-right"};$(()=>setupControls());$("#action-save-prices").click(savePrices);const noLineChecked=()=>spreadsheet.activeSheet().range(4,0,productsCount,16).value("");