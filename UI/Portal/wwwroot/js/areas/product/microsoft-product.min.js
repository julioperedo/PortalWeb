function setupControls(){$("#Listado").kendoGrid({columns:[{field:"sku",title:"Sku",width:140},{field:"itemCode",title:"Cod. DMC",width:160},{field:"name",title:"Nombre",width:270},{field:"fulfillmentType",title:"Tipo",width:180},{field:"cost",title:"Costo",format:"{0:N2}",width:90,attributes:alignRight,headerAttributes:alignRight},{field:"price",title:"Precio",format:"{0:N2}",width:90,attributes:alignRight,headerAttributes:alignRight},{field:"enabled",title:"Habilitado",attributes:alignCenter,headerAttributes:alignCenter,width:90,template:n=>n.enabled?'<i class="fas fa-check"><\/i>':""},{field:"itemCode",title:" ",attributes:alignCenter,width:20,sortable:!1,template:n=>$.trim(n.itemCode)!==""?'<i class="fas fa-pen action action-link action-edit" title="Editar Producto"><\/i>':""}],sortable:!0,selectable:"Single, Row",scrollable:{height:200},messages:{noRecords:"No hay registros para el criterio de búsqueda."},dataSource:{schema:{model:{id:"id"}},data:[]}});$("#detail").kendoWindow({title:"Detalle Producto",visible:!1,scrollable:!0,modal:!0,width:850,iframe:!1,activate:function(n){var t=this;setTimeout(()=>{onRefreshWindow(n),t.center()},300)}});$("#prices").kendoGrid({columns:[{field:"amount",title:"Monto",format:numberFormat,attributes:alignRight,headerAttributes:alignRight},{field:"currency",title:"Moneda"},{field:"priceType",title:"Tipo"},{field:"validFrom",title:"Desde",attributes:alignCenter,headerAttributes:alignCenter,format:dateFormat},{field:"validTo",title:"Hasta",attributes:alignCenter,headerAttributes:alignCenter,format:dateFormat},{field:"id",title:" ",width:35,sortable:!1,attributes:alignCenter,template:'<i class="fas fa-pen action action-link action-edit" title="Editar Producto"><\/i>'}],sortable:!0,selectable:"Single, Row",scrollable:{height:200},messages:{noRecords:"No hay registros para el criterio de búsqueda."},dataSource:{schema:{model:{id:"id"}},data:[]}});filterData()}function filterData(){$.get(urlFilter,{},function(n){n.message!==""?(showError(n.message),loadGrid([])):loadGrid(n.items)})}function loadGrid(n){var t=$("#Listado").data("kendoGrid"),i=new kendo.data.DataSource({data:n});t.setDataSource(i);n&&n.length>0&&$("#filter-box").collapse("hide");setGridHeight("Listado",marginGrid)}function onEditPrice(n){var t=$(n.currentTarget).closest(".k-grid").data("kendoGrid"),i=$(n.currentTarget).closest("tr"),r=t.dataItem(i);t.select(i);$("#price-esd").val(r.amount);$("#section-edit-price-esd").removeClass("d-none");$("#save-product").attr("disabled","disabled");$("#save-price-esd").data("id",r.id)}function onCancelPriceESD(){$("#section-edit-price-esd").addClass("d-none");$("#save-product").removeAttr("disabled")}function onSavePriceESD(n){n.preventDefault();var r=$(n.currentTarget).data(),u=r.id,f=$("#prices").data("kendoGrid"),t=f.dataSource,i=t.get(u);console.log(t.data());i.amount=+$("#price-esd").val();i.statusType=2;t.pushUpdate(i);$("#section-edit-price-esd").addClass("d-none");$("#save-product").removeAttr("disabled")}function onEdit(n){var i=$(n.currentTarget).closest(".k-grid").data("kendoGrid"),r=$(n.currentTarget).closest("tr"),t=i.dataItem(r);i.select(r);$("#sku").text(t.sku);$("#item-code").text(t.itemCode);$("#name").text(t.name);$("#description").text(t.description);$("#fulfillment-type").text(t.fulfillmentType);$("#return-type").text(t.returnType);$("#section-edit-price-esd").addClass("d-none");i=$("#prices").getKendoGrid();$.get(urlPrices,{Id:t.id,ItemCode:t.itemCode},n=>{if(n.message===""){n.items.forEach(n=>{n.validFrom&&(n.validFrom=JSON.toDate(n.validFrom)),n.validTo&&(n.validTo=JSON.toDate(n.validTo))});var t=new kendo.data.DataSource({data:n.items,schema:{model:{id:"id"}}});i.setDataSource(t);$("#regular").val(n.price.regular);$("#offer").val(n.price.offer);$("#offerDescription").val(n.price.offerDescription);$("#observations").val(n.price.observations);$("#commentaries").val(n.price.commentaries);$("#id").val(n.price.id);$("#idProduct").val(n.price.idProduct);$("#idSudsidiary").val(n.price.idSudsidiary);$("#clientSuggested").val(n.price.clientSuggested);$("#detail").getKendoWindow().open()}else console.error(n.message),showError("Se producido un error al traer los datos.")})}function onSave(n){var t,i;if(n.preventDefault(),t=$(n.currentTarget).closest("form"),i=t.kendoValidator().data("kendoValidator"),i.validate()){var r=t.serializeObject(),u=$("#prices").data("kendoGrid"),f=u.dataSource,e=f.data();items=Enumerable.From(e).Where("$.statusType === 2").Select("{ id: $.id, idProduct: $.idProduct, amount: $.amount, currency: $.currency, priceType: $.priceType, validFrom: kendo.toString($.validFrom, 'yyyy-MM-dd'), validTo: kendo.toString($.validTo, 'yyyy-MM-dd'), statusType: 2 }").ToArray();$.post(urlEdit,{Item:r,Prices:items},n=>{n.message===""?($("#detail").getKendoWindow().close(),showMessage("Datos guardados exitisamente.")):(console.error(n.message),showError("Se producido un error al guardar los datos."))})}}const marginGrid=30,alignCenter={style:"text-align: center;"},alignRight={style:"text-align: right;"},dateFormat="{0:dd-MM-yyyy}",numberFormat="{0:N2}";var _intId=0;$(()=>setupControls());$(window).resize(()=>setGridHeight("Listado",marginGrid));$("#prices").on("click",".action-edit",onEditPrice);$("#cancel-price-esd").click(onCancelPriceESD);$("#save-price-esd").click(onSavePriceESD);$("#Listado").on("click",".action-edit",onEdit);$("#save-product").click(onSave);