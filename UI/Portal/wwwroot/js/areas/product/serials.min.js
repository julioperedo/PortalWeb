function onSinceChange(){var n=this.value();$("#FilUntil").data("kendoDatePicker").min(n?n:_minDate)}function onUntilChange(){var n=this.value();$("#FilSince").data("kendoDatePicker").max(n?n:_maxDate)}function setupControls(){var n={style:"text-align: center"};$("#Listado").kendoGrid({groupable:{enabled:!1},pageable:{enabled:!0},noRecords:{template:"No existen resultados para el criterio de búsqueda."},scrollable:!0,sortable:!0,selectable:!0,detailTemplate:kendo.template($("#detailOrder").html()),detailInit:onDetailInit,columns:[{field:"subsidiary",title:"Sucursal"},{field:"clientCode",title:"Cod.Cliente",width:120},{field:"clientName",title:"Cliente"},{field:"date",title:"F. Nota",format:"{0: dd/MM/yyyy}",attributes:n,headerAttributes:n,width:130},{field:"number",title:"# Nota",width:120,template:function(n){var t=n.number;return n.isOwn&&(n.docType===13&&(t=`<a class="sale-note action action-link">${n.number}</a>`),n.docType===15&&(t=`<a class="delivery-note action action-link">${n.number}</a>`)),t}},{field:"docTypeDesc",title:"Tipo",width:120}],dataSource:getDataSource([])})}function getDataSource(n){return new kendo.data.DataSource({data:n,pageSize:500})}function onDetailInit(n){var t=n.detailRow,i=n.data;t.find(".detailNote").kendoGrid({dataSource:{data:i.items},scrollable:!1,sortable:!0,pageable:!1,selectable:!0,columns:[{field:"itemCode",title:"Cod.Producto",width:200},{field:"name",title:"Producto",width:300},{field:"count",title:"Total",width:90},{field:"serialsResume",title:"Seriales"}]})}function clientMapper(n){var t=$("#FilClient").data("kendoDropDownList").dataSource.data(),i=Enumerable.From(t).Where(t=>t.Code===n.value).FirstOrDefault(),r=Enumerable.From(t).IndexOf(i);n.success(r)}function cleanFilters(){$("#FilClient").data("kendoDropDownList").value("");$("#FilProduct").val("");$("#FilSerial").val("");$("#FilSince").data("kendoDatePicker").value("");$("#FilUntil").data("kendoDatePicker").value("")}function loadGrid(n){$.each(n,function(n,t){t.date=JSON.toDate(t.date)});var t=$("#Listado").data("kendoGrid"),i=getDataSource(n);t.setDataSource(i);n&&n.length>0?($("#filter-box").collapse("hide"),$("#action-excel").removeClass("d-none")):$("#action-excel").addClass("d-none");setGridHeight("Listado",30)}function filterData(){var n=getFilters();n.message===""?$.get(urlFilter,n.data,function(n){n.message!==""?(showError(n.message),loadGrid([])):loadGrid(n.items)}):showInfo(`Debe seleccionar los siguientes campos: <br />${n.message}`)}function getFilters(){var r=$("#FilClient").data("kendoDropDownList").value(),u=$("#FilProduct").val(),f=$("#FilSerial").val(),n=$("#FilSince").data("kendoDatePicker").value(),t=$("#FilUntil").data("kendoDatePicker").value(),e=$("#FilDocNumber").val(),i="";return n?n=kendo.toString(n,"yyyy-MM-dd"):i+="- Fecha Inicial<br />",t?t=kendo.toString(t,"yyyy-MM-dd"):i+="- Fecha Final<br />",r===""&&u===""&&f===""&&e===""&&(i+="- Al menos un criterio aparte del rango de fechas"),{message:i,data:{CardCode:r,ItemCode:u,InitDate:n,FinalDate:t,Serial:f,DocNumber:e}}}function ExportExcel(){var n=getFilters();n.message===""?window.location.href=urlExcel+"?"+$.param(n.data):showInfo(`Los siguientes campos son necesarios <br />${n.message}`)}function loadReport(n,t,i){var r={Subsidiary:t,DocNumber:n,User:$.trim($(".user-info > .user-name").first().text())},f=i==="Note"?"SaleNote.trdp":"DeliveryNote.trdp",u=$("#reportViewer1").data("telerik_ReportViewer");if(i==="Delivery"&&(r.SearchType=2),u)try{u.reportSource({report:f,parameters:r});u.refreshReport()}catch(e){showInfo("El servidor está ocupado, espere un momento y vuelva a intentar.")}else $("#reportViewer1").telerik_ReportViewer({serviceUrl:urlService,reportSource:{report:f,parameters:r},viewMode:telerikReportViewer.ViewModes.INTERACTIVE,scaleMode:telerikReportViewer.ScaleModes.FIT_PAGE_WIDTH})}var _minDate,_maxDate;$(function(){_maxDate=$("#FilUntil").data("kendoDatePicker").max();_minDate=$("#FilSince").data("kendoDatePicker").min();setupControls();setGridHeight("Listado",30)});$(window).resize(function(){setGridHeight("Listado",30)});$("#filter-box").on("hidden.bs.collapse",function(){setGridHeight("Listado",30)});$("#filter-box").on("shown.bs.collapse",function(){setGridHeight("Listado",30)});$("#action-clean").click(function(){cleanFilters()});$("#action-filter").click(function(){filterData()});$("#action-excel").on("click",function(){ExportExcel()});$("#Listado").on("click",".sale-note",function(n){var i=$("#Report").data("kendoWindow"),r=$(n.currentTarget).closest(".k-grid").data("kendoGrid"),u=$(n.currentTarget).closest("tr"),t;r.select(u);t=r.dataItem(u);loadReport(t.number,t.subsidiary,"Note");i.title(`Nota de Venta ${t.number}`);i.open().center()});$("#Listado").on("click",".delivery-note",function(n){var i=$("#Report").data("kendoWindow"),r=$(n.currentTarget).closest(".k-grid").data("kendoGrid"),u=$(n.currentTarget).closest("tr"),t;r.select(u);t=r.dataItem(u);loadReport(t.number,t.subsidiary,"Delivery");i.title(`Nota de Entrega ${t.number}`);i.open().center()});