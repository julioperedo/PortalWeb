function setupControls(){_grdEmp=$("#list-employees").kendoGrid({columns:[{title:"Apellidos",field:"lastName",width:140},{title:"Nombres",field:"firstName",width:140},{title:"F. Ingreso",field:"startDate",width:70,format:dateFormat,attributes:alignCenter,headerAttributes:alignCenter},{title:"A&ntilde;os",field:"years",width:70,attributes:alignRight,headerAttributes:alignRight},{title:"D&iacute;as",field:"days",format:"{0: 0.0}",width:90,aggregates:["sum"],attributes:alignRight,headerAttributes:alignRight,footerAttributes:alignRight,footerTemplate:n=>n?.days?.sum??0},{title:"D&iacute;as (Duodécima)",field:"extraDays",format:"{0: 0.0}",width:90,aggregates:["sum"],attributes:alignRight,headerAttributes:alignRight,footerAttributes:alignRight,footerTemplate:n=>n?.extraDays?.sum??0},{title:"Tomados",field:"taken",format:"{0: 0.0}",width:90,aggregates:["sum"],attributes:alignRight,headerAttributes:alignRight,footerAttributes:alignRight,footerTemplate:n=>n?.taken?.sum??0},{title:"Restantes",field:"remaining",format:"{0: 0.0}",width:90,aggregates:["sum"],attributes:alignRight,headerAttributes:alignRight,footerAttributes:alignRight,footerTemplate:n=>n?.remaining?.sum??0},{title:" ",field:"id",attributes:alignCenter,width:50,template:'<a class="action action-link detail-employee" title="Ver detalle"><i class="fas fa-pen"><\/i><\/a>'}],noRecords:{template:'<div class="w-100 p-4">No hay items para el criterio de b&uacute;squeda.<\/div>'},sortable:!0,selectable:"Single, Row",dataSource:[]}).data("kendoGrid");_lvRequests=$("#list-requests").kendoListView({dataSource:{transport:{read:{url:urlRequests}},schema:{model:{id:"id",fields:{requestDate:{type:"date"},fromDate:{type:"date"},toDate:{type:"date"}}}},sort:{field:"id",dir:"asc"}},template:function(n){var i="",h=n.idType=="L"?"Licencia":n.idType=="V"?"Vacaci&oacute;n":n.idType=="H"?"Home Office":"Viaje de Trabajo",r="",e="",t="",o="",s="",u=!0,f;return $.trim(n.comments)!=""&&(o+=`<div class="row"><div class="col"><label>Comentarios:</label> <span class="comments">${n.comments}</span></div></div>`),n.managers.length>0&&(r+='<div class="row">',n.managers.forEach(n=>r+=`<div class="col"><label>Jefe:</label> <span class="label-data">${n.name}</span></div>`),r+="<\/div>"),n.idType=="V"&&(i=`<div class="row">
                <div class="col">
                    <label>Desde:</label> <span class="from-date">${kendo.toString(JSON.toDate(n.vacation.fromDate),"dd-MM-yyyy")}  ${n.vacation.fromDatePeriod}</span>
                </div>
                <div class="col">
                    <label>Hasta:</label> <span class="to-date">${kendo.toString(JSON.toDate(n.vacation.toDate),"dd-MM-yyyy")}  ${n.vacation.toDatePeriod}</span>
                </div>
                <div class="col">
                    <span class="days">${n.vacation.days}</span><label>d&iacute;as</label>
                </div>
            </div>`,n.vacation.replacements.length>0&&(t+='<div class="row">',n.vacation.replacements.forEach(function(n){t+=`<div class="col"><label>Remplazo:</label> <span class="replacemnet">${n.replacementName}</span></div>`;n.available||(u=!1)}),t+="<\/div>"),s=`<span class="available-days">(${n.availableDays} d&iacute;as disponibles)</span>`),n.idType=="L"&&(n.license.date=JSON.toDate(n.license.date),n.license.initialTime=JSON.toTime(n.license.initialTime),n.license.finalTime=JSON.toTime(n.license.finalTime),i=`<div class="row">
                <div class="col">
                    <label>Fecha:</label> <span class="from-date">${kendo.toString(n.license.date,"dd-MM-yyyy")} ( ${kendo.toString(n.license.initialTime,"HH:mm")} al ${kendo.toString(n.license.finalTime,"HH:mm")} )</span>
                </div>
            </div>`,f=$.trim(n.license.idReason==-1?n.license.reasonDescription:n.license.reasonName),e+=f!=""?`<div class="row"><div class="col"><label>Motivo:</label><span class="reason">${f}</span></div></div>`:""),n.idType=="H"&&(i=`<div class="row">
                <div class="col">
                    <label>Desde:</label> <span class="from-date">${kendo.toString(JSON.toDate(n.homeOffice.fromDate),"dd-MM-yyyy")}  ${n.homeOffice.fromDatePeriod}</span>
                </div>
                <div class="col">
                    <label>Hasta:</label> <span class="to-date">${kendo.toString(JSON.toDate(n.homeOffice.toDate),"dd-MM-yyyy")}  ${n.homeOffice.toDatePeriod}</span>
                </div>
            </div>`),n.idType=="T"&&(i=`<div class="row">
                <div class="col">
                    <label>Desde:</label> <span class="from-date">${kendo.toString(JSON.toDate(n.travel.fromDate),"dd-MM-yyyy")}  ${n.travel.fromDatePeriod}</span>
                </div>
                <div class="col">
                    <label>Hasta:</label> <span class="to-date">${kendo.toString(JSON.toDate(n.travel.toDate),"dd-MM-yyyy")}  ${n.travel.toDatePeriod}</span>
                </div>
            </div>`,n.travel.replacements.length>0&&(t+='<div class="row">',n.travel.replacements.forEach(function(n){t+=`<div class="col"><label>Remplazo:</label> <span class="replacemnet">${n.replacementName}</span></div>`;n.available||(u=!1)}),t+="<\/div>")),`<div class="request">
    <div class="row">
        <div class="col-9">
            <div class="row">
                <div class="col"> <span class="request-type">Solicitud de ${h}</span></div>
            </div>
            <div class="row">
                <div class="col">
                    <span class="employee-name">${n.employeeName}</span> ${s}                    
                    <span class="request-date">${kendo.toString(n.requestDate,"dd-MM-yyyy HH:mm")}</span>
                </div>
            </div>            
            ${i}
            ${e}
            ${t}
            ${r}
            ${o}
        </div>
        <div class="col-3 text-center">
            <button class="btn aprove-request align-middle" ${u?"":"disabled"}>Aprobar</button><button class="btn btn-danger deny-request align-middle">Rechazar</button>
        </div>
    </div>
</div>`}}).data("kendoListView");$.get(urlEmployeesResume,{},function(n){if(n.message==""){n.items.forEach(n=>n.startDate=JSON.toDate(n.startDate));var t=new kendo.data.DataSource({data:n.items.filter(n=>n.isAvailable),aggregate:[{aggregate:"sum",field:"days"},{aggregate:"sum",field:"extraDays"},{aggregate:"sum",field:"taken"},{aggregate:"sum",field:"remaining"}],schema:{model:{id:"id"}}});_grdEmp.setDataSource(t)}})}function onAprove(n){let i=$(n.currentTarget).closest(".request"),t=$(n.currentTarget).closest(".k-listview").data("kendoListView").dataItem(i),r=`¿Est&aacute; seguro que desea aprobar la solicitud de <b>${t.employeeName}</b>?`+(t.availableDays<t.days?`, sólo tiene ${t.availableDays} días disponibles.`:"");r+=`<br /><label for="comments" class="pt-2">Comentarios</label><textarea id="comments" type="text" class="form-control" rows="2"></textarea>`;showConfirm(r,function(){let n=$("#comments").val();$.post(urlApprove,{Id:t.id,Comments:n},function(n){n.withErrors?showError("Se ha producido un error al aprobar la solicitud, vuelva a intentar más tarde."):n.message==""?(showMessage("Se ha aprobado la solicitud correctamente."),i.remove()):showInfo(n.message)})})}function onDeny(n){let t=$(n.currentTarget).closest(".request"),i=$(n.currentTarget).closest(".k-listview").data("kendoListView").dataItem(t),r=`¿Est&aacute; seguro que desea rechazar la solicitud de <b>${i.employeeName}</b>?<br />
        <label for="reject-reason" class="pt-2">Motivo</label><textarea id="reject-reason" type="text" class="form-control" rows="2"></textarea>`;showConfirm(r,function(){let n=$("#reject-reason").val();$.post(urlReject,{Id:i.id,RejectReason:n},function(n){n.withErrors?showError("Se ha producido un error al rechazar la solicitud, vuelva a intentar más tarde."):n.message===""?(showMessage("Se ha rechazado la solicitud correctamente."),t.remove()):showInfo(n.message)})})}function onTabActive(n){$(n.target).attr("href")==="#tab2"&&setGridHeight("list-employees",gridMargin)}const alignCenter={"class":"k-text-center !k-justify-content-center"},alignRight={"class":"text-right",style:"justify-content: right"},gridMargin=30,numberFormat="{0:#,##0.00}",dateFormat="{0:dd-MM-yyyy}";var _minDate,_maxDate,_grdEmp,_lvRequests;$(()=>setupControls());$(window).resize(()=>setGridHeight("list-employees",gridMargin));$("#list-requests").on("click",".aprove-request",onAprove);$("#list-requests").on("click",".deny-request",onDeny);$('a[data-toggle="tab"]').on("shown.bs.tab",onTabActive);