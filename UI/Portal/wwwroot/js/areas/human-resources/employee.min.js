function setupPage(){_grdItems=$("#Listado").kendoGrid({noRecords:{template:'<div class="text-center w-100">No se encontraron registros para el criterio de b&uacute;squeda.<\/div>'},columns:[{title:"Nombre",field:"name"},{title:"Gerencia",field:"isManager",attributes:alignCenter,headerAttributes:alignCenter,width:100,template:n=>n.isManager?'<i class="fas fa-check"><\/i>':""},{title:"Habilitado",field:"enabled",attributes:alignCenter,headerAttributes:alignCenter,width:100,template:n=>n.enabled?'<i class="fas fa-check"><\/i>':""},{field:"photo",title:" ",attributes:alignCenter,width:30,template:n=>$.trim(n.photo)!=""?'<i class="fas fa-image" title="Tiene Imagen"><\/i>':""},{field:"id",title:" ",attributes:alignCenter,width:70,sortable:!1,headerAttributes:alignCenter,headerTemplate:'<a title="Sincronizar empleados" class="action action-link action-sync"><i class="fas fa-sync"><\/i><\/a>',template:'<a title="Editar Area de Trabajo" class="action action-link action-edit"><i class="fas fa-pen"><\/i><\/a>'}],sortable:!0,selectable:"Single, Row",dataSource:getDataSource([])}).data("kendoGrid");filterData(!0);_grdDepartments=$("#departments").kendoGrid({noRecords:{template:'<div class="text-center w-100 p-2">No se encontraron registros para el criterio de b&uacute;squeda.<\/div>'},columns:[{title:"Area de Trabajo",field:"department"},{title:"Inmediato Superior",field:"manager"},{field:"id",title:" ",attributes:alignCenter,width:70,sortable:!1,headerAttributes:alignCenter,headerTemplate:'<a title="Sincronizar empleados" class="action action-link action-new"><i class="fas fa-plus"><\/i><\/a>',template:'<a title="Editar Area de Trabajo" class="action action-link action-edit"><i class="fas fa-pen"><\/i><\/a><a title="Eliminar Area de Trabajo" class="action action-link action-delete"><i class="fas fa-trash-alt"><\/i><\/a>'}],sortable:!0,selectable:"Single, Row",dataSource:getDSDepartment([])}).data("kendoGrid");_wndDetail=$("#Detail").kendoWindow({width:750,title:"Detalle de Empleado",visible:!1,modal:!0,activate:onRefreshWindow}).data("kendoWindow");_swEnabled=$("#enabled").kendoSwitch({messages:{checked:"",unchecked:""},size:"small"}).data("kendoSwitch");_ddDepartment=$("#idDepartment").kendoDropDownList({dataSource:{transport:{read:{url:urlDepartments}}},optionLabel:"Seleccione un Area de Trabajo",filter:"contains",dataTextField:"name",dataValueField:"id"}).data("kendoDropDownList");_ddManager=$("#idManager").kendoDropDownList({optionLabel:"Seleccione el Inmediato Superior",filter:"contains",dataTextField:"name",dataValueField:"id",select:function(n){n.dataItem.enabled||n.preventDefault()},template:n=>`<span class="${n.enabled?"":"k-disabled"}">${n.name}</span>`}).data("kendoDropDownList")}function getDataSource(n){return new kendo.data.DataSource({data:n,schema:{model:{id:"id"}}})}function getDSDepartment(n){return new kendo.data.DataSource({data:n,schema:{model:{id:"id"}},filter:[{field:"statusType",operator:"neq",value:"3"}]})}function cleanFilters(){$("#filter").val("")}function getFilters(){var n=$("#filter").val();return{message:"",data:{FilterData:n}}}function filterData(n){var t=getFilters();t.message==""?$.get(urlFilter,t.data,function(n){loadGrid(n.items);n.message!=""&&showError(`Se ha producido el siguiente error al traer los datos: ${n.message}`)}):(setGridHeight("Listado",_gridMargin),n||showInfo(`Se deben ingresar los siguientes campos: <br />${t.message}`))}function loadGrid(n){if(n){var t=getDataSource(n);_grdItems.setDataSource(t);n&&n.length>0?($("#filter-box").collapse("hide"),$("#action-excel").removeClass("d-none")):$("#action-excel").addClass("d-none");setTimeout(()=>setGridHeight("Listado",_gridMargin),100)}}function onEdit(n){var t,i;n.preventDefault();this.classList.contains("action-new")?(_grdItems.clearSelection(),t={id:0,name:"",enabled:!0}):(i=$(n.currentTarget).closest("tr"),_grdItems.select(i),t=_grdItems.dataItem(i));$.get(urlEdit,{Id:t.id},function(n){_ddManager.setDataSource(n.managers);_grdDepartments.setDataSource(getDSDepartment(n.items))});$("#id").val(t.id);$("#photo").val(t.photo);$("#name").val(t.name);$("#shortName").val(t.shortName);$("#position").val(t.position);$("#hierarchyLevel").val(t.hierarchyLevel);$("#mail").val(t.mail);$("#phone").val(t.phone);_swEnabled.check(t.enabled);$("#picture").attr("src",$.trim(t.photo)==""?urlNoPhoto:urlPath+t.photo);$("#department-detail").addClass("d-none");_wndDetail.center().open()}function onCancel(n){n.preventDefault();_wndDetail.close()}function onSave(n){var t,r;if(n.preventDefault(),t=$(n.currentTarget).closest("form"),r=t.kendoValidator({messages:{required:"Campo requerido"}}).data("kendoValidator"),r.validate()){var i=t.serializeObject(),u=_grdDepartments.dataSource.data(),f=u.map(n=>Object.assign({},{id:n.id,idEmployee:+i.id,idDepartment:n.idDepartment,idManager:n.idManager,statusType:n.statusType}));$.post(urlEdit,{Item:i,Departments:f},function(n){n.message==""?(_wndDetail.close(),showMessage("Se realizaron los cambios correctamente."),_grdItems.dataSource.pushUpdate(i)):showError(n.message)})}}function onSync(n){n.preventDefault();$.post(urlSync,{},function(n){n.message==""?(showMessage("Se han empleado los empleados exitosamente."),_grdItems.setDataSource(n.items)):(console.error(n.message),showError("Se ha producido un error al sincronizar los empleados."))})}function onEditDepartment(n){var t,i;n.preventDefault();(this.classList.contains("action-new")||this.classList.contains("action-edit"))&&(this.classList.contains("action-new")&&(_grdDepartments.clearSelection(),t={id:_id++,idDepartment:0,idManager:0}),this.classList.contains("action-edit")&&(i=$(n.currentTarget).closest("tr"),_grdDepartments.select(i),t=_grdDepartments.dataItem(i)),$("#id-detail").val(t.id),_ddDepartment.value(t.idDepartment),_ddManager.value(t.idManager),$("#department-detail").removeClass("d-none"),setRequiredToControls(!0),_wndDetail.center());this.classList.contains("action-delete")&&(i=$(n.currentTarget).closest("tr"),t=_grdDepartments.dataItem(i),showConfirm(`¿Está seguro que desea eliminar el Area de Trabajo <b>${t.department}</b>?`,function(){t.id>0?(t.statusType=3,_grdDepartments.dataSource.pushUpdate(t)):_grdDepartments.dataSource.remove(t)}))}function setRequiredToControls(n){n?$("#idDepartment, #idManager").attr("required","required"):$("#idDepartment, #idManager").removeAttr("required")}function onCancelDepartment(n){n.preventDefault();$("#department-detail").addClass("d-none");setRequiredToControls(!1);_wndDetail.center()}function onSaveDepartment(n){var t,i,r;n.preventDefault();t=$(n.currentTarget).closest("form");i=t.kendoValidator({messages:{required:"Campo requerido"}}).data("kendoValidator");i.validate()&&(r={id:+$("#id-detail").val(),idDepartment:+_ddDepartment.value(),department:_ddDepartment.text(),idManager:+_ddManager.value(),manager:_ddManager.text(),statusType:+$("#id-detail").val()>0?2:1},_grdDepartments.dataSource.pushUpdate(r),$("#department-detail").addClass("d-none"),_wndDetail.center())}var _id=-1e3,_wndDetail,_grdItems,_swEnabled,_grdDepartments,_ddDepartment,_ddManager;const alignCenter={"class":"k-text-center !k-justify-content-center"},alignRight={style:"text-align: right;"},numberFormat="{0:#,##0.00}",dateFormat="{0:dd-MM-yyyy}",_gridMargin=30;$(()=>setupPage());$(window).resize(()=>setGridHeight("Listado",_gridMargin));$("#filter-box").on("hidden.bs.collapse",()=>setGridHeight("Listado",_gridMargin));$("#filter-box").on("shown.bs.collapse",()=>setGridHeight("Listado",_gridMargin));$("#action-clean").click(()=>cleanFilters());$("#action-filter").click(()=>filterData(!1));$("#Listado").on("click",".action-edit",onEdit);$("#Listado").on("click",".action-sync",onSync);$("#Detail").on("click",".action-cancel",onCancel);$("#Detail").on("click",".action-save",onSave);$("#departments").on("click",".action-new, .action-edit, .action-delete",onEditDepartment);$("#department-detail").on("click",".action-cancel-department",onCancelDepartment);$("#department-detail").on("click",".action-save-department",onSaveDepartment);