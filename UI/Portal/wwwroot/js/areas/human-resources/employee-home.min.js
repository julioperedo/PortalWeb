function setupControls(){_ddlType=$("#idType").kendoDropDownList({dataTextField:"name",dataValueField:"id",optionLabel:"Seleccione un Tipo...",dataSource:[{id:"L",name:"Licencia"},{id:"V",name:"Vacación"},{id:"H",name:"Home Office"},{id:"T",name:"Viaje de Trabajo"}],change:n=>setRequestForm(n.sender.value())}).data("kendoDropDownList");_ddlLicenseReason=$("#idReason").kendoDropDownList({dataTextField:"name",dataValueField:"id",optionLabel:"Seleccione un Motivo...",filter:"contains",dataSource:{transport:{read:{url:urlLicenseReason}}},change:n=>$("#reasonDescription").toggleClass("d-none",n.sender.value()!=-1)}).data("kendoDropDownList");_wndDetail=$("#form-detail-request").kendoWindow({visible:!1,modal:!0,iframe:!1,scrollable:!0,title:"Detalle de Solicitud",resizable:!1,width:720,actions:["Close"],activate:n=>setTimeout(()=>onRefreshWindow(n),50)}).data("kendoWindow");$.get(urlEmployee,{},function(n){n.message==""?n.item&&($("title").text(`Datos de RRHH de ${n.item.name} - Portal DMC`),$("#employee-data").removeClass("d-none"),$("#employee-no-data").addClass("d-none"),$("#name").text(n.item.name),$("#start-date").text(kendo.toString(JSON.toDate(n.item.startDate),"dd-MM-yyyy")),$("#years").text(n.item.years),$("#total-days").text(n.item.vacationDays+(n.item.extraVacationDays>0?` + ${n.item.extraVacationDays}`:"")),$("#days-taken").text(n.item.daysTaken),$("#remaining-days").text(`${n.item.vacationDays-n.item.daysTaken} + ${n.item.extraVacationDays}`),$("#rejected-days").text(n.item.rejectedDays)):(console.error(n.message),showError("Se ha producido un error al traer los datos del servidor."))});today=new Date;today.setHours(0,0,0,0);tomorrow=new Date(today);tomorrow.setDate(tomorrow.getDate()+1);startDate=new Date(today);endDate=new Date(tomorrow);_dpSince=$("#fromDate").kendoDatePicker({format:"dd/MM/yyyy",change:function(){startDate=this.value();startDate===null&&this.value("");calculateDays()}}).data("kendoDatePicker");_dpUntil=$("#toDate").kendoDatePicker({format:"dd/MM/yyyy",change:function(){endDate=this.value();endDate===null&&this.value("");calculateDays()}}).data("kendoDatePicker");_ddlSincePeriod=$("#fromDatePeriod").kendoDropDownList({change:function(){startPeriod=this.value();calculateDays()}}).data("kendoDropDownList");_ddlUntilPeriod=$("#toDatePeriod").kendoDropDownList({change:function(){endPeriod=this.value();calculateDays()}}).data("kendoDropDownList");_dpDate=$("#date").kendoDatePicker().data("kendoDatePicker");_tpInitial=$("#initialTime").kendoTimePicker({componentType:"modern"}).data("kendoTimePicker");_tpFinal=$("#finalTime").kendoTimePicker({componentType:"modern"}).data("kendoTimePicker");_grdReplacements=$("#replacements").kendoGrid({sortable:!0,selectable:"Single, Row",dataSource:[],noRecords:{template:'<div class="w-100 p-2">No hay items para el criterio de b&uacute;squeda.<\/div>'},columns:[{title:"Remplazo",field:"replacementName"},{title:"Desde",field:"fromDate",width:120,attributes:alignCenter,headerAttributes:alignCenter,template:n=>`${kendo.toString(n.fromDate,"dd-MM-yyyy")} ${n.fromDatePeriod}`},{title:"Hasta",field:"toDate",width:120,attributes:alignCenter,headerAttributes:alignCenter,template:n=>`${kendo.toString(n.toDate,"dd-MM-yyyy")} ${n.toDatePeriod}`},{title:" ",field:"id",width:70,attributes:alignCenter,headerAttributes:alignCenter,sortable:!1,headerTemplate:'<i class="fas fa-plus action action-link action-new" title="Nuevo Remplazo"><\/i>',template:'<a class="action action-link action-edit" title="Editar Remplazo"><i class="fas fa-pen"><\/i><\/a><a title="Eliminar Remplazo" class="action action-link action-delete"><i class="fas fa-trash-alt"><\/i><\/a>'}]}).data("kendoGrid");_grdYears=$("#resume-years .grid").kendoGrid({columns:[{title:"#",field:"number",width:80},{title:"A&ntilde;o",field:"year",width:120,attributes:alignCenter,headerAttributes:alignCenter},{title:"D&iacute;as",field:"days",width:120,attributes:alignRight,aggregates:["sum"],headerAttributes:alignRight,footerAttributes:alignRight,footerTemplate:n=>n?.days?.sum??0},],sortable:!0,selectable:"Single, Row",dataSource:[]}).data("kendoGrid");_grdDaysTaken=$("#resume-days-taken .grid").kendoGrid({columns:[{title:"Cod.",field:"id",width:70},{title:"F.Solicitud",field:"docDate",width:90,format:"{0: dd-MM-yyyy HH:mm}",attributes:alignCenter,headerAttributes:alignCenter},{title:"Desde",field:"since",width:90,format:"{0: dd-MM-yyyy}",attributes:alignCenter,headerAttributes:alignCenter},{title:"Hasta",field:"until",width:90,format:"{0: dd-MM-yyyy}",attributes:alignCenter,headerAttributes:alignCenter},{title:"D&iacute;as",field:"days",format:"{0: 0.0}",width:90,aggregates:["sum"],attributes:alignRight,headerAttributes:alignRight,footerAttributes:alignRight,footerTemplate:n=>n?.days?.sum??0},{title:"# A&ntilde;o",field:"year",width:70,attributes:alignRight,headerAttributes:alignRight},],noRecords:{template:'<div class="w-100 p-4">No hay items para el criterio de b&uacute;squeda.<\/div>'},sortable:!0,selectable:"Single, Row",dataSource:[]}).data("kendoGrid");_lvRequests=$("#detail-requests .grid").kendoListView({dataSource:{transport:{read:{url:urlGetRequests,data:{OnlyPending:!0}}},schema:{model:{id:"id",fields:{requestDate:{type:"date"},logDate:{type:"date"}}}}},template:function(n){var u="",t="",i="",r="",e="",o="",f;return u=n.idType=="L"?"Licencia":n.idType=="V"?"Vacaci&oacute;n":n.idType=="H"?"Home Office":"Viaje de Trabajo",$.trim(n.comments)!=""&&(o+=`<div class="row"><div class="col"><label>Comentarios:</label> <span class="label-data">${n.comments}</span></div></div>`),n.managers.length>0&&(r+='<div class="row">',n.managers.forEach(n=>r+=`<div class="col"><label>Jefe:</label> <span class="label-data">${n.name}</span></div>`),r+="<\/div>"),n.idType=="V"&&(n.vacation.fromDate=JSON.toDate(n.vacation.fromDate),n.vacation.toDate=JSON.toDate(n.vacation.toDate),n.vacation.replacements.forEach(function(n){n.fromDate=JSON.toDate(n.fromDate);n.toDate=JSON.toDate(n.toDate)}),t+=`<span class="label-data">${kendo.toString(n.vacation.fromDate,"dd-MM-yyyy")} ${n.vacation.fromDatePeriod}</span> al <span class="label-data">${kendo.toString(n.vacation.toDate,"dd-MM-yyyy")} ${n.vacation.toDatePeriod}</span>&nbsp;&nbsp;&nbsp;( <span class="label-data">${n.vacation.days} d&iacute;a${n.vacation.days>1?"s":""}</span> )`,n.vacation.replacements.length>0&&(i+='<div class="row">',n.vacation.replacements.forEach(n=>i+=`<div class="col"><label>Remplazo:</label> <span class="label-data">${n.replacementName}</span></div>`),i+="<\/div>")),n.idType=="H"&&(n.homeOffice.fromDate=JSON.toDate(n.homeOffice.fromDate),n.homeOffice.toDate=JSON.toDate(n.homeOffice.toDate),t+=`<span class="label-data">${kendo.toString(n.homeOffice.fromDate,"dd-MM-yyyy")} ${n.homeOffice.fromDatePeriod}</span> al <span class="label-data">${kendo.toString(n.homeOffice.toDate,"dd-MM-yyyy")} ${n.homeOffice.toDatePeriod}</span>`),n.idType=="T"&&(n.travel.fromDate=JSON.toDate(n.travel.fromDate),n.travel.toDate=JSON.toDate(n.travel.toDate),u+=`&nbsp;&nbsp;&nbsp;( ${n.travel.destiny} )`,t+=`<span class="label-data">${kendo.toString(n.travel.fromDate,"dd-MM-yyyy")}</span> al <span class="label-data">${kendo.toString(n.travel.toDate,"dd-MM-yyyy")}</span>`),n.idType=="L"&&(n.license.date=JSON.toDate(n.license.date),n.license.initialTime=JSON.toTime(n.license.initialTime),n.license.finalTime=JSON.toTime(n.license.finalTime),t+=`<span class="label-data">${kendo.toString(n.license.date,"dd-MM-yyyy")} ( ${kendo.toString(n.license.initialTime,"HH:mm")} al ${kendo.toString(n.license.finalTime,"HH:mm")} )</span>`,f=$.trim(n.license.idReason==-1?n.license.reasonDescription:n.license.reasonName),e+=f!=""?`<div class="row"><div class="col"><label>Motivo:</label><span class="label-data">${f}</span></div></div>`:""),`<div class="request ${n.idState==225?"open":n.idState==221?"sent":n.idState==222?"cancelled":n.idState==223?"rejected":"approved"}">
    <div class="row">
        <div class="col"><label>Tipo:</label> <span class="label-data">${u}</span></div>
    </div>
    <div class="row">
        <div class="col"><label>Per&iacute;odo:</label> ${t}</div>
        <div class="col text-right">
            <span class="state">${n.stateName}</span>${$.trim(n.rejectComments)!=""&&n.idState==223?`<br /><span>${n.rejectComments}</span>`:""}
        </div>
    </div>
    ${e}
    ${i}
    ${r}
    ${o}
    <div class="row">
        <div class="col text-right">
            <button type="button" class="btn btn-outline-primary action-edit" title="Editar Solicitud">Editar</button> 
            <button type="button" class="btn btn-outline-warning action-open" title="Abrir Solicitud para editar">Abrir</button> 
            <button type="button" class="btn btn-outline-danger action-cancel" title="Anular Solicitud">Anular</button>
            <button type="button" class="btn btn-outline-success action-send" title="Enviar Solicitud para aprobación">Enviar</button>
        </div>
    </div>
    <div class="row">
        <div class="col text-right pt-2">
            <span>creado:</span> <span class="request-date">${kendo.toString(n.requestDate,"dd-MM-yyyy HH:mm")}</span>
            <span class="ml-4">&uacute;ltima actualizaci&oacute;n:</span> <span class="request-date">${kendo.toString(n.logDate,"dd-MM-yyyy HH:mm")}</span>
        </div>
    </div>
</div>`},dataBound:function(){this.dataSource.data().length==0&&this.content.append('<div class="py-3 w-100 text-center">No hay items para el criterio de b&uacute;squeda<\/div>')}}).data("kendoListView");$.get(urlHolidays,{},function(n){n.message===""&&(n.items.forEach(function(n){n.since=JSON.toDate(n.since);n.until=JSON.toDate(n.until)}),$("#holidays").val(JSON.stringify(n.items)))});setCustomHeight();let n='<div><i class="fas fa-check"><\/i><i class="fas fa-times"><\/i><h5>#= title #<\/h5><p>#= message #<\/p><\/div>';notificator=$("#custom-message").kendoNotification({button:!0,autoHideAfter:0,position:{bottom:20,right:20},show:function(n){let t=n.element.parent(),i=t.position();t.css({top:i.top-5})},templates:[{type:"success",template:n},{type:"error",template:'<div><i class="fas fa-times-circle"><\/i><i class="fas fa-times"><\/i><h5>#= title #<\/h5><p>#= message #<\/p><\/div>'},{type:"open",template:n},{type:"cancelled",template:n},{type:"sent",template:n}]}).data("kendoNotification")}function setRequestForm(n){$("#form-detail-request .row, .selected-days, .k-picker").removeClass("d-none");$("#form-detail-request input, #form-detail-request select").prop("required",!1);$("#idType").prop("required",!0);n=="L"&&($("#fromDate, #destiny, #replacements").closest(".row").addClass("d-none"),$("#date, #initialTime, #finalTime, #idReason").prop("required",!0));n=="V"&&$("#initialTime, #idReason, #destiny").closest(".row").addClass("d-none");n=="H"&&($(".selected-days").addClass("d-none"),$("#initialTime, #idReason, #destiny, #replacements").closest(".row").addClass("d-none"));n=="T"&&($(".selected-days").addClass("d-none"),$("#fromDatePeriod, #toDatePeriod").closest(".k-picker").addClass("d-none"),$("#initialTime, #idReason").closest(".row").addClass("d-none"));calculateDays()}function showTotalDays(n){n.preventDefault();hideDetails();$.get(urlResumeYears,{},function(n){$("#resume-years").removeClass("d-none");var t=$("#resume-years .grid").data("kendoGrid"),i=new kendo.data.DataSource({data:n.items,aggregate:[{aggregate:"sum",field:"days"}],sort:[{field:"number",dir:"asc"}],schema:{model:{id:"number"}}});t.setDataSource(i)})}function showDaysTaken(n){n.preventDefault();hideDetails();var t=n.currentTarget.classList.contains("days-taken");$.get(urlResumeDaysTaken,{Accepted:t},function(n){var i,r;n.message===""?($("#resume-days-taken").removeClass("d-none"),$("#resume-days-taken label").html(`Detalle de d&iacute;as de vacaciones ${t?"tomadas":"rechazadas"}`),i=$("#resume-days-taken .grid").data("kendoGrid"),n.items.forEach(n=>{n.docDate=JSON.toDate(n.docDate),n.since=JSON.toDate(n.since),n.until=JSON.toDate(n.until)}),r=new kendo.data.DataSource({data:n.items,aggregate:[{aggregate:"sum",field:"days"}],sort:[{field:"id",dir:"asc"}],schema:{model:{id:"id"}}}),i.setDataSource(r)):(console.error(n.message),showError("Se ha producido un error al traer los datos del servidor."))})}function hideDetails(){$("#resume-years, #resume-days-taken, #detail-requests").addClass("d-none")}function setCustomHeight(){var n=_gridMargin,t=typeof InstallTrigger!="undefined";t&&(n+=15);$(".grid-details .grid").each((t,i)=>{var r=$(i).find(".k-grid-content");r.css("max-height",$(window).height()-325-n)})}function showRequests(n){n.preventDefault();hideDetails();$.get(urlGetRequests,{},n=>showRequestsGrid(n))}function showRequestsGrid(n){n.forEach(n=>{n.requestDate=JSON.toDate(n.requestDate),n.logDate=JSON.toDate(n.logDate)});$("#detail-requests").removeClass("d-none");_lvRequests.dataSource.data(n)}function openRequestForm(n){var e=n.currentTarget.classList.contains("add-request"),i,t,f,r,u;e?(t=new Date,f=(new Date).addHours(2),i={id:0,idEmployee:0,requestDate:t,idState:_states.find(n=>n.name=="open").id,stateName:"Abierta",idType:"L",comments:"",rejectComments:"",externalCode:"NO sincronizado",license:{id:0,date:t,initialTime:t,finalTime:f,idReason:0,reasonDescription:""}}):(r=$("#detail-requests .grid").data("kendoGrid"),u=$(n.currentTarget).closest("tr"),r.select(u),i=r.dataItem(u));loadRequestForm(i)}function loadRequestForm(n){if(setRequestForm(n.idType),$("#id").val(n.id),$("#idEmployee").val(n.idEmployee),$("#externalCode").val(n.externalCode),$("#externalCode-label").text($.trim(n.externalCode)!=""?n.externalCode:"NO sincronizado"),$("#idState").val(n.idState),_ddlType.value(n.idType),$("#state-label").text(n.stateName),$("#requestDate").val(JSON.fromDate(n.requestDate)),$("#comments").val(n.comments),n.idType=="L"&&($("#idDetail").val(n.license.id),_dpDate.value(n.license.date),_tpInitial.value(n.license.initialTime),_tpFinal.value(n.license.finalTime),_ddlLicenseReason.value(n.license.idReason),$("#reasonDescription").text(n.license.reasonDescription),$("#reasonDescription").toggleClass("d-none",n.license.idReason!=-1),_grdReplacements.setDataSource(getReplacementDS([]))),n.idType=="V"){$("#idDetail").val(n.vacation.id);_dpSince.value(n.vacation.fromDate);_dpUntil.value(n.vacation.toDate);_ddlSincePeriod.value(n.vacation.fromDatePeriod);_ddlUntilPeriod.value(n.vacation.toDatePeriod);calculateDays();$(".selected-days span").text(n.days);let t=_.cloneDeep(n.vacation.replacements);_grdReplacements.setDataSource(getReplacementDS(t))}if(n.idType=="H"&&($("#idDetail").val(n.homeOffice.id),_dpSince.value(n.homeOffice.fromDate),_dpUntil.value(n.homeOffice.toDate),_ddlSincePeriod.value(n.homeOffice.fromDatePeriod),_ddlUntilPeriod.value(n.homeOffice.toDatePeriod),_grdReplacements.setDataSource(getReplacementDS([]))),n.idType=="T"){$("#idDetail").val(n.travel.id);_dpSince.value(n.travel.fromDate);_dpUntil.value(n.travel.toDate);$("#destiny").val(n.travel.destiny);let t=_.cloneDeep(n.travel.replacements);_grdReplacements.setDataSource(getReplacementDS(t))}$("#replacement-detail").addClass("d-none");$("#Send").prop("checked",!1);_wndDetail.open()}function getReplacementDS(n){return n||(n=[]),new kendo.data.DataSource({data:n,filter:[{field:"statusType",operator:"neq",value:3}],schema:{model:{id:"id",fields:{fromDate:{type:"date"},toDate:{type:"date"}}}}})}function cancelRequest(n){n.preventDefault();_wndDetail.close()}function saveRequest(n){var t,i,u;n.preventDefault();notificator.hide();var f=$("#form-request"),e={messages:{required:"",reason:"",since:"",until:"",destiny:"",period:"Período Inválido",replacements:"Necesita un remplazo por el período solicitado"},rules:{reason:n=>n.is("#reasonDescription")&&_ddlType.value()=="L"&&_ddlLicenseReason.value()=="-1"?$.trim(n.val())!="":!0,since:n=>n.is("#fromDate")&&_ddlType.value()!="L"?$.trim(n.val())!="":!0,until:n=>n.is("#toDate")&&_ddlType.value()!="L"?$.trim(n.val())!="":!0,period:n=>(n.is("#toDate")||n.is("#fromDate"))&&_ddlType.value()!="L"?JSON.toDate($("#fromDate").val())<=JSON.toDate($("#toDate").val()):!0,destiny:n=>n.is("#destiny")&&_ddlType.value()=="T"?$.trim(n.val())!="":!0,replacements:function(n){if(n.is("#id"&&_ddlType.value()=="T"&&_ddlType.value()=="V")){for(var r=_grdReplacements.dataSource.data(),u=JSON.toDate($("#fromDate").val()),f=JSON.toDate($("#toDate").val()),t=u,i=!0;t<=f&&i;)i=r.filter(n=>n.fromDate<=t&&n.toDate>=t).length>0,t=t.addDays(1);return i}return!0}},validationSummary:!0},r=f.kendoValidator(e).data("kendoValidator");r.validate()?(t={id:+$("#id").val(),idEmployee:+$("#idEmployee").val(),requestDate:JSON.toDate($("#requestDate").val()).toFormattedString(),idType:_ddlType.value(),idState:$("#Send").prop("checked")?_states.find(n=>n.name=="sent").id:+$("#idState").val(),comments:$("#comments").val(),rejectComments:$(".reject-comments").text(),externalCode:$("#externalCode").val()!="NO sincronizado"?$("#externalCode").val():""},t.idType=="L"&&(t.license={id:+$("#idDetail").val(),date:_dpDate.value().toFormattedString(),initialTime:_tpInitial.value().toTimeFormattedString(),finalTime:_tpFinal.value().toTimeFormattedString(),idReason:_ddlLicenseReason.value(),reasonDescription:$("#reasonDescription").val()}),t.idType=="V"&&(i=_grdReplacements.dataSource.data().map(function(n){return{id:n.id,idReplacement:n.idReplacement,fromDate:n.fromDate.toFormattedString(),fromDatePeriod:n.fromDatePeriod,toDate:n.toDate.toFormattedString(),toDatePeriod:n.toDatePeriod,idState:"O"}}),t.vacation={id:+$("#idDetail").val(),fromDate:_dpSince.value().toFormattedString(),fromDatePeriod:_ddlSincePeriod.value(),toDate:_dpUntil.value().toFormattedString(),toDatePeriod:_ddlUntilPeriod.value(),days:getDays(_dpSince.value(),_ddlSincePeriod.value(),_dpUntil.value(),_ddlUntilPeriod.value()),replacements:i}),t.idType=="H"&&(t.homeOffice={id:+$("#idDetail").val(),fromDate:_dpSince.value().toFormattedString(),fromDatePeriod:_ddlSincePeriod.value(),toDate:_dpUntil.value().toFormattedString(),toDatePeriod:_ddlUntilPeriod.value()}),t.idType=="T"&&(i=_grdReplacements.dataSource.data().map(function(n){return{id:n.id,idReplacement:n.idReplacement,fromDate:n.fromDate.toFormattedString(),fromDatePeriod:n.fromDatePeriod,toDate:n.toDate.toFormattedString(),toDatePeriod:n.toDatePeriod,idState:"O"}}),t.travel={id:+$("#idDetail").val(),fromDate:_dpSince.value().toFormattedString(),fromDatePeriod:_ddlSincePeriod.value(),toDate:_dpUntil.value().toFormattedString(),toDatePeriod:_ddlUntilPeriod.value(),destiny:$("#destiny").val(),replacements:i}),$.post(urlEdit,{item:t},function(n){n.message==""?(showMessage("Se ha guardado la solicitud exitosamente"),hideDetails(),showRequestsGrid(n.items),_wndDetail.close()):notificator.show({title:"Error",message:n.message},"error")})):(u=r.errors(),console.log("NO validó",u))}function deleteRequest(n){n.preventDefault();notificator.hide();let t=$("#id").val();t==0?_wndDetail.close():$.post(urlDelete,{Id:t},function(n){n.message==""?(notificator.show({title:"",message:"Solicitud eliminada exitosamente."},"success"),hideDetails(),showRequestsGrid(n.items),_wndDetail.close()):notificator.show({title:"Error",message:n.message},"error")})}function getDays(n,t,i,r){var f=0,u=new Date(n),e,o;if(n&i){for(e=JSON.parse($("#holidays").val()),e.forEach(function(n){n.since=JSON.toDate(n.since);n.until=JSON.toDate(n.until)});u<=i;)o=e.some(n=>n.since<=u&&n.until>=u),o||u.getDay()==6||u.getDay()==0||(f+=1),u.setDate(u.getDate()+1);t=="PM"&&(f-=.5);r=="AM"&&(f-=.5)}return f}function calculateDays(){let t=_dpSince.value(),i=_ddlSincePeriod.value(),r=_dpUntil.value(),u=_ddlUntilPeriod.value(),n=getDays(t,i,r,u);$(".selected-days span").text(n);$("#days").val(n)}function onButtonPressed(n){n.preventDefault();let f=$(n.currentTarget).closest(".request"),t=$(n.currentTarget).closest(".k-listview").data("kendoListView").dataItem(f),r=0,i,e,s=$(n.currentTarget).text(),u;n.currentTarget.classList.contains("action-open")&&(i=_states.find(n=>n.name==="open"),u="Se ha abierto la solicitud correctamente.");n.currentTarget.classList.contains("action-cancel")&&(i=_states.find(n=>n.name==="cancelled"),u="Se ha cancelado la solicitud correctamente.");n.currentTarget.classList.contains("action-send")&&(i=_states.find(n=>n.name==="sent"),u="Se ha enviado la solicitud correctamente.");r=i.id;e=i.name;var o={id:t.id,idEmployee:t.idEmployee,requestDate:t.requestDate,fromDate:t.fromDate,fromDatePeriod:t.fromDatePeriod,toDate:t.toDate,toDatePeriod:t.toDatePeriod,days:t.days,idState:r,idReplacement:t.idReplacement,externalCode:t.externalCode};o.idState=r;showConfirm(`¿Est&aacute; seguro que desea <b>${s}</b> la solicitud?`,function(){$.post(urlChangeState,{Item:o,NewStateId:r},function(n){n.message===""&&(f.closest(".request").attr("class",`request ${e}`),f.find(".state").text(i.desc),notificator.show({title:"",message:u},e))})})}function onEdit(n){n.preventDefault();notificator.hide();let t=$(n.currentTarget).closest(".request"),i=$(n.currentTarget).closest(".k-listview").data("kendoListView").dataItem(t);loadRequestForm(i)}function onSendChange(){$("#save-request").removeClass("btn-primary btn-success").addClass(this.checked?"btn-success":"btn-primary").text(this.checked?"Enviar Solicitud":"Guardar Solicitud")}function onEditReplacement(n){var i,t,r=function(n){showHidePanelReplacement(!0);$("#idDetailReplacement").val(n.id);_ddlReplace.value(n.idReplacement);_dpFromDateReplace.value(n.fromDate);_ddlFromDatePeriodReplace.value(n.fromDatePeriod);_dpToDateReplace.value(n.toDate);_ddlToDatePeriodReplace.value(n.toDatePeriod)};n.currentTarget.classList.contains("action-new")&&(t={id:_newId--,idReplacement:-1,fromDate:_dpSince.value(),fromDatePeriod:_ddlSincePeriod.value(),toDate:_dpUntil.value(),toDatePeriod:_ddlUntilPeriod.value(),statusType:0},r(t));n.currentTarget.classList.contains("action-edit")&&(i=$(n.currentTarget).closest("tr"),t=_grdReplacements.dataItem(i),r(t));n.currentTarget.classList.contains("action-delete")&&(i=$(n.currentTarget).closest("tr"),t=_grdReplacements.dataItem(i),showConfirm(`¿Está seguro que desea eliminar el remplazo <b>${t.replacementName}</b>?`,function(){t.statusType==1?_grdReplacements.dataSource.pushDestroy(t):(t.statusType=3,_grdReplacements.dataSource.pushUpdate(t))}))}function showHidePanelReplacement(n){$("#replacement-detail").empty();$("#replacement-detail").toggleClass("d-none",!n);n&&($("#replacement-detail").append(replaceForm),_ddlReplace=$("#idReplacement").kendoDropDownList({dataTextField:"name",dataValueField:"id",optionLabel:"Seleccione un Remplazo...",filter:"contains",dataSource:{transport:{read:{url:urlEmployees}}}}).data("kendoDropDownList"),_dpFromDateReplace=$("#fromDate-replacement").kendoDatePicker({format:"dd/MM/yyyy",change:function(){this.value()==null&&this.value("")}}).data("kendoDatePicker"),_dpToDateReplace=$("#toDate-replacement").kendoDatePicker({format:"dd/MM/yyyy",change:function(){this.value()==null&&this.value("")}}).data("kendoDatePicker"),_ddlFromDatePeriodReplace=$("#fromDatePeriod-replacement").kendoDropDownList().data("kendoDropDownList"),_ddlToDatePeriodReplace=$("#toDatePeriod-replacement").kendoDropDownList().data("kendoDropDownList"));_wndDetail.center()}function saveReplacement(){var i=_dpSince.value(),r=_dpUntil.value(),t=+$("#idDetailReplacement").val(),u=+$("#idReplacement").val(),f=$(this).closest("form"),e={rules:{since:function(n){if(n.is("#fromDate-replacement")){var f=JSON.toDate(n.val());if(f<i||f>r||_grdReplacements.dataSource.data().filter(n=>n.id!=t&&n.idReplacement==u&&f>=n.fromDate&&f<=n.toDate).length>0&&x.statusType!=3)return!1}return!0},until:function(n){if(n.is("#toDate-replacement")){var f=JSON.toDate(n.val());if(f<i||f>r||_grdReplacements.dataSource.data().filter(n=>n.id!=t&&n.idReplacement==u&&f>=n.fromDate&&f<=n.toDate).length>0&&x.statusType!=3)return!1}return!0}},messages:{required:"",since:"Fuera del rango a cubrir",until:"Fuera del rango a cubrir"}},o=f.kendoValidator(e).data("kendoValidator"),n;o.validate()&&(n=t>0?_grdReplacements.dataSource.get(t):{id:t},n.statusType=n.id>0?2:1,n.idReplacement=+_ddlReplace.value(),n.replacementName=_ddlReplace.text(),n.fromDate=_dpFromDateReplace.value(),n.fromDatePeriod=_ddlFromDatePeriodReplace.value(),n.toDate=_dpToDateReplace.value(),n.toDatePeriod=_ddlToDatePeriodReplace.value(),_grdReplacements.dataSource.pushUpdate(n),showHidePanelReplacement(!1))}var _newId=0,_minDate,_maxDate,today,tommorow,startDate,endDate,startDateReplacement,endDateReplacement,startPeriod="AM",endPeriod="PM",_dpDate,_tpInitial,_tpFinal,notificator,_wndDetail,_ddlType,_ddlLicenseReason,_dpSince,_dpUntil,_ddlSincePeriod,_ddlUntilPeriod,_grdYears,_grdDaysTaken,_lvRequests,_grdReplacements,_ddlReplace,_dpFromDateReplace,_dpToDateReplace,_ddlFromDatePeriodReplace,_ddlToDatePeriodReplace;const alignCenter={"class":"k-text-center !k-justify-content-center"},alignRight={"class":"text-right",style:"justify-content: right"},gridMargin=30,numberFormat="{0:#,##0.00}",dateFormat="{0:dd-MM-yyyy}",_gridMargin=30,perActivities=$("#permission").val(),requestTemplate=`<div class="request #if(idState == 225){#open#}##if(idState == 221){#sent#}##if(idState == 222){#cancelled#}##if(idState == 223){#rejected#}##if(idState === 224){#approved#}#">
    <div class="row">
        <div class="col">            
            <label>Per&iacute;odo:</label> <span class="from-date">#=kendo.toString(fromDate, "dd-MM-yyyy")# #=fromDatePeriod#</span> - <span class="to-date">#=kendo.toString(toDate, "dd-MM-yyyy")# #=toDatePeriod#</span>
            &nbsp;&nbsp;&nbsp;( #=days# d&iacute;a#if(days>1) {#s#} # )
        </div>
        <div class="col text-right">
            <span class="state">#=stateName#</span>#if($.trim(rejectComments) != "" && idState === 223) {# <br /><span>#=rejectComments#</span> #}#
        </div>
    </div>
    <div class="row">
        <div class="col">
            <label>Remplazo:</label> <span class="replacement">#=replacementName#</span>
        </div>
    </div>
    <div class="row">
        <div class="col">
            <label>Jefe:</label> <span class="manager">#=managerName#</span>
        </div>
    </div>
    <div class="row">
        <div class="col text-right">
            <button type="button" class="btn btn-outline-primary action-edit" title="Editar Solicitud">Editar</button> 
            <button type="button" class="btn btn-outline-warning action-open" title="Abrir Solicitud para editar">Abrir</button> 
            <button type="button" class="btn btn-outline-danger action-cancel" title="Anular Solicitud">Anular</button>
            <button type="button" class="btn btn-outline-success action-send" title="Enviar Solicitud para aprobación">Enviar</button>
        </div>
    </div>
    <div class="row">
        <div class="col text-right">
            creado: <span class="request-date">#=kendo.toString(requestDate, "dd-MM-yyyy HH:mm")#</span>
            &uacute;ltima actualizaci&oacute;n: #=kendo.toString(logDate, "dd-MM-yyyy HH:mm")#
        </div>
    </div>    
</div>`,replaceForm=`<form id="form-replacement" class="mt-2">
                       <input type="hidden" id="idDetailReplacement" />
                       <input id="idReplacement" name="idReplacement" class="w-100" required />
                       <div class="form-group mt-2">
                           <label for="fromDate-replacement" class="mr-1">Desde</label>
                           <input id="fromDate-replacement" name="fromDate-replacement" type="date" style="width: 130px" required />
                           <select id="fromDatePeriod-replacement" name="fromDatePeriod-replacement" style="width: 70px">
                               <option>AM</option>
                               <option>PM</option>
                           </select>
                       </div>
                       <div class="form-group">
                           <label for="toDate-replacement" class="mr-1">Hasta</label>
                           <input id="toDate-replacement" name="toDate-replacement" type="date" style="width: 130px" required />
                           <select id="toDatePeriod-replacement" name="toDatePeriod-replacement" style="width: 70px">
                               <option>AM</option>
                               <option selected="selected">PM</option>
                           </select>
                       </div>
                       <div class="text-right">
                           <button type="button" class="btn btn-outline-secondary cancel-replacement">Cancelar</button>
                           <button type="button" class="btn btn-outline-primary save-replacement">Aceptar</button>
                       </div>
                   </form>`,_states=[{id:225,name:"open",desc:"Abierta"},{id:221,name:"sent",desc:"Enviada"},{id:222,name:"cancelled",desc:"Cancelada"},{id:223,name:"rejected",desc:"Rechazada"},{id:224,name:"approved",desc:"Aprobada"}];$(()=>setupControls());$(window).resize(setCustomHeight);$(".total-days").click(showTotalDays);$(".days-taken, .rejected-days").click(showDaysTaken);$(".see-requests").click(showRequests);$("body").on("click",".add-request, .detail-request",openRequestForm);$("#cancel-request").click(cancelRequest);$("#save-request").click(saveRequest);$("#detail-requests").on("click",".action-open, .action-cancel, .action-send",onButtonPressed);$("#detail-requests").on("click",".action-edit",onEdit);$("#delete-request").click(deleteRequest);$("#Send").on("change",onSendChange);$("#replacements").on("click",".action-new, .action-edit, .action-delete",onEditReplacement);$("#replacement-detail").on("click",".cancel-replacement",()=>showHidePanelReplacement(!1));$("#replacement-detail").on("click",".save-replacement",saveReplacement);