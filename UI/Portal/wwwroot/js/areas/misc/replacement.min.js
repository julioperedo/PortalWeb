function setupControls(){var n=new Date,t=$("#FilInitialDate").kendoDatePicker({format:"d/M/yyyy",value:n,change:function(){var n=this.value();n===null&&this.value("");i.min(n?n:_minDate)}}).data("kendoDatePicker"),i=$("#FilFinalDate").kendoDatePicker({format:"d/M/yyyy",value:n,change:function(){var n=this.value();n===null&&this.value("");t.max(n?n:_maxDate)}}).data("kendoDatePicker");_maxDate=i.max();_minDate=t.min();$("#form-type").val()==="C"?($("#FilSeller").kendoDropDownList({dataTextField:"name",dataValueField:"shortName",optionLabel:"Seleccione un Ejecutivo...",dataSource:{transport:{read:{url:urlSellers}}}}),$("#FilReplacement").kendoDropDownList({dataTextField:"name",dataValueField:"shortName",optionLabel:"Seleccione un Remplazo...",dataSource:{transport:{read:{url:urlSellers}}}})):$("#FilType").kendoDropDownList({dataTextField:"Text",dataValueField:"Value",value:"X",dataSource:[{Text:"Como Reemplazado",Value:"X",Selected:!0},{Text:"Como Reemplazante",Value:"Y"}]});$("#Listado").kendoGrid({sortable:!0,noRecords:{template:"No hay resultados para el criterio de búsqueda."},selectable:"Single, Row",columns:[{title:"Nombre",field:"sellerName"},{title:"Reemplazo",field:"replacementName"},{title:"Desde",attributes:alignCenter,headerAttributes:alignCenter,width:90,field:"initialDate",format:"{0:dd/MM/yyyy}"},{title:"Hasta",attributes:alignCenter,headerAttributes:alignCenter,width:90,field:"finalDate",format:"{0:dd/MM/yyyy}"},{field:"id",title:" ",attributes:alignCenter,width:80,sortable:!1,headerAttributes:alignCenter,headerTemplate:'<i class="fas fa-plus action new-item" title="Nuevo Rempazo"><\/i>',template:'<i class="fas fa-pen action action-edit" title="Editar Remplazo"><\/i>&nbsp;&nbsp;<i class="fas fa-trash-alt action action-delete" title="Eliminar Remplazo"><\/i>'}],dataSource:[]});$("#Detail").kendoWindow({scrollable:!0,visible:!1,width:900,actions:["Close"],resizable:!1,title:"Reemplazo",modal:!0,refresh:n=>{var t=$("#InitialDate").kendoDatePicker({format:"d/M/yyyy",change:function(){var n=this.value();n===null&&this.value("");i.min(n?n:_minDate)}}).data("kendoDatePicker"),i=$("#FinalDate").kendoDatePicker({format:"d/M/yyyy",change:function(){var n=this.value();n===null&&this.value("");t.max(n?n:_maxDate)}}).data("kendoDatePicker");$("#SellerCode").kendoDropDownList({dataTextField:"name",dataValueField:"shortName",optionLabel:"Seleccione un Ejecutivo...",dataSource:{transport:{read:{url:urlSellers}}}});$("#ReplaceCode").kendoDropDownList({dataTextField:"name",dataValueField:"shortName",optionLabel:"Seleccione un Remplazo...",dataSource:{transport:{read:{url:urlSellers}}}});onRefreshWindow(n)}})}function getFilters(){var n=$("#FilInitialDate").data("kendoDatePicker").value(),t=$("#FilFinalDate").data("kendoDatePicker").value(),i="",r="";return n&&(n=n.toISOString()),t&&(t=t.toISOString()),$("#form-type").val()==="C"?(i=$("#FilSeller").data("kendoDropDownList").value(),r=$("#FilReplacement").data("kendoDropDownList").value()):$("#FilType").data("kendoDropDownList").value()==="X"?i=$("#CurrentSeller").val():r=$("#CurrentSeller").val(),{InitialDate:n,FinalDate:t,SellerCode:i,ReplacementCode:r}}function filterData(){var n=getFilters();$.get(urlFilter,n,function(n){n.message===""?loadGrid(n.items):showError(n.message)})}function loadGrid(n){var i,r,t;$.each(n,function(n,t){t.initialDate=JSON.toDate(t.initialDate);t.finalDate=JSON.toDate(t.finalDate)});i=$("#Listado").data("kendoGrid");r=new kendo.data.DataSource({data:n});i.setDataSource(r);t=_gridMargin;n&&n.length>0&&($("#filter-box").collapse("hide"),t-=20);setTimeout(()=>{setGridHeight("Listado",t)},200)}var _minDate,_maxDate;const alignCenter={style:"text-align: center;"},alignRight={style:"text-align: right;"},dateFormat="{0:dd-MM-yyyy HH:mm:ss}",_gridMargin=30;$(function(){setupControls();setGridHeight("Listado",_gridMargin)});$(window).resize(()=>{setGridHeight("Listado",_gridMargin)});$("#action-filter").click(()=>filterData());$("#action-clean").click(()=>{$("#FilInitialDate").data("kendoDatePicker").value(new Date),$("#FilFinalDate").data("kendoDatePicker").value(new Date),$("#form-type").val()==="C"?($("#FilSeller").data("kendoDropDownList").value(""),$("#FilReplacement").data("kendoDropDownList").value("")):$("#FilType").data("kendoDropDownList").value("X"),loadGrid([])});$("#Listado").on("click",".new-item",function(){var n=$("#Detail").data("kendoWindow");n.refresh({url:urlEdit,data:{Id:0}});n.open()});$("#Listado").on("click",".action-edit",function(n){var u;n.preventDefault();var t=$("#Detail").data("kendoWindow"),i=$("#Listado").data("kendoGrid"),r=$(n.currentTarget).closest("tr");i.select(r);u=i.dataItem(r);t.refresh({url:urlEdit,data:{Id:u.id}});t.open()});$("#Listado").on("click",".action-delete",function(){var t=$("#Listado").data("kendoGrid"),n=t.dataItem($(this).closest("tr")),i=getFilters();showConfirm(`¿Está seguro que desea eliminar el remplazo de <b>${n.sellerName}</b> a <b>${n.replacementName}</b>?`,()=>{$.post(urlDelete,{Id:n.id,Filters:i},function(t){t.message===""?(loadGrid(t.items),showMessage(`Se ha eliminado el remplazo de <b>${n.sellerName}</b> a <b>${n.replacementName}</b> correctamente.`)):showError(t.message)})})});$("#Detail").on("click","#save-item",function(n){var t,u;if(n.preventDefault(),t=$(this).closest("form"),u=t.kendoValidator().data("kendoValidator"),u.validate()){var e=getFilters(),i=t.serializeObject(),f=!0,r=$("#CurrentSeller").val();r&&i.SellerCode!==r&&i.ReplaceCode!==r&&(f=!1);f?$.post(urlEdit,{Item:i,Filters:e},function(n){n.message===""?(loadGrid(n.items),showMessage("Datos guardados correctamente."),$("#Detail").data("kendoWindow").close()):showError(n.message)}):showInfo("Ud. debe ser unos de los dos (remplazante o remplazado).")}});