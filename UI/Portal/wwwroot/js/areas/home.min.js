function setupControls(){chartList=JSON.parse($("#Charts").val());var s=Boolean(kendo.support.mobileOS),n=new Date,t=new Date(n.getFullYear(),n.getMonth(),1),i=$("#regional-since").kendoDatePicker({format:"d/M/yyyy",value:t,change:function(){var n=this.value();n===null&&this.value("");r.min(n?n:_minDate);getRegionalData()}}).data("kendoDatePicker"),r=$("#regional-until").kendoDatePicker({format:"d/M/yyyy",value:n,change:function(){var n=this.value();n===null&&this.value("");i.max(n?n:_maxDate);getRegionalData()}}).data("kendoDatePicker");_maxDate=r.max();_minDate=i.min();Enumerable.From(chartList).Where("$.IdChart === 1 || $.IdChart === 7").Count()>0?(_canSee=Enumerable.From(chartList).Where("$.IdChart === 7").Count()>0,$("#tableResume").kendoGrid({dataSource:getDatasourceResume([]),scrollable:!1,sortable:!0,pageable:!1,selectable:"Single, Row",columns:[{field:"subsidiary",title:"Sucursal",footerTemplate:"TOTAL",media:"(min-width:1175px)"},{field:"warehouse",title:"Almacén",media:"(min-width:1175px)"},{field:"today",title:"Facturado Hoy",format:"{0:N2}",footerTemplate:"#:kendo.toString(sum, 'N2')#",attributes:alignRight,headerAttributes:alignRight,footerAttributes:alignRight,width:100,template:n=>seeSalesDetail?`<a class='billed-today action action-link'>${kendo.toString(n.today,"N2")}</a>`:kendo.toString(n.today,"N2"),media:"(min-width:1175px)"},{field:"period",title:"Facturado Período",format:"{0:N2}",footerTemplate:"#:kendo.toString(sum, 'N2')#",attributes:alignRight,headerAttributes:alignRight,footerAttributes:alignRight,width:100,template:n=>seeSalesDetail?`<a class='billed-period action action-link'>${kendo.toString(n.period,"N2")}</a>`:kendo.toString(n.period,"N2"),media:"(min-width:1175px)"},{field:"notBilled",title:"Sólo Entregado",format:"{0:N2}",attributes:alignRight,headerAttributes:alignRight,footerAttributes:alignRight,width:100,footerTemplate:"#:kendo.toString(sum, 'N2')#",template:n=>seeSalesDetail?`<a class='delivered-period action action-link'>${kendo.toString(n.notBilled,"N2")}</a>`:kendo.toString(n.notBilled,"N2"),media:"(min-width:1175px)"},{field:"percentage",title:"Porcentaje",format:"{0:N2} %",attributes:alignRight,headerAttributes:alignRight,width:100,media:"(min-width:1175px)"},{field:"expected",title:"Proyectado",format:"{0:N2}",attributes:alignRight,headerAttributes:alignRight,width:100,footerTemplate:"#:kendo.toString(sum, 'N2')#",footerAttributes:alignRight,media:"(min-width:1175px)"},{field:"expectedDifference",title:"Dif. Proyectado",attributes:alignRight,headerAttributes:alignRight,width:100,template:templateExpectedDiff,footerTemplate:footerTemplateExpectedDiff,footerAttributes:alignRight,media:"(min-width:1175px)"},{field:"expectedDifferencePercentage",title:"Dif. Proyectado %",format:"{0:N2} %",attributes:alignRight,headerAttributes:alignRight,width:100,template:templateExpectedDiffPercentage,footerTemplate:footerTemplateExpectedDiffPercentage,footerAttributes:alignRight,media:"(min-width:1175px)"},{field:"margin",title:"Margen",format:"{0:N2} %",attributes:alignRight,headerAttributes:alignRight,footerAttributes:alignRight,width:70,footerTemplate:marginTotal,media:"(min-width:1175px)"},{field:"authorized",title:"OV Autorizadas",format:"{0:N2}",attributes:alignRight,headerAttributes:alignRight,width:100,footerAttributes:alignRight,footerTemplate:"#:kendo.toString(sum, 'N2')#",template:n=>seeSalesDetail?`<a class='aov action action-link'>${kendo.toString(n.authorized,"N2")}</a>`:kendo.toString(n.authorized,"N2"),media:"(min-width:1175px)"},{field:"open",title:"OV Abiertas",format:"{0:N2}",attributes:alignRight,headerAttributes:alignRight,width:100,footerAttributes:alignRight,footerTemplate:"#:kendo.toString(sum, 'N2')#",template:n=>seeSalesDetail?`<a class='openov action action-link'>${kendo.toString(n.open,"N2")}</a>`:kendo.toString(n.open,"N2"),media:"(min-width:1175px)"},{field:"stock",title:"Valor Stock",format:"{0:N2}",attributes:alignRight,headerAttributes:alignRight,width:100,footerAttributes:alignRight,media:"(min-width:1175px)",footerTemplate:"#:kendo.toString(sum, 'N2')#",template:n=>gridGrouped?`<a class="stockvalue action action-link">${kendo.toString(n.stock,"N2")}</a>`:kendo.toString(n.stock,"N2")},{field:"subsidiary",title:"Resumen",template:templateColumnMobile,media:"(max-width:1174px)",footerTemplate:footerTemplateColumnMobile}],dataBound:function(n){var t=n.sender,i=$(window).width();i>=1175&&(gridGrouped?(t.hideColumn("warehouse"),Enumerable.From(regionalData.projection).Select("$.amount").Sum()>0&&(t.showColumn("expected"),t.showColumn("expectedDifference"),t.showColumn("expectedDifferencePercentage"))):(t.showColumn("warehouse"),t.hideColumn("expected"),t.hideColumn("expectedDifference"),t.hideColumn("expectedDifferencePercentage")),Enumerable.From(chartList).Where("$.IdChart === 7").Count()>0?(t.showColumn("margin"),t.showColumn("authorized"),t.showColumn("stock")):(t.hideColumn("margin"),t.hideColumn("authorized"),t.hideColumn("stock")),regionalData.notBilled&&regionalData.notBilled.length>0?t.showColumn("notBilled"):t.hideColumn("notBilled"))}}),$("#openOVs").kendoGrid({columns:[{title:"Almacen",width:90,field:"warehouse"},{title:"# Orden",width:100,field:"docNumber",template:n=>n.docNumber?`<a class="sale-order action action-link" data-number="${n.docNumber}">${n.docNumber}</a>`:""},{title:"Fecha",attributes:alignCenter,headerAttributes:alignCenter,width:100,field:"docDate",format:"{0:dd/MM/yyyy}"},{title:"Order Cliente",width:100,field:"clientOrder"},{title:"Cliente",width:"180px",field:"clientName"},{title:"Vendedor",width:"120px",field:"sellerName"},{title:"Total",attributes:alignRight,headerAttributes:alignRight,width:100,field:"total",format:"{0:#,##0.00}"},{title:"Abierto",attributes:alignRight,headerAttributes:alignRight,width:100,field:"openAmount",format:"{0:#,##0.00}"},{title:"Completo",attributes:alignCenter,headerAttributes:alignCenter,width:90,field:"complete",template:n=>n.complete?'<i class="fas fa-check"><\/i>':""},{title:" ",width:30,field:"header",template:n=>n.header||n.footer?'<a class="comment action action-link"><i class="fas fa-list-alt"><\/i><\/a>':""},{title:" ",width:30,field:"hasFiles",template:n=>n.hasFiles?'<a class="attach action action-link"><i class="fas fa-paperclip"><\/i><\/a>':""}],sortable:!0,selectable:"Single, Row",dataSource:[],detailInit:function(n){var i=["FLETES","ENVIO","DMCSERVICIOS","DMCCARGOS"],t=n.data;$.get(urlOrderDetail,{Subsidiary:t.subsidiary,DocEntry:t.id,State:t.state},t=>{t.message===""?$("<div>").appendTo(n.detailCell).kendoGrid({scrollable:!1,sortable:!0,pageable:!1,selectable:"Single, Row",columns:[{title:"Cod. Item DMC",width:150,field:"itemCode",template:n=>i.indexOf(n.itemCode)>=0?n.itemCode:`<span class='item-code action action-link'>${n.itemCode}</span>`},{title:"Descripción",field:"itemName"},{title:"Línea",width:200,field:"line"},{title:"Cantidad",attributes:alignRight,headerAttributes:alignRight,width:90,field:"openQuantity"},{title:"Precio",attributes:alignRight,headerAttributes:alignRight,width:90,field:"price",format:"{0:N2}"},{title:"Subtotal",attributes:alignRight,headerAttributes:alignRight,width:90,field:"itemTotal",format:"{0:N2}"},{title:"Completo",attributes:alignCenter,headerAttributes:alignCenter,width:90,field:"complete",template:n=>n.complete?'<i class="fas fa-check"><\/i>':""}],dataSource:t.items,noRecords:{template:"No hay items con acelerador"}}):showError(`Se ha producido el siguiente error al traer los datos: ${t.message}.`)})}}),$("#notesBilled").kendoGrid({columns:[{title:"Almacen",field:"warehouse"},{title:"# Nota",width:100,field:"noteNumber",template:n=>n.noteNumber?`<a class="sale-note action action-link">${n.noteNumber}</a>`:""},{title:"# Orden",width:80,field:"orderNumber",template:function(n){var t="",i;return n.orderNumber&&(n.orderNumber.indexOf(",")?(i=[],n.orderNumber.split(", ").forEach(n=>{i.push(`<a class="sale-order action action-link" data-number="${n}">${n}</a>`)}),t=i.join("<br />")):t=`<a class="sale-order action action-link" data-number="${n.orderNumber}">${n.orderNumber}</a>`),t}},{title:"Fecha",attributes:alignCenter,headerAttributes:alignCenter,width:100,field:"docDate",format:"{0:dd-MM-yyyy}"},{title:"Nombre Cliente",field:"clientName"},{title:"Vendedor",field:"sellerName"},{title:"Total",attributes:alignRight,headerAttributes:alignRight,width:100,field:"total",format:"{0:#,##0.00}"},{title:"Margen",attributes:alignRight,headerAttributes:alignRight,width:80,field:"margin",format:"{0:#,##0.00} %"}],sortable:!0,selectable:"Single, Row",dataSource:[],detailInit:function(n){var t=n.data;$.get(urlNoteDetail,{Subsidiary:t.subsidiary,DocNumber:t.noteNumber},t=>{t.message===""?$("<div>").appendTo(n.detailCell).kendoGrid({columns:[{title:"Cod. Item DMC",width:150,template:"<span class='item-code action action-link'>#=itemCode#<\/span>",field:"itemCode"},{title:"Descripción",field:"itemName"},{title:"Cantidad",attributes:alignRight,headerAttributes:alignRight,width:90,field:"quantity"},{title:"Precio",attributes:alignRight,headerAttributes:alignRight,width:90,field:"price",format:"{0:N2}"},{title:"Subtotal",attributes:alignRight,headerAttributes:alignRight,width:90,field:"itemTotal",format:"{0:N2}"},{title:"Margen",attributes:alignRight,headerAttributes:alignRight,width:90,field:"margin",format:"{0:N2} %"}],sortable:!0,selectable:"Single, Row",scrollable:!1,dataSource:t.items}):showError(`Se ha producido el siguiente error al traer los datos: ${t.message}.`)})}}),$("#justDelivered").kendoGrid({columns:[{title:"Almacen",field:"warehouse",width:150},{title:"# Nota E.",width:100,field:"docNumber",template:n=>`<a class="delivery-note action action-link">${n.docNumber}</a>`,width:90},{title:"Fecha",attributes:alignCenter,headerAttributes:alignCenter,width:100,field:"docDate",format:"{0:dd-MM-yyyy}"},{title:"Nombre Cliente",field:"clientName",width:300},{title:"Vendedor",field:"sellerName",width:200},{title:"Total",attributes:alignRight,headerAttributes:alignRight,width:100,field:"total",format:"{0:#,##0.00}"}],sortable:!0,selectable:"Single, Row",dataSource:[],detailInit:function(n){var t=n.data;$.get(urlDeliveryNoteDetail,{Subsidiary:t.subsidiary,DocNumber:t.docNumber},i=>{i.message===""?(i.items&&i.items.length>0&&i.items.forEach(n=>{n.itemTotal=n.quantity*n.price,n.warehouse=t.warehouse}),$("<div>").appendTo(n.detailCell).kendoGrid({columns:[{title:"Cod. Item DMC",width:150,template:"<span class='item-code action action-link'>#=itemCode#<\/span>",field:"itemCode"},{title:"Descripción",field:"itemName"},{title:"Cantidad",attributes:alignRight,headerAttributes:alignRight,width:90,field:"quantity"},{title:"Precio",attributes:alignRight,headerAttributes:alignRight,width:90,field:"price",format:"{0:N2}"},{title:"Subtotal",attributes:alignRight,headerAttributes:alignRight,width:90,field:"itemTotal",format:"{0:N2}"}],sortable:!0,selectable:"Single, Row",scrollable:!1,dataSource:i.items})):showError(`Se ha producido el siguiente error al traer los datos: ${i.message}.`)})}}),$("#stockDetail").kendoGrid({columns:[{title:"Almacén",field:"warehouse"},{title:"Stock",attributes:alignRight,headerAttributes:alignRight,width:120,field:"total",format:"{0:#,##0.00}"}],sortable:!0,selectable:"Single, Row",dataSource:[],detailInit:function(n){var t=n.data,i=$("#divisions .active input").val()||"General";$.get(urlStockWarehouse,{Subsidiary:resumeItem.subsidiary,Warehouse:t.warehouse,Division:i},function(t){$("<div>").appendTo(n.detailCell).kendoGrid({scrollable:!1,sortable:!0,pageable:!1,selectable:!0,columns:[{field:"line",title:"Línea",width:200},{field:"total",title:"Stock",width:120,format:"{0:N2}",attributes:alignRight,headerAttributes:alignRight},],dataSource:t.items,noRecords:{template:"No se encontraron registros para el criterio de búsqueda."}});n.masterRow.closest(".k-window-content").css("max-height","");var i=$("#Detail").getKendoWindow();i.setOptions({height:800});i.center()})}}),Enumerable.From(chartList).Where("$.IdChart === 7").Count()===0&&$("#switch-warehouses").addClass("d-none")):$("#resumeSales").addClass("d-none");Enumerable.From(chartList).Where("$.IdChart === 2 || $.IdChart === 8").Count()>0?$("#tableTopClients").kendoGrid({dataSource:getDatasourceTopClients([]),scrollable:!1,sortable:!0,pageable:!1,selectable:!0,columns:[{field:"name",title:"Cliente",footerTemplate:"TOTAL"},{field:"total",title:"Total",format:"{0:N2}",footerTemplate:"#:kendo.toString(sum, 'N2')#",attributes:alignRight,headerAttributes:alignRight,footerAttributes:alignRight,width:90},{field:"percentage",title:"Porcentaje",format:"{0:N2} %",footerTemplate:"#:kendo.toString(sum, 'N2')# %",attributes:alignRight,headerAttributes:alignRight,footerAttributes:alignRight,width:80,minScreenWidth:1120},{field:"margin",title:"Margen",format:"{0:N2} %",width:80,attributes:alignRight,headerAttributes:alignRight}],dataBound:function(n){var t=n.sender;Enumerable.From(chartList).Where("$.IdChart === 8").Count()>0?t.showColumn("margin"):t.hideColumn("margin")}}):$("#topClients").addClass("d-none");$("#Detail").kendoWindow({visible:!1,open:onRefreshWindow,modal:!0,iframe:!1,scrollable:!0,title:"OV Autorizadas",resizable:!1,width:1200,actions:["Close"]});$("#Report").kendoWindow({visible:!1,width:1100,title:"Producto",modal:!0});$("#Detail2").kendoWindow({visible:!1,modal:!0,iframe:!1,scrollable:!0,title:"Detalle Stock",resizable:!1,width:1100,actions:["Close"],activate:function(){wnd=this;setTimeout(()=>wnd.center(),250)}});Enumerable.From(chartList).Where("$.IdChart === 11").Count()>0&&$("#tableKbytes").kendoGrid({dataSource:{data:[],aggregate:[{field:"amount",aggregate:"sum"},{field:"points",aggregate:"sum"}]},scrollable:!1,sortable:!0,pageable:!1,selectable:!0,excel:{fileName:"Kbytes.xlsx"},columns:[{field:"code",title:"Cod.",width:100,footerTemplate:"TOTAL"},{field:"name",title:"Nombre",width:250},{field:"status",title:"Status",width:130},{field:"amount",title:"Monto",format:"{0:N2}",footerTemplate:"#:kendo.toString(sum, 'N2')#",attributes:alignRight,headerAttributes:alignRight,footerAttributes:alignRight,width:90},{field:"points",title:"Puntos",format:"{0:N0}",footerTemplate:"#:kendo.toString(sum, 'N0')#",attributes:alignRight,headerAttributes:alignRight,footerAttributes:alignRight,width:90}]});Enumerable.From(chartList).Where("$.IdChart === 5 || $.IdChart === 6").Count()===0&&$("#sellersResume").addClass("d-none");$("#kbytes-year").kendoNumericTextBox({format:"####",change:()=>loadKbytesData()});var u=$("#products-since").kendoDatePicker({format:"d/M/yyyy",value:t,change:function(){var n=this.value();n===null&&this.value("");f.min(n?n:_minDate);getProductsData()}}).data("kendoDatePicker"),f=$("#products-until").kendoDatePicker({format:"d/M/yyyy",value:n,change:function(){var n=this.value();n===null&&this.value("");u.max(n?n:_maxDate);getProductsData()}}).data("kendoDatePicker"),e=$("#seller-resume-since").kendoDatePicker({format:"d/M/yyyy",value:t,change:function(){var n=this.value();n===null&&this.value("");o.min(n?n:_minDate);getTeamData()}}).data("kendoDatePicker"),o=$("#seller-resume-until").kendoDatePicker({format:"d/M/yyyy",value:n,change:function(){var n=this.value();n===null&&this.value("");e.max(n?n:_maxDate);getTeamData()}}).data("kendoDatePicker");Enumerable.From(chartList).Where("$.ChartGroup === 'Regional'").Count()>0?getRegionalData():$(".card-regional").addClass("d-none");Enumerable.From(chartList).Where("$.ChartGroup === 'Kbytes'").Count()===0&&$(".card-kbytes").addClass("d-none");Enumerable.From(chartList).Where("$.ChartGroup === 'Productos'").Count()===0&&$(".card-products").addClass("d-none");Enumerable.From(chartList).Where("$.ChartGroup === 'Rendimiento de Equipo'").Count()===0&&$(".card-team").addClass("d-none")}function getRegionalData(){var t=$("#regional-since").data("kendoDatePicker").value(),n;t&&(t=t.toISOString());n=$("#regional-until").data("kendoDatePicker").value();n&&(n=n.toISOString());$.get(ulrSalesResume,{InitialDate:t,FinalDate:n},n=>{n.message===""?(regionalData.authorized=n.authorized,regionalData.opens=n.opens,regionalData.sales=n.sales,regionalData.salesToday=n.salesToday,regionalData.stock=n.stock,regionalData.warehouses=n.warehouses,regionalData.projection=n.projection,regionalData.projectionChart=n.projectionChart,regionalData.notBilled=n.notBilled,loadRegionalResume("G",!0),$("#divisions > div:first").addClass("active")):showError(`Se ha producido un error al traer los datos del servidor: <br />${n.message}`)});$.get(ulrTopClients,{InitialDate:t,FinalDate:n},n=>{n.message===""?(regionalData.topClients=n.clients,loadTopClients("G","General"),$("#subsidiaries > div:first").addClass("active")):showError(`Se ha producido un error al traer los datos del servidor: <br />${n.message}`)})}function loadRegionalResume(n,t){var i=[],r,u,c,f,e,o,l,s,a;if(gridGrouped=t,r=n==="G"?"":n==="C"?"$.division === ''":`$.division === '${n}'`,u=Enumerable.From(regionalData.sales).Where(r).Select("$.total").Sum(),regionalData.warehouses.forEach(t=>{var f={subsidiary:t.subsidiary,warehouse:t.warehouse},e=`$.subsidiary === '${t.subsidiary}' && $.warehouse === '${t.warehouse}'`,o=n==="M"?"$.division === 'M'":"",s=(o!==""&&e!==""?`${o} &&`:o)+e;e=(r!==""&&e!==""?`${r} &&`:r)+e;f.period=Enumerable.From(regionalData.sales).Where(e).Select("$.total").Sum();f.marginTotal=Enumerable.From(regionalData.sales).Where(e).Select("$.margin").Sum();f.taxlessTotal=Enumerable.From(regionalData.sales).Where(e).Select("$.taxlessTotal").Sum();f.today=Enumerable.From(regionalData.salesToday).Where(e).Select("$.total").Sum();f.margin=f.period>0?f.marginTotal/f.period*100:0;f.authorized=Enumerable.From(regionalData.authorized).Where(e).Select("$.total").Sum();f.open=Enumerable.From(regionalData.opens).Where(e).Select("$.total").Sum();f.stock=Enumerable.From(regionalData.stock).Where(s).Select("$.total").Sum();f.percentage=u>0?f.period/u*100:0;f.notBilled=Enumerable.From(regionalData.notBilled).Where(e).Select("$.total").Sum();i.push(f)}),c=$("#tableResume").data("kendoGrid"),t?(e=Enumerable.From(i).GroupBy("{ subsidiary: $.subsidiary }",null,function(t,i){var h=0,f=0,c=0,l=0,o=0,a=0,v=0,y=0,e=0,r=0,s=0,p=0,w=0,b;return i.ForEach(function(n){h+=n.today;f+=n.period;a+=n.authorized;v+=n.open;y+=n.stock;o+=n.marginTotal;e+=n.taxlessTotal;w+=n.notBilled}),u>0&&(c=f*100/u),l=e>0?o/e*100:0,b=n==="G"?`$.subsidiary === '${t.subsidiary}'`:`$.subsidiary === '${t.subsidiary}' && $.division === '${n}'`,r=Enumerable.From(regionalData.projection).Where(b).Select("$.amount").Sum(),s=f-r,p=r>0?s/r*100:0,{subsidiary:t.subsidiary,today:h,period:f,margin:l,notBilled:w,percentage:c,authorized:a,open:v,stock:y,taxlessTotal:e,marginTotal:o,extended:Enumerable.From(chartList).Where("$.IdChart === 7").Count()>0,expected:r,expectedDifference:s,expectedDifferencePercentage:p}},"$.subsidiary").ToArray(),f=getDatasourceResume(e)):(i.forEach(n=>n.extended=Enumerable.From(chartList).Where("$.IdChart === 7").Count()>0),f=getDatasourceResume(i)),c.setDataSource(f),o=Highcharts.getOptions().colors,l=$("#chartResume"),t)a=Enumerable.From(e).Select("{ name: $.subsidiary, y: $.period }").ToArray(),s={credits:!1,chart:{plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1,type:"pie",backgroundColor:"transparent",width:300},title:{text:""},tooltip:{pointFormat:"Total: <b>{point.y:,.2f} ( {point.percentage:.2f} % )<\/b>"},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!1},showInLegend:!0}},series:[{name:"Clientes",colorByPoint:!0,data:a}]};else{var v=[],y=[],p=[],h=0;Enumerable.From(i).OrderBy("$.subsidiary, $.warehouse").GroupBy("{ subsidiary: $.subsidiary }",null,function(n,t){var i=0,u=Enumerable.From(t.source).Where("$.period > 0").Count(),f=u>1?5/(u-1)/10:0,r;return h++,r=0,t.ForEach(function(n){if(i+=n.period,n.period>0){var t=.2-r*f;p.push({name:n.warehouse,y:n.period,color:new Highcharts.Color(o[h]).brighten(t).get()});r++}}),y.push({name:n.subsidiary,y:i===0?null:i,color:new Highcharts.Color(o[h]).brighten(-.6).get()}),""},"$.subsidiary").ToArray();v=[{type:"pie",name:"Sucursales",data:y,size:"60%",dataLabels:{formatter:function(){return this.y>5?this.point.name:null},color:"white",distance:-30}},{type:"pie",name:"Almacenes",data:p,size:"80%",innerSize:"60%"}];s={credits:!1,chart:{type:"pie",backgroundColor:"transparent",width:300},title:{text:"Ventas por Sucursal / Almacen"},labels:{items:[]},series:v,tooltip:{pointFormat:"{series.name}: <b>{point.y:,.2f}<\/b>",valueDecimals:2},exporting:{sourceWidth:1400},plotOptions:{pie:{dataLabels:{enabled:!0,format:"<b>{point.name}<\/b><br /> {point.y:,.2f}"}}}}}l.highcharts(s);var w=Enumerable.From(regionalData.projectionChart.series).Where("$.name == 'Santa Cruz Proyectado' && $.division == '"+n+"'").Select("$.values").First(),b=Enumerable.From(regionalData.projectionChart.series).Where("$.name == 'Santa Cruz Facturado' && $.division == '"+n+"'").Select("$.values").First(),k=Enumerable.From(regionalData.projectionChart.series).Where("$.name == 'Iquique Proyectado' && $.division == '"+n+"'").Select("$.values").First(),d=Enumerable.From(regionalData.projectionChart.series).Where("$.name == 'Iquique Facturado' && $.division == '"+n+"'").Select("$.values").First(),g=Enumerable.From(regionalData.projectionChart.series).Where("$.name == 'Miami Proyectado' && $.division == '"+n+"'").Select("$.values").First(),nt=Enumerable.From(regionalData.projectionChart.series).Where("$.name == 'Miami Facturado' && $.division == '"+n+"'").Select("$.values").First(),tt=[];regionalData.projectionChart.labels.forEach(n=>tt.push(n));Highcharts.chart("chartProjection",{chart:{type:"column"},title:{text:"Proyección de Ventas"},xAxis:{categories:regionalData.projectionChart.labels},yAxis:[{min:0,title:{text:"Ventas"}}],legend:{shadow:!1},tooltip:{shared:!0},plotOptions:{column:{grouping:!1,shadow:!1,borderWidth:0}},series:[{name:"Santa Cruz Proyectado",color:"rgba(21,87,36,.9)",data:w,pointPadding:.3,pointPlacement:-.3},{name:"Santa Cruz Facturado",color:"rgba(195,230,134,1)",data:b,pointPadding:.4,pointPlacement:-.3},{name:"Iquique Proyectado",color:"rgba(0,64,133,.9)",data:k,pointPadding:.3,pointPlacement:0},{name:"Iquique Facturado",color:"rgba(184,218,255,1)",data:d,pointPadding:.4,pointPlacement:0},{name:"Miami Proyectado",color:"rgba(248,161,203,.9)",data:g,pointPadding:.3,pointPlacement:.3},{name:"Miami Facturado",color:"rgba(186,60,61,1)",data:nt,pointPadding:.4,pointPlacement:.3}],credits:!1})}function loadTopClients(n,t){var i=n==="G"?"":n==="C"?"$.division === ''":`$.division === '${n}'`,f=t==="General"?"":`$.subsidiary === '${t}'`,e=(i!==""&&f!==""?`${i} && `:i)+f,r=Enumerable.From(regionalData.topClients).Where(e).Select("$.total").Sum(),o=Enumerable.From(regionalData.topClients).Where(e).GroupBy("{ code: $.code, name: $.name }",null,function(n,t){var u=0,f=0,e=0,i=0,o=0;return t.ForEach(n=>{u+=n.total,f+=n.marginTotal,i+=n.taxlessTotal}),r>0&&(o=u*100/r),e=i>0?f/i*100:0,{code:n.code,name:n.name,total:u,marginTotal:f,margin:e,taxlessTotal:i,percentage:o}},"$.code, $.name").ToArray(),h=$("#tableTopClients").data("kendoGrid"),u=Enumerable.From(o).OrderByDescending("$.total").Take(10).ToArray(),c=getDatasourceTopClients(u);h.setDataSource(c);var l=Highcharts.getOptions().colors,s=Enumerable.From(u).Select("{ name: $.name, y: $.total }").ToArray(),a=Enumerable.From(u).Select("$.total").Sum();o.length>10&&s.push({name:"Varios",y:r-a,sliced:!0,selected:!0,color:new Highcharts.Color(l[5]).brighten(-.6).get()});$("#chartTopClients").highcharts({credits:!1,chart:{plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1,type:"pie",backgroundColor:"transparent"},title:{text:""},tooltip:{pointFormat:"Total: <b>{point.y:,.2f} ( {point.percentage:.2f} % )<\/b>"},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!1},showInLegend:!0}},series:[{name:"Clientes",colorByPoint:!0,data:s}]})}function openBilledPeriod(n,t){var f,e,s=$(n.currentTarget).closest(".k-grid").data("kendoGrid"),h=$(n.currentTarget).closest("tr"),i,r,l;s.select(h);var u=s.dataItem(h),c=$("#divisions .active input").val(),o=$("#Detail").getKendoWindow();t==="P"?(i=$("#regional-since").data("kendoDatePicker").value(),i&&(i=i.toISOString()),r=$("#regional-until").data("kendoDatePicker").value(),r&&(r=r.toISOString()),f=urlPeriodBills,e={Subsidiary:u.subsidiary,Warehouse:u.warehouse,Division:c,InitialDate:i,FinalDate:r},o.title("Facturadas Período")):(f=urlTodayBills,e={Subsidiary:u.subsidiary,Warehouse:u.warehouse,Division:c},o.title("Facturadas Hoy"));$("#notesBilled").removeClass("d-none");$("#openOVs").addClass("d-none");$("#stockDetail").addClass("d-none");$("#justDelivered").addClass("d-none");l=$("#notesBilled").data("kendoGrid");$.get(f,e,n=>{n.items.forEach(n=>{n.docDate=JSON.toDate(n.docDate)});var t=new kendo.data.DataSource({data:n.items});l.setDataSource(t);o.open()})}function openDelivered(n){var r=$(n.currentTarget).closest(".k-grid").data("kendoGrid"),u=$(n.currentTarget).closest("tr"),t,f,i,e,o;r.select(u);t=r.dataItem(u);f=$("#divisions .active input").val();i=$("#Detail").getKendoWindow();$("#notesBilled").addClass("d-none");$("#openOVs").addClass("d-none");$("#stockDetail").addClass("d-none");$("#justDelivered").removeClass("d-none");i.title("Notas de Entrega sin Facturar");$.get(urlOpenDeliveryNotes,{Subsidiary:t.subsidiary,Warehouse:t.warehouse,Division:f},n=>{e=$("#justDelivered").data("kendoGrid"),n.items.forEach(n=>n.docDate=JSON.toDate(n.docDate)),o=new kendo.data.DataSource({data:n.items}),e.setDataSource(o),i.open()})}function marginTotal(n){return kendo.toString(n.taxlessTotal.sum>0?n.marginTotal.sum/n.taxlessTotal.sum*100:0,"N2")+" %"}function getDatasourceResume(n){return new kendo.data.DataSource({data:n,aggregate:[{field:"period",aggregate:"sum"},{field:"today",aggregate:"sum"},{field:"marginTotal",aggregate:"sum"},{field:"taxlessTotal",aggregate:"sum"},{field:"authorized",aggregate:"sum"},{field:"open",aggregate:"sum"},{field:"stock",aggregate:"sum"},{field:"expected",aggregate:"sum"},{field:"expectedDifference",aggregate:"sum"},{field:"notBilled",aggregate:"sum"}]})}function getDatasourceTopClients(n){return new kendo.data.DataSource({data:n,aggregate:[{field:"total",aggregate:"sum"},{field:"percentage",aggregate:"sum"}]})}function isEmpty(n){return!$.trim(n.html())}function loadReport(n,t,i,r){var e={Subsidiary:t,DocNumber:n,User:$.trim($(".user-info > .user-name").first().text())},u="SaleOrder.trdp",f;if(i==="Note"&&(u="SaleNote.trdp"),i==="Delivery"&&(u="DeliveryNote.trdp",e.SearchType=r),i==="Bill"&&(u="Bill.trdp"),f=$("#reportViewer1").data("telerik_ReportViewer"),f)try{f.reportSource({report:u,parameters:e});f.refreshReport()}catch(o){console.error(`Error al recargar el reporte: ${o}`);showInfo("El servidor está ocupado, espere un momento y vuelva a intentar.")}else try{$("#reportViewer1").telerik_ReportViewer({serviceUrl:urlService,reportSource:{report:u,parameters:e},scaleMode:telerikReportViewer.ScaleModes.FIT_PAGE_WIDTH})}catch(o){console.error(`Error al cargar el reporte: ${o}`);showInfo("El servidor está ocupado, espere un momento y vuelva a intentar.")}}function loadKbytesData(){cleanDetail();var n=$("#resumes");$.get(urlKbytes,{},t=>{var u,i;if(t.message===""){kbytesLoaded=!0;var f=`<div class="panel slide">
                                <div class="">
                                    <div class="text-center details-title">
                                        <div>
                                            <span class="small-label">año</span><br />
                                            <span class="year-title">#=year#</span><br />
                                        </div>                    
                                        <a class="see-details" data-type="N" data-year="#=year#"><span class="small-label action">ver detalle</span></a>
                                    </div>
                                    <div class="text-right details">
                                        <div>
                                            <span class="year-values">#=kendo.toString(amount, "N2")#</span><br />
                                            <span class="small-label">monto acumulado</span>
                                        </div>
                                        <div>
                                            <span class="year-values">#=kendo.toString(points, "N0")#</span><br />
                                            <span class="small-label">puntos acumulados</span>
                                        </div>                 
                                    </div>
                                </div>
                            </div>`,e=kendo.template(f),r=$("<div>").addClass("width-panel"),o=`<div class="panel available width-panel">
                                <div class="row">
                                    <div class="col text-center">
                                        <div>                                                
                                            <span class="points-title">${kendo.toString(t.availablePoints,"N0")}</span><br />                                       
                                            <span class="small-label">puntos disponibles</span>&nbsp;&nbsp;&nbsp;<a class="see-details" data-type="AP" data-year="0"><span class="small-label action">ver detalle</span></a>
                                        </div>
                                    </div>                                       
                                </div>
                            </div>`;r.append(o);t.claimedPoints>0&&(u=`<div class="panel  width-panel">
                                   <div class="row">
                                       <div class="col text-center">
                                            <div>
                                                <span class="small-label">puntos usados</span>
                                                <span class="points-title">${kendo.toString(t.claimedPoints,"N0")}</span>                                                
                                            </div>
                                            <a class="see-details" data-type="UP" data-year="0"><span class="small-label action">ver detalle</span></a>
                                       </div>                                       
                                   </div>
                               </div>`,r.append(u));n.append(r);i=$("<div>").attr("id","years-slider").addClass("slider-2");t.years.forEach(n=>{i.append(e(n))});i.append(`<div onclick="prev()" class="control-btn prev"><i class="fas fa-arrow-left"></i></div>
                           <div onclick="next()" class="control-btn next"><i class="fas fa-arrow-right"></i></div>`);n.append(i)}else showError(`Se ha producido el siguiente error al traer los datos del servidor:<br /> ${t.message}`)})}function cleanDetail(){$("#resumes").empty();loadGridNotes([],0);$("#notesContainer").addClass("d-none");loadGridAwards([]);$("#awardsContainer").addClass("d-none");$("#pointsContainer").addClass("d-none")}function loadGridAwards(n){var t,i;n.forEach(n=>{n.claimDate=JSON.toDate(n.claimDate)});$("#notesContainer").addClass("d-none");$("#pointsContainer").addClass("d-none");$("#awardsContainer").removeClass("d-none");t=$("#listAwards").data("kendoGrid");t?(i=new kendo.data.DataSource({data:n}),t.setDataSource(i)):$("#listAwards").kendoGrid({toolbar:["excel"],dataSource:{data:n},sortable:!0,selectable:!0,pageable:!1,noRecords:{template:"No hay registros para el criterio de búsqueda"},columns:[{field:"cardName",title:"Cliente",width:300},{field:"claimDate",title:"Fecha",format:"{0:dd-MM-yyyy}",width:100,attributes:alignCenter,headerAttributes:alignCenter},{field:"quantity",title:"Cantidad",width:80,attributes:alignRight,headerAttributes:alignRight},{field:"award",title:"Premio",width:450},{field:"points",title:"Puntos Usados",width:120,format:"{0:N0}",attributes:alignRight,headerAttributes:alignRight}]})}function loadGridNotes(n,t){var u,i,r,f,e;$("#notesContainer").removeClass("d-none");$("#awardsContainer").addClass("d-none");$("#pointsContainer").addClass("d-none");u=$("#listNotes").data("kendoGrid");t>=2023?(i=n=>new kendo.data.DataSource({data:n,sort:{field:"amount",dir:"desc"},aggregate:[{aggregate:"sum",field:"amount"},{aggregate:"sum",field:"points"}]}),r=[{field:"cardCode",title:"Cod. Cliente",width:90},{field:"cardName",title:"Cliente",width:250},{field:"points",title:"Puntos",format:"{0:N0}",headerAttributes:alignRight,attributes:alignRight,footerAttributes:alignRight,footerTemplate:n=>n.points.sum!==null?kendo.toString(n.points.sum,"N0"):"",width:100},{field:"amount",format:"{0:N2}",title:"Monto",headerAttributes:alignRight,attributes:alignRight,footerAttributes:alignRight,footerTemplate:n=>n.amount.sum!==null?kendo.toString(n.amount.sum,"N2"):"",width:100}],f=n=>{var t=n.sender;t.element.find("table").attr("style","")}):(n.forEach(n=>{n.year=t,n.amountQ1===0&n.pointsQ1===0&&(n.amountQ1=null,n.pointsQ1=null,n.statusQ1=null),n.amountQ2===0&n.pointsQ2===0&&(n.amountQ2=null,n.pointsQ2=null,n.statusQ2=null),n.amountQ3===0&n.pointsQ3===0&&(n.amountQ3=null,n.pointsQ3=null,n.statusQ3=null),n.amountQ4===0&n.pointsQ4===0&&(n.amountQ4=null,n.pointsQ4=null,n.statusQ4=null)}),i=n=>new kendo.data.DataSource({data:n,sort:{field:"totalAmount",dir:"desc"},aggregate:[{aggregate:"sum",field:"amountQ1"},{aggregate:"sum",field:"amountQ2"},{aggregate:"sum",field:"amountQ3"},{aggregate:"sum",field:"amountQ4"},{aggregate:"sum",field:"pointsQ1"},{aggregate:"sum",field:"pointsQ2"},{aggregate:"sum",field:"pointsQ3"},{aggregate:"sum",field:"pointsQ4"},{aggregate:"sum",field:"totalPoints"},{aggregate:"sum",field:"totalAmount"}]}),r=[{field:"cardCode",title:"Cod. Cliente",width:90},{field:"cardName",title:"Cliente",width:250},{title:"Q1",headerAttributes:alignCenter,columns:[{field:"pointsQ1",title:"Puntos",format:"{0:N0}",headerAttributes:alignRight,attributes:alignRight,footerAttributes:alignRight,footerTemplate:n=>n.pointsQ1.sum!==null?kendo.toString(n.pointsQ1.sum,"N0"):"",width:100},{field:"amountQ1",format:"{0:N2}",title:"Monto",headerAttributes:alignRight,attributes:alignRight,footerAttributes:alignRight,footerTemplate:n=>n.amountQ1.sum!==null?kendo.toString(n.amountQ1.sum,"N2"):"",width:100},{field:"statusQ1",title:"Estatus",width:100}]},{title:"Q2",headerAttributes:alignCenter,columns:[{field:"pointsQ2",title:"Puntos",format:"{0:N0}",headerAttributes:alignRight,attributes:alignRight,footerAttributes:alignRight,footerTemplate:n=>n.pointsQ2.sum!==null?kendo.toString(n.pointsQ2.sum,"N0"):"",width:100},{field:"amountQ2",format:"{0:N2}",title:"Monto",headerAttributes:alignRight,attributes:alignRight,footerAttributes:alignRight,footerTemplate:n=>n.amountQ2.sum!==null?kendo.toString(n.amountQ2.sum,"N2"):"",width:100},{field:"statusQ2",title:"Estatus",width:100}]},{title:"Q3",headerAttributes:alignCenter,columns:[{field:"pointsQ3",title:"Puntos",format:"{0:N0}",headerAttributes:alignRight,attributes:alignRight,footerAttributes:alignRight,footerTemplate:n=>n.pointsQ3.sum!==null?kendo.toString(n.pointsQ3.sum,"N0"):"",width:100},{field:"amountQ3",format:"{0:N2}",title:"Monto",headerAttributes:alignRight,attributes:alignRight,footerAttributes:alignRight,footerTemplate:n=>n.amountQ3.sum!==null?kendo.toString(n.amountQ3.sum,"N2"):"",width:100},{field:"statusQ3",title:"Estatus",width:100}]},{title:"Q4",headerAttributes:alignCenter,columns:[{field:"pointsQ4",title:"Puntos",format:"{0:N0}",headerAttributes:alignRight,attributes:alignRight,footerAttributes:alignRight,footerTemplate:n=>n.pointsQ4.sum!==null?kendo.toString(n.pointsQ4.sum,"N0"):"",width:100},{field:"amountQ4",format:"{0:N2}",title:"Monto",headerAttributes:alignRight,attributes:alignRight,footerAttributes:alignRight,footerTemplate:n=>n.amountQ4.sum!==null?kendo.toString(n.amountQ4.sum,"N2"):"",width:100},{field:"statusQ4",title:"Estatus",width:100}]},{title:"TOTAL",headerAttributes:alignCenter,columns:[{field:"totalPoints",title:"Puntos",format:"{0:N0}",headerAttributes:alignRight,attributes:alignRight,footerAttributes:alignRight,footerTemplate:n=>n.totalPoints.sum!==null?kendo.toString(n.totalPoints.sum,"N0"):"",width:100},{field:"totalAmount",format:"{0:N2}",title:"Monto",headerAttributes:alignRight,attributes:alignRight,footerAttributes:alignRight,footerTemplate:n=>n.totalAmount.sum!==null?kendo.toString(n.totalAmount.sum,"N2"):"",width:100}]}],f=n=>{var t=n.sender,i=Enumerable.From(t.dataSource.data()).Select("$.year").FirstOrDefault();i>"2021"?(t.showColumn("statusQ1"),t.showColumn("statusQ2"),t.showColumn("statusQ3"),t.showColumn("statusQ4")):(t.hideColumn("statusQ1"),t.hideColumn("statusQ2"),i==="2021"?(t.showColumn("statusQ3"),t.showColumn("statusQ4")):(t.hideColumn("statusQ3"),t.hideColumn("statusQ4")));t.element.find("table").attr("style","")});u?(e=i(n),u.setOptions({dataSource:i(n),columns:r})):$("#listNotes").kendoGrid({toolbar:["excel"],dataSource:i(n),sortable:!0,selectable:!0,pageable:!1,noRecords:{template:"No hay registros para el criterio de búsqueda"},columns:r,dataBound:f})}function loadGridPoints(n){var r,f,t;$("#notesContainer").addClass("d-none");$("#awardsContainer").addClass("d-none");$("#pointsContainer").removeClass("d-none");var i=[],u=[...new Set(n.map(n=>n.year).sort())],e=[...new Map(n.map(n=>[n.cardCode,{cardCode:n.cardCode,cardName:n.cardName}])).values()];e.forEach(t=>{var f=0,r={cardCode:t.cardCode,cardName:t.cardName};u.forEach(i=>{var u=n.find(n=>n.cardCode===t.cardCode&&n.year===i);u?(r["points"+i]=u.points,r["claimed"+i]=u.claimed,f=f+u.points+u.claimed):(r["points"+i]=0,r["claimed"+i]=0)});r.total=f;i.push(r)});r=$("#listPoints").data("kendoGrid");r?(f=new kendo.data.DataSource({data:i,sort:{field:"cardName",dir:"asc"},aggregate:[{aggregate:"sum",field:"total"}]}),r.setDataSource(f)):(t=[{field:"cardCode",title:"Cod. Cliente",width:90},{field:"cardName",title:"Cliente",width:300}],u.forEach(n=>{t.push({title:`Puntos ${n}`,headerAttributes:alignCenter,columns:[{field:"points"+n,title:"Acumulado",format:"{0:N0}",headerAttributes:alignRight,attributes:alignRight,width:100},{field:"claimed"+n,format:"{0:N0}",title:"Usados",headerAttributes:alignRight,attributes:alignRight,width:100}]})}),t.push({title:"TOTAL",field:"total",format:"{0:N0}",headerAttributes:alignRight,attributes:alignRight,width:100}),$("#listPoints").kendoGrid({toolbar:["excel"],dataSource:{data:i,sort:{field:"amount",dir:"desc"}},sortable:!0,selectable:!0,pageable:!1,noRecords:{template:"No hay registros para el criterio de búsqueda"},columns:t}))}function getProductsData(){var t=$("#products-since").data("kendoDatePicker").value(),n;t&&(t=kendo.toString(t,"yyyy-MM-dd"));n=$("#products-until").data("kendoDatePicker").value();n&&(n=kendo.toString(n,"yyyy-MM-dd"));Enumerable.From(chartList).Where("$.IdChart === 3").Count()>0&&$.get(urlResumeLines,{InitialDate:t,FinalDate:n},n=>{n.message===""?(productsLoaded=!0,productData.lines=n.chart,loadLines()):showError(`Se ha producido un error al traer los datos del servidor: <br />${n.message}`)});Enumerable.From(chartList).Where("$.IdChart === 4").Count()>0&&$.get(urlResumeCategories,{InitialDate:t,FinalDate:n},n=>{n.message===""?(productsLoaded=!0,productData.categories=n.chart,loadCategories()):showError(`Se ha producido un error al traer los datos del servidor: <br />${n.message}`)})}function loadLines(){var r=Highcharts.getOptions().colors;Highcharts.setOptions({lang:{decimalPoint:".",thousandsSep:","}});var t,i=[],n=productData.lines;$.each(n.series,function(n,t){var u=[];$.each(t.data,function(n,t){u.push({name:t.label,y:t.value,color:new Highcharts.Color(r[n%10]).brighten(.3-n/50).get()})});i.push({type:t.type,name:t.name,data:u})});t={credits:!1,title:{text:n.title},xAxis:{categories:n.labels},yAxis:{min:0,title:{text:"Monto en $us"},stackLabels:{enabled:!0,format:"{total:,.2f}",rotation:-45,y:-30}},series:i,legend:{enabled:!1},tooltip:{pointFormat:"{series.name}: <b>{point.y:,.2f}<\/b>"},exporting:{sourceWidth:1400,sourceHeight:900},plotOptions:{column:{stacking:"normal"}},chart:{height:500,backgroundColor:"transparent"}};$("#chartLines").highcharts(t)}function loadCategories(){var r=Highcharts.getOptions().colors;Highcharts.setOptions({lang:{decimalPoint:".",thousandsSep:","}});var t=[],i=[],n=productData.categories;$.each(n.series,function(n,i){var r=[];$.each(i.data,function(n,t){r.push({name:t.label,y:t.value,drilldown:t.label})});t.push({name:i.name,colorByPoint:!0,data:r})});$.each(n.drillDown,function(n,t){var r=[];$.each(t.data,function(n,t){r.push({name:t.label,y:t.value})});i.push({name:t.name,id:t.name,data:r})});$("#chartCategories").highcharts({credits:!1,chart:{type:"column",backgroundColor:"transparent"},title:{text:n.title},xAxis:{type:"category"},yAxis:{title:{text:"Monto en $us"}},legend:{enabled:!1},plotOptions:{series:{borderWidth:0,dataLabels:{enabled:!0,format:"{point.y:,.2f}"}}},tooltip:{headerFormat:'<span style="font-size:11px">{series.name}<\/span><br>',pointFormat:'<span style="color:{point.color}">{point.name}<\/span>: <b>{point.y:,.2f}<\/b><br/>'},series:t,labels:{style:{"text-decoration":"none",color:"blue"}},exporting:{sourceWidth:1400,sourceHeight:900},drilldown:{series:i}})}function getEventsData(){$("#events-container").empty();$.get(ulrLastEvents,{},function(n){n.length>0&&$.each(n,function(n,t){var u,f,i,e,o,s,r,h,c;o=$("<span>").text(t.description);t.date=JSON.toDate(t.date);r=$("<span>").addClass("date");t.date.getHours()==0&&t.date.getMinutes()==0?r.text(kendo.toString(t.date,"dd/MM/yyyy")):r.text(kendo.toString(t.date,"dd/MM/yyyy HH:mm"));t.detail?(h=urlEvent+"/"+t.id,c=$("<a class='event'>").attr("href",h).text(t.name),e=$("<h4>").html(c)):e=$("<h4>").text(t.name);s=$("<input>").attr("type","hidden").val(t.id);f=$("<div>").addClass("box").addClass("color-"+(n+1)%5);i=$("<div>").addClass("inner-box");i.append(s);i.append(e);i.append(r);i.append("<br />");i.append(o);u=$("<div>").addClass("col-12").addClass("col-sm-6").addClass("col-md-4").addClass("col-lg-4");f.append(i);u.append(f);$("#events-container").append(u)})})}function getTeamData(){var t=$("#seller-resume-since").data("kendoDatePicker").value(),n;t&&(t=kendo.toString(t,"yyyy-MM-dd"));n=$("#seller-resume-until").data("kendoDatePicker").value();n&&(n=kendo.toString(n,"yyyy-MM-dd"));Enumerable.From(chartList).Where("$.IdChart === 10").Count()>0&&(teamLoaded||$.get(urlTeamQuota,{},n=>{var i,t,r;n.message===""?(teamLoaded=!0,i=[],t=n.chart,$.each(t.series,function(n,t){var r=[];$.each(t.data,function(n,t){r.push({name:t.label,y:t.percentage,percentage:t.value,total:t.total})});i.push({type:t.type,name:t.name,data:r})}),r={credits:!1,chart:{type:"bar",backgroundColor:"transparent",height:600},title:{text:t.title},xAxis:{categories:t.labels},yAxis:{min:0,title:{text:"Cumplimiento"}},legend:{enabled:!1},series:i,tooltip:{formatter:function(){return"<b>"+this.point.category+"<\/b><br/>Cumplimiento: "+Highcharts.numberFormat(Math.abs(this.point.percentage),2)+" $US"}},plotOptions:{bar:{dataLabels:{enabled:!0,format:"{point.y:,.2f} %"}}}},$("#chartTeamQuota").highcharts(r)):showError(`Se ha producido un error al traer los datos del servidor: <br />${n.message}`)}));Enumerable.From(chartList).Where("$.IdChart === 5").Count()>0&&t&&n&&$.get(urlTeamResume,{InitialDate:t,FinalDate:n},n=>{if(n.message===""){teamLoaded=!0;var u=Highcharts.getOptions().colors,i,r=[],t=n.chart;$.each(t.series,function(n,t){var i=[];$.each(t.data,function(n,t){i.push({name:t.label,y:t.value,color:new Highcharts.Color(u[n%10]).brighten(.3-n/50).get()})});r.push({type:t.type,name:t.name,data:i})});i={credits:!1,title:{text:t.title},xAxis:{categories:t.labels},yAxis:{min:0,title:{text:"Monto en $us"},stackLabels:{enabled:!0,format:"{total:,.2f}",rotation:-45,y:-30}},series:r,legend:{enabled:!1},tooltip:{pointFormat:"{series.name}: <b>{point.y:,.2f}<\/b>"},exporting:{sourceWidth:1400,sourceHeight:900},plotOptions:{column:{stacking:"normal"}},chart:{height:500,backgroundColor:"transparent"}};$("#chartSellersResume").highcharts(i)}else showError(`Se ha producido un error al traer los datos del servidor: <br />${n.message}`)});Enumerable.From(chartList).Where("$.IdChart === 6").Count()>0&&t&&n&&$.get(urlTeamResumeInTime,{InitialDate:t,FinalDate:n},n=>{if(n.message===""){teamLoaded=!0;objChartData=n.chart;lstSeries=[];$.each(objChartData.series,function(n,t){var i=[];$.each(t.data,function(n,t){t.value>0?i.push({name:t.label,y:t.value}):i.push({name:t.label,y:null})});lstSeries.push({type:t.type,name:t.name,data:i})});var t={credits:!1,chart:{backgroundColor:"transparent",height:500},title:{text:objChartData.title,x:-20},xAxis:{categories:objChartData.labels},yAxis:{title:{text:"Monto en Us$"},plotLines:[{value:0,width:1,color:"#808080"}]},tooltip:{valueSuffix:" Us$"},legend:{layout:"vertical",align:"right",verticalAlign:"middle",borderWidth:0},exporting:{sourceWidth:1400,sourceHeight:900},series:lstSeries};$("#chartSellersOnTime").highcharts(t)}else showError(`Se ha producido un error al traer los datos del servidor: <br />${n.message}`)})}function templateExpectedDiff(n){var t=n.expectedDifference>=0?"expected-positive":"expected-negative";return`<span class="${t}">${kendo.toString(n.expectedDifference,"N2")}</span>`}function footerTemplateExpectedDiff(n){var t=n.expectedDifference.sum>=0?"expected-positive":"expected-negative";return`<span class="${t}">${kendo.toString(n.expectedDifference.sum,"N2")}</span>`}function templateExpectedDiffPercentage(n){var t=n.expectedDifference>=0?"expected-positive":"expected-negative";return`<span class="${t}">${kendo.toString(n.expectedDifferencePercentage,"N2")} %</span>`}function footerTemplateExpectedDiffPercentage(n){var i=n.expectedDifference.sum>=0?"expected-positive":"expected-negative",t=n.expected.sum>0?n.expected.sum:0;return`<span class="${i}">${kendo.toString(t>0?n.expectedDifference.sum/t*100:0,"N2")} %</span>`}function templateColumnMobile(n){var i=n.extended?`<div class="col-6"><span class="title">Margen: </span> ${kendo.toString(n.margin,"N2")} %</div>`:``,r=n.extended?`<div class="col-6"><span class="title">Autorizadas: </span> ${seeSalesDetail?`<a class="aov action action-link">`:``}${kendo.toString(n.authorized,"N2")}${seeSalesDetail?`</a>`:``}</div>`:``,u=n.extended?`<div class="col-6"><span class="title">Stock: </span> <a class="stockvalue action action-link">${kendo.toString(n.stock,"N2")}</a></div>`:``,t=n.expectedDifference>=0?"expected-positive":"expected-negative",f=regionalData.notBilled&&regionalData.notBilled.length>0?`<div class="col-12"><span class="title">S&oacute;lo entregado: </span> ${seeSalesDetail?`<a class='delivered-period action action-link'>`:``}${kendo.toString(n.notBilled,"N2")}</a></div>`:"";return template=`<div class="row" data-uid="${n.uid}">
                    <div class="col-12"><span class="title subsidiary">${n.subsidiary}</span></div>
                    <div class="col-6"><span class="title">Fact. Hoy: </span> <a class="billed-today action action-link">${kendo.toString(n.today,"N2")}</a></div>
                    <div class="col-6"><span class="title">Fact. Periodo: </span> <a class="billed-period action action-link">${kendo.toString(n.period,"N2")}</a></div>
                    ${f}
                    ${i}
                    <div class="col-6"><span class="title">Porcentage: </span> ${kendo.toString(n.percentage,"N2")} %</div>
                    ${n.expected>0?`<div class="col-6"><span class="title">Proyectado: </span> ${kendo.toString(n.expected,"N2")}</div>`:""}
                    ${n.expected>0?`<div class="col-6"><span class="title">Dif. Proyectado: </span> <span class="${t}">${kendo.toString(n.expectedDifference,"N2")}</span></div>`:""}
                    ${n.expected>0?`<div class="col-12"><span class="title">Dif. Proy. Porc.: </span> <span class="${t}">${kendo.toString(n.expectedDifferencePercentage,"N2")} %</span></div>`:""}
                    ${r}
                    <div class="col-6"><span class="title">Abiertas: </span> <a class="openov action action-link">${kendo.toString(n.open,"N2")}</a></div>
                    ${u}
                </div>`}function footerTemplateColumnMobile(n){var r=_canSee?`<div class="col-6"><span class="title">Margen: </span> ${kendo.toString(n.period.sum>0?n.marginTotal.sum/n.taxlessTotal.sum*100:0,"N2")} %</div>`:``,u=_canSee?`<div class="col-6"><span class="title">Autorizadas: </span> <a class="aov action action-link">${kendo.toString(n.authorized.sum,"N2")}</a></div>`:``,f=_canSee?`<div class="col-6"><span class="title">Stock: </span> <a class="stockvalue action action-link">${kendo.toString(n.stock.sum,"N2")}</a></div>`:``,t=n.expectedDifference.sum>=0?"expected-positive":"expected-negative",i=n.expected.sum>0?n.expected.sum:0,e=regionalData.notBilled&&regionalData.notBilled.length>0?`<div class="col-12"><span class="title">S&oacute;lo entregado: </span> <span>${kendo.toString(n.notBilled.sum,"N2")}</span></div>`:"";return template=`<div class="row">
                        <div class="col-12"><span class="title subsidiary">Total</span></div>
                        <div class="col-6"><span class="title">Fact. Hoy: </span> <a class="billed-today action action-link">${kendo.toString(n.today.sum,"N2")}</a></div>
                        <div class="col-6"><span class="title">Fact. Periodo: </span> <a class="billed-period action action-link">${kendo.toString(n.period.sum,"N2")}</a></div>
                        ${e}
                        ${r}
                        ${n.expected.sum>0?`<div class="col-6"><span class="title">Proyectado: </span> ${kendo.toString(n.expected.sum,"N2")}</div>`:""}
                        ${n.expected.sum>0?`<div class="col-6"><span class="title">Dif. Proyectado: </span> <span class="${t}">${kendo.toString(n.expectedDifference.sum,"N2")}</span></div>`:""}
                        ${n.expected.sum>0?`<div class="col-6"><span class="title">Dif. Proy. Porc.: </span> <span class="${t}">${kendo.toString(i>0?n.expectedDifference.sum/i*100:0,"N2")} %</span></div>`:""}
                        ${u}
                        <div class="col-6"><span class="title">Abiertas: </span> <a class="openov action action-link">${kendo.toString(n.open.sum,"N2")}</a></div>
                        ${f}
                    </div>`}function showHideAccordion(n){$(n.target).prev().find("i:last-child").toggleClass("fa-angle-up fa-angle-down");n.type==="show"&&(n.target.id!=="contentKbytes"||kbytesLoaded||loadKbytesData(),n.target.id!=="contentProducts"||productsLoaded||getProductsData(),n.target.id!=="contentTeam"||teamLoaded||getTeamData(),n.target.id!=="contentEvents"||eventsLoaded||getEventsData())}function switchWarehouses(n){$(n.currentTarget).text(n.target.innerText==="Ver Almacenes"?"Ocultar Almacenes":"Ver Almacenes");var t=$("#divisions .active input").val().charAt(0);loadRegionalResume(t,!gridGrouped)}function changeDivision(n){var t=$(n.target).find("input").val().charAt(0),i=$("#subsidiaries .active input").val();loadRegionalResume(t,gridGrouped);loadTopClients(t,i)}function changeSubsidiary(n){var t=$("#divisions .active input").val().charAt(0),i=$(n.target).find("input").val();loadTopClients(t,i)}function showOpenOrders(n,t){var i=$(n.currentTarget).closest(".k-grid").data("kendoGrid"),r=$(n.currentTarget).closest("tr"),u=i.dataItem(r),f=$("#Detail").getKendoWindow(),e,o;i.select(r);$("#notesBilled").addClass("d-none");$("#openOVs").removeClass("d-none");$("#stockDetail").addClass("d-none");$("#justDelivered").addClass("d-none");f.title(`OV ${t?"Autorizadas":"Abiertas"}`);e=$("#divisions .active input").val();o=$("#openOVs").data("kendoGrid");$.get(urlOpenOrders,{Subsidiary:u.subsidiary,Warehouse:u.warehouse,Division:e,Authorized:t},n=>{n.items.forEach(n=>{n.docDate=JSON.toDate(n.docDate)});var t=new kendo.data.DataSource({data:n.items});o.setDataSource(t);f.open()})}function openStockDetail(n){var t=$(n.currentTarget).closest(".k-grid").data("kendoGrid"),i=$(n.currentTarget).closest("tr"),r=t.dataItem(i),u;t.select(i);u=$("#divisions .active input").val();resumeItem=r;$("#notesBilled").addClass("d-none");$("#openOVs").addClass("d-none");$("#stockDetail").removeClass("d-none");$("#justDelivered").addClass("d-none");$.get(urlStock,{Subsidiary:r.subsidiary,Division:u},n=>{var t=$("#Detail").getKendoWindow(),i=$("#stockDetail").data("kendoGrid"),r=new kendo.data.DataSource({data:n.items});t.title("Detalle Stock");i.setDataSource(r);t.open()})}function openReport(n,t){var r=$(n.currentTarget).closest(".k-grid").data("kendoGrid"),u=$(n.currentTarget).closest("tr"),i=r.dataItem(u),f=$("#Report").getKendoWindow();r.select(u);f.title(t==="SO"?"Orden de Venta":i.isDeliveryNote==="Y"?"Nota de Entrega":"Nota de Venta");loadReport(t==="SO"?n.currentTarget.dataset.number:i.noteNumber,i.subsidiary,t==="SO"?"Order":i.isDeliveryNote==="Y"?"Delivery":"Note",1);f.open().center()}function openItemStock(n){var i=$(n.currentTarget).closest(".k-grid").data("kendoGrid"),r=$(n.currentTarget).closest("tr"),t=i.dataItem(r);i.select(r);var u=$(n.currentTarget).closest(".k-grid").closest("td").closest(".k-grid").data("kendoGrid"),f=$(n.currentTarget).closest(".k-grid").closest("tr").prev(".k-master-row"),e=u.dataItem(f);["FLETES","ENVIO","DMCSERVICIOS"].indexOf(t.itemCode)===-1&&$.get(urlGetStock,{Subsidiary:e.subsidiary,Warehouse:t.warehouse,ItemCode:t.itemCode},n=>{var r,t,i;n.message===""?(r=$("<div>"),r.kendoGrid({columns:[{title:"Sucursal",field:"subsidiary"},{title:"Almacen",field:"warehouse"},{title:"Cod. Item",width:160,field:"itemCode"},{title:"Stock",attributes:alignRight,headerAttributes:alignRight,width:95,field:"stock"},{title:"Reservado",attributes:alignRight,headerAttributes:alignRight,width:95,field:"reserved",template:n=>n.reserved>0?`<a class="reserved action action-link">${n.reserved}</a>`:n.reserved},{title:"Disponible",attributes:alignRight,headerAttributes:alignRight,width:95,field:"available2"},{title:"Pedido",attributes:alignRight,headerAttributes:alignRight,width:95,field:"requested"}],sortable:!0,selectable:"Single, Row",dataSource:n.items}),t=$("<div>"),t.append(r),t.append($("<div>").addClass("items-reserved mt-3")),i=$("#Detail2").data("kendoWindow"),i.setOptions({width:1050,title:"Detalle Stock"}),i.content(t),i.open()):showError(`Se ha producido el siguiente error al traer los datos: ${n.message}.`)})}function openDetails(n,t){var r=$(n.currentTarget).closest(".k-grid").data("kendoGrid"),u=$(n.currentTarget).closest("tr"),e=r.dataItem(u),o=t==="comment"?"#templateComments":"#templateAttach",s=t==="comment"?"Comentarios":"Archivos Adjuntos",f,i;r.select(u);f=kendo.template($(o).html());i=$("<div>").kendoWindow({width:650,title:s}).data("kendoWindow");i.content(f(e));i.center().open()}function showReservedDetail(n){var r=$(n.currentTarget).closest(".k-grid").data("kendoGrid"),u=$(n.currentTarget).closest("tr");r.select(u);var t=r.dataItem(u),e=$("#Detail2").data("kendoWindow"),f=$(n.currentTarget).closest(".k-grid").parent().find(".items-reserved"),i=[{title:"Ejecutivo",field:"sellerName"},{title:"Cliente",field:"clientCode",template:n=>`<strong>${n.clientCode}</strong> - ${n.clientName}`},{title:"Orden",field:"docNum",width:90,template:n=>`<a class="sale-order action action-link" data-number="${n.docNum}">${n.docNum}</a>`},{title:"Fecha",field:"docDate",format:"{0: dd-MM-yyyy}",width:95,attributes:alignCenter,headerAttributes:alignCenter},{title:"Cantidad",field:"quantity",width:100,attributes:alignRight,headerAttributes:alignRight},{title:"Precio",field:"price",format:"{0: #,##0.00}",width:90,attributes:alignRight,headerAttributes:alignRight}];t.subsidiary.toLowerCase()==="iquique"&&(i.push({title:"Autorizado",field:"authorized",template:n=>n.authorized==="Y"?'<i class="fas fa-check"><\/i>':"",width:90,attributes:alignCenter,headerAttributes:alignCenter}),i.push({title:"Correlativo",field:"correlative",width:130}));$.get(urlReservedItems,{Subsidiary:t.subsidiary,Warehouse:t.warehouse,ItemCode:t.itemCode},function(n){if(n.message===""){n.items.forEach(n=>n.docDate=JSON.toDate(n.docDate));var t=f.data("kendoGrid");t?t.setDataSource(new kendo.data.DataSource({data:n.items})):f.kendoGrid({columns:i,sortable:!0,selectable:"Single, Row",dataSource:n.items});setTimeout(()=>e.center(),100)}else showError(`Se ha producido el siguiente error al traer los datos: ${n.message}`)})}function openFile(n){var t=$(n.currentTarget).attr("data-file"),i=$(n.currentTarget).attr("data-subsidiary"),r=$(n.currentTarget).text();window.location.href=urlDownloadFile+"?"+$.param({Subsidiary:i,DocEntry:t,FileName:r})}function openEvent(n){n.preventDefault();var t=$("<div>").kendoWindow({activate:onRefreshWindow,title:"Detalle del Evento",width:1100,modal:!0,iframe:!1,scrollable:!0,refresh:onRefreshWindow}).data("kendoWindow");t.refresh({url:n.target.href});setTimeout(()=>{t.open().center()},100)}function seeDetails(n){$("#resumes .selected").removeClass("selected");$(n.currentTarget).closest(".panel").addClass("selected");var t=n.currentTarget.dataset;t.type==="N"?$.get(urlNotes,{Year:t.year},function(n){if(n.message===""){var i=t.year>=2023?n.items.filter(n=>n.amount>0||n.points>0):n.items;loadGridNotes(i,t.year)}else console.error(n.message),showError("Se ha producido un error al traer los datos del servidor")}):t.type==="UP"?$.get(urlAwards,{},function(n){n.message===""?loadGridAwards(n.items):(console.error(n.message),showError("Se ha producido un error al traer los datos del servidor"))}):$.get(urlAvailablePoints,{},function(n){n.message===""?loadGridPoints(n.items):(console.error(n.message),showError("Se ha producido un error al traer los datos del servidor"))})}function openDeliveryNote(n){var t=$(n.currentTarget).closest(".k-grid").data("kendoGrid"),i=$(n.currentTarget).closest("tr"),r=t.dataItem(i),u=$("#Report").getKendoWindow();t.select(i);u.title("Nota de Entrega");loadReport(r.docNumber,r.subsidiary,"Delivery",2);u.open().center()}function prev(){document.getElementById("years-slider").scrollLeft-=270}function next(){document.getElementById("years-slider").scrollLeft+=270}var chartList,_minDate,_maxDate,regionalData={},productData={},teamData={},gridGrouped,kbytesLoaded=!1,productsLoaded=!1,teamLoaded=!1,eventsLoaded=!1,_canSee=!1,resumeItem;const alignRight={style:"text-align: right;"},alignCenter={style:"text-align: center;"},seeSalesDetail=$("#SeeAllSalesDetail").val()==="Y";$(document).ajaxError((n,t,i,r)=>catchError(n,t,i,r));$(()=>setupControls());$("#accordion").on("hide.bs.collapse show.bs.collapse",showHideAccordion);$("#accordion").on("shown.bs.collapse",n=>$(".page-content").animate({scrollTop:$(n.target).parent().offset().top},400));$("#switch-warehouses").click(switchWarehouses);$("#divisions .btn").click(changeDivision);$("#subsidiaries .btn").click(changeSubsidiary);$("#tableResume").on("click",".billed-today",n=>openBilledPeriod(n,"T"));$("#tableResume").on("click",".billed-period",n=>openBilledPeriod(n,"P"));$("#tableResume").on("click",".delivered-period",openDelivered);$("#tableResume").on("click",".aov",n=>showOpenOrders(n,!0));$("#tableResume").on("click",".openov",n=>showOpenOrders(n,!1));$("#tableResume").on("click",".stockvalue",openStockDetail);$("body").on("click",".sale-order",n=>openReport(n,"SO"));$("#Detail").on("click",".sale-note",n=>openReport(n,"SN"));$("#Detail").on("click",".item-code",openItemStock);$("#Detail").on("click",".comment",n=>openDetails(n,"comment"));$("#Detail").on("click",".attach",n=>openDetails(n,"attach"));$("#Detail").on("click",".delivery-note",openDeliveryNote);$("body").on("click",".reserved",showReservedDetail);$("body").on("click",".open-file",openFile);$("#events-container").on("click",".event",openEvent);$("#resumes").on("click",".see-details",seeDetails);