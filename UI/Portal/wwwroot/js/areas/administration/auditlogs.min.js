function setupControls(){var n=$("#filClients"),t=$("#filUsers"),i,r;$("#local-user").val()==="Y"?n.multipleSelect({filter:!0,minimumCountSelected:1,selectAll:!1,onUncheckAll:()=>t.empty().multipleSelect("refresh").multipleSelect("disable"),onClick:()=>loadUsers(n,t)}):loadUsers(n,t);t.multipleSelect();i=$("#filSince").kendoDatePicker({change:function(){var n=this.value();n===null&&this.value("");r.min(n?n:_minDate)}}).data("kendoDatePicker");r=$("#filUntil").kendoDatePicker({change:function(){var n=this.value();n===null&&this.value("");i.max(n?n:_maxDate)}}).data("kendoDatePicker");_maxDate=r.max();_minDate=i.min();$("#Listado").kendoGrid({noRecords:{template:"No se encontraron registros para el criterio de búsqueda."},columns:[{title:"Cliente",hidden:!0,field:"clientCode",aggregates:["count"],groupHeaderTemplate:"Cliente: #= value #    ( Total: #=count# )"},{title:"Nombre",width:250,field:"userName",aggregates:["count"],groupHeaderTemplate:"Usuario: #= value #    ( Total: #=count# )"},{title:"Descripción",width:200,field:"description"},{title:"Fecha",width:120,field:"logDate",format:"{0:dd/MM/yyyy HH:mm}"}],sortable:!0,selectable:"Single, Row",dataSource:[]});$("#local-user").val()==="Y"&&$.get(urlClients,{},function(t){t.forEach(t=>{n.append(new Option(t.name,t.code,!1))});n.multipleSelect("refresh").multipleSelect("uncheckAll")});setGridHeight("Listado",_gridMargin)}function loadUsers(n,t){var i=$("#local-user").val()==="Y"?n.multipleSelect("getSelects"):[n.val()],r;i&&i.length>0?(r=Enumerable.From(i).Select(function(n){return`'${n}'`}).ToArray().join(),$.get(urlUsers,{CardCode:r},function(n){n.message!==""?(showError(n.message),t.multipleSelect("disable")):(t.empty(),n.items.length>0?(n.items.forEach(n=>{var i=$("<optgroup>").attr("label",n.client);n.users.forEach(n=>i.append(new Option(n.name,n.id)));t.append(i)}),t.multipleSelect("enable")):t.multipleSelect("disable"),t.multipleSelect("refresh"));t.multipleSelect("uncheckAll")})):t.multipleSelect("disable")}function getFilters(){var i="",r=Enumerable.From($("#filUsers").multipleSelect("getSelects")).Select("$").ToArray().join(),n=$("#filSince").data("kendoDatePicker").value(),t=$("#filUntil").data("kendoDatePicker").value();return r===""&&(i="- Debe seleccionar al menos un usuario.<br />"),n===null&&t===null?i+="- Debe seleccionar al menos una fecha.":(n&&(n=n.toISOString()),t&&(t=t.toISOString())),{message:i,data:{Users:r,Since:n,Until:t}}}function loadGrid(n){if(n){n.forEach(n=>{n.logDate=JSON.toDate(n.logDate)});var t=$("#Listado").data("kendoGrid"),i=new kendo.data.DataSource({data:n,group:[{field:"clientCode",dir:"asc",aggregates:[{field:"clientCode",aggregate:"count"}]},{field:"userName",dir:"asc",aggregates:[{field:"userName",aggregate:"count"}]}],pageSize:500,sort:[{field:"logDate",dir:"desc"}],schema:{model:{id:"id"}}});t.setDataSource(i);n&&n.length>0?($("#filter-box").collapse("hide"),$("#action-excel").removeClass("d-none")):$("#action-excel").addClass("d-none");setGridHeight("Listado",_gridMargin)}}var _minDate,_maxDate;const alignCenter={style:"text-align: center;"},alignRight={style:"text-align: right;"},numberFormat="{0:#,##0.00}",dateFormat="{0:dd-MM-yyyy}",_gridMargin=30;$(function(){setupControls()});$(window).resize(()=>setGridHeight("Listado",_gridMargin));$("#filter-box").on("hidden.bs.collapse",()=>setGridHeight("Listado",_gridMargin));$("#filter-box").on("shown.bs.collapse",()=>setGridHeight("Listado",_gridMargin));$("#action-clean").click(function(){$("#filClients").multipleSelect("uncheckAll");$("#filSince").data("kendoDatePicker").value("");$("#filUntil").data("kendoDatePicker").value("")});$("#action-filter").click(function(){var n=getFilters();n.message===""?$.get(urlFilter,n.data,function(n){loadGrid(n.items);n.message!==""&&showError(`Se ha producido el siguiente error al traer los datos: ${n.message}`)}):showInfo(`Los siguientes campos son requeridos: <br />${n.message}`)});$("#action-excel").click(function(){var n=getFilters();n.message===""?window.location.href=urlExcel+"?"+$.param(n.data):showInfo(`Los siguientes campos son requeridos: <br />${n.message}`)});