function setupControls(){var n=$("#clients").kendoMultiSelect({filter:"contains",dataTextField:"name",dataValueField:"code",noDataTemplate:"No hay resultados para el criterio de búsqueda.",virtual:{itemHeight:26,valueMapper:function(n){var t=this.dataSource.data(),i=[];n.value.forEach(n=>{i.push(t.indexOf(t.find(t=>t.code===n)))});n.success(i)}},dataSource:{transport:{read:urlClients}}}).data("kendoMultiSelect");$("#emails").kendoGrid({noRecords:{template:"No se encontraron registros para el criterio de búsqueda."},height:300,columns:[{title:"Correo Electrónico",field:"eMail"},{title:"Agregado por",field:"userName"},{title:"Agregado el",field:"date",format:"{0:dd-MM-yyyy HH:mm}",width:120}],sortable:!0,selectable:"Single, Row",dataSource:[]});$.get(urlClientsListed,{},function(t){t.message===""?t.items&&n.value(t.items):showError("Se ha producido un error al traer los datos del servidor.")})}function filterMails(){var n=$.trim($("#filter-mails").val());n===""?showInfo("Debe ingresar algún criterio de búsqueda."):$.get(urlFilterMails,{Filter:n},function(n){n.message===""?loadGrid(n.items):(loadGrid([]),showError(`Se ha producido el siguiente error al traer los datos: <br />${n.message}`))})}function loadGrid(n){if(n){n.forEach(n=>n.date=JSON.toDate(n.date));var t=$("#emails").data("kendoGrid"),i=new kendo.data.DataSource({data:n});t.setDataSource(i)}}function addMail(){var t=$("#form-add-mail"),i=t.kendoValidator({messages:{required:"Es requerido",email:"No es un correo electrónico válido"}}).data("kendoValidator");if(i.validate()){var n=$("#new-mail").val(),r=$("#emails").data("kendoGrid"),u=new Date;$.post(urlAddMail,{EMail:n},function(t){t.message===""?(showMessage(`Se ha agregado el correo <b>${n}</b> a la lista negra.`),r.dataSource.add({EMail:n,UserName:$.trim($(".user-info > .user-name").first().text()),Date:u})):t.error==="Y"?showError(`Se ha producido el siguiente error al tratar de guardar el correo electrónico: <br />${t.message}`):showInfo(t.message)})}}var _minDate,_maxDate;const alignCenter={style:"text-align: center;"},alignRight={style:"text-align: right;"},numberFormat="{0:#,##0.00}",dateFormat="{0:dd-MM-yyyy}",_gridMargin=30;$(function(){setupControls()});$("#filter-mails").keypress(function(n){n.which==13&&filterMails()});$("#action-filter-mails").click(function(){filterMails()});$("#new-mail").keypress(function(n){n.which==13&&addMail()});$("#add-mail").click(function(){addMail()});$("#action-save-clients").click(function(){var n=$("#clients").getKendoMultiSelect().value();n.length>0?$.post(urlSaveClients,{Clients:n},function(n){n.message===""?showMessage("Se realizaron los cambios correctamente."):showError(`Se ha producido el siguiente error al intentar guardar los datos: <br />${n.message}`)}):showMessage("Debe seleccionar algún Cliente para Guardar.")});