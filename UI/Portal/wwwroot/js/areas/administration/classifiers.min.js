function setupControls(){$("#Listado").kendoGrid({noRecords:{template:"No se encontraron registros para el criterio de búsqueda."},columns:[{title:"Tipo",field:"name"},{title:"Descripción",field:"description"},{title:"Base",attributes:alignCenter,headerAttributes:alignCenter,width:80,template:'# if(isBase) {# <i class="fas fa-check"><\/i> #} #',field:"isBase"},{field:"id",title:" ",attributes:alignCenter,width:70,sortable:!1,headerAttributes:alignCenter,headerTemplate:'<a class="action action-link action-new" title="Nuevo Clasificador"><i class="fas fa-plus"><\/i><\/a>',template:'<a class="action action-link action-edit" title="Editar Clasificador"><i class="fas fa-pen"><\/i><\/a><a class="action action-link action-delete" title="Eliminar Clasificador"><i class="fas fa-trash-alt"><\/i><\/a>'}],sortable:!0,selectable:"Single, Row",dataSource:[]})}function cleanFilters(){$("#filter").val("")}function getFilters(){var n=$("#filter").val();return{message:"",data:{FilterData:n}}}function filterData(n){var t=getFilters();t.message===""?$.get(urlFilter,t.data,function(n){loadGrid(n.items);n.message!==""&&showError(`Se ha producido el siguiente error al traer los datos: ${n.message}`)}):n||(setGridHeight("Listado",_gridMargin),showInfo(`Se deben ingresar los siguientes campos: <br />${t.message}`))}function loadGrid(n){if(n){n.forEach(n=>{n.date=JSON.toDate(n.date)});var t=$("#Listado").data("kendoGrid"),i=new kendo.data.DataSource({data:n});t.setDataSource(i);n&&n.length>0?($("#filter-box").collapse("hide"),$("#action-excel").removeClass("d-none")):$("#action-excel").addClass("d-none");setGridHeight("Listado",_gridMargin)}}function loadDetailItem(n){$("#detail-id").val(n.id);$("#detail-name").val(n.name);$("#detail-description").val(n.description);$("#detail-value").val(n.value);$("#detail-isbase").prop("checked",n.isBase);$("#action-save").attr("disabled",!0);$("#detail-classifier").removeClass("d-none");$("#Detail").data("kendoWindow").center()}function hideDetail(){$("#action-save").removeAttr("disabled");$("#detail-classifier").addClass("d-none");$("#Detail").data("kendoWindow").center()}function saveDetailItem(){var e=$("#detail-form").kendoValidator({messages:{required:"Campo requerido"}}).data("kendoValidator");if(e.validate()){var o=$("#detail-id").val(),i=$.trim($("#detail-name").val()),r=$.trim($("#detail-description").val()),u=$.trim($("#detail-value").val()),f=$("#detail-isbase").prop("checked"),t=JSON.parse($("#items").val()),n=Enumerable.From(t).Where("$.id === "+o).FirstOrDefault();n?($.trim(n.name)!==i||$.trim(n.description)!==r||$.trim(n.value)!==u||n.isBase!==f)&&(n.name=i,n.description=r,n.value=u,n.isBase=f,n.statusType!==1&&(n.statusType=2)):(n={id:getId(),name:i,description:r,isBase:f,value:u,statusType:1},t.push(n));$("#ListItems").data("kendoGrid").setDataSource(new kendo.data.DataSource({data:t.filter(n=>n.statusType!==3)}));$("#items").val(JSON.stringify(t));hideDetail()}}function getId(){return newId--,newId}function onNew(){var n=$("#Detail").data("kendoWindow");n.refresh({url:urlEdit,data:{Id:0}});n.center().open()}function onEdit(n){var t=$("#Detail").data("kendoWindow"),i=$("#Listado").data("kendoGrid"),r=$(n.currentTarget).closest("tr"),u;i.select(r);u=i.dataItem(r);t.refresh({url:urlEdit,data:{Id:u.id}});t.center().open()}function onDelete(n){var t=$("#Listado").data("kendoGrid").dataItem($(n.currentTarget).closest("tr"));showConfirm("¿Está seguro que desea eliminar el Clasificador?",function(){var n=getFilters();$.post(urlDelete,{Id:t.id,FilterData:n.FilterData},function(n){n.message===""?(loadGrid(n.items),showMessage("Se ha eliminado el Clasificador correctamente.")):showError(n.message)})})}function onRefresh(n){var t=JSON.parse($("#items").val());$("#ListItems").kendoGrid({sortable:!0,selectable:"Single, Row",height:400,noRecords:{template:"No se encontraron registros para el criterio de búsqueda."},columns:[{title:"Nombre",field:"name"},{title:"Base",attributes:alignCenter,headerAttributes:alignCenter,width:70,template:'# if(isBase) {# <i class="fas fa-check"><\/i> #} #',field:"isBase"},{title:"Valor",field:"value",width:80},{field:"id",title:" ",attributes:alignCenter,width:70,sortable:!1,headerAttributes:alignCenter,headerTemplate:'<a class="action action-link action-new" title="Nuevo Item"><i class="fas fa-plus"><\/i><\/a>',template:'<a class="action action-link action-edit"><i class="fas fa-pen" title="Editar Item"><\/i><\/a><a class="action action-link action-delete" title="Eliminar Item"><i class="fas fa-trash-alt"><\/i><\/a>'}],dataSource:t});onRefreshWindow(n)}function onNewDetail(){loadDetailItem({id:0,name:"",description:"",isBase:!1,value:"",statusType:0})}function onEditDetail(n){var t=$("#ListItems").data("kendoGrid"),i=$(n.currentTarget).closest("tr"),r;t.select(i);r=t.dataItem(i);loadDetailItem(r)}function onDeleteDetail(n){hideDetail();var r=$("#ListItems").data("kendoGrid"),u=$(n.currentTarget).closest("tr"),i=r.dataItem(u),t=JSON.parse($("#items").val());showConfirm(`¿Está seguro que desea eliminar el item: <b>${i.name}</b>?`,function(){var n=Enumerable.From(t).Where("$.id === "+i.id).FirstOrDefault();n.statusType!==1?n.statusType=3:t=t.filter(t=>t.id!==n.id);$("#ListItems").data("kendoGrid").setDataSource(new kendo.data.DataSource({data:t.filter(n=>n.statusType!==3)}));$("#items").val(JSON.stringify(t))})}function onSave(){var t=$("#form-classifier"),u=t.kendoValidator().data("kendoValidator"),n,i,r;u.validate()&&(n=t.serializeObject(),i=JSON.parse($("#items").val()),n.listClassifiers=i.filter(n=>n.statusType!==0),r=getFilters(),$.post(urlEdit,{Item:n,FilterData:r.FilterData},function(n){n.message===""?(loadGrid(n.items),$("#Detail").data("kendoWindow").close(),showMessage("Se realizaron los cambios correctamente.")):showError(n.message)}))}var newId=0;const alignCenter={"class":"k-text-center !k-justify-content-center"},alignRight={style:"text-align: right;"},numberFormat="{0:#,##0.00}",dateFormat="{0:dd-MM-yyyy}",_gridMargin=30;$(()=>{setupControls(),setTimeout(function(){setGridHeight("Listado",_gridMargin)},800),filterData(!0)});$(window).resize(()=>setGridHeight("Listado",_gridMargin));$("#filter-box").on("hidden.bs.collapse, shown.bs.collapse",()=>setGridHeight("Listado",_gridMargin));$("#action-clean").click(()=>cleanFilters());$("#action-filter").click(()=>filterData(!1));$("#Listado").on("click",".action-new",onNew);$("#Listado").on("click",".action-edit",onEdit);$("#Listado").on("click",".action-delete",onDelete);$("#Detail").on("click",".action-new",onNewDetail);$("#Detail").on("click",".action-edit",onEditDetail);$("#Detail").on("click",".action-delete",onDeleteDetail);$("#Detail").on("click","#action-cancel-item",hideDetail);$("#Detail").on("click","#action-save-item",saveDetailItem);$("#Detail").on("click","#action-cancel",()=>$("#Detail").data("kendoWindow").close());$("#Detail").on("click","#action-save",onSave);