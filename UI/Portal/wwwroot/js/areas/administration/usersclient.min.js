function onRefresh(n){$("#IdProfile").kendoDropDownList({cascadeFrom:"CardCode",cascadeFromField:"cardCode",dataTextField:"name",dataValueField:"id",optionLabel:"Seleccione un Perfil ...",dataSource:{transport:{read:{url:urlProfiles,data:function(n){return{CardCode:$("#CardCode").val(),CardName:n.filter&&n.filter.filters.length>1?n.filter.filters[1].value:""}}}},serverFiltering:!0}});onRefreshWindow(n)}function setupControls(){$("#filProfiles").kendoDropDownList({cascadeFrom:"filClients",cascadeFromField:"cardCode",dataTextField:"name",dataValueField:"id",optionLabel:"Seleccione un Perfil ...",dataSource:{transport:{read:{url:urlProfiles,data:function(){return{CardCode:$("#CardCode").val()}}}},serverFiltering:!0}});$("#Listado").kendoGrid({noRecords:{template:"No se encontraron registros para el criterio de búsqueda."},columns:[{title:"Client Name",hidden:!0,field:"clientName",groupHeaderTemplate:"Cliente: #= value #"},{title:"Profile Name",hidden:!0,field:"profileName",groupHeaderTemplate:"Perfil: #= value #"},{title:"Nombre",field:"name"},{title:"E-Mail",field:"eMail"},{title:"Habilitado",attributes:alignCenter,headerAttributes:alignCenter,width:100,template:'# if(enabled) {# <i class="fas fa-check"><\/i> #} #',field:"enabled"},{title:" ",width:35,template:'# if(enabled && eMail && eMail.length > 0) {# <a title="Enviar Datos de Acceso por Correo" class="action-send-email action action-link"><i class="fas fa-envelope"><\/i><\/a> #} #',field:"eMail",sortable:!1},{field:"id",title:" ",attributes:alignCenter,width:70,sortable:!1,headerAttributes:alignCenter,headerTemplate:'<i class="fas fa-plus action action-new" title="Nuevo Usuario"><\/i>',template:function(n){var t="",i="action action-link action-delete",r="Eliminar Usuario";return n.sessionCount>0&&(i="disabled",t='disabled="disabled"',r="No se puede eliminar el usuario porque ya ha sido usado"),`<a class="action action-link action-edit" title="Editar Usuario"><i class="fas fa-pen"></i></a>&nbsp;&nbsp;<a class="${i}" ${t} title="${r}"><i class="fas fa-trash-alt"></i></a>`}}],sortable:!0,selectable:"Single, Row",dataSource:[]})}function cleanFilters(){$("#filProfiles").getKendoDropDownList().value("");$("#filProfiles").getKendoDropDownList().text("");$("#filName").val("")}function getFilters(){var n=$("#CardCode").val(),t=$("#filName").val(),i=$("#filProfiles").getKendoDropDownList().value();return{message:"",data:{CardCode:n,ProfileCode:i,Name:t}}}function filterData(n){var t=getFilters();t.message===""?$.get(urlFilter,t.data,function(n){loadGrid(n.items);n.message!==""&&showError(`Se ha producido el siguiente error al traer los datos: ${n.message}`)}):n||(setGridHeight("Listado",_gridMargin),showInfo(`Se deben ingresar los siguientes campos: <br />${t.message}`))}function loadGrid(n){if(n){var t=$("#Listado").data("kendoGrid"),i=new kendo.data.DataSource({data:n,group:[{field:"clientName",dir:"asc"},{field:"profileName",dir:"asc"}],sort:[{field:"name",dir:"asc"}],schema:{model:{id:"id"}}});t.setDataSource(i);n&&n.length>0?($("#filter-box").collapse("hide"),$("#action-excel").removeClass("d-none")):$("#action-excel").addClass("d-none");setGridHeight("Listado",_gridMargin)}}function saveUser(){var n=$("form").serializeObject(),t,i;n.Id<=0&&(t=$("#CardCode").getKendoDropDownList(),t&&(n.ClientName=" ( "+t.text().replace(" - "," ) "),n.ProfileName=$("#IdProfile").getKendoDropDownList().text()));n.Enabled=$("#Enabled").prop("checked");i=getFilters();$.post(urlEdit,{User:n,Filters:i.data},function(n){n.message===""?(loadGrid(n.items),$("#Detail").data("kendoWindow").close(),showMessage("Se realizaron los cambios correctamente.")):showError(n.message)})}var newId=0;const alignCenter={style:"text-align: center;"},alignRight={style:"text-align: right;"},numberFormat="{0:#,##0.00}",dateFormat="{0:dd-MM-yyyy}",_gridMargin=30;$(()=>{setupControls(),setTimeout(function(){setGridHeight("Listado",_gridMargin)},800),filterData(!0)});$(window).resize(function(){setGridHeight("Listado",_gridMargin)});$("#filter-box").on("hidden.bs.collapse",function(){setGridHeight("Listado",_gridMargin)});$("#filter-box").on("shown.bs.collapse",function(){setGridHeight("Listado",_gridMargin)});$("#action-clean").click(function(){cleanFilters()});$("#action-filter").click(function(){filterData(!1)});$("#Listado").on("click",".action-new",function(){var n=$("#Detail").data("kendoWindow");n.refresh({url:urlEdit,data:{Id:0}});n.center().open()});$("#Listado").on("click",".action-edit",function(n){var t=$("#Detail").data("kendoWindow"),i=$("#Listado").data("kendoGrid"),r=$(n.currentTarget).closest("tr"),u;i.select(r);u=i.dataItem(r);t.refresh({url:urlEdit,data:{Id:u.id}});t.center().open()});$("#Listado").on("click",".action-delete",function(n){var t=$("#Listado").data("kendoGrid").dataItem($(n.currentTarget).closest("tr"));showConfirm(`¿Está seguro que desea eliminar el Usuario <b>${t.name}</b>?`,function(){var n=getFilters();$.post(urlDelete,{Id:t.id,Filters:n.data},function(n){n.message===""?(loadGrid(n.items),showMessage(`Se ha eliminado el Usuario <b>${t.name}</b> correctamente.`)):showError(n.message)})})});$("#Listado").on("click",".action-send-email",function(n){var t=$("#Listado").data("kendoGrid").dataItem($(n.currentTarget).closest("tr"));$.post(urlSendEmail,{Id:t.id,WithCopy:!1},function(n){n.message!==""?showError(n.message):showMessage("Se ha enviado el correo exitosamente.")})});$("#Detail").on("click","#action-cancel",function(){$("#Detail").data("kendoWindow").close()});$("#Detail").on("click","#action-save",function(){var n=$(this).closest("form"),t=n.kendoValidator().data("kendoValidator");t.validate()&&saveUser()});