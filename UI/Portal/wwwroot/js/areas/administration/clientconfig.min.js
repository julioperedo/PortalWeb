function setupControls(){$("#Listado").kendoGrid({noRecords:{template:"No se encontraron registros para el criterio de búsqueda."},dataSource:[],columns:[{field:"name",title:"Nombre"},{field:"eMail",title:"Correo Electrónico"},{field:"typeDesc",title:"Tipo"},{field:"blackList",width:120,title:"En Lista Negra",attributes:alignCenter,headerAttributes:alignCenter,template:'# if(blackList) {# <i class="fas fa-check"><\/i> #} #'},{field:"id",title:" ",attributes:alignCenter,width:50,sortable:!1,headerAttributes:alignCenter,headerTemplate:'<i class="fas fa-plus action action-new" title="Nuevo Contacto"><\/i>',template:'<i class="fas fa-pen action action-edit" title="Editar Contacto"><\/i>&nbsp;&nbsp;<i class="fas fa-trash-alt action action-delete" title="Eliminar Contacto"><\/i>'}],mobile:!0,sortable:!0,selectable:!0});$("#ListadoUsuarios").kendoGrid({noRecords:{template:"No se encontraron registros para el criterio de búsqueda."},dataSource:[],width:700,columns:[{field:"login",title:"Login",width:300},{field:"lastGeneratedTokenDate",title:"Última generación de Token",format:"{0:dd-MM-yyyy}",width:180},{field:"enabled",width:120,title:"Habilitado",attributes:alignCenter,headerAttributes:alignCenter,template:'# if(enabled) {# <i class="fas fa-check"><\/i> #} #'},{field:"id",title:" ",attributes:alignCenter,width:50,sortable:!1,headerAttributes:alignCenter,headerTemplate:'<i class="fas fa-plus action action-new" title="Nuevo Usuario"><\/i>',template:'<i class="fas fa-pen action action-edit" title="Editar Usuario"><\/i>&nbsp;&nbsp;<i class="fas fa-trash-alt action action-delete" title="Eliminar Usuario"><\/i>'}],mobile:!0,sortable:!0,selectable:!0});$("#Detail").kendoWindow({visible:!1,width:950,title:"Contacto",modal:!0});$("#DetailUser").kendoWindow({visible:!1,width:950,title:"Usuario del WebSevice",modal:!0});$("#Type").kendoDropDownList({dataTextField:"name",dataValueField:"id",dataSource:{transport:{read:{url:urlGetTypes}}}});$.get(urlGetItems,{},n=>{n.message===""?(loadGrid(n.items),setGridHeight("Listado",_gridMargin)):showError("Se ha producido un error al traer los datos del servidor, por favor intente nuevamente.")});$.get(urlGetUsers,{},n=>{n.message===""?n.allowed&&($("#ListadoUsuarios").removeClass("d-none"),$("#not-allowed").addClass("d-none"),loadGridUsers(n.users)):showError("Se ha producido un error al traer los datos del servidor, por favor intente nuevamente.")})}function loadGrid(n){var t=$("#Listado").data("kendoGrid");t.setDataSource(new kendo.data.DataSource({data:n}))}function loadDetail(n){$("#Id").val(n.id);$("#Name").val(n.name);$("#EMail").val(n.eMail);$("#Type").data("kendoDropDownList").value(n.type)}function loadGridUsers(n){n.forEach(n=>{n.lastGeneratedTokenDate=JSON.toDate(n.lastGeneratedTokenDate),n.logDate=JSON.toDate(n.logDate)});var t=$("#ListadoUsuarios").data("kendoGrid");t.setDataSource(new kendo.data.DataSource({data:n}))}function loadDetailUser(n){$("#user-data").val(JSON.stringify(n));$("#user-name").val(n.login);$("#password").val(n.password);$("#enabled").prop("checked",n.enabled)}const alignCenter={style:"text-align: center;"},_gridMargin=30;$(()=>{setupControls(),setTimeout(()=>setGridHeight("Listado",_gridMargin),800)});$(window).resize(()=>{setGridHeight("Listado",_gridMargin)});$("#Listado").on("click",".action-new",function(){var n=$("#Detail").data("kendoWindow");loadDetail({Id:0,Name:"",EMail:"",Type:1});n.center().open()});$("#Listado").on("click",".action-edit",function(n){var u=$("#Detail").data("kendoWindow"),t=$("#Listado").data("kendoGrid"),i=$(n.currentTarget).closest("tr"),r;t.select(i);r=t.dataItem(i);loadDetail(r);u.center().open()});$("#Listado").on("click",".action-delete",function(n){var t=$("#Listado").data("kendoGrid").dataItem($(n.currentTarget).closest("tr"));showConfirm(`¿Está seguro que desea eliminar el Contacto <b>${t.name}</b> para <b>${t.typeDesc}</b>?`,function(){$.post(urlDelete,{Id:t.id},function(n){n.message===""?(loadGrid(n.items),showMessage(`Se ha eliminado el Usuario <b>${t.name}</b> correctamente.`)):showError(n.message)})})});$("#Detail").on("click","#action-cancel",function(){$("#Detail").data("kendoWindow").close()});$("#Detail").on("click","#action-save",function(){var n=$(this).closest("form"),i=n.kendoValidator().data("kendoValidator"),t;i.validate()&&(t=n.serializeObject(),$.post(urlEdit,{Item:t},n=>{n.message===""?(loadGrid(n.items),$("#Detail").data("kendoWindow").close()):showError("Se ha producido un error al intentar guardar los datos en el servidor.")}))});$("#ListadoUsuarios").on("click",".action-new",()=>{var n=$("#DetailUser").data("kendoWindow"),t={id:0,login:"",password:"",cardCode:cardCode,lastGeneratedTokenDate:null,enabled:!0};loadDetailUser(t);n.center().open()});$("#ListadoUsuarios").on("click",".action-edit",n=>{var u=$("#DetailUser").data("kendoWindow"),t=$("#ListadoUsuarios").data("kendoGrid"),i=$(n.currentTarget).closest("tr"),r;t.select(i);r=t.dataItem(i);loadDetailUser(r);u.center().open()});$("#ListadoUsuarios").on("click",".action-delete",n=>{var t=$("#ListadoUsuarios").data("kendoGrid").dataItem($(n.currentTarget).closest("tr"));showConfirm(`¿Está seguro que desea eliminar el usuario <b>${t.login}</b>?`,function(){$.post(urlDeleteUser,{Id:t.id},function(n){n.message===""?(loadGridUsers(n.items),showMessage(`Se ha eliminado el Usuario <b>${t.login}</b> correctamente.`)):showError(n.message)})})});$("#see-password").click(n=>{var t=$("#password");t.attr("type",t.attr("type")==="password"?"text":"password");$(n.currentTarget).find("i").toggleClass("fa-eye").toggleClass("fa-eye-slash")});$("#DetailUser").on("click","#action-cancel-user",()=>$("#DetailUser").data("kendoWindow").close());$("#DetailUser").on("click","#action-save-user",n=>{var i,r,t;n.preventDefault();i=$(n.currentTarget).closest("form");r=i.kendoValidator({messages:{required:"campo requerido"}}).data("kendoValidator");r.validate()&&(t=JSON.parse($("#user-data").val()),t.login=$("#user-name").val(),t.password=$("#password").val(),t.enabled=$("#enabled").prop("checked"),$.post(urlEditUser,{Item:t},n=>{n.message===""&n.errors===""?(loadGridUsers(n.items),$("#DetailUser").data("kendoWindow").close(),showMessage("Se han guardado los datos exitosamente.")):n.message===""?(console.error(n.errors),showError("Se ha producido un error al intentar guardar los datos en el servidor.")):showError(n.message)}))});